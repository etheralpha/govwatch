{"rss":{"@version":"2.0","@xmlns:discourse":"http://www.discourse.org/","@xmlns:atom":"http://www.w3.org/2005/Atom","@xmlns:dc":"http://purl.org/dc/elements/1.1/","channel":{"title":"Ethereum Research - Latest topics","link":"https://ethresear.ch/latest","description":"Latest topics","lastBuildDate":"Sun, 09 Jun 2024 07:59:33 +0000","atom:link":{"@href":"https://ethresear.ch/latest.rss","@rel":"self","@type":"application/rss+xml"},"item":[{"title":"The contention between preconfs and ePBS","dc:creator":"potuz","category":"Architecture","description":"<p>This quick note is motivated by a question of <a class=\"mention\" href=\"https://ethresear.ch/u/hasu.research\">@Hasu.research</a> regarding the compatibility of ePBS with the different mechanisms for preconfirmations that are being proposed by independent groups <a href=\"https://ethresear.ch/t/the-preconfirmation-sauna/19762\">1</a> <a href=\"https://ethresear.ch/t/blob-preconfirmations-with-inclusion-lists-to-mitigate-blob-contention-and-censorship/19150\">2</a> <a href=\"https://chainbound.github.io/bolt-docs/\" rel=\"noopener nofollow ugc\">3</a> <a href=\"https://docs.google.com/presentation/d/1a-0rP2knM11g59UmnKn7I7NH8BlFM5wNhczH35sbkSo/edit#slide=id.g2731bc99d1b_0_0\" rel=\"noopener nofollow ugc\">4</a> <a href=\"https://docs.primev.xyz/get-started/introduction\" rel=\"noopener nofollow ugc\">5</a>. The only purpose of this note is to leave a quick written record of the fundamental contention between the enshrinements of preconfirmations and the <a href=\"https://github.com/potuz/consensus-specs/pull/2\" rel=\"noopener nofollow ugc\">current proposal for ePBX</a>.</p>\n<h2><a name=\"overloading-inclusion-lists-1\" class=\"anchor\" href=\"https://ethresear.ch#overloading-inclusion-lists-1\"></a>Overloading inclusion lists.</h2>\n<p>Even in the very first post on <a href=\"https://ethresear.ch/t/based-preconfirmations/17353\">based preconfirmations</a>, the idea of using <a href=\"https://eips.ethereum.org/EIPS/eip-7547\" rel=\"noopener nofollow ugc\">forced inclusion lists</a> was put forward as a way for proposers to signal their intent of honoring preconfirmations, forcing builders to include these transactions. An extrapolation of this idea led, in one of the original designs for ILs, to propose that inclusion lists may essentially include a complete list of transactions the proposer has in its current mempool. One of the problems with these ideas is that the full list of transactions would need to be broadcast over the P2P network twice: once when the inclusion list is broadcast, and the second time within the payload itself. In all known designs for inclusion lists, validators attest for the existence of the full executable transaction list. This implies in particular that</p>\n<ol>\n<li>The list must be available at the beacon block validation time.</li>\n<li>The list must be executed at the beacon block validation time.</li>\n</ol>\n<p>This section is not meant to be read as <em>inclusion lists aren’t compatible with ePBS</em> but rather any preconfirmation system (and next block forced inclusion lists by definition are such a system) that relies on the execution and distribution of the transactions at the consensus block validation time, necessarily clashes with the main optimization from ePBS.</p>\n<h2><a name=\"epbs-validation-optimization-2\" class=\"anchor\" href=\"https://ethresear.ch#epbs-validation-optimization-2\"></a>ePBS validation optimization</h2>\n<p>The above two points are in direct opposition with the main optimization that ePBS brings to block processing, that is that the only hot path to validation is that of the consensus block that has to be fully verified before the attestation deadline. All other validations, like transaction execution, data availability, etc. are deferred to the remainder of the slot and into the next slot.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/8/f/8f3daa474ae131dfbee7c96cfd9f2a7e4035c06a.jpeg\" data-download-href=\"https://ethresear.ch/uploads/default/8f3daa474ae131dfbee7c96cfd9f2a7e4035c06a\" title=\"ePBS slot\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/8/f/8f3daa474ae131dfbee7c96cfd9f2a7e4035c06a_2_690x364.jpeg\" alt=\"ePBS slot\" data-base62-sha1=\"kraovl1lfJNBvSrOxQ6y37JNNuW\" width=\"690\" height=\"364\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/8/f/8f3daa474ae131dfbee7c96cfd9f2a7e4035c06a_2_690x364.jpeg, https://ethresear.ch/uploads/default/optimized/3X/8/f/8f3daa474ae131dfbee7c96cfd9f2a7e4035c06a_2_1035x546.jpeg 1.5x, https://ethresear.ch/uploads/default/optimized/3X/8/f/8f3daa474ae131dfbee7c96cfd9f2a7e4035c06a_2_1380x728.jpeg 2x\" data-dominant-color=\"EEF5F4\"></a></div><p></p>\n<p>While ePBS is compatible with inclusion lists, their addition inherently stresses this optimization. Broadcasting a small list of 16 transactions that can be immediately executed in microseconds is not the same as broadcasting a full block, and presumably, even blob transactions as some based rollups would require.</p>\n<h2><a name=\"the-centralized-nature-of-preconfs-3\" class=\"anchor\" href=\"https://ethresear.ch#the-centralized-nature-of-preconfs-3\"></a>The centralized nature of preconfs</h2>\n<p>There is no current design (that I am aware of) of preconfirmations, that does not rely on a centralized entity. This is natural to expect in the absence of an encrypted public mempool, users can’t send their transactions in the open to the next proposer (although they could <em>encrypt the transactions to the public BLS address of the next proposer</em>), and we can’t enshrine an RPC provider, all systems thus make use on existing centralized entities (for example relays) to act as a preconfer. Decentralization comes in that it is ultimately the proposer who enforces these preconfirmations, by forcing the builder to fullfil them.</p>\n<p>Thus, in all proposed systems for preconfirmations, either of L1 transactions or for based rollups, there exist a centralized entity that at the very least is responsible for gathering the transactions and giving out the preconfirmations. Systems differ on how is that these preconfirmations are enforced, they range from new L1 slashing proposals, to restaking proposals (moving the slashing to a separate layer), etc. The point is that preconfirmations can be enforced by the protocol itself, or by a somewhat decentralized party like the subset of validators participating in the preconfirmation scheme. In summary, there is a plethora of options for enforcing the (or penalizing the lack of) inclusion of preconfirmations, in decreasing level of trustlessness:</p>\n<ul>\n<li>The L1 protocol itself enforces inclusion. For example, forced ILs, with proposer level slashings on missed slots, preconf equivocations, etc.</li>\n<li>Some separate committee enforces them. For example a subset of the L1 validators also participate in a sidechain by restaking, and the enforcement/punishment is carried in that sidechain.</li>\n<li>A centralized entity enforces them. For example the relay itself only sends bids from builders that have satisfied the required preconfs.</li>\n</ul>\n<h2><a name=\"a-viable-way-compatible-with-epbs-staked-builders-as-preconfirmers-4\" class=\"anchor\" href=\"https://ethresear.ch#a-viable-way-compatible-with-epbs-staked-builders-as-preconfirmers-4\"></a>A viable way compatible with ePBS: staked builders as preconfirmers.</h2>\n<p>Any approach with a full payload being broadcast with the consensus block for preconfirmation enforcement clashes directly with the main scaling optimization of ePBS with regard to block validation. As thus, it seems difficult to expect a working design in which the proposers are in charge of sending and enforcing preconfirmations. The second and third approaches above are fully compatible with ePBS.</p>\n<p>One of the features that preconfirmation systems can leverage when ePBS is in place, is that builders themselves are staked validators, thus they can be subject to the same rules that these systems currently require from proposers. For example, those systems that rely on slashings on a restaking scheme could simply add conditions on participating builders. That is, the proposer set participating in the scheme only take bids from builders that are participants of the scheme. The builders and proposers are required to be restaked. There are new penalty conditions for</p>\n<ul>\n<li>A proposer that does not include a block.</li>\n<li>A proposer that includes a block with a commitment to a non-participating builder.</li>\n<li>A builder that does not include the payload</li>\n<li>A builder that includes a payload does not satisfies the preconf list.</li>\n</ul>\n<h2><a name=\"a-separate-note-on-restaking-5\" class=\"anchor\" href=\"https://ethresear.ch#a-separate-note-on-restaking-5\"></a>A separate note on restaking</h2>\n<p>ePBS also presents a challenge on any restaking scheme: builders can transfer funds in the same payload that they commit a slashable offense. L1 protocol can deal with this by immediately deducting the bid from the builder’s balance at the time of CL block processing, but delaying the credit to the proposer. In case the builder commits a slashable offense, the buffer allows the L1 protocol to implement penalization procedures that can impact those delayed funds accordingly. If the builder is restaked however, the restaking chain does not have access to these funds.</p>\n            <p><small>3 posts - 2 participants</small></p>\n            <p><a href=\"https://ethresear.ch/t/the-contention-between-preconfs-and-epbs/19770\">Read full topic</a></p>","link":"https://ethresear.ch/t/the-contention-between-preconfs-and-epbs/19770","pubDate":"Sun, 09 Jun 2024 07:59:33 +0000","discourse:topicPinned":"No","discourse:topicClosed":"No","discourse:topicArchived":"No","guid":{"@isPermaLink":"false","#text":"ethresear.ch-topic-19770"},"source":{"@url":"https://ethresear.ch/t/the-contention-between-preconfs-and-epbs/19770.rss","#text":"The contention between preconfs and ePBS"},"filter":false},{"title":"On block-space distribution mechanisms","dc:creator":"mikeneuder","category":"Block proposer","description":"<h1><a name=\"on-block-space-distribution-mechanisms-1\" class=\"anchor\" href=\"https://ethresear.ch#on-block-space-distribution-mechanisms-1\"></a>On block-space distribution mechanisms</h1>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/c/3/c3fa4239ef0f468256ba44d0e860fb3d7edaedcf.jpeg\" data-download-href=\"https://ethresear.ch/uploads/default/c3fa4239ef0f468256ba44d0e860fb3d7edaedcf\" title=\"upload_3067440b5b4f752379ddba32df7ecf8b\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/c/3/c3fa4239ef0f468256ba44d0e860fb3d7edaedcf_2_499x500.jpeg\" alt=\"upload_3067440b5b4f752379ddba32df7ecf8b\" data-base62-sha1=\"rXHhzRegZZYL0qvOGMxv8ppT3v9\" width=\"499\" height=\"500\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/c/3/c3fa4239ef0f468256ba44d0e860fb3d7edaedcf_2_499x500.jpeg, https://ethresear.ch/uploads/default/optimized/3X/c/3/c3fa4239ef0f468256ba44d0e860fb3d7edaedcf_2_748x750.jpeg 1.5x, https://ethresear.ch/uploads/default/optimized/3X/c/3/c3fa4239ef0f468256ba44d0e860fb3d7edaedcf_2_998x1000.jpeg 2x\" data-dominant-color=\"94AFB8\"></a></div><br>\n<sub><strong>^p.s. yes, we anthropomorphize the protocol as a ghost because <a href=\"https://arxiv.org/pdf/1710.09437.pdf\" rel=\"noopener nofollow ugc\">Casper</a>.</strong></sub><br>\n<sub><strong>^^p.p.s. not sure why the auctioneer ghost looks like he is conducting an orchestra, but here we are ¯\\_(ツ)_/¯.</strong></sub><br>\n<sub><strong>^^^ p.p.p.s. by the way, if you haven’t seen <a href=\"https://en.wikipedia.org/wiki/Maestro_(2023_film)\" rel=\"noopener nofollow ugc\">Maestro</a>, it’s great.</strong></sub><p></p>\n<p><span class=\"math\">\\cdot</span><br>\n<em>by <a href=\"https://x.com/mikeneuder\" rel=\"noopener nofollow ugc\">Mike</a>, <a href=\"https://x.com/PGarimidi\" rel=\"noopener nofollow ugc\">Pranav</a>, &amp; <a href=\"https://x.com/Tim_Roughgarden\" rel=\"noopener nofollow ugc\">Dr. Tim Roughgarden</a> – June 8, 2024.</em><br>\n<span class=\"math\">\\cdot</span><br>\n<strong>Acknowledgements</strong><br>\n<em>Special thanks to <a href=\"https://x.com/barnabemonnot\" rel=\"noopener nofollow ugc\">Barnabé</a>, <a href=\"https://x.com/_julianma\" rel=\"noopener nofollow ugc\">Julian</a>, <a href=\"https://x.com/_JonahB_\" rel=\"noopener nofollow ugc\">Jonah</a>, <a href=\"https://x.com/DavideCrapis\" rel=\"noopener nofollow ugc\">Davide</a>, <a href=\"https://x.com/soispoke\" rel=\"noopener nofollow ugc\">Thomas</a>, <a href=\"https://x.com/terencechain\" rel=\"noopener nofollow ugc\">Terence</a>, <a href=\"https://x.com/potuz_eth\" rel=\"noopener nofollow ugc\">Potuz</a>, &amp; <a href=\"https://www.nano210.blog/\" rel=\"noopener nofollow ugc\">Nate</a> for comments and discussions.</em><br>\n<span class=\"math\">\\cdot</span><br>\n<strong>tl;dr;</strong> <em>Block space, the capacity for transaction inclusion, is the principal resource exported by blockchains. As the crypto ecosystem scales up and professionalizes, the value produced by efficient usage of block space (<a href=\"https://arxiv.org/abs/1904.05234\" rel=\"noopener nofollow ugc\">MEV</a>) has come to play a significant role in the economics of permissionless consensus mechanisms. An immense amount of ink has been spilled by the research community considering what, if anything, protocols should enshrine in response to MEV (see <a href=\"https://ethresear.ch#related-work-2\">Related Work</a>). Indeed, the past few years resemble a <a href=\"https://en.wikipedia.org/wiki/Blind_men_and_an_elephant\" rel=\"noopener nofollow ugc\">Blind Men and the Elephant</a> narrative arc, where many different perspectives, solutions, and theories have been propounded, but each angle can feel disjoint and difficult to compare. The first half of this article aims to present a broad-strokes painting of the “MEV-ephant” by distilling the design space into a core set of questions and exploring how existing proposals answer them. The second half hones in specifically on allocation mechanisms enabled by execution tickets, demonstrating an important new insight – there is a trade-off between the quality of the in-protocol MEV oracle and the fairness of the mechanism.</em></p>\n<p><strong>Organization:</strong> <a href=\"https://ethresear.ch#h-1-motivation-3\">Section 1</a> motivates the need for an in-protocol mechanism to handle block-space distribution as part of the “endgame” for Proof-of-Stake. <a href=\"https://ethresear.ch#h-2-enumeration-6\">Section 2</a> enumerates five axes along which block-space distribution mechanisms may be measured, using a familiar set of questions: <em>who, what, when, where, how</em> (abbr. the <code>W^4H questions</code>). <a href=\"https://ethresear.ch#h-3-interrogation-11\">Section 3</a> interrogates how the block builder is selected, focusing on the execution tickets model. <a href=\"https://ethresear.ch#h-4-extrapolation-18\">Section 4</a> extrapolates by concluding and raising open questions that follow from the framework established.</p>\n<p><strong>Structural note:</strong> This article is rather long for this format and has some technical elements. We encourage the reader to focus on the portion of the article they are most interested in:</p>\n<ul>\n<li>Sections <a href=\"https://ethresear.ch#h-1-motivation-3\">1</a>, <a href=\"https://ethresear.ch#h-2-enumeration-6\">2</a>, &amp; <a href=\"https://ethresear.ch#h-4-extrapolation-18\">4</a> provide a broader perspective on the existing proposals and our proposed methodology for analyzing them.</li>\n<li><a href=\"https://ethresear.ch#h-3-interrogation-11\">Section 3</a> (which is <span class=\"math\">\\approx 44\\%</span> of the content, but <a href=\"https://youtu.be/VDvr08sCPOc?t=111\" rel=\"noopener nofollow ugc\"><span class=\"math\">100\\%</span></a> of the math) provides a detailed analysis of allocation mechanisms enabled by the execution tickets design. This section can be read in sequence, in isolation, or skipped altogether – up to you!</li>\n</ul>\n<p><span class=\"math\">\\cdot</span><br>\n<strong>Contents</strong></p>\n<ol>\n<li><a href=\"https://ethresear.ch#h-1-motivation-3\"><strong>Motivation</strong></a><br>\n<a href=\"https://ethresear.ch#h-1-what-4\"><em>1) What</em></a><br>\n<a href=\"https://ethresear.ch#Block-space-distribution-today\"><em>Block-space distribution today through <code>mev-boost</code></em></a></li>\n<li><a href=\"https://ethresear.ch#h-2-enumeration-6\"><strong>Enumeration</strong></a><br>\n<a href=\"https://ethresear.ch#the-elementshttpsenwikipediaorgwikieuclid27s_elements-of-block-space-distribution-7\"><em>The elements of block-space distribution</em></a><br>\n<a href=\"https://ethresear.ch#execution-tickets-and-other-animals-8\"><em>Execution tickets and other animals</em></a><br>\n<a href=\"https://ethresear.ch#applying-w4h-a-comparative-analysis-9\"><em>Applying W^4H: a comparative analysis</em></a><br>\n<a href=\"https://ethresear.ch#motivational-interlude-10\"><em>Motivational interlude</em></a></li>\n<li><a href=\"https://ethresear.ch#h-3-interrogation-11\"><strong>Interrogation</strong></a><br>\n<a href=\"https://ethresear.ch#preliminaries-12\"><em>Preliminaries</em></a><br>\n<a href=\"https://ethresear.ch#model-13\"><em>Model</em></a><br>\n<a href=\"https://ethresear.ch#familiar-allocation-mechanisms-14\"><em>Familiar allocation mechanisms</em></a><br>\n<a href=\"https://ethresear.ch#comparing-the-outcomes-15\"><em>Comparing the outcomes</em></a><br>\n<a href=\"https://ethresear.ch#aside-1-calculating-equilibrium-bids-16\"><em>Aside #1: Calculating equilibrium bids</em></a><br>\n<a href=\"https://ethresear.ch#aside-2-tullock-contests-17\"><em>Aside #2: Tullock Contests</em></a></li>\n<li><a href=\"https://ethresear.ch#h-4-extrapolation-18\"><strong>Extrapolation</strong></a></li>\n</ol>\n<p><span class=\"math\">\\cdot</span></p>\n<h4><a name=\"related-work-2\" class=\"anchor\" href=\"https://ethresear.ch#related-work-2\"></a><strong>Related work</strong></h4>\n<ol>\n<li><em>mev-boost &amp; relays</em>\n<ul>\n<li><a href=\"https://ethresear.ch/t/mev-boost-merge-ready-flashbots-architecture/11177\"><em>MEV-Boost: Merge ready Flashbots Architecture</em></a>; Flashbots team</li>\n<li><a href=\"https://ethresear.ch/t/relays-in-a-post-epbs-world/16278\"><em>Relays in a post-ePBS world</em></a>; Mike, Jon, Hasu, Tomasz, Chris, Toni</li>\n</ul>\n</li>\n<li><em>mev-burn / mev-smoothing</em>\n<ul>\n<li><a href=\"https://ethresear.ch/t/burning-mev-through-block-proposer-auctions/14029\"><em>Burning MEV through block proposer auctions</em></a>; Domothy</li>\n<li><a href=\"https://ethresear.ch/t/mev-burn-a-simple-design/15590\"><em>MEV burn – a simple design</em></a>; Justin</li>\n<li><a href=\"https://ethresear.ch/t/committee-driven-mev-smoothing/10408\"><em>Committee-driven MEV smoothing</em></a>; Francesco</li>\n<li><a href=\"https://ethresear.ch/t/dr-changestuff-or-how-i-learned-to-stop-worrying-and-love-mev-burn/17384\"><em>Dr. changestuff or: how I learned to stop worrying and love mev-burn</em></a>; Mike, Toni, Justin</li>\n</ul>\n</li>\n<li><em>enshrined Proposer-Builder Separation (ePBS)</em>\n<ul>\n<li><a href=\"https://ethresear.ch/t/two-slot-proposer-builder-separation/10980\"><em>Two-slot proposer/builder separation</em></a>; Vitalik</li>\n<li><a href=\"https://ethresear.ch/t/unbundling-pbs-towards-protocol-enforced-proposer-commitments-pepc/13879\"><em>Unbundling PBS: towards protocol-enforced proposer commitments (PEPC)</em></a>; Barnabé</li>\n<li><a href=\"https://barnabe.substack.com/p/pbs\" rel=\"noopener nofollow ugc\"><em>Notes on Proposer-Builder Separation</em></a>; Barnabé</li>\n<li><a href=\"https://mirror.xyz/barnabe.eth/QJ6W0mmyOwjec-2zuH6lZb0iEI2aYFB9gE-LHWIMzjQ\" rel=\"noopener nofollow ugc\"><em>More pictures about proposers and builders</em></a>; Barnabé</li>\n<li><a href=\"https://ethresear.ch/t/why-enshrine-proposer-builder-separation-a-viable-path-to-epbs/15710\"><em>Why enshrine Proposer-Builder Separation?</em></a>; Mike, Justin</li>\n<li><a href=\"https://ethresear.ch/t/epbs-design-constraints/18728\"><em>ePBS design constraints</em></a>; Potuz</li>\n<li><a href=\"https://mirror.xyz/barnabe.eth/LJUb_TpANS0VWi3TOwGx_fgomBvqPaQ39anVj3mnCOg\" rel=\"noopener nofollow ugc\"><em>Reconsidering the market structure of PBS</em></a>; Barnabé</li>\n</ul>\n</li>\n<li><em>block-space futures</em>\n<ul>\n<li><a href=\"https://mirror.xyz/0x03c29504CEcCa30B93FF5774183a1358D41fbeB1/CPYI91s98cp9zKFkanKs_qotYzw09kWvouaAa9GXBrQ\" rel=\"noopener nofollow ugc\"><em>Block vs. Slot Auction PBS</em></a>; Julian</li>\n<li><a href=\"https://frontier.tech/ethereums-blockspace-future\" rel=\"noopener nofollow ugc\"><em>Opportunities and Considerations of Ethereum’s Blockspace Future</em></a>; Drew, Ankit</li>\n<li><a href=\"https://collective.flashbots.net/t/when-to-sell-your-blocks/2814\" rel=\"noopener nofollow ugc\"><em>When to sell your blocks</em></a>; Quintus, Conor</li>\n</ul>\n</li>\n<li><em>execution tickets</em>\n<ul>\n<li><a href=\"https://www.youtube.com/watch?v=MtvbGuBbNqI\" rel=\"noopener nofollow ugc\"><em>Attester-proposer separation</em></a>; Justin</li>\n<li><a href=\"https://ethresear.ch/t/execution-tickets/17944\"><em>Execution tickets</em></a>; Justin, Mike</li>\n<li><a href=\"https://ethresear.ch/t/economic-analysis-of-execution-tickets/18894\"><em>Economic Analysis of Execution Tickets</em></a>; Jonah, Davide</li>\n<li><a href=\"https://ethresear.ch/t/block-auction-epbs-versus-execution-ticket/19232\"><em>Block-auction ePBS versus Execution Ticket</em></a>; Terence</li>\n</ul>\n</li>\n</ol>\n<hr>\n<h3><a name=\"h-1-motivation-3\" class=\"anchor\" href=\"https://ethresear.ch#h-1-motivation-3\"></a>(1) – Motivation</h3>\n<p>Before descending into this murky rabbit hole, let’s start by simply motivating the necessity of a block-space distribution mechanism. Validators in Proof-of-Stake protocols are tasked with producing and voting on blocks. The figure below, from Barnabé’s excellent “<a href=\"https://mirror.xyz/barnabe.eth/QJ6W0mmyOwjec-2zuH6lZb0iEI2aYFB9gE-LHWIMzjQ\" rel=\"noopener nofollow ugc\"><em>More pictures about proposers and builders</em></a>,” describes these as “proposing” and “attesting” rights, respectively.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/7/d/7d85ca7f1812a5822490fa079365301c99733620.png\" data-download-href=\"https://ethresear.ch/uploads/default/7d85ca7f1812a5822490fa079365301c99733620\" title=\"upload_72dad4dc4f8c77f0d57f8f126b3c2e46\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/7/d/7d85ca7f1812a5822490fa079365301c99733620_2_690x219.png\" alt=\"upload_72dad4dc4f8c77f0d57f8f126b3c2e46\" data-base62-sha1=\"hUqkro39EJ5rltxQKhLzwWWHCNy\" width=\"690\" height=\"219\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/7/d/7d85ca7f1812a5822490fa079365301c99733620_2_690x219.png, https://ethresear.ch/uploads/default/optimized/3X/7/d/7d85ca7f1812a5822490fa079365301c99733620_2_1035x328.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/7/d/7d85ca7f1812a5822490fa079365301c99733620_2_1380x438.png 2x\" data-dominant-color=\"D6D1D5\"></a></div><p></p>\n<h4><a name=\"h-1-what-4\" class=\"anchor\" href=\"https://ethresear.ch#h-1-what-4\"></a>1) What</h4>\n<p>(<span class=\"math\">\\uparrow</span> <a href=\"https://twitter.com/SBF_FTX/status/1591989554881658880?lang=en\" rel=\"noopener nofollow ugc\">important cultural ref</a>.)</p>\n<p>A block-space distribution mechanism is the process by which the protocol determines the owner of the “proposing” or “block construction” rights. Proof-of-Stake protocols typically use some version of the following rules:</p>\n<ul>\n<li><strong>block-space (proposing) rights</strong> – A random validator is elected as the leader and permitted to create the next block.</li>\n<li><strong>voting (attesting) rights</strong> – All validators vote during some time window for the block they see as the canonical head.</li>\n</ul>\n<p>Validators perform these tasks because they receive rewards for doing so. We categorize the rewards according to their origin in either the consensus layer (the issuance from the protocol – e.g., newly minted <code>ETH</code>) or the execution layer (transaction fees and MEV):</p>\n<ol>\n<li><strong>Consensus layer</strong><br>\na. <em>Attestation rewards</em> – see <a href=\"https://github.com/ethereum/annotated-spec/blob/160764ac180eca2cea3581f731ee96ac7098f9f7/phase0/beacon-chain.md#components-of-attestation-deltas\" rel=\"noopener nofollow ugc\">attestation deltas</a>.<br>\nb. <em>Block rewards</em> – see <a href=\"https://github.com/ethereum/annotated-spec/blob/160764ac180eca2cea3581f731ee96ac7098f9f7/phase0/beacon-chain.md#rewards-and-penalties-1\" rel=\"noopener nofollow ugc\"><code>get_proposer_reward</code></a>.</li>\n<li><strong>Execution layer</strong><br>\na. <em>Transaction fees</em> – see <a href=\"https://etherscan.io/gastracker\" rel=\"noopener nofollow ugc\">gas tracker</a>.<br>\nb. <em>MEV (transaction ordering)</em> – see <a href=\"https://mevboost.pics/\" rel=\"noopener nofollow ugc\">mevboost.pics</a>.</li>\n</ol>\n<p>Rewards <code>1a</code>, <code>1b</code>, &amp; <code>2a</code> are well understood and “<a href=\"https://barnabe.substack.com/p/seeing-like-a-protocol\" rel=\"noopener nofollow ugc\">in the view</a>” of the protocol. MEV rewards present a more serious challenge because fully capturing the value realized by transaction ordering is difficult. Unlike the other rewards, even the amount of MEV in a block is unknowable for all intents and purposes (as a permissionless and pseudonymous system, it’s impossible to trace who controls each account and any corresponding offchain activity that may be profitable in tandem). MEV also changes dramatically over time (e.g., as a function of price volatility), resulting in execution layer rewards having a much higher variance than the consensus layer rewards. Further, the Ethereum protocol, as implemented, has no insight into the MEV being produced and extracted by its transactions. To improve protocol visibility into MEV, many mechanisms try to approximate the MEV in a given block; we refer to these as <em>MEV oracles</em>. Block-space distribution mechanisms generally have the potential to produce such an oracle, making the protocol “MEV-aware.”</p>\n<p>This suggests the question, <em>why does the protocol care about being MEV-aware?</em> One answer: <strong>MEV awareness may increase the protocol’s ability to preserve the homogeneity of validator rewards, even if validators have varying degrees of sophistication.</strong> For example, if the protocol could accurately burn all MEV, then the validator incentives would be fully in the protocol’s view (just like <code>1a</code>, <code>1b</code>, &amp; <code>2a</code> above). Alternatively, a mechanism that shares all MEV among validators regardless of their sophistication (e.g., <a href=\"https://ethresear.ch/t/committee-driven-mev-smoothing/10408\">mev-smoothing</a>) would seem to promote a larger, more diverse and decentralized validator set, while keeping the MEV rewards as an extra incentivization to stake. Without MEV awareness, the validators best equipped to extract or smooth MEV (e.g., due to relationships with block builders, proprietary algorithms/software, access to exclusive order flow, &amp; economies of scale) may earn disproportionately high rewards and exert significant centralization pressures on the protocol.</p>\n<p>Ethereum protocol design strives to keep a decentralized validator set at all costs. It probably goes without saying, but for completeness: <strong>the protocol’s credible neutrality, censorship resistance, and permissionlessness are directly downstream of a decentralized validator set.</strong></p>\n<h4><a name=\"block-space-distribution-today-5\" class=\"anchor\" href=\"https://ethresear.ch#block-space-distribution-today-5\"></a>Block-space distribution today</h4>\n<p>In Ethereum today, <a href=\"https://mevboost.pics/\" rel=\"noopener nofollow ugc\"><code>mev-boost</code></a> accounts for <span class=\"math\">\\approx 90\\%</span> of all blocks. Using <code>mev-boost</code>, proposers (the validator randomly selected as the leader) sell their block-building rights to the highest paying bidder through an auction. The figure below demonstrates this flow (we exclude the <a href=\"https://www.relayscan.io/\" rel=\"noopener nofollow ugc\">relays</a> because they functionally serve as an extension of the builders).</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/b/7/b70bdfef2fd8dc26a478c2b870495ea39ebd07bc.png\" data-download-href=\"https://ethresear.ch/uploads/default/b70bdfef2fd8dc26a478c2b870495ea39ebd07bc\" title=\"upload_5f698b1a28978bd8f9779e596c471d9a\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/b/7/b70bdfef2fd8dc26a478c2b870495ea39ebd07bc_2_252x499.png\" alt=\"upload_5f698b1a28978bd8f9779e596c471d9a\" data-base62-sha1=\"q7iOKKk8JeMriCTq5Tc7z3t7NqQ\" width=\"252\" height=\"499\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/b/7/b70bdfef2fd8dc26a478c2b870495ea39ebd07bc_2_252x499.png, https://ethresear.ch/uploads/default/optimized/3X/b/7/b70bdfef2fd8dc26a478c2b870495ea39ebd07bc_2_378x748.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/b/7/b70bdfef2fd8dc26a478c2b870495ea39ebd07bc_2_504x998.png 2x\" data-dominant-color=\"F6F2F4\"></a></div><br>\n.<br>\nProposers are incentivized to outsource their block building because builders (the canonical name for MEV-extracting agents specializing in sequencing transactions) pay them more than they would have earned had they built the block themselves. Circling back to our goal of “<strong>preserving the homogeneity of validator rewards in the presence of MEV</strong>,” we see that <code>mev-boost</code> allows access to the builder market for <em>all validators</em>, effectively preserving near-equivalent MEV rewards among solo stakers and professional staking service providers – great! But…<p></p>\n<p>Of course, there is a but… <code>mev-boost</code> has issues that continue to rankle some of the Ethereum community. Without being exhaustive, a few of the negative side-effects of taking the <code>mev-boost</code> medicine are:</p>\n<ul>\n<li><strong>Relays</strong> – These <a href=\"https://www.relayscan.io/\" rel=\"noopener nofollow ugc\">trusted-third parties</a> broker the sale of blocks between proposers and builders. The immense reliance on relays increases the fragility of the protocol as a whole, as demonstrated through <a href=\"https://collective.flashbots.net/t/disclosure-mitigation-of-block-equivocation-strategy-with-early-getpayload-calls-for-proposers/1705\" rel=\"noopener nofollow ugc\">repeated</a>, <a href=\"https://research.lido.fi/t/bloxroute-feb-6th-post-mortem/6586\" rel=\"noopener nofollow ugc\">incidents</a>, <a href=\"https://gist.github.com/benhenryhunter/5c397db3985a59d14a52816305a6c1b8\" rel=\"noopener nofollow ugc\">involving</a>, <a href=\"https://gist.github.com/benhenryhunter/7b7d9c9e3218aad52f75e3647b83a6cc\" rel=\"noopener nofollow ugc\">relays</a>. Further, since relays have no inherent revenue stream, more exotic (and closed-source) methods of capturing margins (e.g., <a href=\"https://bloxroute.com/pulse/introducing-the-validator-gateway-boost-your-ethereum-validator-rewards/\" rel=\"noopener nofollow ugc\">timing games as a service</a> and <a href=\"https://twitter.com/sui414/status/1778708084510302445\" rel=\"noopener nofollow ugc\">bid adjustments</a>) are being implemented.</li>\n<li><strong>Out-of-protocol software is brittle</strong> – Beyond the relays, participation in the <code>mev-boost</code> market requires validators to run additional software. The standard suite for solo staking now involves running four binaries: (i) the consensus beacon node, (ii) the consensus validator client, (iii) the execution client, and (iv) mev-boost. Beyond the significant overhead for solo stakers, reliance on this software also provides another potential point of failure during hard forks. See the <a href=\"https://collective.flashbots.net/t/impact-of-the-prysm-invalid-signature-bug-on-the-mev-boost-ecosystem-at-the-shapella-fork/1623\" rel=\"noopener nofollow ugc\">Shapella incident</a> and the <a href=\"https://writings.flashbots.net/preparing-for-dencun\" rel=\"noopener nofollow ugc\">Dencun upgrade</a> for an example of the complexity induced by having more out-of-protocol software.</li>\n<li><strong>Builder centralization and censorship</strong> – While this is likely <a href=\"https://vitalik.eth.limo/general/2021/12/06/endgame.html\" rel=\"noopener nofollow ugc\">inevitable</a>, builder centralization was accelerated by the mass adoption of <code>mev-boost</code>. <a href=\"https://www.relayscan.io/\" rel=\"noopener nofollow ugc\">Three builders</a> account for <span class=\"math\">\\approx 95\\%</span> of <code>mev-boost</code> blocks (<span class=\"math\">85\\%</span> of all Ethereum blocks). <code>mev-boost</code> implements an open-outcry, first-price, winner-takes-all auction, leading to high levels of builder concentration and <a href=\"https://ethresear.ch/t/game-theoretic-model-for-mev-boost-auctions-mma/16206\">strategic</a>, <a href=\"https://ethresear.ch/t/bid-cancellations-considered-harmful/15500\">bidding</a>. Without <a href=\"https://ethresear.ch/t/no-free-lunch-a-new-inclusion-list-design/16389\">inclusion lists</a> or another censorship-resistance gadget, builders have extreme influence over transaction inclusion and exclusion – see <a href=\"https://censorship.pics/\" rel=\"noopener nofollow ugc\">censorship.pics</a>.</li>\n<li><strong>Timing games</strong> – While <a href=\"https://arxiv.org/abs/2305.09032\" rel=\"noopener nofollow ugc\">timing games</a> are known to be a fundamental issue in Proof-of-Stake protocols, <code>mev-boost</code> pushes staking service providers to compete on thin margins. Additionally, relays (who conduct <code>mev-boost</code> auctions on the proposer’s behalf) serve as sophisticated middlemen facilitating timing games. Thus, we have seen <a href=\"https://p2p.org/economy/unlock-p2p-orgs-mev-enhancement-feature/\" rel=\"noopener nofollow ugc\">marketing</a> endorsing playing timing games to boost the yield from staking with a specific provider.</li>\n</ul>\n<p><em>“OK, OK … blah blah … we have heard this story before … <a href=\"https://youtu.be/q8wJqMbr6eY?si=LVryerWbrw3_ge-I\" rel=\"noopener nofollow ugc\">tell me something I don’t know</a>.” (<span class=\"math\">\\leftarrow</span> h/t Barnabé for the aptly-named, 14k-views on youtube, musical reference.)</em></p>\n<h3><a name=\"h-2-enumeration-6\" class=\"anchor\" href=\"https://ethresear.ch#h-2-enumeration-6\"></a>(2) – Enumeration</h3>\n<p>Obligatory ‘stage-setting’ out of the way, let’s look a little more carefully at the ~essence~ of a block-space distribution mechanism.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/5/5/55cc9892e24d897856dff5e70b48fe8682903b6e.jpeg\" data-download-href=\"https://ethresear.ch/uploads/default/55cc9892e24d897856dff5e70b48fe8682903b6e\" title=\"upload_cdbf47258422c2a96ea2903ce113a113\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/5/5/55cc9892e24d897856dff5e70b48fe8682903b6e_2_552x367.jpeg\" alt=\"upload_cdbf47258422c2a96ea2903ce113a113\" data-base62-sha1=\"cf0VErVtcwbNNGlnvZ7LASL7nYi\" width=\"552\" height=\"367\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/5/5/55cc9892e24d897856dff5e70b48fe8682903b6e_2_552x367.jpeg, https://ethresear.ch/uploads/default/optimized/3X/5/5/55cc9892e24d897856dff5e70b48fe8682903b6e_2_828x550.jpeg 1.5x, https://ethresear.ch/uploads/default/original/3X/5/5/55cc9892e24d897856dff5e70b48fe8682903b6e.jpeg 2x\" data-dominant-color=\"57362A\"></a></div><br>\n<sub><strong>^ “<a href=\"https://youtu.be/mvy4YH9--Vw?t=108\" rel=\"noopener nofollow ugc\"><em>Is that what I think it is?</em></a>”</strong></sub><p></p>\n<h4><a name=\"the-elementshttpsenwikipediaorgwikieuclid27s_elements-of-block-space-distribution-7\" class=\"anchor\" href=\"https://ethresear.ch#the-elementshttpsenwikipediaorgwikieuclid27s_elements-of-block-space-distribution-7\"></a>The <a href=\"https://en.wikipedia.org/wiki/Euclid%27s_Elements\" rel=\"noopener nofollow ugc\">elements</a> of block-space distribution</h4>\n<p>Consider the game of acquiring block space; MEV incentivizes agents to participate, while the combination of in-protocol and out-of-protocol software defines the rules. When designing this game, what elements should be considered? To answer this question, we use a familiar rhetorical pattern of “who, what, when, where, &amp; how” (hopefully <a href=\"https://ethresear.ch#h-1-motivation-3\">Section 1</a> sufficiently answered “why”), which we refer to as the <code>W^4H questions</code>. (<span class=\"math\">\\leftarrow</span> h/t Barnabé pt. 2 for the connection to “<a href=\"https://www.goodreads.com/book/show/22749723-who-gets-what-and-why\" rel=\"noopener nofollow ugc\"><em>Who Gets What – and Why</em></a>”).</p>\n<ul>\n<li><em><strong>Who</strong> controls the outcome of the game?</em></li>\n<li><em><strong>What</strong> is the good that players are competing for?</em></li>\n<li><em><strong>When</strong> does the game take place?</em></li>\n<li><em><strong>Where</strong> does the MEV oracle come from?</em></li>\n<li><em><strong>How</strong> is the block builder chosen?</em></li>\n</ul>\n<p>These questions might seem overly simplistic, but when considered in isolation, each can be viewed as an axis in the design space to measure mechanisms. To demonstrate this, we highlight a few different species from the block-space distribution mechanism <a href=\"https://en.wikipedia.org/wiki/Genus\" rel=\"noopener nofollow ugc\">genus</a> that have been explored in the past. While they may feel disjointed and unrelated, their relationship is clarified by understanding how they answer the <code>W^4H questions</code>.</p>\n<h4><a name=\"execution-tickets-and-other-animals-8\" class=\"anchor\" href=\"https://ethresear.ch#execution-tickets-and-other-animals-8\"></a>Execution tickets and other animals</h4>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/0/5/05be4a7b2ce343036ba89733f9371dc1cbaa2b5b.jpeg\" data-download-href=\"https://ethresear.ch/uploads/default/05be4a7b2ce343036ba89733f9371dc1cbaa2b5b\" title=\"upload_23e73e8aae1d7223973af83053d41ebc\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/0/5/05be4a7b2ce343036ba89733f9371dc1cbaa2b5b_2_328x500.jpeg\" alt=\"upload_23e73e8aae1d7223973af83053d41ebc\" data-base62-sha1=\"OO5cbvPqLWsW7LCqlUWknUvu9d\" width=\"328\" height=\"500\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/0/5/05be4a7b2ce343036ba89733f9371dc1cbaa2b5b_2_328x500.jpeg, https://ethresear.ch/uploads/default/optimized/3X/0/5/05be4a7b2ce343036ba89733f9371dc1cbaa2b5b_2_492x750.jpeg 1.5x, https://ethresear.ch/uploads/default/optimized/3X/0/5/05be4a7b2ce343036ba89733f9371dc1cbaa2b5b_2_656x1000.jpeg 2x\" data-dominant-color=\"AABDC6\"></a></div><br>\n<sub><strong>^ fantastic book.</strong></sub><p></p>\n<p>We present a compendium of many different proposed mechanisms. Note that this is only a subset of the rather substantial literature around these designs – cf. <a href=\"https://notes.ethereum.org/@mikeneuder/infinite-buffet\" rel=\"noopener nofollow ugc\">infinite buffet</a>. For each of the following, we summarize only the key ideas (see <a href=\"https://ethresear.ch#related-work-2\">related work</a> for more).</p>\n<ul>\n<li>Execution tickets\n<ul>\n<li><strong>Key ideas</strong> – Block building and proposing rights are sold directly through “tickets” issued by the protocol. Ticket holders are randomly sampled to become block builders with a fixed lookahead. The ticket holder has the authority to produce a block at the assigned slot.</li>\n</ul>\n</li>\n<li>Block-auction PBS\n<ul>\n<li><strong>Key ideas</strong> – The protocol bestows block production rights through a random leader-election process. The selected validator can sell their block outright to the builder market or build it locally. The builder must ~commit to a specific block~ when bidding in the auction. <code>mev-boost</code> is an out-of-protocol instantiation of block-auction PBS; enshrined PBS (ePBS), as <a href=\"https://ethresear.ch/t/two-slot-proposer-builder-separation/10980\">originally presented</a>, is the in-protocol equivalent.</li>\n</ul>\n</li>\n<li>MEV-burn/mev-smoothing\n<ul>\n<li><strong>Key ideas</strong> – A committee is tasked with enforcing a minimum value over the bid the proposer selects in an auction. By requiring the proposer to choose a “large enough” bid, an MEV oracle is created. The MEV is either <em>smoothed</em> between committee members or <em>burned</em> (smoothed over all <code>ETH</code> holders).</li>\n</ul>\n</li>\n<li>Slot-auction PBS\n<ul>\n<li><strong>Key ideas</strong> – Similar to block-auction PBS but instead sells the <a href=\"https://mirror.xyz/0x03c29504CEcCa30B93FF5774183a1358D41fbeB1/CPYI91s98cp9zKFkanKs_qotYzw09kWvouaAa9GXBrQ\" rel=\"noopener nofollow ugc\">slot</a> to the builder market ~without~ requiring a commitment to a specific block – sometimes referred to as block space futures. By not requiring the builders to commit to a particular block, future slots may be auctioned off ahead of time rather than waiting until the slot itself.</li>\n</ul>\n</li>\n<li>Partial-block auction\n<ul>\n<li><strong>Key ideas</strong> – Allows a more flexible unit for selling block-space. Instead of selling the full block or slot, allow proposers to sell <em>some</em> of their block, e.g., the top-of-block (which is the most valuable for arbitrageurs), while retaining the rest-of-block construction. Live in other Proof-of-Stake networks, e.g., Jito’s <a href=\"https://jito-labs.gitbook.io/mev/searcher-resources/block-engine\" rel=\"noopener nofollow ugc\">block engine</a> and Skip <a href=\"https://docs.skip.money/blocksdk/lanes/existing-lanes/mev\" rel=\"noopener nofollow ugc\">MEV lane</a>.</li>\n</ul>\n</li>\n<li>APS-burn a.k.a. Execution Auction (nomenclature in flux &amp; the EA acronym has a bit of … <a href=\"https://en.wikipedia.org/wiki/Effective_altruism\" rel=\"noopener nofollow ugc\">baggage</a>)\n<ul>\n<li><strong>Key ideas</strong> – A brand new proposal from <a href=\"https://mirror.xyz/barnabe.eth/QJ6W0mmyOwjec-2zuH6lZb0iEI2aYFB9gE-LHWIMzjQ\" rel=\"noopener nofollow ugc\">Barnabé</a> which compels a proposer to auction off the block building and proposing rights ahead of time. The slot is sold ex-ante (a fixed amount of time in advance) without requiring a commitment to a specific block; a committee (à la mev-burn/smoothing) enforces the winning bid is sufficiently large.</li>\n</ul>\n</li>\n</ul>\n<p>We know, we know – it’s a lot to keep track of; it’s nearly a full-time job just to stay abreast of all these acronyms. But by comparing these proposals along the axes laid out by the <code>W^4H questions</code>, we can see how they all fit together as different parts of the same design space.</p>\n<h4><a name=\"applying-w4h-a-comparative-analysis-9\" class=\"anchor\" href=\"https://ethresear.ch#applying-w4h-a-comparative-analysis-9\"></a>Applying W^4H: a comparative analysis</h4>\n<p>For each of the five <code>W^4H questions</code>, we describe different trade-offs made by the aforementioned proposals. For brevity, we don’t analyze each question for each proposal; we instead focus on highlighting key differences arising from each line of questioning.</p>\n<ul>\n<li><em><strong>Who</strong> controls the outcome of the game?</em>\n<ul>\n<li>With execution tickets, the protocol dictates the winner of the game by randomly choosing from the set of ticket holders.</li>\n<li>With block-auction PBS, the proposer (protocol-elected leader) unilaterally chooses the winner of the game.</li>\n<li>With mev-burn, the proposer still chooses the winner, but the winning bid is constrained by the committee, reducing the proposer’s agency.</li>\n</ul>\n</li>\n<li><em><strong>What</strong> is the good that players are competing for?</em>\n<ul>\n<li>With block-auction PBS, the entire block is sold, but bids must commit to the block contents.</li>\n<li>With slot-auction PBS, the entire block is sold, but without any specific block commitment.</li>\n<li>With partial-block PBS, a portion of the block is sold.</li>\n</ul>\n</li>\n<li><em><strong>When</strong> does the game take place?</em>\n<ul>\n<li>With block-auction PBS, the auction takes place during the slot.</li>\n<li>With slot-auction PBS, the auction may take place many slots (e.g., 32) ahead of time because there is no block-content commitment.</li>\n<li>With execution tickets, the tickets are assigned to slots at a fixed lookahead after being sold ex-ante by the protocol (more on the ticket-selling model we use below).</li>\n</ul>\n</li>\n<li><em><strong>Where</strong> does the MEV oracle come from?</em>\n<ul>\n<li>With mev-burn/smoothing, a committee enforces that a sufficiently large bid is selected as the winner; this bid size is the oracle.</li>\n<li>With execution tickets, the total money spent on tickets serves as the oracle.</li>\n</ul>\n</li>\n<li><em><strong>How</strong> is the block builder chosen?</em>\n<ul>\n<li>In block-auction PBS, any outsourced block production has a winner-take-all allocation, with the highest bidder granted the block-building rights.</li>\n<li>Within execution tickets, many different allocation mechanisms can be implemented. In the original proposal, for example, where a random ticket is selected, the mechanism is ‘proportional-to-ticket-count’; in this case, the highest paying bidder (whoever holds the most tickets) merely has the highest probability of being selected, meaning they are not guaranteed the block building rights.</li>\n<li>If that (^) seems opaque, don’t worry. The entire following section is a deep dive into these different allocations.</li>\n</ul>\n</li>\n</ul>\n<h4><a name=\"motivational-interlude-10\" class=\"anchor\" href=\"https://ethresear.ch#motivational-interlude-10\"></a>Motivational interlude</h4>\n<p>Before continuing, let’s review our original motivation for block-space distribution mechanisms:</p>\n<blockquote>\n<p><strong>Block-space distribution mechanisms aim to preserve the homogeneity of validator rewards in the presence of MEV.</strong></p>\n</blockquote>\n<p>This is a great grounding, but if that is our only goal, why not just continue using <code>mev-boost</code>? Well, remember that <code>mev-boost</code> has some negative side effects that we probably want the endgame protocol to be resilient against. We highlight four other potential design goals of a block-space distribution mechanism:</p>\n<ol>\n<li><em>Encouraging a wider set of builders to be competitive.</em></li>\n<li><em>Allow validators and builders to interact trustlessly.</em></li>\n<li><em>Incorporating MEV-awareness into the base layer protocol.</em></li>\n<li><em>Removing MEV from validator rewards altogether.</em></li>\n</ol>\n<p>Note that while (1, 2, &amp; 3) appear relatively uncontroversial (*knock on wood*), (4) is more opinionated (and requires (3) as a pre-condition). The protocol may hope to eliminate MEV rewards from validator rewards as a means to ensure that the consensus layer rewards (what the protocol controls) more accurately reflect the full incentives of the system. This also ties into questions around staking macro-economics and the idea of <a href=\"https://ethresear.ch/t/endgame-staking-economics-a-case-for-targeting/18751\">protocol</a>, <a href=\"https://notes.ethereum.org/@mikeneuder/iiii\" rel=\"noopener nofollow ugc\">issuance</a> – a much more politically-charged discussion. On the other hand, MEV rewards are a byproduct of network usage; MEV could instead be seen as a <a href=\"https://www.nano210.blog/infinite-blockspace-equilibrium/\" rel=\"noopener nofollow ugc\">value capture</a> mechanism for the native token. We aren’t trying to address these questions here but rather explore how different answers to them would shape the design of the mechanism.</p>\n<p>What can we do at the protocol-design level to align with these desiderata? As laid out above, there are many trade-offs to consider, but in the following section, we examine “<em>How is the block builder chosen?</em>” to improve on some of these dimensions.</p>\n<h3><a name=\"h-3-interrogation-11\" class=\"anchor\" href=\"https://ethresear.ch#h-3-interrogation-11\"></a>(3) – Interrogation</h3>\n<p><strong>Editorial note:</strong> As mentioned earlier, this section is longer and more technical than the others – feel free to skip to <a href=\"https://ethresear.ch#h-4-extrapolation-18\">Section 4</a> if you are time (or interest) constrained!</p>\n<p><strong>Section goal:</strong> <em>To demonstrate the quantitative trade-off between MEV-oracle quality and the “fairness” of the two most familiar approaches to allocating block proposer rights, which we call <code>Proportional-all-pay</code> and <code>Winner-take-all</code>.</em></p>\n<p>We aim to accomplish this with the following subsections:</p>\n<ul>\n<li><a href=\"https://ethresear.ch#preliminaries-12\"><em>Preliminaries</em></a> – Motivate the fixed-price, unlimited-quantity execution ticket sale mechanism we use.</li>\n<li><a href=\"https://ethresear.ch#model-13\"><em>Model</em></a> - Introduce the notation needed to analyze the model.</li>\n<li><a href=\"https://ethresear.ch#familiar-allocation-mechanisms-14\"><em>Familiar allocation mechanisms</em></a> - Describe the <code>Proportional-all-pay</code> and <code>Winner-take-all</code> mechanisms using the established framework.</li>\n<li><a href=\"https://ethresear.ch#comparing-the-outcomes-15\"><em>Comparing the outcomes</em></a> - Calculate the resulting equilibria in a two-player example.</li>\n<li><a href=\"https://ethresear.ch#aside-1-calculating-equilibrium-bids-16\"><em>Aside #1: Calculating equilibrium bids</em></a> - Derive the equilibria in the general case.</li>\n<li><a href=\"https://ethresear.ch#aside-2-tullock-contests-17\"><em>Aside #2: Tullock Contests</em></a> - Contextualize the model as a Tullock Contest and draw connections to the existing literature.</li>\n</ul>\n<p>Let’s <a href=\"https://youtu.be/GLsCR2RMBak?t=119\" rel=\"noopener nofollow ugc\">dig</a> in.</p>\n<h4><a name=\"preliminaries-12\" class=\"anchor\" href=\"https://ethresear.ch#preliminaries-12\"></a>Preliminaries</h4>\n<p>Before diving into the space of allocation mechanisms made possible with execution tickets, we must first set up the model. Consider a protocol that sells execution tickets with the following rules:</p>\n<ol>\n<li>the price is fixed at <code>1 WEI</code>, and</li>\n<li>unlimited tickets can be bought and sold from the protocol.</li>\n</ol>\n<p><strong>Note:</strong> <em>this version of execution tickets is effectively equivalent to creating two disjoint staking mechanisms – one each for attesting and proposing. Small changes in the design, e.g., not allowing tickets to be resold to the protocol, may have massive implications for how the market plays out, but that isn’t the focus of this article. Instead, we narrowly explore the question of block-space allocation, given an existing ticket holder set.</em></p>\n<p>Notably, the set of block producers is disjoint (from the protocol’s perspective) from the set of attesters – individuals must select which part of the protocol they participate in by deciding whether to stake or buy tickets. The secondary ticket market may evolve as a venue for selling the building rights just in time to the builder market (as is done in <code>mev-boost</code> today).</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/e/4/e4f36ef0b6e6e5d80c4a923d9465bf74212af039.png\" data-download-href=\"https://ethresear.ch/uploads/default/e4f36ef0b6e6e5d80c4a923d9465bf74212af039\" title=\"upload_45a1fa23182dd6a28c2c07dc2479f150\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/e/4/e4f36ef0b6e6e5d80c4a923d9465bf74212af039_2_486x499.png\" alt=\"upload_45a1fa23182dd6a28c2c07dc2479f150\" data-base62-sha1=\"wFopQiId1m57tNMc332Tz7uwpvj\" width=\"486\" height=\"499\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/e/4/e4f36ef0b6e6e5d80c4a923d9465bf74212af039_2_486x499.png, https://ethresear.ch/uploads/default/optimized/3X/e/4/e4f36ef0b6e6e5d80c4a923d9465bf74212af039_2_729x748.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/e/4/e4f36ef0b6e6e5d80c4a923d9465bf74212af039_2_972x998.png 2x\" data-dominant-color=\"F9F7F9\"></a></div><br>\n<span class=\"math\">\\cdot</span><br>\nSeparately, builders may choose to interact directly with the protocol by buying execution tickets themselves, but their capital may be better utilized as active liquidity, capturing arbitrage across trading venues. Thus, they may prefer buying block space on the secondary market during the just-in-time auction instead.<p></p>\n<p>Why restrict ourselves to this posted-price-unlimited-supply mechanism? Two reasons:</p>\n<ol>\n<li><em>It’s not clear that a sophisticated market could even be implemented in the consensus layer.</em> The clients are optimized to allow any validator with consumer-grade hardware to participate in the network. This desideratum may be incompatible with fast auctions, bonding curves, or other possible ticket-selling mechanisms. Questions around how many tickets are sold, the MEV around onchain ticket-sale inclusion (meta-MEV?!), and the timing (and timing games) of ticket sales seem closer to execution layer concerns than something that could reasonably be implemented by Ethereum consensus while keeping hardware requirements limited.</li>\n</ol>\n<blockquote>\n<p>“<em>One may imagine the inclusion of ET market-related transactions to possibly induce MEV, whether these transactions are included in the beacon block or the execution payload.</em>” – <strong>Barnabé in</strong> “<a href=\"https://mirror.xyz/barnabe.eth/QJ6W0mmyOwjec-2zuH6lZb0iEI2aYFB9gE-LHWIMzjQ\" rel=\"noopener nofollow ugc\"><em>More pictures about proposers and builders</em></a>.”</p>\n</blockquote>\n<ol start=\"2\">\n<li><em>Even if (a big if) the protocol ~could~ implement a more rigid ticket-selling market, the design space for such a mechanism is immense.</em> Many potential pricing mechanisms have been discussed, e.g., bonding curves, 1559-style dynamic pricing, auctions, etc.; making general claims about these remains outside the scope of this post.</li>\n</ol>\n<p>Therefore, we focus on the “unlimited, 1 <code>WEI</code> posted-price” version of execution tickets, where the protocol internalizes minimal complexity. With this framing, we can ask the question that is probably <a href=\"https://youtu.be/5KNEZJ6KkLI?t=53\" rel=\"noopener nofollow ugc\">burning</a> you up inside, “<em>given a set of execution ticket holders, how should the winner be selected?</em>” … sounds easy enough, right? Turns out there is a good deal we can say, even with such a seemingly simple question; let’s explore a few different options.</p>\n<h4><a name=\"model-13\" class=\"anchor\" href=\"https://ethresear.ch#model-13\"></a>Model</h4>\n<p>Consider the repeated game of buying execution tickets to earn MEV rewards for your investment.</p>\n<ul>\n<li>During each period, each player effectively submits a bid, which is the number of tickets they buy. Denote the vector of bids by <span class=\"math\">\\mathbf{b}</span>, where <span class=\"math\">b_i</span> is the bid of the <span class=\"math\">i^{th}</span> player.</li>\n<li>Each player has a valuation for winning the block production rights. Denote the vector of valuations by <span class=\"math\">\\mathbf{v}</span>, where <span class=\"math\">v_i</span> is the value of the <span class=\"math\">i^{th}</span> player.</li>\n<li>At each time step, an allocation mechanism determines each player’s allocation based on the vector of bids. Assuming bidders are risk-neutral (i.e., don’t care between winning 2 <code>ETH</code> with probability <span class=\"math\">0.5</span> vs. 1 <code>ETH</code> with probability <span class=\"math\">1</span>), we can equivalently say that they are each allocated “some portion” of the block, which can be alternatively be interpreted as “the probability that they win a given block.” In an <span class=\"math\">n</span> player game, let <span class=\"math\">x: \\mathbf{b} \\rightarrow [0,1]^n</span> denote the map implementing an allocation mechanism, where <span class=\"math\">x_i(\\mathbf{b})</span> is the allocation of the <span class=\"math\">i^{th}</span> player, under the constraint that <span class=\"math\">\\sum_i x_i(\\mathbf{b}) =1</span> (i.e., the mechanism fully allocates).</li>\n<li>Each player’s payment is collected at each round. Let <span class=\"math\">p: \\mathbf{b} \\rightarrow \\mathbb{R}_{\\geq 0}^n</span> denote the payment rule determined by the set of bids, where <span class=\"math\">p_i(\\mathbf{b})</span> is the payment of the <span class=\"math\">i^{th}</span> player.</li>\n<li>The utility function of each player in the game is, <span class=\"math\">U_i(\\mathbf{b}) = v_i x_i(\\mathbf{b}) - p_i(\\mathbf{b})</span>. The intuition is that “a player’s utility is their value for winning multiplied by the amount they won, less their payment.”</li>\n</ul>\n<h4><a name=\"familiar-allocation-mechanisms-14\" class=\"anchor\" href=\"https://ethresear.ch#familiar-allocation-mechanisms-14\"></a>Familiar allocation mechanisms</h4>\n<p>Consider two (quite different) possible mechanisms.</p>\n<p><code>Proportional-all-pay</code> (a slight modification to the <a href=\"https://ethresear.ch/t/execution-tickets/17944\">original</a> execution tickets proposal)</p>\n<ul>\n<li>During each round, all players submit a bid. Denote the vector of bids by <span class=\"math\">\\mathbf{b}</span>.</li>\n<li>The probability that a bid wins the game is the value of the bid divided by the sum of all the values of the bids,</li>\n</ul>\n<div class=\"math\">\nx_i(\\mathbf{b}) = \\frac{b_i}{\\sum_j b_j}.\n</div>\n<ul>\n<li>Each player pays their bid, no matter the outcome of the game (hence “all-pay”), <span class=\"math\">p_i(\\mathbf{b}) = b_i.</span><a href=\"https://ethresear.ch#fn1dst\"><span class=\"math\">^{[1]}</span></a><a name=\"fn1\" href=\"https://ethresear.ch\"></a></li>\n</ul>\n<p><code>Winner-take-all</code> (the current implementation of PBS)</p>\n<ul>\n<li>During each round, all players submit a bid. Denote the vector of bids by <span class=\"math\">\\mathbf{b}</span>.</li>\n<li>The highest bidder wins the game, so <span class=\"math\">x_i(\\mathbf{b}) = 1</span> if <span class=\"math\">\\max(\\mathbf{b}) = b_i</span> and <span class=\"math\">x_i(\\mathbf{b}) = 0</span> otherwise (where ties are broken in favor of the lower index bidder, say).</li>\n<li>Only the winning player pays the value of their bid, so <span class=\"math\">p_i(\\mathbf{b}) = b_i</span> if <span class=\"math\">\\max(\\mathbf{b}) = b_i</span> and <span class=\"math\">p_i(\\mathbf{b}) = 0</span> otherwise (same tie-breaking as above).<a href=\"https://ethresear.ch#fn2dst\"><span class=\"math\">^{[2]}</span></a><a name=\"fn2\" href=\"https://ethresear.ch\"></a></li>\n</ul>\n<h4><a name=\"comparing-the-outcomes-15\" class=\"anchor\" href=\"https://ethresear.ch#comparing-the-outcomes-15\"></a>Comparing the outcomes</h4>\n<p>To demonstrate the different outcomes from these two mechanisms, consider the two-player game where <code>Player 1</code> has a valuation of <span class=\"math\">v_1 = 4</span> and <code>Player 2</code> has a valuation of <span class=\"math\">v_2 = 2.</span> (We consider a complete information setting in which the individual values are common knowledge. To see how the equilibria bid is calculated and for extended discussion, see <a href=\"https://ethresear.ch#aside-1-calculating-equilibrium-bids-16\">Aside 1</a>.)</p>\n<ul>\n<li><strong><code>Proportional-all-pay</code> outcome:</strong>\n<ul>\n<li>Equilibrium Bids: <span class=\"math\">\\qquad\\,\\,\\,\\;\\;\\; b_1 = 8/9</span>, <span class=\"math\">\\,b_2 = 4/9</span></li>\n<li>Equilibrium Allocations: <span class=\"math\">\\;\\;\\; x_1 = 2/3</span>, <span class=\"math\">x_2 = 1/3</span></li>\n<li>Equilibrium Payments: <span class=\"math\">\\;\\;\\;\\; p_1 = 8/9</span>, <span class=\"math\">\\,p_2 = 4/9</span></li>\n</ul>\n</li>\n</ul>\n<p>This all should feel intuitively correct; with <span class=\"math\">v_1 = 2 \\cdot v_2</span> (<code>Player 1</code> has <code>2x</code> the value for the block), <code>Player 1</code> bids, receives and pays twice as much as <code>Player 2</code>.</p>\n<ul>\n<li><strong><code>Winner-take-all</code> outcome:</strong>\n<ul>\n<li>Equilibrium Bids: <span class=\"math\">\\qquad\\,\\,\\,\\;\\;\\; b_1 = 2+\\epsilon</span>, <span class=\"math\">b_2 = 2</span></li>\n<li>Equilibrium Allocations: <span class=\"math\">\\;\\;\\; x_1 = 1</span>, <span class=\"math\">\\quad\\;\\; x_2 = 0</span></li>\n<li>Equilibrium Payments: <span class=\"math\">\\;\\;\\;\\,\\, p_1 = 2+\\epsilon</span>, <span class=\"math\">p_2 = 0</span></li>\n</ul>\n</li>\n</ul>\n<p>This is pretty different. <code>Player 1</code> bids and pays just over <code>Player 2</code>’s value (we use <span class=\"math\">\\epsilon</span> to denote a small amount), receiving the entire allocation. <code>Player 2</code> receives nothing and pays nothing.<a href=\"https://ethresear.ch#fn3dst\"><span class=\"math\">^{[3]}</span></a><a name=\"fn3\" href=\"https://ethresear.ch\"></a></p>\n<p>Now consider the “revenue” (or the sum of the bids collected by the mechanism) generated from each case:</p>\n<ul>\n<li><strong><code>Proportional-all-pay</code> revenue:</strong> <span class=\"math\">b_1 + b_2 = 4/3</span></li>\n<li><strong><code>Winner-take-all</code> revenue:</strong> <span class=\"math\">\\qquad\\quad\\,\\,\\,\\;\\;\\;\\; b_1 = 2+\\epsilon</span></li>\n</ul>\n<p><code>Winner-take-all</code> has better revenue, corresponding to a more accurate MEV oracle (and thus more MEV burned or smoothed by the protocol) than <code>Proportional-all-pay</code>. Intuitively, by allocating block-production rights to players with lower values (as <code>Proportional-all-pay</code> does), we forgo revenue we would have received had we simply allocated the entire rights to the player with the highest value. We point the interested reader to <a href=\"https://ethresear.ch#aside-1-calculating-equilibrium-bids-16\">Aside 1</a> for a more complete treatment.</p>\n<p>Another factor to consider is the “fairness” or “distribution” of the allocation mechanism. For example, suppose we agree on the metric: <span class=\"math\">\\text{fairness} = \\sqrt{x_1 \\cdot x_2}</span> (we use the geometric mean because if <span class=\"math\">x_1 + x_2</span> has a fixed sum, the geometric mean is maximized at <span class=\"math\">x_1 = x_2</span> and zero if either <span class=\"math\">x_1,x_2</span> is zero). Now, let’s look at the fairness outcomes of the two candidate mechanisms:</p>\n<ul>\n<li><strong><code>Proportional-all-pay</code> fairness:</strong> <span class=\"math\">\\sqrt{1/3 \\cdot 2/3} \\approx 0.471</span></li>\n<li><strong><code>Winner-take-all</code> fairness:</strong> <span class=\"math\">\\qquad\\qquad\\;\\,\\;\\sqrt{1 \\cdot 0} = 0</span></li>\n</ul>\n<p>Here, the “performance” of the two mechanisms flips – the <code>Winner-take-all</code> is <em>less fair</em> because <code>Player 2</code> has no chance of winning the game with a lower value. In the <code>Proportional-all-pay</code>, <code>Player 2</code> can hope to win some blocks despite bidding a lower value. As another example, consider the case where <span class=\"math\">v_1=v_2+\\epsilon</span>. The <code>Winner-take-all</code> mechanism allocates all the rights to <code>Player 1</code>, while the <code>Proportional-all-pay</code> splits the rights approximately in half.</p>\n<blockquote>\n<p>Brief note: why might the protocol care about fairness? In a decentralized protocol, a single actor having too much power undermines the credible neutrality of the system. As such, the protocol may be willing to “pay” (in the form of reduced revenue) to ensure that a resource is more evenly distributed among players. Alternatively, we could consider this a measure of “entropy” or even simply randomness being injected into the outcome of the game to try to reduce the influence the most dominant player can have.</p>\n</blockquote>\n<p>This leads to the punchline from this small example: <strong>a fundamental trade-off exists between MEV-oracle quality and fairness.</strong> The <code>Proportional-all-pay</code> mechanism (and hence the original execution tickets proposal) is fairer because both players win the game with some probability, incentivizing them each (but more importantly, the higher value player) to <a href=\"https://en.wikipedia.org/wiki/Bid_shading\" rel=\"noopener nofollow ugc\">shade</a> their bid accordingly, lowering the revenue, and thus the MEV-oracle accuracy, of the mechanism. The first price mechanism elicits higher bids since bidders only pay if they win the entire block production rights, increasing the revenue, but this <code>Winner-take-all</code> dynamic makes the allocation less fair.</p>\n<p><em>Open question: is <code>Proportional-all-pay</code> an “optimal” Sybil-proof mechanism?</em> In the permissionless setting, we only consider Sybil-proof mechanisms, where a player doesn’t benefit from splitting their bid into multiple identities. We posit that the <code>Proportional-all-pay</code> mechanism sits in the <a href=\"https://en.wikipedia.org/wiki/Habitable_zone\" rel=\"noopener nofollow ugc\">Goldilock’s Zone</a> of a Sybil-proof mechanism that gets both good revenue/MEV-oracle accuracy and fairness. We leave as an interesting open problem to determine the extent to which the <code>Proportional-all-pay</code> mechanism’s “optimality” (e.g., we were unable to find another Sybil-proof mechanism that dominates it in both revenue and fairness).</p>\n<h4><a name=\"aside-1-calculating-equilibrium-bids-16\" class=\"anchor\" href=\"https://ethresear.ch#aside-1-calculating-equilibrium-bids-16\"></a>Aside <span class=\"hashtag-raw\">#1</span> – Calculating equilibrium bids</h4>\n<p><a href=\"https://ethresear.ch#h-4-extrapolation-18\">Convenience link</a> to skip to the conclusion for the less-keen reader <img src=\"https://ethresear.ch/images/emoji/facebook_messenger/wink.png?v=12\" title=\":wink:\" class=\"emoji\" alt=\":wink:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>\n<p>In the numerical example above, we provide the equilibrium bids for the <code>Winner-take-all</code> and <code>Proportional-all-pay</code> mechanisms without proof. How can these be determined generally (e.g., continuing to assume that bidders’ values are common knowledge)?<a href=\"https://ethresear.ch#fn4dst\"><span class=\"math\">^{[4]}</span></a><a name=\"fn4\" href=\"https://ethresear.ch\"></a></p>\n<p>The <code>Winner-take-all</code> is the familiar <a href=\"https://www.econport.org/econport/request?page=man_auctions_firstpricesealed\" rel=\"noopener nofollow ugc\">First Price Auction</a> setting. In such auctions, the complete information Pure-Nash equilibrium has the two highest-value bidders, each bidding the second-highest bidder’s value, with every other agent bidding below this. In effect, we expect that the highest-value bidder always wins while paying the second highest bidder’s value (we represent this simply as <span class=\"math\">b_1=b_2+\\epsilon</span>, though you could equivalently tie-break in favor of the higher-value player).</p>\n<p>In the <code>Proportional-all-pay</code> setting, each player has the utility,</p>\n<div class=\"math\">\n\\begin{align}\nU_i (\\mathbf{b}) &amp;= v_i \\cdot x_i(\\mathbf{b}) - b_i \\\\\n&amp;= v_i \\cdot \\frac{b_i}{\\sum_j b_j} - b_i.\n\\end{align}\n</div>\n<p>To determine the existence of a <a href=\"https://en.wikipedia.org/wiki/Nash_equilibrium\" rel=\"noopener nofollow ugc\">Pure Nash Equilibrium</a>, we consider each player’s first- and second-order conditions. Let <span class=\"math\">\\mathbf{b}^*</span> denote the candidate equilibrium set of bids.</p>\n<ol>\n<li><strong>First-order condition</strong>: <span class=\"math\">\\partial U_i / \\partial b_i (\\mathbf{b^*}) = 0</span> (or <span class=\"math\">\\partial U_i / \\partial b_i (\\mathbf{b^*}) \\leq 0, \\;\\forall i \\text{ s.t. } b^*_i=0</span>.)\n<ul>\n<li>Intuitively, this condition checks a non-zero-bidding player is (to first order) locally indifferent to small changes in its bid.</li>\n</ul>\n</li>\n<li><strong>Second-order condition</strong>: <span class=\"math\">\\partial^2 U_i / \\partial b_i^2 &lt; 0</span>\n<ul>\n<li>Intuitively, this condition ensures that the utility function is concave, implying that locally best responses are globally best for all players.</li>\n</ul>\n</li>\n</ol>\n<p>In our simple two-player example in the <code>Proportional-all-pay</code> setting, we have the following.</p>\n<div class=\"math\">\n\\begin{align}\n\\frac{\\partial U_1}{\\partial b_1}(\\mathbf{b}) = \\frac{v_1 b_2}{(b_1 + b_2)^2} - 1 = 0 \\; , \\quad \\frac{\\partial U_2}{\\partial b_2}(\\mathbf{b}) = \\frac{v_2 b_1}{(b_1 + b_2)^2} - 1 = 0\n\\end{align}\n</div>\n<p>This system can be solved to find the equilibrium bids, <span class=\"math\">\\mathbf{b}^*</span>,</p>\n<div class=\"math\">\n\\begin{align}\nb^*_1 = \\frac{v_1^2 v_2}{(v_1 + v_2)^2}\\; , \\quad b^*_2 = \\frac{v_2^2 v_1}{(v_1 + v_2)^2}.\n\\end{align}\n</div>\n<p>For our toy example, we have <span class=\"math\">v_1=4, \\; v_2=2 \\implies b_1^* = 32/36, \\; b_2^* = 16/36</span>. We can verify our first-order conditions</p>\n<div class=\"math\">\n\\begin{align}\n\\frac{4 \\cdot 16/36}{16/9} - 1 = 0 \\; , \\quad \\frac{2 \\cdot 32/36}{16/9} - 1 = 0 \\quad \\checkmark\n\\end{align}\n</div>\n<p>The second-order conditions can also be verified – this is left as an exercise for the reader <img src=\"https://ethresear.ch/images/emoji/facebook_messenger/wink.png?v=12\" title=\":wink:\" class=\"emoji\" alt=\":wink:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>\n<h4><a name=\"aside-2-tullock-contests-17\" class=\"anchor\" href=\"https://ethresear.ch#aside-2-tullock-contests-17\"></a>Aside <span class=\"hashtag-raw\">#2</span> – Tullock Contests</h4>\n<p><a href=\"https://youtu.be/lL2ZwXj1tXM?t=60\" rel=\"noopener nofollow ugc\">Last chance</a> to <a href=\"https://ethresear.ch#h-4-extrapolation-18\">skip to the conclusion</a>. (If you continue, by definition, you are the “interested reader” – <a href=\"https://www.youtube.com/watch?v=SC4xMk98Pdc&amp;t=35s\" rel=\"noopener nofollow ugc\">congrats</a>.)</p>\n<p>The model described above is established in the algorithmic game theory literature as a <a href=\"https://www.chapman.edu/ESI/wp/GeneralizedTullockContest-Sheremeta.pdf\" rel=\"noopener nofollow ugc\">Tullock Contest</a> – named for Gordon Tullock, who explored the idea in his seminal work, “<a href=\"https://link.springer.com/chapter/10.1007/978-3-540-79182-9_6\" rel=\"noopener nofollow ugc\"><em>Efficient Rent Seeking</em></a>.” He motivates this study by considering situations where investment is made before the outcome is known and where the investments might not transfer easily between participants, e.g., political spending.</p>\n<blockquote>\n<p>“<em>Suppose, for example, that we organize a lobby in Washington for the purpose of raising the price of milk and are unsuccessful. We cannot simply transfer our collection of contacts, influences, past bribes, and so forth to the steel manufacturers’ lobby. In general, our investments are too specialized, and, in many cases, they are matters of very particular and detailed goodwill to a specific organization. It is true that we could sell the steel lobby our lobbyists with their connections and perhaps our mailing list. But presumably, all these things have been bought by us at their proper cost. Our investment has not paid, but there is nothing left to transfer.</em>” – <strong>Gordon Tullock (1980)</strong></p>\n</blockquote>\n<p>This allocation mechanism has been applied in the previous crypto literature as well. Back in 2018 (ancient history in crypto-terms), Arnosti and Weinberg wrote “<a href=\"https://arxiv.org/abs/1811.08572\" rel=\"noopener nofollow ugc\"><em>Bitcoin: A natural oligopoly</em></a>,” which demonstrates that even small operating cost advantages among miners in a Proof-of-Work system lead to surprisingly concentrated equilibria. Similarly, Bahrani, Garimidi, and Roughgarden (these names sound familiar :D) explored the centralization effects of heterogeneity in block building skill in “<a href=\"https://arxiv.org/abs/2401.12120\" rel=\"noopener nofollow ugc\"><em>Centralization in Block Building and Proposer-Builder Separation</em></a>.” There appears to be a deep relationship between permissionless crypto-economic systems, where anti-Sybil mechanisms typically require financial investment for participation, and Tullock Contests – more on this <code>Soon™</code> (maybe).</p>\n<h3><a name=\"h-4-extrapolation-18\" class=\"anchor\" href=\"https://ethresear.ch#h-4-extrapolation-18\"></a>(4) – Extrapolation</h3>\n<p>Phew, thanks for hanging in there; let’s take stock of what we learned. <strong><a href=\"https://ethresear.ch#h-3-interrogation-11\">Section 3</a> demonstrates the fundamental trade-off between MEV-oracle accuracy and fairness of an instantiation of an execution ticket mechanism.</strong> A protocol may be willing to *pay* (in the form of reduced revenue) for more distribution and entropy with the goal of improving and maintaining the protocol’s credible neutrality. Further, using the model to derive equilibrium bids helps inform how we may expect agents to respond to various allocation and payment rules. <a href=\"https://youtu.be/Hm3JodBR-vs?t=21\" rel=\"noopener nofollow ugc\">Neat</a> – our framework led to some interesting and hopefully helpful insights! Maybe we can extend it to other problems in the space as well?</p>\n<p>Further questions that this specific model may help answer (returning to three of our <code>W^4 questions</code>):</p>\n<ul>\n<li><em><strong>What</strong> is the good that players are competing for?</em>\n<ul>\n<li>Can we extend the model dimensionality, allowing different players to have different values for portions of the block (e.g., an arbitrageur may disproportionately value the top of a block but have zero value for the remainder)?</li>\n</ul>\n</li>\n<li><em><strong>When</strong> does the game take place?</em>\n<ul>\n<li>How does the MEV-oracle accuracy change if the game takes place far ahead of time versus during the slot itself (e.g., pricing future expected MEV versus present realizable MEV)?</li>\n</ul>\n</li>\n<li><em><strong>How</strong> is the block builder chosen?</em>\n<ul>\n<li>Are there other Sybil-proof mechanisms that dominate <code>Proportional-all-pay</code> in both revenue and fairness?</li>\n<li>Can we more formally characterize the fundamental trade-offs between revenue and fairness?</li>\n<li>Given the Sybil-proofness constraint, what alternative allocation and payment rules should be explored (e.g., Tullock contests where the allocation rule is parameterized by <span class=\"math\">\\alpha&gt;1</span> where <span class=\"math\">x_i = b_i^\\alpha / \\sum_j b_j^\\alpha</span>), and can we identify the optimal choice?</li>\n</ul>\n</li>\n</ul>\n<p>Zooming back out, other versions of the <code>W^4H questions</code> may require different models to reason about.</p>\n<ul>\n<li><em><strong>Who</strong> controls the outcome of the game?</em>\n<ul>\n<li>In the committee-enforced version of these mechanisms, how could collusive behavior emerge?</li>\n<li>If the just-in-time block auction continues to take place out-of-protocol, should we explicitly describe the secondary market?</li>\n</ul>\n</li>\n<li><em><strong>When</strong> does the game take place?</em>\n<ul>\n<li>How critical is network latency when considering lookahead block-space sales versus same-slot? Is it worth modeling the <a href=\"https://dl.acm.org/doi/pdf/10.1145/42282.42283\" rel=\"noopener nofollow ugc\">partially-synchronous</a> setting?</li>\n<li>How do block builder valuations change if multi-slot MEV is feasible?</li>\n</ul>\n</li>\n<li><em><strong>Where</strong> does the MEV oracle come from?</em>\n<ul>\n<li>If it comes from the committee, are there incentives for committee members to behave dishonestly?</li>\n<li>Do such incentives depend on whether protocol-captured MEV is burned or smoothed?</li>\n</ul>\n</li>\n</ul>\n<p>As per usual, open questions abound, but we hope (a) <code>W^4H questions</code> help expand the understanding of block-space distribution mechanisms and (b) the deep dive into allocation mechanisms helps inform the potential design space of execution tickets.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/8/f/8f4ceb270ae099c612cbb2afb4958a9bea1b42d1.jpeg\" data-download-href=\"https://ethresear.ch/uploads/default/8f4ceb270ae099c612cbb2afb4958a9bea1b42d1\" title=\"upload_a24cdf5b513fb4e410700573687adcd6\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/8/f/8f4ceb270ae099c612cbb2afb4958a9bea1b42d1_2_690x493.jpeg\" alt=\"upload_a24cdf5b513fb4e410700573687adcd6\" data-base62-sha1=\"krH4GmXJutATDXVkFG65HsnaAi5\" width=\"690\" height=\"493\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/8/f/8f4ceb270ae099c612cbb2afb4958a9bea1b42d1_2_690x493.jpeg, https://ethresear.ch/uploads/default/optimized/3X/8/f/8f4ceb270ae099c612cbb2afb4958a9bea1b42d1_2_1035x739.jpeg 1.5x, https://ethresear.ch/uploads/default/optimized/3X/8/f/8f4ceb270ae099c612cbb2afb4958a9bea1b42d1_2_1380x986.jpeg 2x\" data-dominant-color=\"625453\"></a></div><br>\n<sub><strong>^ <a href=\"https://youtu.be/WSLMN6g_Od4?t=92\" rel=\"noopener nofollow ugc\">The world once we figure out MEV.</a></strong></sub><p></p>\n<p>Excited to be here with y’all.</p>\n<p><em>— made with <img src=\"https://ethresear.ch/images/emoji/facebook_messenger/heart.png?v=12\" title=\":heart:\" class=\"emoji\" alt=\":heart:\" loading=\"lazy\" width=\"20\" height=\"20\"> by mike, pranav, &amp; dr. tim roughgarden.</em></p>\n<hr>\n<h3><a name=\"footnotes-19\" class=\"anchor\" href=\"https://ethresear.ch#footnotes-19\"></a>footnotes</h3>\n<p><span class=\"math\">^{[1]}</span><a name=\"fn1dst\" href=\"https://ethresear.ch\"></a>: The “all-pay” feature is made possible by burning the price paid for each ticket. <a href=\"https://ethresear.ch#fn1\"><img src=\"https://ethresear.ch/images/emoji/facebook_messenger/leftwards_arrow_with_hook.png?v=12\" title=\":leftwards_arrow_with_hook:\" class=\"emoji\" alt=\":leftwards_arrow_with_hook:\" loading=\"lazy\" width=\"20\" height=\"20\">︎</a></p>\n<p><span class=\"math\">^{[2]}</span><a name=\"fn2dst\" href=\"https://ethresear.ch\"></a>: The “winner-pay” version could be done by refunding all non-winning ticket holders their payment at the end of each round. <a href=\"https://ethresear.ch#fn2\"><img src=\"https://ethresear.ch/images/emoji/facebook_messenger/leftwards_arrow_with_hook.png?v=12\" title=\":leftwards_arrow_with_hook:\" class=\"emoji\" alt=\":leftwards_arrow_with_hook:\" loading=\"lazy\" width=\"20\" height=\"20\">︎</a></p>\n<p><span class=\"math\">^{[3]}</span><a name=\"fn3dst\" href=\"https://ethresear.ch\"></a>: As mentioned earlier, simply refunding the non-winning tickets instantiates the “winner-pays” property. <a href=\"https://ethresear.ch#fn3\"><img src=\"https://ethresear.ch/images/emoji/facebook_messenger/leftwards_arrow_with_hook.png?v=12\" title=\":leftwards_arrow_with_hook:\" class=\"emoji\" alt=\":leftwards_arrow_with_hook:\" loading=\"lazy\" width=\"20\" height=\"20\">︎</a></p>\n<p><span class=\"math\">^{[4]}</span><a name=\"fn4dst\" href=\"https://ethresear.ch\"></a>: This is primarily for tractability in calculating equilibria analytically. Although a strong assumption, it’s not unreasonable in the context of lookahead auctions where bidders might have established prior distributions on their competitor’s valuations. We also view the insights from studying the complete-information equilibria as valuable heuristics for how we may expect these mechanisms to behave in practice. <a href=\"https://ethresear.ch#fn4\"><img src=\"https://ethresear.ch/images/emoji/facebook_messenger/leftwards_arrow_with_hook.png?v=12\" title=\":leftwards_arrow_with_hook:\" class=\"emoji\" alt=\":leftwards_arrow_with_hook:\" loading=\"lazy\" width=\"20\" height=\"20\">︎</a></p>\n            <p><small>1 post - 1 participant</small></p>\n            <p><a href=\"https://ethresear.ch/t/on-block-space-distribution-mechanisms/19764\">Read full topic</a></p>","link":"https://ethresear.ch/t/on-block-space-distribution-mechanisms/19764","pubDate":"Sat, 08 Jun 2024 12:42:54 +0000","discourse:topicPinned":"No","discourse:topicClosed":"No","discourse:topicArchived":"No","guid":{"@isPermaLink":"false","#text":"ethresear.ch-topic-19764"},"source":{"@url":"https://ethresear.ch/t/on-block-space-distribution-mechanisms/19764.rss","#text":"On block-space distribution mechanisms"},"filter":false},{"title":"The Preconfirmation Sauna","dc:creator":"The-CTra1n","category":"Architecture","description":"<h1><a name=\"the-preconfirmation-sauna-1\" class=\"anchor\" href=\"https://ethresear.ch#the-preconfirmation-sauna-1\"></a>The Preconfirmation Sauna</h1>\n<p><em>We are <a href=\"https://switchboard.nethermind.io/\" rel=\"noopener nofollow ugc\">Switchboard</a>, a Nethermind-backed team dedicated to answering the most pressing preconfirmation questions. Thanks to <a class=\"mention\" href=\"https://ethresear.ch/u/swapnilraj\">@swapnilraj</a>,<a class=\"mention\" href=\"https://ethresear.ch/u/tkstanczak\">@tkstanczak</a>,<a class=\"mention\" href=\"https://ethresear.ch/u/julian\">@Julian</a>,<a class=\"mention\" href=\"https://ethresear.ch/u/linoscope\">@linoscope</a>, and Michal Zajac for your helpful comments.</em></p>\n<p><em><strong>TL;DR:</strong> Decentralized preconfirmers come with significant tradeoffs that will likely make them impractical for the forseeable future. The preconfirmation sauna creates a repeated game amongst permissionless preconfirmers which incentivizes trust, specialization within these tradeoffs, innovation, as well as user-focused preconfirmation policies. More than this, the sauna provides a common interface for all entities in the preconfirmation supply chain to interact, simplifying the preconfirmation process. We believe this set of sauna-related health benefits can unlock preconfirmations.</em></p>\n<p>In the short time that we as an industry have been thinking about preconfirmations, <a href=\"https://ethresear.ch/t/based-preconfirmations/17353\">more or less since November 2023</a>, several teams have emerged to compete for the title of “the preconfirmation protocol”. This is despite almost no shared understanding or appreciation for how a preconfirmer should behave, or how this behaviour should be incentivized.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/7/7/77482b8de0ad4950c6713b95d52d9508699a1a3b.jpeg\" data-download-href=\"https://ethresear.ch/uploads/default/77482b8de0ad4950c6713b95d52d9508699a1a3b\" title=\"image\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/7/7/77482b8de0ad4950c6713b95d52d9508699a1a3b_2_517x291.jpeg\" alt=\"image\" data-base62-sha1=\"h1drs3g3BOZxpvFX3hFT2bZWkKD\" width=\"517\" height=\"291\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/7/7/77482b8de0ad4950c6713b95d52d9508699a1a3b_2_517x291.jpeg, https://ethresear.ch/uploads/default/optimized/3X/7/7/77482b8de0ad4950c6713b95d52d9508699a1a3b_2_775x436.jpeg 1.5x, https://ethresear.ch/uploads/default/optimized/3X/7/7/77482b8de0ad4950c6713b95d52d9508699a1a3b_2_1034x582.jpeg 2x\" data-dominant-color=\"5E4A40\"></a></div><p></p>\n<p>This article outlines Switchboard’s vision for how this preconfirmation competition should play out: specifically, how it can be harnessed to encourage innovation without siloing off parts of the transaction supply chain, and how it can address technological barriers to preconfirmations including fair exchange (see Appendix for more details).</p>\n<p><strong>Goal:</strong> Leverage this emergent preconfirmation protocol competition to enable preconfirmations in what we call the preconfirmation sauna.</p>\n<p><strong>Non-goals:</strong></p>\n<ul>\n<li>Engineer the preconfirmation sauna immediately. The sauna needs preconfirmation protocols just like the preconfirmation protocols need the sauna. Until these protocols emerge, the sauna remains a vision. The engineering specifications will develop as the needs of everyone in the preconfirmation supply chain becomes clearer. In this sense, we are waiting for the rocks to heat up before adding water.</li>\n<li>Confuse the preconfirmation sauna with <a href=\"https://www.youtube.com/watch?v=jrm4ZUoj9xY&amp;list=PLJqWcTqh_zKHDFarAcF29QfdMlUpReZrR&amp;index=13\" rel=\"noopener nofollow ugc\">commit-boost.</a> Commit-boost is a mev-boost rewrite to allow L1 proposers to commit to certain restrictions on their blocks while still outsourcing partial block-building rights. We share their vision for a unified interface for proposer commitments, preconfirmations being a perfect example of a proposer commitment. The sauna isn’t just focused on a unified interface though; it brings competition, pricing policies, preconfirmer registration &amp; slashing conditions, trust, etc. In that sense, commit-boost will depend on the sauna to make preconfirmations a reality.</li>\n</ul>\n<h2><a name=\"the-multi-headed-hydra-of-preconfirmations-2\" class=\"anchor\" href=\"https://ethresear.ch#the-multi-headed-hydra-of-preconfirmations-2\"></a>The Multi-headed Hydra of Preconfirmations</h2>\n<p>The problem of offering preconfirmations is a multi-headed hydra. What makes a preconfirmer “good” or “bad” will depend on many factors including, but not limited to:</p>\n<ul>\n<li>Latency</li>\n<li>Throughput</li>\n<li>(Trusted) execution guarantees</li>\n<li>Privacy</li>\n<li>Cost</li>\n<li>Interoperability with other protocols</li>\n<li>Decentralization</li>\n<li>General trust</li>\n<li>Liveness/censorship resistance</li>\n<li>Ability to express intents</li>\n</ul>\n<p>Most of these factors have trade-offs, so deciding on a single preconfirmation protocol which somewhat specializes in a subset of these criteria would be a mistake at this early stage of preconfirmation development.</p>\n<h3><a name=\"encouraging-competition-3\" class=\"anchor\" href=\"https://ethresear.ch#encouraging-competition-3\"></a>Encouraging Competition</h3>\n<p>Beyond the warm fuzzy feelings we get from many permissionless preconfirmers, we need competing preconfirmers to incentivize competition and keep preconfirmation strategies honest and transparent. Although some preconfirmation guarantees require tradeoffs, e.g. cost vs latency, the benefits of repeated honest behaviour and its long-term access to the preconfirmation market/revenue has almost no trade-off considerations that come into play. Even in the fringe cases where malicious behaviour may have significant immediate profits for a preconfirmer, proposers can always opt-in to choosing entities whose reputational value dominates any such profits, e.g. Flashbots, Vitalik, etc. (even within this set of “trusted” entities, there will be other tradeoffs that must be considered).</p>\n<p>This out-of-the-sauna trust will be necessary as the demand for high-throughput, low-latency preconfirmations likely means we need to delegate preconfirmations temporarily to high-resource and/or centralized entities/committees. In the sauna, misbehaving preconfirmers can be reported and deprioritized by users and proposers, creating a significant disincentive for preconfirmers to act maliciously. As such, users and proposers can immediately begin to depend on the subjective parts of the preconfirmation supply chain such as pricing policies and expected response times that are necessary for preconfirmations to become a reality now.</p>\n<h2><a name=\"the-flaw-in-existing-approaches-4\" class=\"anchor\" href=\"https://ethresear.ch#the-flaw-in-existing-approaches-4\"></a>The flaw in existing approaches</h2>\n<p>The community has been semi-publicly focused on the infrastructure that enables a proposer to offer preconfirmations. There are 2 broad solutions in this regard:</p>\n<ul>\n<li>The based proposer commits to a specific preconfirmation protocol ahead of time. Most projects are looking at this. On its current trajectory, this is probably a “winner-takes-most” approach with each project trying to establish itself as the only game in town.</li>\n<li>The based rollup commits to a specific preconfirmation protocol ahead of time and this preconfirmation protocol is trusted to enable preconfirmations. If the preconfirmation protocol fails, liveness breaks.</li>\n</ul>\n<p>The endgame for both of these approaches requires the user and the proposer to trust a single preconfirmation protocol indefinitely. We see it as unacceptable to depend on the honest behaviour of a single preconfirmation protocol preconfirming all transactions for Ethereum.</p>\n<p>If all of the preconfirmation flow is coming through one specific preconfirmation protocol, this removes competition and places an entity that can rent-capture between Ethereum and its users. More than this, it is unlikely that an emergent preconfirmation protocol could/should be trusted without strong technical guarantees, or viable alternatives for users and validators to switch to. In this sense, trust is a powerful property for emerging technologies that can bridge technological barriers to key problems.</p>\n<p>With respect to preconfirmations, one such problem that trust can address is the fair exchange of preconfirmation requests and responses. In the Appendix, we discuss how the trust generated through the preconfirmation sauna offers a viable solution to the fair exchange problem.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/4/a/4a85e73316a1e964f707ca071b550976707e83f2.jpeg\" data-download-href=\"https://ethresear.ch/uploads/default/4a85e73316a1e964f707ca071b550976707e83f2\" title=\"image\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/4/a/4a85e73316a1e964f707ca071b550976707e83f2_2_517x346.jpeg\" alt=\"image\" data-base62-sha1=\"aDgdzzzGuiRNNdWF6dVuKkWO8Iq\" width=\"517\" height=\"346\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/4/a/4a85e73316a1e964f707ca071b550976707e83f2_2_517x346.jpeg, https://ethresear.ch/uploads/default/optimized/3X/4/a/4a85e73316a1e964f707ca071b550976707e83f2_2_775x519.jpeg 1.5x, https://ethresear.ch/uploads/default/optimized/3X/4/a/4a85e73316a1e964f707ca071b550976707e83f2_2_1034x692.jpeg 2x\" data-dominant-color=\"F8F8F8\"></a></div><br>\nThe current path to preconfirmations involves many protocols building by themselves, competing for a critical mass of validator adoption. Until that point, preconfirmation infrastructure will fragment until one emerges as dominant. This game ends with the best-backed/-connected protocol winning. This leads to an indefinite monopoly on the preconfirmation supply chain, which harms both competition and trust.<p></p>\n<h1><a name=\"enter-the-sauna-5\" class=\"anchor\" href=\"https://ethresear.ch#enter-the-sauna-5\"></a>Enter the Sauna.</h1>\n<p>From <a href=\"https://en.wikipedia.org/wiki/Finnish_sauna\" rel=\"noopener nofollow ugc\">Wikipedia</a>: “Saunas are strictly egalitarian places: no titles or hierarchies are used in the sauna.” Business is often done in saunas. If someone is ever caught misbehaving, people can choose not to sauna with them again.</p>\n<p>The preconfirmation sauna is completely agnostic to the preconfirmation protocols that exist within the sauna framework. To enter the preconfirmation sauna, preconfirmers and their respective protocols register as prospective preconfirmers in the system. Proposers then choose whichever preconfirmer(s) they like to delegate preconfirmation rights to.</p>\n<p>Although the intuition is that proposers would choose the preconfirmer paying the most for the opportunity, there are other factors at play. Proposers must trust the preconfirmer to broadcast all of the preconfirmations to the network ahead of/at block building time, depending on whether or not the preconfirmer is also the one building the final block. This is because preconfirmations almost certainly need proposer slashing conditions to prevent <a href=\"https://ethresear.ch/t/based-preconfirmations/17353\">safety or liveness faults.</a> As such, a proposer risks being slashed by choosing an untrusted preconfirmer.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/6/5/65a590148c5dbc6e81dc2013a87d91f7d21ce4e0.jpeg\" data-download-href=\"https://ethresear.ch/uploads/default/65a590148c5dbc6e81dc2013a87d91f7d21ce4e0\" title=\"image\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/6/5/65a590148c5dbc6e81dc2013a87d91f7d21ce4e0_2_517x286.jpeg\" alt=\"image\" data-base62-sha1=\"evcWm05gUbqjWUZMRvyEV4OE1Gg\" width=\"517\" height=\"286\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/6/5/65a590148c5dbc6e81dc2013a87d91f7d21ce4e0_2_517x286.jpeg, https://ethresear.ch/uploads/default/optimized/3X/6/5/65a590148c5dbc6e81dc2013a87d91f7d21ce4e0_2_775x429.jpeg 1.5x, https://ethresear.ch/uploads/default/optimized/3X/6/5/65a590148c5dbc6e81dc2013a87d91f7d21ce4e0_2_1034x572.jpeg 2x\" data-dominant-color=\"D4CEBF\"></a></div><br>\nTo enable preconfirmations we need healthy competition among protocols. Importantly, this competition should not be over fragmenting users and validators, but over the quality of preconfirmations being offered. Competition over improved preconfirmation guarantees not only creates an incentive to act honestly, but also an incentive to innovate. The vision of the sauna is to ensure permissionless access to the preconfirmation game, and to leverage the competition and trust that this permissionlessness brings. For this to happen, switching between protocols needs to be seamless for everyone in the supply chain. Although this probably requires some standards, standards aren’t a necessity.<p></p>\n<h2><a name=\"everyone-to-the-sauna-6\" class=\"anchor\" href=\"https://ethresear.ch#everyone-to-the-sauna-6\"></a>Everyone to the Sauna.</h2>\n<p>If we want proposers and users to engage in specific preconfirmation protocols, we need trust. More than trust, there needs to be clear incentives for everyone to engage with one another.</p>\n<ol>\n<li><strong>Proposers want to use the preconfirmer.</strong> Proposers need to know that committing to a preconfirmation protocol will generate higher revenue than simply outsourcing building through something like mev-boost. This requires the preconfirmation protocols to be paying competitively for the right to preconfirm. Almost by definition, this can only be achieved through competition among independent protocols. Proposers also need to know with a high degree of confidence that a preconfirmer will maintain liveness and forward all preconfirmations to the network, and avoid any proposer slashing conditions. With a sauna full of preconfirmers, proposers can choose more robust preconfirmers with less failure and slashing risk at the expense of lost revenue. Proposers can also opt for riskier preconfirmers offering higher revenue. The choice is theirs!</li>\n<li><strong>Users want to use the preconfirmer.</strong> Fundamentally, preconfirmation revenue can only be generated through user submission of preconfirmation requests. This requires user to trust in the preconfirmation protocol. With only a single preconfirmation protocol, this likely leads to preconfirmation policies that favour the relayer and not the user or proposer. User adoption of minimally trusted preconfirmations (no/limited guarantees of inclusion, selection biases on inclusion, etc.) will likely be limited.  In that sense, we need competing preconfirmation protocols to incentivize trust in the preconfirmer and policies that favour the users.</li>\n</ol>\n<p>Trust breeds trust. With a sauna full of competing preconfirmation protocols, there are clear incentives to optimize preconfirmation policies and guarantees, including trust (recall the Repeated Preconfirmation Sauna Game), to secure selection from the proposer and the users.</p>\n<h2><a name=\"life-after-sauna-7\" class=\"anchor\" href=\"https://ethresear.ch#life-after-sauna-7\"></a>Life after Sauna</h2>\n<p>Importantly, the use of the sauna isn’t necessary. Proposers can communicate directly with, and commit to, their preferred preconfirmer outside of the sauna. We still imagine an endgame where there is some preconfirmer that trustlessly provides “perfect” preconfirmations.</p>\n<h1><a name=\"conclusion-8\" class=\"anchor\" href=\"https://ethresear.ch#conclusion-8\"></a>Conclusion</h1>\n<p>Until the perfect preconfirmation protocol emerges, protocols need to compete, experiment and innovate while still enabling preconfirmations. More than this, the ability to delegate, send, and receive preconfirmations should be as simple and standardized as possible. To do this, a credibly neutral platform is essential. This is what we envision for the sauna. We look forward to seeing you in there.</p>\n<h3><a name=\"call-to-action-9\" class=\"anchor\" href=\"https://ethresear.ch#call-to-action-9\"></a>Call to Action</h3>\n<p>At Switchboard, we aren’t just building therapeutic wooden structures. We’re also working on improving the preconfirmation protocols themselves. Although we believe preconfirmations could probably be offered along Justin’s timeline of this year, with help from the sauna, <a href=\"https://ethresear.ch/t/the-preconfirmation-sauna/19762#the-multi-headed-hydra-of-preconfirmations-2\">the multi-headed hydra of preconfirmations</a> must be tackled. Preconfirmation RnD, to which Switchboard is committed, will be vital in this regard.</p>\n<h2><a name=\"appendix-the-fair-exchange-problem-a-sauna-case-study-10\" class=\"anchor\" href=\"https://ethresear.ch#appendix-the-fair-exchange-problem-a-sauna-case-study-10\"></a>Appendix. The Fair Exchange Problem: A Sauna Case Study</h2>\n<p>There are many issues that a preconfirmation protocol must address to be considered viable, <a href=\"https://ethresear.ch/t/strawmanning-based-preconfirmations/19695\">some of which are outlined here through a strawman framing of a preconfirmation protocol.</a> <a href=\"https://x.com/_julianma/status/1796552412687155320\" rel=\"noopener nofollow ugc\">One of the key components needed for preconfirmations is the fair exchange of preconfirmation requests</a> from users and responses, the preconfirmations, from the preconfirmers.</p>\n<p>Fair exchange is a hard problem. Users want to get the strongest possible guarantees of inclusion/execution when they submit a request, while preconfirmers want to give the weakest guarantees of inclusion/execution, retaining as much optionality as they can until the block must be built. The most well-known solution we have for fair exchange, albeit for block building, is <a href=\"https://boost.flashbots.net/\" rel=\"noopener nofollow ugc\">mev-boost</a>. This solution hinges on trust in the relayers that execute the fair exchange of blocks between block builders and block proposers. This game started out with a single trusted Flashbots relayer, but now many trusted relayers exist. Some builders even run their own relayer, most notably <a href=\"https://docs.titanrelay.xyz/\" rel=\"noopener nofollow ugc\">Titan</a>. Doesn’t this break the fair exchange guarantees of a trust intermediary? No!</p>\n<p>Titan relay have a significant incentive to never betray the trust of L1 proposers, and indirectly, builders using the Titan relay. With the Titan relay, Titan builder has a clear advantage compared to submitting blocks to any other relay, as Titan builder bids can be updated much quicker at the Titan relay than if the bids needed to first be relayed to an external relay. Furthermore, if any Titan misbehaviour is ever detected (or even reasonably suspected), proposers will stop trusting, listening to, and selecting the Titan relayer. Consequently, Titan would probably lose the edge they get from relaying their own blocks forever if a single misbehaviour is ever detected. This is incredibly powerful. This is the <em>Repeated Sauna Game.</em></p>\n<p>The Repeated Sauna Game can also be played between preconfirmers. Some protocols may pride themselves on trustless approaches to the fair exchange problem: something like a censorship-resistant input tape with strong data-availability guarantees. Unfortunately, this will come at latency, throughput, and cost tradeoffs. In that sense, users and proposers are probably happy to accept guarantees from the Titan of preconfirmations, even if that currently means a centralized entity with no formal guarantees of fair exchange. Thanks to the Repeated Preconfirmation Sauna Game, Titan preconfirmer has just as much to lose, if not more, from misbehaving when offering preconfirmations. With preconfirmations, the preconfirmer will be able to capture revenue from preconfirming, albeit within the bounds of the ordering and execution policies that they commit to offering users and proposers. Thus, the Repeated Preconfirmation Sauna Game has tangible incentives to keep preconfirmers behaving honestly, enabling fair exchange, among many other services where some amount of trust can bridge current technological barriers.</p>\n<p>To summarize, the Repeated Preconfirmation Sauna Game establishes dependable economic trust among rational preconfirmers through:</p>\n<ul>\n<li>The existence of alternative rational and competitive preconfirmers.</li>\n<li>The monitoring of preconfirmer behaviour by many independent observers; users, wallets, proposers, other preconfirmers, etc.</li>\n<li>Reputation and eligibility for future, likely increasing, revenue outweighing short-term incentives to deviate.</li>\n</ul>\n            <p><small>1 post - 1 participant</small></p>\n            <p><a href=\"https://ethresear.ch/t/the-preconfirmation-sauna/19762\">Read full topic</a></p>","link":"https://ethresear.ch/t/the-preconfirmation-sauna/19762","pubDate":"Fri, 07 Jun 2024 17:15:40 +0000","discourse:topicPinned":"No","discourse:topicClosed":"No","discourse:topicArchived":"No","guid":{"@isPermaLink":"false","#text":"ethresear.ch-topic-19762"},"source":{"@url":"https://ethresear.ch/t/the-preconfirmation-sauna/19762.rss","#text":"The Preconfirmation Sauna"},"filter":false},{"title":"Censorship Resistance Through Game Theory","dc:creator":"antonydenyer","category":"Block proposer","description":"<blockquote>\n<p>tldr; relays should divulge more metadata about the block so that validators can make more informed decisions that align with their preferences</p>\n</blockquote>\n<blockquote>\n<p><em>Thanks to <a class=\"mention\" href=\"https://ethresear.ch/u/simbro\">@simbro</a> <a class=\"mention\" href=\"https://ethresear.ch/u/mmp\">@mmp</a> for early feedback</em></p>\n</blockquote>\n<p>Censorship resistance is a fundamental property that underpins the decentralised nature of blockchain networks and ensures the integrity and accessibility of transactions within the system. While the threat of “hard censorship” is well understood, the challenges faced by preventing “soft censorship” resistance are more nuanced.</p>\n<p>“Soft censorship” involves delaying or slowing down the propagation and inclusion of valid transactions. It could be accidental or deliberate; either way, it disrupts the normal flow of transactions, negatively impacts execution quality and harms user experience.</p>\n<p>“Hard censorship” means the complete and permanent prevention or blocking of valid transactions from landing on-chain (e.g., OFAC compliance). The majority of research on censorship resistance has focused on this topic.</p>\n<p>Previous approaches to mitigating censorship have focused on inclusion lists and tend towards some form of unconditionality. A proposer must include a transaction, or it is a protocol violation.</p>\n<aside class=\"quote quote-modified\" data-post=\"1\" data-topic=\"18500\">\n  <div class=\"title\">\n    <div class=\"quote-controls\"></div>\n    <img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://ethresear.ch/user_avatar/ethresear.ch/mikeneuder/48/11832_2.png\" class=\"avatar\">\n    <a href=\"https://ethresear.ch/t/unconditional-inclusion-lists/18500\">Unconditional inclusion lists</a> <a class=\"badge-wrapper  box\" href=\"https://ethresear.ch/c/proof-of-stake/block-proposer/10\"><span class=\"badge-category-parent-bg\" style=\"background-color: #3AB54A;\"></span><span class=\"badge-category-bg\" style=\"background-color: #AB9364;\"></span><span style=\"color: #FFFFFF\" data-drop-close=\"true\" class=\"badge-category clear-badge\" title=\"This is for discussing the implementation of the full proof of stake system.  E.g., going beyond PoS/PoW hybrid to full PoS.\">Block proposer</span></a>\n  </div>\n  <blockquote>\n    <a name=\"unconditional-inclusion-lists-1\" class=\"anchor\" href=\"https://ethresear.ch#unconditional-inclusion-lists-1\"></a>Unconditional inclusion lists\n <a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/2X/d/d6fe238dfb55e13146a0b91b64a514c48122f44d.jpeg\" data-download-href=\"https://ethresear.ch/uploads/default/d6fe238dfb55e13146a0b91b64a514c48122f44d\" title=\"upload_d8336517ff27bb713b162aea8e862611\">[upload_d8336517ff27bb713b162aea8e862611]</a> \n^lol \n\\cdot \nby <a href=\"https://twitter.com/mikeneuder\" rel=\"noopener nofollow ugc\">mike</a> &amp; <a href=\"https://twitter.com/nero_eth\" rel=\"noopener nofollow ugc\">toni</a> based on discussions with <a href=\"https://twitter.com/potuz1\" rel=\"noopener nofollow ugc\">potuz</a> &amp; <a href=\"https://twitter.com/terencechain\" rel=\"noopener nofollow ugc\">terence</a> \n\\cdot \ntuesday – january 30, 2024 \n\\cdot \ntl;dr; Inclusion lists return agency to the proposer in a PBS world by allowing them to express preferences over the transactions included onchain, despite outsourcing their block production to the specialized builder market. This document discretizes the inclusion list design, advocates for a specific feature s…\n  </blockquote>\n</aside>\n\n<p>By applying game theory principles to PBS, incentives can be leveraged to foster etherum aligned outcomes. Our goal is to create a scenario where including all valid transactions and resisting censorship attempts becomes the dominant strategy for block builders. This approach not only addresses the challenges of soft censorship but also mitigates the risks of hard censorship. It has the potential to improve the integrity of ethereum significantly.</p>\n<p>This proposal is not meant to replace inclusion lists but should be considered a progressive move towards more robust forms of censorship resistance.</p>\n<h2><a name=\"what-motivates-validators-1\" class=\"anchor\" href=\"https://ethresear.ch#what-motivates-validators-1\"></a>What motivates validators</h2>\n<p>Under mev-boost, the most profitable block always wins; this assumes that all actors in the PBS auction are rational. However, it fails to account for the fact that some validators are motivated by factors other than profit. PBS has impacted censorship resistance and pushed the network towards centralisation. Many validators (over 8% at last count) refrain from using mev-boost, perhaps because of concerns around censorship and centralisation. Validators may perceive themselves as being more ethereum aligned if they are not running mev-boost because they accept transactions that block builders censor.</p>\n<aside class=\"quote quote-modified\" data-post=\"1\" data-topic=\"19753\">\n  <div class=\"title\">\n    <div class=\"quote-controls\"></div>\n    <img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://ethresear.ch/user_avatar/ethresear.ch/nero_eth/48/14934_2.png\" class=\"avatar\">\n    <a href=\"https://ethresear.ch/t/is-it-worth-using-mev-boost/19753\">Is it worth using MEV-Boost?</a> <a class=\"badge-wrapper  box\" href=\"https://ethresear.ch/c/economics/16\"><span class=\"badge-category-bg\" style=\"background-color: #BF1E2E;\"></span><span style=\"color: #FFFFFF\" data-drop-close=\"true\" class=\"badge-category clear-badge\">Economics</span></a>\n  </div>\n  <blockquote>\n    <a name=\"is-it-worth-using-mev-boost-1\" class=\"anchor\" href=\"https://ethresear.ch#is-it-worth-using-mev-boost-1\"></a>Is it worth using MEV-Boost?\nTo answer that question from an economic perspective, we will look into the APYs. \n&gt; For simplicity, we assume a total of 1 million active validators and ignore sync-committee rewards. \n&gt; The underlying data ranges from November 2023 - 6 June 2024 and includes all slots. \nFirst, let’s check the difference between local block building and using MEV-Boost. \nWe can see that the block reward is higher for MEV-Boost users: \n <a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/e/9/e91a721ea6757f818e7a0fd840534c63a581145e.png\" data-download-href=\"https://ethresear.ch/uploads/default/e91a721ea6757f818e7a0fd840534c63a581145e\" title=\"reward_comparison (3)\">[reward_comparison (3)]</a> \nThe median block rewar…\n  </blockquote>\n</aside>\n\n<h2><a name=\"block-builders-2\" class=\"anchor\" href=\"https://ethresear.ch#block-builders-2\"></a>Block Builders</h2>\n<p>The current implementation of PBS is designed so that block builders will pay the maximum possible to validators, to the detriment of all other factors. One reason PBS was introduced was the idea that block builders would be better at building blocks than validators, especially solo validators. They would be better connected and have access to private order flow. The problem is that better was assumed to mean more profitable. The current optimum strategy is to be a vertically integrated searcher builder that can pay the most for a block. Anything that gets included in that block is secondary and only there to reduce the cost burden on the purchase of the block.</p>\n<p>We need to change the game, so the optimum strategy is to fill the block with as many transactions and blobs as possible within the protocol’s constraints and pay the validator for the privilege. Put another way, block builders should be better at building blocks than validators. To achieve this new optimum strategy, they must be well connected to the far reaches of the network, accept transactions from any source, and include all valid transactions.</p>\n<p>In short we need to force the transaction supply chain to be more representative of validators wishes.</p>\n<p><a href=\"https://www.antonydenyer.co.uk/assets/img/blog/block-proposer-inclusion-lists/censorship-pics.png\" rel=\"noopener nofollow ugc\"><img src=\"https://ethresear.ch/uploads/default/original/3X/b/c/bce4e393de8cc20c5571269b8ac90ab767c26d3d.png\" alt=\"chart showing 10% validators censor - 39% builders censor\" data-base62-sha1=\"qX29IME5hWkSZ1LXpZZEBnIsyLj\" width=\"690\" height=\"316\"></a></p>\n<p>Source: <a href=\"https://censorship.pics/\" rel=\"noopener nofollow ugc\">https://censorship.pics/</a></p>\n<h2><a name=\"how-to-introduce-a-dilemma-3\" class=\"anchor\" href=\"https://ethresear.ch#how-to-introduce-a-dilemma-3\"></a>How to introduce a dilemma</h2>\n<p>Currently, block proposers are missing out on priority fee rewards. Let’s assume an OFAC censored transaction is in the mempool tc, and a block builder creates a ‘censored’ block bc. The total amount of rewards available is bc + tc. However, the block proposer only gets bc. The block proposer is choosing to accept bc because the rewards are greater than what they could build themselves (see <a href=\"https://ethereum.github.io/beacon-APIs/#/Validator/produceBlockV3\" rel=\"noopener nofollow ugc\">builder_boost_factor</a>). The block builder knows it can build a better block than the block proposer as they have more order flow. The only thing that keeps the block builder from bidding just above the fees in a block containing mempool transactions is healthy competition between block builders.</p>\n<p>Previous works have explored the possibility of a multi-proposer system or partial block auctions requiring significant protocol and infrastructure changes.</p>\n<aside class=\"quote quote-modified\" data-post=\"1\" data-topic=\"18777\">\n  <div class=\"title\">\n    <div class=\"quote-controls\"></div>\n    <img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://ethresear.ch/user_avatar/ethresear.ch/mikeneuder/48/11832_2.png\" class=\"avatar\">\n    <a href=\"https://ethresear.ch/t/concurrent-block-proposers-in-ethereum/18777\">Concurrent Block Proposers in Ethereum</a> <a class=\"badge-wrapper  box\" href=\"https://ethresear.ch/c/proof-of-stake/block-proposer/10\"><span class=\"badge-category-parent-bg\" style=\"background-color: #3AB54A;\"></span><span class=\"badge-category-bg\" style=\"background-color: #AB9364;\"></span><span style=\"color: #FFFFFF\" data-drop-close=\"true\" class=\"badge-category clear-badge\" title=\"This is for discussing the implementation of the full proof of stake system.  E.g., going beyond PoS/PoW hybrid to full PoS.\">Block proposer</span></a>\n  </div>\n  <blockquote>\n    <a name=\"concurrent-block-proposers-in-ethereum-1\" class=\"anchor\" href=\"https://ethresear.ch#concurrent-block-proposers-in-ethereum-1\"></a>Concurrent Block Proposers in Ethereum\n <a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/2X/5/5d7f225cd21b2e950c8fb59fe4a2e2864e3b639e.jpeg\" data-download-href=\"https://ethresear.ch/uploads/default/5d7f225cd21b2e950c8fb59fe4a2e2864e3b639e\" title=\"upload_9cfebe6c788a99112f6efb3a851deac0\">[upload_9cfebe6c788a99112f6efb3a851deac0]</a> \n^look ma, we are trying to end the proposer monopoly \n\\cdot \nby <a href=\"https://twitter.com/mikeneuder\" rel=\"noopener nofollow ugc\">mike</a> &amp; <a href=\"https://twitter.com/MaxResnick1\" rel=\"noopener nofollow ugc\">max</a> – friday; february 23, 2024. \n\\cdot \nAbstract: The Ethereum protocol elects a single proposer to produce a block during each 12-second slot. That proposer has unilateral authority over the set of transactions included. As a result, time-sensitive transactions can be censored by a single party. We present an initial analysis of increasing th…\n  </blockquote>\n</aside>\n\n<aside class=\"quote quote-modified\" data-post=\"1\" data-topic=\"13879\">\n  <div class=\"title\">\n    <div class=\"quote-controls\"></div>\n    <img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://ethresear.ch/user_avatar/ethresear.ch/barnabe/48/4742_2.png\" class=\"avatar\">\n    <a href=\"https://ethresear.ch/t/unbundling-pbs-towards-protocol-enforced-proposer-commitments-pepc/13879\">Unbundling PBS: Towards protocol-enforced proposer commitments (PEPC)</a> <a class=\"badge-wrapper  box\" href=\"https://ethresear.ch/c/economics/16\"><span class=\"badge-category-bg\" style=\"background-color: #BF1E2E;\"></span><span style=\"color: #FFFFFF\" data-drop-close=\"true\" class=\"badge-category clear-badge\">Economics</span></a>\n  </div>\n  <blockquote>\n    Many thanks to <a class=\"mention\" href=\"https://ethresear.ch/u/fradamt\">@fradamt</a> <a class=\"mention\" href=\"https://ethresear.ch/u/casparschwa\">@casparschwa</a> <a class=\"mention\" href=\"https://ethresear.ch/u/vbuterin\">@vbuterin</a> <a class=\"mention\" href=\"https://ethresear.ch/u/ralexstokes\">@ralexstokes</a> <a class=\"mention\" href=\"https://ethresear.ch/u/nikete\">@nikete</a> for discussions and comments related to the following post. Personal opinions are expressed in the first-person-singular. \nProtecting the proposer and ensuring liveness of the chain are a big part of why PBS is considered to be moved into the Ethereum protocol. Ideally, when the proposer utilises the services of a builder, there is a contract between parties for the delivery of some goods (valuable blockspace), and the contract …\n  </blockquote>\n</aside>\n\n<h2><a name=\"proposer-inclusion-lists-4\" class=\"anchor\" href=\"https://ethresear.ch#proposer-inclusion-lists-4\"></a>Proposer inclusion lists</h2>\n<p>To introduce some form of dilemma for the block builder, the block proposer should have better visibility of what they are delegating. Currently, the relay only exposes information about fee rewards and gas used. We could <a href=\"https://github.com/ethereum/beacon-APIs/issues/450\" rel=\"noopener nofollow ugc\">extend builder_boost_factor</a> to include an opinion about gas used that would only require changes on the consensus layer client. But let’s go much further; the relay should publish the transaction hashes of the winning bid. The consensus layer client can then check against its view of the mempool and decide if it wants to delegate block building to that relay.</p>\n<p>To frame this in more formal game theoretical terms and notation, we can consider the interaction between the block proposer and the block builder as a strategic game. This game involves decisions on whether to include certain transactions (t1 and t2) in the block, based on the incentives (tips and MEV) associated with each transaction. The players in this game are the block proposer and the block builder, and their strategies involve deciding which transactions to include or censor.</p>\n<h2><a name=\"game-setup-5\" class=\"anchor\" href=\"https://ethresear.ch#game-setup-5\"></a>Game Setup</h2>\n<p>Players: Block Proposer (P) and Block Builder (B).</p>\n<h2><a name=\"strategies-6\" class=\"anchor\" href=\"https://ethresear.ch#strategies-6\"></a>Strategies:</h2>\n<p>For Block Proposer <code>(P)</code>: Accept <code>(A)</code> or Censor <code>(C)</code> transactions.</p>\n<p>For Block Builder <code>(B)</code>: Accept <code>(A)</code> or Censor <code>(C)</code> transactions.</p>\n<p>Payoffs: Defined in terms of gwei received from tips and MEV.</p>\n<h2><a name=\"transactions-7\" class=\"anchor\" href=\"https://ethresear.ch#transactions-7\"></a>Transactions</h2>\n<p><code>t1</code>: A censored public mempool transaction paying <code>1</code> gwei in tips.</p>\n<p><code>t2</code>: A private transaction paying <code>2</code> gwei in tips and <code>2</code> gwei in MEV.</p>\n<h2><a name=\"payoff-matrix-8\" class=\"anchor\" href=\"https://ethresear.ch#payoff-matrix-8\"></a>Payoff Matrix</h2>\n<p>The outcomes of the game can be represented in a payoff matrix where the rows represent the Block Builder’s strategies, and the columns represent the Block Proposer’s strategies. The payoffs are represented as tuples, with the first element being the payoff for the Block Proposer and the second element being the payoff for the Block Builder.</p>\n<div class=\"md-table\">\n<table>\n<thead>\n<tr>\n<th>B \\ P</th>\n<th>Accept (A)</th>\n<th>Censor (C)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Accept (A)</td>\n<td>(3, 2)</td>\n<td>(3, 2)</td>\n</tr>\n<tr>\n<td>Censor (C)</td>\n<td>(1, 0)</td>\n<td>(2, 2)</td>\n</tr>\n</tbody>\n</table>\n</div><h2><a name=\"analysis-9\" class=\"anchor\" href=\"https://ethresear.ch#analysis-9\"></a>Analysis</h2>\n<p>Builder censors and proposer censors (C, C): The block contains <code>t2</code>. The proposer receives <code>2</code> gwei in tips, and the builder receives <code>2</code> gwei in MEV. This is a Win-Lose scenario in the original description, but in game-theoretical terms, it’s a Nash Equilibrium if the builder’s payoff for censoring is higher than accepting without proposer enforcement.</p>\n<p>Builder censors and proposer accepts (C, A): The proposer chooses to build a block with <code>t1</code>, receiving <code>1</code> gwei in tips. The validator is “eth aligned” and wishes to forgo the additional rewards. It is a Lose-Lose scenario, indicating a misalignment of strategies leading to suboptimal payoffs for both players.</p>\n<p>Builder accepts and proposer accepts (A, A): The block contains both <code>t1</code> and <code>t2</code>. The proposer receives <code>3</code> gwei in tips, and the builder receives <code>2</code> gwei in MEV. This is a Win-Win scenario, representing a Pareto optimal outcome where no player can be made better off without making the other player worse off.</p>\n<p>Builder accepts and proposer censors/doesn’t enforce (A, C): The block contains both <code>t1</code> and <code>t2</code> because it is more profitable. The proposer receives <code>3</code> gwei in tips, and the builder receives <code>2</code> gwei in MEV. This is also a Win-Win scenario, similar to (A, A), indicating that the proposer’s decision to censor does not change the outcome due to the builder’s acceptance.</p>\n<p>In this strategic game, the optimal outcomes for both players are when both accept the transactions, leading to a Win-Win situation. The game illustrates the importance of alignment in strategies between the block proposer and the block builder to maximize their respective payoffs.</p>\n<h2><a name=\"summary-10\" class=\"anchor\" href=\"https://ethresear.ch#summary-10\"></a>Summary</h2>\n<p>Some validators need to be irrational (10% already are) whilst using mev-boost. Solo Validators Can Stay Retarded Longer Than Block Builders Can Stay Solvent.</p>\n<p>The threat of not accepting a block builder’s block should be enough incentive for them to choose not to censor transactions.</p>\n<p>Which validators censor and which do not will become apparent over time. This may mean that block builders will change their tactics depending on who is proposing the next block.</p>\n<p>Smaller transactions and participants are less likely to be sidelined by profit-maximising behaviour. This will lead to priority fees trending downwards.</p>\n<p>Block builders will help strengthen the network rather than centralise it.</p>\n<p>No hard fork required. The only changes needed are in the relay spec, the consensus layer client and some minor changes in the execution client.</p>\n<p>The only downside I can foresee is that relays may be leaking some information to other block builders.</p>\n<p>Minor changes to clients</p>\n<p>Minor changes to relay infrastructure</p>\n<h1><a name=\"conclusion-11\" class=\"anchor\" href=\"https://ethresear.ch#conclusion-11\"></a>Conclusion</h1>\n<p>In summary, by leveraging game theory principles, this proposal aims to significantly reduce transaction censorship by block builders, fostering a more inclusive and decentralized network. In the best case, it will lead to the cessation of censorship practices among block builders, enhancing the network’s integrity. In the worst case, given the relatively minor changes required, it might represent a learning opportunity with minimal loss. At the very least, it promises to stimulate more competition and differentiation within the block builder market, contributing to the overall health and diversity of the ecosystem.</p>\n            <p><small>1 post - 1 participant</small></p>\n            <p><a href=\"https://ethresear.ch/t/censorship-resistance-through-game-theory/19760\">Read full topic</a></p>","link":"https://ethresear.ch/t/censorship-resistance-through-game-theory/19760","pubDate":"Fri, 07 Jun 2024 07:48:03 +0000","discourse:topicPinned":"No","discourse:topicClosed":"No","discourse:topicArchived":"No","guid":{"@isPermaLink":"false","#text":"ethresear.ch-topic-19760"},"source":{"@url":"https://ethresear.ch/t/censorship-resistance-through-game-theory/19760.rss","#text":"Censorship Resistance Through Game Theory"},"filter":false},{"title":"1st completely trustless Blockchain, using pure math and zk-snarks for validation. = High censorship resistance","dc:creator":"cryptskii","category":"zk-s[nt]arks","description":"<h1><a name=\"private-scalable-fully-decentralized-payment-network-without-compromise-1\" class=\"anchor\" href=\"https://ethresear.ch#private-scalable-fully-decentralized-payment-network-without-compromise-1\"></a>Private Scalable Fully Decentralized Payment Network <em>(Without Compromise)</em></h1>\n<p><strong>Brandon “Cryptskii” Ramsay</strong></p>\n<h1><a name=\"abstract-2\" class=\"anchor\" href=\"https://ethresear.ch#abstract-2\"></a>Abstract</h1>\n<p>This research paper presents a novel decentralized payment network model that leverages zero-knowledge proofs (ZKPs) to ensure transaction validity and balance consistency without relying on validators or consensus mechanisms. The network features a fixed token supply, airdropped to participants at inception, eliminating the need for mining and associated costs. The core design focuses on direct mutual verification between sender and receiver, with an extensive exploration of the underlying mathematical foundations, formal proofs, algorithms, and data structures underpinning this system.</p>\n<p>The proposed payment network aims to address key challenges faced by existing decentralized payment systems, such as high transaction costs, scalability limitations, and privacy concerns. By employing ZKPs and a unilateral payment channel architecture, the network enables efficient, secure, and privacy-preserving transactions without the need for intermediaries or complex consensus protocols. The paper provides a comprehensive analysis of the system’s security, privacy, and scalability properties, along with detailed comparisons to alternative approaches. The underlying mathematical framework and formal proofs are rigorously defined, ensuring the robustness and correctness of the proposed model.</p>\n<h1><a name=\"introduction-3\" class=\"anchor\" href=\"https://ethresear.ch#introduction-3\"></a>Introduction</h1>\n<p>Decentralized payment systems have garnered significant attention due to their potential to provide secure, transparent, and efficient financial transactions without intermediaries. However, existing solutions often face challenges related to high transaction costs, scalability limitations, and privacy concerns. This research introduces a novel decentralized payment network that leverages zero-knowledge proofs (ZKPs) and unilateral payment channels to address these issues.</p>\n<p>The proposed network architecture is designed to address specific challenges faced by existing decentralized payment systems:</p>\n<ol>\n<li>The absence of mining and associated costs solves the issue of high transaction fees and energy consumption in traditional proof-of-work-based systems.</li>\n<li>The elimination of validators and consensus mechanisms tackles the scalability limitations and potential centralization risks in proof-of-stake and delegated systems.</li>\n<li>The use of storage partitioning and off-chain payment channels addresses the scalability and privacy concerns associated with storing all transactions on-chain.</li>\n</ol>\n<p>By distributing a fixed token supply to participants at the network’s inception, the system eliminates the need for mining and its associated costs. The network focuses on enabling direct mutual verification of transactions between senders and receivers, ensuring the validity of transactions and the consistency of account balances without relying on validators or consensus mechanisms. By leveraging zk-SNARKs, the network allows for direct proof of validity between sender and receiver, as the succinct zero-knowledge proofs inherently prove the correctness of transactions.</p>\n<p>To enhance efficiency and scalability, the network uses a multi-tier Merkle tree system with Merkle proofs, ensuring that only a constant succinct size <span class=\"math\">(O(1))</span> of data is submitted to the blockchain. This design minimizes on-chain storage requirements and ensures data availability.</p>\n<p>At the core of this novel payment network lies a comprehensive mathematical framework that leverages zero-knowledge proofs, particularly zk-SNARKs, to validate transactions and generate wallet state proofs. These proofs enable efficient verification of transaction validity and balance updates while preserving user privacy.</p>\n<p>The network’s architecture is composed of several key components, including unilateral payment channels, hierarchical smart contracts, and partitioned storage nodes. These components work together to enable scalable, secure, and privacy-preserving transactions, while minimizing on-chain storage requirements and ensuring data availability.</p>\n<p>To ensure the robustness and correctness of the proposed model, the paper presents formal algorithms, theorems, and proofs for crucial aspects of the system, such as the Balance Consistency Theorem and the dispute resolution mechanism. These mathematical formalisms provide a solid foundation for the security and reliability of the payment network.</p>\n<p>Furthermore, the paper includes an in-depth analysis of the network’s security, privacy, and scalability properties, highlighting its advantages over alternative approaches, such as traditional blockchain-based payment systems and centralized payment networks. The analysis also acknowledges potential limitations and challenges, such as the complexity of zk-SNARK implementations and the need for ongoing optimizations.</p>\n<p>The main contributions of this research can be summarized as follows:</p>\n<ol>\n<li>A comprehensive mathematical framework for ensuring transaction validity and balance consistency using zero-knowledge proofs, particularly zk-SNARKs.</li>\n<li>A detailed description of the network’s architecture, including unilateral payment channels, hierarchical smart contracts, and partitioned storage nodes.</li>\n<li>Formal algorithms, theorems, and proofs for key components of the system, such as the Balance Consistency Theorem, zk-SNARK proof generation, smart contract verification, and dispute resolution.</li>\n<li>An in-depth analysis of the network’s security, privacy, and scalability properties, along with detailed comparisons to alternative approaches.</li>\n<li>An exploration of promising use cases that leverage the enhanced privacy features of the proposed system.</li>\n</ol>\n<p>The proposed decentralized payment network presents a promising approach to enabling secure, private, and scalable transactions in a decentralized setting, paving the way for more efficient and accessible financial services on the blockchain. The extensive mathematical formalism and rigorous analysis provided in this paper contribute to the growing body of research on decentralized payment systems and demonstrate the potential of zero-knowledge proofs in enhancing the security, privacy, and scalability of blockchain-based financial applications.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/d/6/d6d467a101f5b9aae81288f1c0d30234082f2bcd.jpeg\" data-download-href=\"https://ethresear.ch/uploads/default/d6d467a101f5b9aae81288f1c0d30234082f2bcd\" title=\"DALL·E_2024-06-05_20.49.33_-_A_high-level_overview_of_a_decentralized_payment_network_architecture._The_diagram_includes_Off-Cha\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/d/6/d6d467a101f5b9aae81288f1c0d30234082f2bcd_2_575x499.jpeg\" alt=\"DALL·E_2024-06-05_20.49.33_-_A_high-level_overview_of_a_decentralized_payment_network_architecture._The_diagram_includes_Off-Cha\" data-base62-sha1=\"uEtfJQwTCmabOiEAZSjJdDoxXeB\" width=\"575\" height=\"499\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/d/6/d6d467a101f5b9aae81288f1c0d30234082f2bcd_2_575x499.jpeg, https://ethresear.ch/uploads/default/optimized/3X/d/6/d6d467a101f5b9aae81288f1c0d30234082f2bcd_2_862x748.jpeg 1.5x, https://ethresear.ch/uploads/default/original/3X/d/6/d6d467a101f5b9aae81288f1c0d30234082f2bcd.jpeg 2x\" data-dominant-color=\"D4D5CF\"></a></div><p></p>\n<h1><a name=\"background-4\" class=\"anchor\" href=\"https://ethresear.ch#background-4\"></a>Background</h1>\n<p>This section introduces the key concepts and technologies used in the proposed decentralized payment network, providing a solid foundation for understanding the system’s design and functionality.</p>\n<h2><a name=\"zero-knowledge-proofs-zkps-5\" class=\"anchor\" href=\"https://ethresear.ch#zero-knowledge-proofs-zkps-5\"></a>Zero-Knowledge Proofs (ZKPs)</h2>\n<p>Zero-knowledge proofs (ZKPs) are cryptographic protocols that enable one party (the prover) to prove to another party (the verifier) that a statement is true without revealing any information beyond the validity of the statement itself. ZKPs have numerous applications in blockchain technology, particularly in privacy-preserving transactions and scalable off-chain solutions.</p>\n<p>One prominent type of ZKP is zk-SNARKs (Zero-Knowledge Succinct Non-Interactive Arguments of Knowledge). zk-SNARKs enable the generation of succinct proofs that can be verified quickly, making them well-suited for blockchain applications where proofs need to be stored on-chain and verified by multiple parties.</p>\n<p><strong>Definition</strong>: A zero-knowledge proof for a statement <span class=\"math\">S</span> is a protocol between a prover <span class=\"math\">P</span> and a verifier <span class=\"math\">V</span> such that:</p>\n<ul>\n<li><strong>Completeness</strong>: If <span class=\"math\">S</span> is true, <span class=\"math\">V</span> will be convinced by <span class=\"math\">P</span> with high probability.</li>\n<li><strong>Soundness</strong>: If <span class=\"math\">S</span> is false, <span class=\"math\">V</span> will not be convinced by <span class=\"math\">P</span> except with negligible probability.</li>\n<li><strong>Zero-Knowledge</strong>: If <span class=\"math\">S</span> is true, <span class=\"math\">V</span> learns nothing beyond the fact that <span class=\"math\">S</span> is true.</li>\n</ul>\n<p>In the proposed decentralized payment network, zk-SNARKs are employed to prove the validity of transactions and generate wallet state proofs, ensuring the privacy and security of user balances while enabling efficient verification.</p>\n<h1><a name=\"system-architecture-6\" class=\"anchor\" href=\"https://ethresear.ch#system-architecture-6\"></a>System Architecture</h1>\n<p>The proposed decentralized payment network consists of several key components: off-chain payment channels, hierarchical smart contracts, and partitioned storage nodes. This section provides a detailed description of each component and their interactions within the overall system.<br>\nCertainly! Here is the document reformatted in Markdown with low-level LaTeX math included:</p>\n<h3><a name=\"unilateral-payment-channels-7\" class=\"anchor\" href=\"https://ethresear.ch#unilateral-payment-channels-7\"></a>Unilateral Payment Channels</h3>\n<p>Payment channels are a key component of scalable blockchain solutions, enabling off-chain transactions between parties without the need to record every transaction on the main blockchain. In the proposed network, each user has a unilateral payment channel associated with their wallet contract, which holds their tokens off-chain. This design choice simplifies channel management and enables cross-partition transactions.</p>\n<p><strong>Definition:</strong> A unilateral payment channel between a user <span class=\"math\">U</span> and their wallet contract <span class=\"math\">W</span> is a tuple <span class=\"math\">(B, T_1, T_2, \\ldots, T_n)</span>, where:</p>\n<ul>\n<li><span class=\"math\">B</span> is the initial balance of <span class=\"math\">U</span> in the payment channel.</li>\n<li><span class=\"math\">T_1, T_2, \\ldots, T_n</span> are the transactions executed within the payment channel.</li>\n</ul>\n<p>The final state of the payment channel is determined by the cumulative effect of all transactions <span class=\"math\">T_1, T_2, \\ldots, T_n</span> on the initial balance <span class=\"math\">B</span>.</p>\n<p>To set up a unilateral payment channel, a user creates a wallet contract on the blockchain and transfers the desired amount of tokens to the contract. The wallet contract manages the user’s off-chain balance and state updates through zk-SNARK proofs. When a user wants to transfer tokens to another user, they generate a zk-SNARK proof that verifies the validity of the transaction and includes the necessary metadata for the recipient to generate the next transaction proof. This design enables instant transaction finality and eliminates the need for on-chain confirmation.</p>\n<h3><a name=\"example-1-unilateral-payment-channel-setup-and-transactions-8\" class=\"anchor\" href=\"https://ethresear.ch#example-1-unilateral-payment-channel-setup-and-transactions-8\"></a>Example 1: Unilateral Payment Channel Setup and Transactions</h3>\n<p>Suppose Alice wants to set up a unilateral payment channel with an initial balance of 100 tokens. She creates a wallet contract <span class=\"math\">W_A</span> on the blockchain and transfers 100 tokens to it. The wallet contract initializes Alice’s off-chain balance to 100 tokens.</p>\n<p>Later, Alice decides to send 30 tokens to Bob. She generates a zk-SNARK proof <span class=\"math\">\\pi_1</span> that verifies the validity of the transaction, including the availability of sufficient funds and the correctness of the updated balances. Upon generating the proof <span class=\"math\">\\pi_1</span>, the wallet contract immediately locks 30 tokens, reducing Alice’s available balance to 70 tokens. Alice sends the transaction details and the proof <span class=\"math\">\\pi_1</span> to Bob.</p>\n<p>Bob verifies the proof <span class=\"math\">\\pi_1</span> to ensure the transaction’s validity. If the proof is valid, Alice and Bob update their local off-chain balances accordingly. Alice’s balance remains 70 tokens, while Bob’s balance increases by 30 tokens. Both parties sign the proof <span class=\"math\">\\pi_1</span> to authorize the future rebalancing of their respective payment channels.</p>\n<p>If Bob does not accept the proof within a specified timeout period, the smart contract automatically releases the locked funds back to Alice’s available balance, ensuring no funds are indefinitely locked.</p>\n<p>This example demonstrates how unilateral payment channels enable secure, off-chain transactions between users while preserving privacy and scalability.</p>\n<h3><a name=\"off-chain-payment-channel-operations-9\" class=\"anchor\" href=\"https://ethresear.ch#off-chain-payment-channel-operations-9\"></a>Off-Chain Payment Channel Operations</h3>\n<p>As introduced in Section 2, off-chain payment channels form the foundation of the proposed network’s scalability. Each user has a unilateral payment channel associated with their wallet contract, which holds their tokens off-chain. The channel setup and transaction process can be formally described as follows:</p>\n<p><strong>Channel Setup</strong></p>\n<pre><code class=\"lang-auto\">\\begin{algorithm}[H]\n\\caption{Unilateral Payment Channel Setup}\n\\begin{algorithmic}[1]\n\\Procedure{SetupChannel}{$U, W, B$}\n\\State $U$ creates a wallet contract $W$ on the blockchain\n\\State $U$ transfers $B$ tokens to $W$\n\\State $W$ initializes the off-chain balance of $U$ to $B$\n\\State \\textbf{return} $W$\n\\EndProcedure\n\\end{algorithmic}\n\\end{algorithm}\n</code></pre>\n<p>Here, <span class=\"math\">U</span> represents the user, <span class=\"math\">W</span> is the wallet contract, and <span class=\"math\">B</span> is the initial balance in the payment channel.</p>\n<p><strong>Off-Chain Transactions</strong></p>\n<pre><code class=\"lang-auto\">\\begin{algorithm}[H]\n\\caption{Off-Chain Transaction}\n\\begin{algorithmic}[1]\n\\Procedure{OffchainTransaction}{$S, R, T$}\n\\State $S$ generates a zk-SNARK proof $\\pi$ for the transaction $T$\n\\State $S$'s wallet contract locks the transaction amount\n\\State $S$ sends $(T, \\pi)$ to $R$\n\\State $R$ verifies $\\pi$ to ensure the validity of $T$\n\\If{$\\pi$ is valid}\n\\State $S$ updates their local off-chain balance\n\\State $R$ updates their local off-chain balance\n\\State $S$ and $R$ sign $\\pi$ to authorize rebalancing\n\\Else\n\\State $S$'s wallet contract releases the locked amount after timeout\n\\EndIf\n\\State \\textbf{return} $(T, \\pi)$\n\\EndProcedure\n\\end{algorithmic}\n\\end{algorithm}\n</code></pre>\n<p>Here, <span class=\"math\">S</span> represents the sender, <span class=\"math\">R</span> is the receiver, and <span class=\"math\">T</span> is the transaction. The zk-SNARK proof <span class=\"math\">\\pi</span> verifies the validity of the transaction, including the availability of sufficient funds and the correctness of the updated balances. If the proof is valid, both parties update their local off-chain balances and sign the proof to authorize the future rebalancing of their payment channels. If the proof is not accepted within a specified timeout period, the smart contract automatically releases the locked funds back to the sender’s available balance.</p>\n<h3><a name=\"hierarchical-smart-contracts-10\" class=\"anchor\" href=\"https://ethresear.ch#hierarchical-smart-contracts-10\"></a>Hierarchical Smart Contracts</h3>\n<p>The hierarchical smart contract structure is a key component of the proposed network, enabling efficient rebalancing of payment channels and management of cross-partition transactions. The structure consists of three layers: root contracts, intermediate contracts, and wallet contracts.</p>\n<ul>\n<li>\n<p><strong>Root Contracts:</strong></p>\n<p><strong>Responsibilities:</strong></p>\n<ul>\n<li>Serve as the entry point for users and maintain a mapping of intermediate contracts.</li>\n<li>Aggregate Merkle roots from intermediate contracts and submit a single, final aggregated Merkle root.</li>\n<li>Submit the final Merkle root to the blockchain at regular intervals, ensuring the global state is verifiable on-chain with minimal frequency and cost being a constant size <span class=\"math\">O(1)</span>.</li>\n</ul>\n</li>\n<li>\n<p><strong>Intermediate Contracts:</strong></p>\n<p><strong>Responsibilities:</strong></p>\n<ul>\n<li>Manage liquidity pools for specific transaction types or user groups.</li>\n<li>Maintain a mapping of wallet contracts and are responsible for rebalancing payment channels based on the transaction proofs submitted by users.</li>\n<li>Collect Merkle roots from wallet contracts and aggregate them into a single Merkle tree within their partition.</li>\n<li>Periodically submit the aggregated Merkle root to the root contract.</li>\n<li>Ensure the state within their partition is verifiable on-chain with minimal frequency and cost.</li>\n</ul>\n</li>\n<li>\n<p><strong>Wallet Contracts:</strong></p>\n<p><strong>Responsibilities:</strong></p>\n<ul>\n<li>Represent individual user payment channels and hold the users’ off-chain balances.</li>\n<li>Generate zk-SNARK proofs for their state and submit these proofs to the storage nodes.</li>\n<li>Store proofs to the storage nodes for data availability.</li>\n</ul>\n</li>\n</ul>\n<p>The hierarchical structure allows for efficient liquidity management and reduced on-chain transaction costs, as rebalancing operations are performed at the intermediate level, and the root contracts only need to process periodic updates.</p>\n<h3><a name=\"example-3-hierarchical-smart-contract-interaction-11\" class=\"anchor\" href=\"https://ethresear.ch#example-3-hierarchical-smart-contract-interaction-11\"></a>Example 3: Hierarchical Smart Contract Interaction</h3>\n<p>Continuing with the previous examples, suppose Alice, Bob, Carol, and David belong to the same user group managed by an intermediate contract <span class=\"math\">IC_1</span>. The intermediate contract <span class=\"math\">IC_1</span> is mapped to a root contract <span class=\"math\">RC</span>.</p>\n<ul>\n<li>\n<p>When Alice sends 30 tokens to Bob (transaction <span class=\"math\">T_1</span>), she generates a zk-SNARK proof <span class=\"math\">\\pi_1</span>. Upon generating the proof <span class=\"math\">\\pi_1</span>, Alice’s wallet contract immediately locks 30 tokens, reducing her available balance accordingly. The transaction proof <span class=\"math\">\\pi_1</span> is then submitted to the intermediate contract <span class=\"math\">IC_1</span>. The intermediate contract verifies the proof and updates the balances of Alice’s and Bob’s wallet contracts accordingly.</p>\n</li>\n<li>\n<p>Similarly, when Alice receives 50 tokens from Carol (transaction <span class=\"math\">T_2</span>), Carol generates a zk-SNARK proof <span class=\"math\">\\pi_2</span>. Upon generating the proof <span class=\"math\">\\pi_2</span>, Carol’s wallet contract immediately locks 50 tokens, reducing her available balance. The transaction proof <span class=\"math\">\\pi_2</span> is then submitted to <span class=\"math\">IC_1</span>, which verifies the proof and updates the balances of Alice’s and Carol’s wallet contracts.</p>\n</li>\n<li>\n<p>Periodically, the intermediate contract <span class=\"math\">IC_1</span> submits a summary of the balance updates to the root contract <span class=\"math\">RC</span>, which maintains a global view of the network’s state by submitting a single aggregated Merkle root to the blockchain.</p>\n</li>\n</ul>\n<p>This hierarchical structure, with the immediate balance locking mechanism, ensures that all transactions are secure and funds are not double spent, even if there are delays in transaction acceptance or verification.</p>\n<h3><a name=\"storage-nodes-and-blockchain-interaction-12\" class=\"anchor\" href=\"https://ethresear.ch#storage-nodes-and-blockchain-interaction-12\"></a>Storage Nodes and Blockchain Interaction</h3>\n<p>To ensure data availability and scalability, the proposed network employs storage nodes that store the off-chain transaction history and wallet state proofs. Each storage node maintains a copy of the entire off-chain data, ensuring redundancy and decentralization.</p>\n<p><strong>Storage Node Operations:</strong></p>\n<ul>\n<li><strong>Storing Proofs:</strong> Storage nodes store zk-SNARK proofs for individual wallet states. Each wallet maintains its own Merkle tree that includes these proofs.</li>\n<li><strong>Aggregating Data:</strong> At regular intervals, storage nodes aggregate the off-chain data into a single Merkle root, representing the state of all payment channels they manage. This Merkle root is then submitted to the intermediate contracts.</li>\n</ul>\n<pre><code class=\"lang-python\">def store_proof(proof, user, wallet):\n    # Store the proof for user and wallet contract\n    # Update the local Merkle tree with the proof\n\ndef submit_merkle_root():\n    # Generate the Merkle root for all stored proofs\n    # Submit the Merkle root to the intermediate contract\n</code></pre>\n<p>The blockchain acts as a secure and immutable ledger, storing the Merkle roots submitted by the root contract. This allows for efficient</p>\n<p>verification of the network’s global state, as any discrepancies between the off-chain data and the on-chain Merkle roots can be easily detected and resolved.</p>\n<p>This hierarchical structure enables efficient verification of individual payment channels and the entire network state without storing the full transaction history on-chain. By leveraging the security and immutability of the blockchain while keeping the majority of the data off-chain, the proposed network achieves a balance between scalability, data availability, and security.</p>\n<h3><a name=\"example-4-storage-node-operation-and-blockchain-interaction-13\" class=\"anchor\" href=\"https://ethresear.ch#example-4-storage-node-operation-and-blockchain-interaction-13\"></a>Example 4: Storage Node Operation and Blockchain Interaction</h3>\n<p>Following the previous examples, suppose storage node <span class=\"math\">SN_1</span> is responsible for storing the transaction proofs and wallet state proofs for Alice, Bob, Carol, and David.</p>\n<ul>\n<li>When Alice generates a wallet state proof <span class=\"math\">\\pi_s</span> after transactions <span class=\"math\">T_1, T_2,</span> and <span class=\"math\">T_3</span>, she submits the proof to the storage node <span class=\"math\">SN_1</span>. The storage node stores the proof and updates its local Merkle tree with the new proof.</li>\n<li>Similarly, when Bob, Carol, and David generate their wallet state proofs, they submit them to <span class=\"math\">SN_1</span>, which stores the proofs and updates its local Merkle tree accordingly.</li>\n<li>At the end of each epoch, <span class=\"math\">SN_1</span> generates a Merkle root <span class=\"math\">R</span> that represents the state of all payment channels it manages. The storage node then submits the Merkle root <span class=\"math\">R</span> to the intermediate contract, providing a compact and tamper-evident snapshot of the network’s state.</li>\n<li>The intermediate contract aggregates the Merkle roots from all storage nodes within its partition and submits a single final Merkle root to the root contract.</li>\n<li>The root contract aggregates the Merkle roots from all intermediate contracts and submits a single final Merkle root to the blockchain.</li>\n<li>The blockchain stores the submitted Merkle root, allowing for efficient verification of the network’s global state. If any discrepancies arise between the off-chain data and the on-chain Merkle roots, they can be easily detected and resolved using the dispute resolution mechanism described in the following section.</li>\n</ul>\n<p>This hierarchical structure, combined with immediate balance locking and zk-SNARK proofs, ensures secure, efficient, and scalable off-chain transactions, maintaining the integrity and security of the overall network.</p>\n<h1><a name=\"transaction-validity-and-balance-consistency-14\" class=\"anchor\" href=\"https://ethresear.ch#transaction-validity-and-balance-consistency-14\"></a>Transaction Validity and Balance Consistency</h1>\n<p>To ensure the validity of transactions and the consistency of account balances, the proposed payment network employs a combination of zero-knowledge proofs and formal mathematical proofs. This section presents the core theorems and algorithms that underpin the system’s security and correctness. <em>(as stated in the abstract, we have a fixed supply released in full at genesis)</em></p>\n<h2><a name=\"transaction-validity-15\" class=\"anchor\" href=\"https://ethresear.ch#transaction-validity-15\"></a>Transaction Validity</h2>\n<p>Each transaction in the proposed network is accompanied by a zk-SNARK proof that verifies the following conditions:</p>\n<ul>\n<li>The sender has sufficient balance to cover the transaction amount.</li>\n<li>The sender’s updated balance is correctly computed.</li>\n<li>The receiver’s updated balance is correctly computed.</li>\n</ul>\n<p>Let <span class=\"math\">T_i</span> be a transaction in which sender <span class=\"math\">S</span> transfers <span class=\"math\">\\Delta_i</span> tokens to receiver <span class=\"math\">R</span>. The accompanying zk-SNARK proof <span class=\"math\">\\pi_i</span> ensures the following conditions:</p>\n<div class=\"math\">\n\\begin{align*}\nB_S &amp;\\geq \\Delta_i \\\\\nB'_S &amp;= B_S - \\Delta_i \\\\\nB'_R &amp;= B_R + \\Delta_i\n\\end{align*}\n</div>\n<p>where <span class=\"math\">B_S</span> and <span class=\"math\">B_R</span> are the initial balances of <span class=\"math\">S</span> and <span class=\"math\">R</span>, respectively, and <span class=\"math\">B'_S</span> and <span class=\"math\">B'_R</span> are the updated balances after the transaction.</p>\n<h2><a name=\"balance-consistency-16\" class=\"anchor\" href=\"https://ethresear.ch#balance-consistency-16\"></a>Balance Consistency</h2>\n<p>To prove the consistency of account balances in the presence of valid transactions, we present the following theorem:</p>\n<p><strong>Theorem (Balance Consistency)</strong>: Given a series of valid transactions <span class=\"math\">T_1, T_2, \\ldots, T_n</span> between two parties <span class=\"math\">S</span> and <span class=\"math\">R</span>, the final balances <span class=\"math\">B'_S</span> and <span class=\"math\">B'_R</span> satisfy:</p>\n<div class=\"math\">\nB'_S + B'_R = B_S + B_R\n</div>\n<p>where <span class=\"math\">B_S</span> and <span class=\"math\">B_R</span> are the initial balances of <span class=\"math\">S</span> and <span class=\"math\">R</span>, respectively.</p>\n<p><strong>Proof</strong>: We prove the theorem by induction on the number of transactions <span class=\"math\">n</span>.</p>\n<p><strong>Base case</strong>: For <span class=\"math\">n = 1</span>, we have a single transaction <span class=\"math\">T_1</span> with amount <span class=\"math\">\\Delta_1</span>. The updated balances after the transaction are:</p>\n<div class=\"math\">\n\\begin{align*}\nB'_S &amp;= B_S - \\Delta_1 \\\\\nB'_R &amp;= B_R + \\Delta_1\n\\end{align*}\n</div>\n<p>Adding the above equations yields:</p>\n<div class=\"math\">\nB'_S + B'_R = B_S + B_R\n</div>\n<p><strong>Inductive step</strong>: Assume the theorem holds for <span class=\"math\">n = k</span> transactions. We prove that it also holds for <span class=\"math\">n = k + 1</span> transactions.</p>\n<p>Let <span class=\"math\">B^{(k)}_S</span> and <span class=\"math\">B^{(k)}_R</span> be the balances after the first <span class=\"math\">k</span> transactions. By the induction hypothesis, we have:</p>\n<div class=\"math\">\nB^{(k)}_S + B^{(k)}_R = B_S + B_R\n</div>\n<p>Now, consider the <span class=\"math\">(k+1)</span>-th transaction <span class=\"math\">T_{k+1}</span> with amount <span class=\"math\">\\Delta_{k+1}</span>. The updated balances after this transaction are:</p>\n<div class=\"math\">\n\\begin{align*}\nB^{(k+1)}_S &amp;= B^{(k)}_S - \\Delta_{k+1} \\\\\nB^{(k+1)}_R &amp;= B^{(k)}_R + \\Delta_{k+1}\n\\end{align*}\n</div>\n<p>Adding the above equations and substituting the induction hypothesis yields:</p>\n<div class=\"math\">\n\\begin{align*}\nB^{(k+1)}_S + B^{(k+1)}_R &amp;= (B^{(k)}_S - \\Delta_{k+1}) + (B^{(k)}_R + \\Delta_{k+1}) \\\\\n&amp;= B^{(k)}_S + B^{(k)}_R \\\\\n&amp;= B_S + B_R\n\\end{align*}\n</div>\n<p>Therefore, the theorem holds for <span class=\"math\">n = k + 1</span> transactions.</p>\n<p>By the principle of mathematical induction, the theorem holds for any number of valid transactions<br>\n<span class=\"math\">n \\geq 1</span>. <span class=\"math\">\\blacksquare</span></p>\n<p>The Balance Consistency theorem ensures that the total balance of the system remains constant throughout a series of valid transactions, providing a fundamental property for the security and correctness of the proposed payment network.</p>\n<h1><a name=\"fraud-prevention-mechanisms-17\" class=\"anchor\" href=\"https://ethresear.ch#fraud-prevention-mechanisms-17\"></a>Fraud Prevention Mechanisms</h1>\n<p>The proposed decentralized payment network integrates multiple layers of fraud prevention mechanisms through its hierarchical smart contract system and the use of zk-SNARKs. These measures ensure the integrity and consistency of transaction states, inherently preventing the submission of outdated or fraudulent states. This section outlines how these mechanisms work in detail.</p>\n<h3><a name=\"zk-snark-proofs-and-state-updates-18\" class=\"anchor\" href=\"https://ethresear.ch#zk-snark-proofs-and-state-updates-18\"></a>ZK-SNARK Proofs and State Updates</h3>\n<p>The network leverages zk-SNARKs to validate each transaction. The key elements include:</p>\n<ul>\n<li>\n<p><strong>Proof of Validity</strong>: Each transaction within the network must be accompanied by a zk-SNARK proof. This proof verifies several critical aspects:</p>\n<ul>\n<li>The sender has sufficient balance to cover the transaction.</li>\n<li>The sender’s updated balance after the transaction is correctly computed.</li>\n<li>The receiver’s updated balance after the transaction is correctly computed.</li>\n</ul>\n</li>\n<li>\n<p><strong>Consistent State Management</strong>: Each user’s wallet contract maintains a Merkle tree of state proofs. Each state update (i.e., each transaction) is validated through zk-SNARKs, ensuring it is consistent with the previously recorded state. This cryptographic validation prevents unauthorized or incorrect state changes.</p>\n</li>\n</ul>\n<h3><a name=\"prevention-of-old-state-submission-19\" class=\"anchor\" href=\"https://ethresear.ch#prevention-of-old-state-submission-19\"></a>Prevention of Old State Submission</h3>\n<p>The design of the proposed network inherently prevents the submission of outdated or fraudulent states through the following mechanisms:</p>\n<ul>\n<li>\n<p><strong>Proof Consistency</strong>: Each zk-SNARK proof submitted for a state update must be consistent with the latest recorded state. Intermediate contracts aggregate data from wallet contracts, and root contracts submit these aggregated roots to the blockchain. Any attempt to submit an old state would be detected as it would not match the current aggregated Merkle root.</p>\n</li>\n<li>\n<p><strong>On-Chain Verification</strong>: The final aggregated Merkle root submitted by the root contract is stored on the blockchain, providing a tamper-evident record of the global state. During dispute resolution, the submitted state proofs are verified against this on-chain Merkle root to ensure only the most recent valid state is considered.</p>\n</li>\n</ul>\n<h3><a name=\"mitigated-need-for-watchtowers-20\" class=\"anchor\" href=\"https://ethresear.ch#mitigated-need-for-watchtowers-20\"></a>Mitigated Need for Watchtowers</h3>\n<p>Due to the robust fraud prevention mechanisms built into the proposed system, the traditional need for watchtowers entities that monitor the blockchain for malicious activities and act on behalf of users is significantly reduced. The hierarchical structure and the use of zk-SNARKs ensure that:</p>\n<ul>\n<li>Each state update is cryptographically verified, preventing unauthorized changes.</li>\n<li>The aggregated Merkle roots provide a consistent and tamper-evident record of the network’s state.</li>\n<li>Dispute resolution is handled efficiently and fairly based on the most recent valid state proofs.</li>\n</ul>\n<p>The comprehensive fraud prevention mechanisms of the proposed decentralized payment network ensure high levels of security and integrity without the need for external monitoring entities like watchtowers. The hierarchical smart contract system and zk-SNARKs work together to maintain consistent and verifiable transaction states, providing a secure and efficient framework for decentralized financial transactions.</p>\n<h3><a name=\"role-of-the-dao-21\" class=\"anchor\" href=\"https://ethresear.ch#role-of-the-dao-21\"></a>Role of the DAO</h3>\n<p>While the built-in mechanisms provide robust security and minimize the need for watchtowers, there are scenarios where manual involvement might be necessary. To address these situations, a Decentralized Autonomous Organization (DAO) can be implemented to manage and oversee the network’s operations. The DAO would play a crucial role in:</p>\n<ul>\n<li><strong>Handling Exceptional Cases</strong>: Situations that require manual intervention beyond the automated fraud prevention and dispute resolution mechanisms.</li>\n<li><strong>Balancing Automation and Trust</strong>: Ensuring the right mix of automated processes, cryptographic proofs, and trust mechanisms to maintain network integrity.</li>\n<li><strong>Democratic Decision-Making</strong>: Leveraging community governance to make decisions on critical issues, such as protocol upgrades, handling disputes that the automated system cannot resolve, and other governance matters.</li>\n</ul>\n<h4><a name=\"dao-functions-22\" class=\"anchor\" href=\"https://ethresear.ch#dao-functions-22\"></a>DAO Functions</h4>\n<ol>\n<li><strong>Manual Dispute Resolution</strong>: For disputes that cannot be resolved through automated proofs, the DAO can step in to review and make a final decision based on community consensus.</li>\n<li><strong>Protocol Upgrades</strong>: The DAO can propose and vote on protocol upgrades to enhance the system’s functionality and security.</li>\n<li><strong>Network Oversight</strong>: Providing ongoing oversight and making strategic decisions to ensure the network remains secure and efficient.</li>\n</ol>\n<p>The combination of zk-SNARKs, hierarchical smart contracts, and the DAO creates a robust framework for fraud prevention and network governance. The minimized need for watchtowers is achieved through advanced cryptographic verification and efficient dispute resolution mechanisms. However, the DAO ensures that any issues requiring manual involvement are handled with a balance of automation, trust, rigorous mathematical verification, and democratic decision-making. This comprehensive approach provides a secure, scalable, and trustworthy decentralized payment network.</p>\n<h2><a name=\"dispute-resolution-23\" class=\"anchor\" href=\"https://ethresear.ch#dispute-resolution-23\"></a>Dispute Resolution</h2>\n<p>In the event of a dispute between parties, the proposed network employs a dispute resolution mechanism based on the submitted zk-SNARK proofs and Merkle roots. The dispute resolution process can be formally described as follows:</p>\n<pre><code class=\"lang-auto\">\\begin{algorithm}[H]\n\\caption{Dispute Resolution}\n\\begin{algorithmic}[1]\n\\Procedure{ResolveDispute}{$S, R, \\pi_S, \\pi_R$}\n\\State $S$ submits their final state proof $\\pi_S$\n\\State $R$ submits their final state proof $\\pi_R$\n\\State Verify $\\pi_S$ and $\\pi_R$ against the submitted Merkle roots\n\\If{$\\pi_S$ is valid and $\\pi_R$ is invalid}\n\\State Resolve the dispute in favor of $S$\n\\ElsIf{$\\pi_R$ is valid and $\\pi_S$ is invalid}\n\\State Resolve the dispute in favor of $R$\n\\Else\n\\State Resolve the dispute based on the most recent valid state proof\n\\EndIf\n\\EndProcedure\n\\end{algorithmic}\n\\end{algorithm}\n</code></pre>\n<p>Here, <span class=\"math\">S</span> and <span class=\"math\">R</span> represent the disputing parties, and <span class=\"math\">\\pi_S</span> and <span class=\"math\">\\pi_R</span> are their respective final state proofs. The dispute resolution mechanism verifies the submitted proofs against the Merkle roots stored on-chain and resolves the dispute based on the validity of the proofs. This ensures that the resolution is based on the most recent valid state of the payment channel, preventing fraud and maintaining the integrity of the system.</p>\n<p>The dispute resolution process follows these steps:</p>\n<ol>\n<li><strong>Dispute Initiation:</strong> Either party can initiate a dispute by submitting a dispute request to the relevant smart contract (e.g., the intermediate contract managing their user group).</li>\n<li><strong>Evidence Submission:</strong> Both parties are required to submit their final state proofs <span class=\"math\">(\\pi_S \\text{ and } \\pi_R)</span> within a predefined timeframe (e.g., 24 hours). These proofs represent the latest state of their respective payment channels and include the relevant transaction history.</li>\n<li><strong>Proof Verification:</strong> The dispute resolution mechanism verifies the submitted proofs against the Merkle roots stored on-chain. This verification process ensures that the proofs are valid and consistent with the global state of the network.</li>\n<li><strong>Resolution:</strong> The dispute is resolved based on the validity of the submitted proofs:\n<ul>\n<li>If <span class=\"math\">\\pi_S</span> is valid and <span class=\"math\">\\pi_R</span> is invalid, the dispute is resolved in favor of party <span class=\"math\">S</span>.</li>\n<li>If <span class=\"math\">\\pi_R</span> is valid and <span class=\"math\">\\pi_S</span> is invalid, the dispute is resolved in favor of party <span class=\"math\">R</span>.</li>\n<li>If both proofs are valid, the dispute is resolved based on the most recent valid state proof, determined by the timestamp or sequence number associated with the proofs.</li>\n<li>If neither proof is valid or if one party fails to submit their proof within the required timeframe, the dispute can be escalated to a higher-level contract (e.g., the root contract) or a trusted third party for manual review and resolution.</li>\n</ul>\n</li>\n<li><strong>Outcome Enforcement:</strong> Once the dispute is resolved, the smart contracts automatically enforce the outcome by updating the balances of the involved parties according to the resolution decision. This may involve redistributing tokens between the parties’ payment channels or applying penalties for fraudulent behavior.</li>\n</ol>\n<p>To incentivize honest behavior and discourage frivolous disputes, the network can implement additional mechanisms:</p>\n<ul>\n<li><strong>Dispute Bond:</strong> Parties initiating a dispute may be required to post a bond (in the form of tokens) that is forfeited if their submitted proof is found to be invalid or if they fail to submit their proof within the required timeframe. This bond serves as a deterrent against malicious actors and ensures that disputing parties have a stake in the resolution process.</li>\n<li><strong>Reputation System:</strong> The network can maintain a reputation score for each user based on their history of successful transactions and dispute resolutions. Users with a high reputation score may be given preference in case of ambiguous disputes or may enjoy reduced dispute bond requirements. Conversely, users with a history of fraudulent behavior or frivolous disputes may face higher bond requirements or even temporary suspension from the network.</li>\n</ul>\n<p>By combining cryptographic proofs, smart contract automation, and economic incentives, the proposed dispute resolution mechanism ensures that conflicts are resolved fairly and efficiently while maintaining the integrity of the payment network.</p>\n<p><strong>Example 5: Dispute Resolution</strong></p>\n<p>Suppose a dispute arises between Alice and Bob regarding the final state of their payment channel. Alice claims that her final balance is 100 tokens, while Bob claims that Alice’s final balance is 80 tokens.</p>\n<ol>\n<li><strong>Dispute Initiation:</strong> Alice initiates a dispute by submitting a dispute request to the intermediate contract <span class=\"math\">IC_1</span> that manages their user group. She deposits the required dispute bond of 10 tokens.</li>\n<li><strong>Evidence Submission:</strong> Alice and Bob submit their respective final state proofs, <span class=\"math\">\\pi_A</span> and <span class=\"math\">\\pi_B</span>, to the dispute resolution mechanism within the 24-hour timeframe. Alice’s proof <span class=\"math\">\\pi_A</span> shows her balance as 100 tokens, while Bob’s proof <span class=\"math\">\\pi_B</span> shows Alice’s balance as 80 tokens.</li>\n<li><strong>Proof Verification:</strong> The dispute resolution mechanism verifies the submitted proofs against the Merkle roots stored on-chain. It finds that Alice’s proof <span class=\"math\">\\pi_A</span> is consistent with the on-chain state, while Bob’s proof <span class=\"math\">\\pi_B</span> is invalid.</li>\n<li><strong>Resolution:</strong> As Alice’s proof <span class=\"math\">\\pi_A</span> is valid and Bob’s proof <span class=\"math\">\\pi_B</span> is invalid, the dispute is resolved in favor of Alice. The resolution confirms that Alice’s final balance is indeed 100 tokens.</li>\n<li><strong>Outcome Enforcement:</strong> The intermediate contract <span class=\"math\">IC_1</span> automatically updates the balances of Alice and Bob’s payment channels according to the resolution decision. Alice’s balance remains at 100 tokens, while Bob’s balance is adjusted based on the discrepancy. Additionally, Bob’s dispute bond of 10 tokens is forfeited and distributed as a reward to Alice for submitting a valid proof.</li>\n</ol>\n<p>This example demonstrates how the dispute resolution mechanism ensures the integrity of the payment network by resolving conflicts based on the validity of the submitted zk-SNARK proofs and the Merkle roots stored on-chain, while also incentivizing honest behavior through the use of dispute bonds.</p>\n<h2><a name=\"comparison-to-alternative-approaches-24\" class=\"anchor\" href=\"https://ethresear.ch#comparison-to-alternative-approaches-24\"></a>Comparison to Alternative Approaches</h2>\n<p>The proposed decentralized payment network offers several advantages over alternative approaches, such as traditional blockchain-based payment systems and centralized payment networks.</p>\n<p>Compared to traditional blockchain-based payment systems, the proposed network provides higher scalability and privacy. The use of off-chain payment channels and zk-SNARKs enables faster and more private transactions, while the hierarchical smart contract structure and partitioned storage nodes enable more efficient processing and storage of transaction data.</p>\n<p>Compared to centralized payment networks, the proposed system offers greater security, transparency, and censorship resistance. By leveraging the security and immutability of blockchain technology and the privacy-preserving properties of zk-SNARKs, the network can provide a more secure and transparent payment infrastructure that is resistant to censorship and control by central authorities.</p>\n<p><strong>Example 6: Comparison to Centralized Payment Networks</strong></p>\n<p>Suppose a centralized payment network relies on a single trusted entity to process transactions and manage user balances. While this approach may offer high transaction throughput, it also presents several risks and limitations:</p>\n<ol>\n<li><strong>Single point of failure</strong>: If the central entity experiences technical issues or becomes compromised, the entire payment network may become unavailable or vulnerable to fraud.</li>\n<li><strong>Lack of transparency</strong>: Users must trust the central entity to manage their funds honestly and securely, without the ability to independently verify the state of their balances or the validity of transactions.</li>\n<li><strong>Censorship risk</strong>: The central entity may choose to block or reverse transactions based on their own criteria, censoring users or restricting access to the payment network.</li>\n</ol>\n<p>In contrast, the proposed decentralized payment network addresses these issues through its use of blockchain technology, zk-SNARKs, and a decentralized architecture:</p>\n<ol>\n<li><strong>Decentralization</strong>: The network is maintained by a distributed network of storage nodes and smart contracts, eliminating the single point of failure and ensuring the availability and resilience of the system.</li>\n<li><strong>Transparency and verifiability</strong>: Users can independently verify the state of their balances and the validity of transactions using the zk-SNARK proofs and the Merkle roots stored on-chain, providing a high level of transparency and trust in the system.</li>\n<li><strong>Censorship resistance</strong>: The decentralized nature of the network and the use of zk-SNARKs ensure that transactions cannot be easily censored or reversed by any single entity, preserving the freedom and autonomy of users.</li>\n</ol>\n<p>This example highlights the significant advantages of the proposed decentralized payment network over centralized alternatives, providing a more secure, transparent, and censorship-resistant payment infrastructure for users.</p>\n<h1><a name=\"analysis-25\" class=\"anchor\" href=\"https://ethresear.ch#analysis-25\"></a>Analysis</h1>\n<p>This section provides a comprehensive analysis of the security, privacy, and scalability properties of the proposed decentralized payment network, and compares it to alternative approaches.</p>\n<p>We delve into the technical details of the zk-SNARK implementation, discuss potential challenges and trade-offs, explore additional privacy-enhancing techniques, and consider the governance aspects of the system.</p>\n<h2><a name=\"security-analysis-26\" class=\"anchor\" href=\"https://ethresear.ch#security-analysis-26\"></a>Security Analysis</h2>\n<p>The security of the proposed network relies on the soundness and completeness of the zk-SNARK proofs, as well as the integrity of the hierarchical smart contract structure. We employ the state-of-the-art zk-SNARK construction proposed by Groth, which offers succinct proofs and efficient verification. The zk-SNARK scheme is built upon the q-Power Knowledge of Exponent (q-PKE) assumption and the q-Decisional Diffie-Hellman (q-DDH) assumption in bilinear groups.</p>\n<p>Let <span class=\"math\">\\mathcal{G}_1</span>, <span class=\"math\">\\mathcal{G}_2</span>, and <span class=\"math\">\\mathcal{G}_T</span> be cyclic groups of prime order <span class=\"math\">p</span>, and let <span class=\"math\">e : \\mathcal{G}_1 \\times \\mathcal{G}_2 \\rightarrow \\mathcal{G}_T</span> be a bilinear map. The q-PKE assumption states that for any polynomial-size adversary <span class=\"math\">\\mathcal{A}</span>, the following probability is negligible in the security parameter <span class=\"math\">\\lambda</span>:</p>\n<div class=\"math\">\n\\Pr\\left[\n\\begin{array}{c}\ng \\xleftarrow{\\$} \\mathcal{G}_1, \\quad \\alpha, s \\xleftarrow{\\$} \\mathbb{Z}_p, \\quad g_2 \\leftarrow g^{\\alpha},\\\\\n(c_1, \\ldots, c_q) \\xleftarrow{\\$} \\mathbb{Z}_p^q, \\quad t_i \\leftarrow g^{c_i} \\cdot g_2^{s \\cdot c_i},\\\\\n(h, \\hat{h}) \\leftarrow \\mathcal{A}(g, g_2, \\{t_i\\}_{i=1}^q) : \\\\\nh = g^s \\wedge \\hat{h} \\neq \\prod_{i=1}^q t_i^{c_i}\n\\end{array}\n\\right]\n</div>\n<p>The q-DDH assumption states that for any polynomial-size adversary <span class=\"math\">\\mathcal{A}</span>, the following probability is negligible in the security parameter <span class=\"math\">\\lambda</span>:</p>\n<div class=\"math\">\n\\Pr\\left[\n\\begin{array}{c}\ng \\xleftarrow{\\$} \\mathcal{G}_1, \\quad \\alpha, s, r \\xleftarrow{\\$} \\mathbb{Z}_p, \\quad g_2 \\leftarrow g^{\\alpha},\\\\\n(c_1, \\ldots, c_q) \\xleftarrow{\\$} \\mathbb{Z}_p^q, \\quad t_i \\leftarrow \\begin{cases}\ng_2^{c_i}, &amp; \\text{if } b=0\\\\\ng_2^{c_i + s}, &amp; \\text{if } b=1\n\\end{cases},\\\\\nb \\xleftarrow{\\$} \\{0, 1\\}, \\quad b' \\leftarrow \\mathcal{A}(g, g_2, \\{t_i\\}_{i=1}^q) : \\\\\nb = b'\n\\end{array}\n\\right]\n</div>\n<p>Under these assumptions, the zk-SNARK construction ensures that the proofs are sound and complete, meaning that a prover cannot create a valid proof for a false statement (soundness) and that a valid proof always verifies successfully (completeness). Consequently, transactions are guaranteed to be valid, and balances are correctly updated, preventing double-spending and other fraudulent activities.</p>\n<h1><a name=\"attack-vector-prevention-27\" class=\"anchor\" href=\"https://ethresear.ch#attack-vector-prevention-27\"></a>Attack Vector Prevention</h1>\n<p>The hierarchical smart contract structure, combined with the storage nodes, ensures that the network’s global state remains consistent and verifiable, even in the presence of malicious actors. The smart contracts are implemented using the Solidity language and are formally verified using the Oyente and Zeus tools to ensure their correctness and security.</p>\n<p><strong>1. Collusion during the trusted setup ceremony:</strong></p>\n<ul>\n<li>Mitigated by the use of secure multi-party computation (MPC) protocols like ZEXE, ensuring a distributed setup process.</li>\n<li>Involvement of diverse participants reduces the likelihood of successful collusion.</li>\n</ul>\n<p><strong>2. Collusion among users:</strong></p>\n<ul>\n<li>Prevented by the use of unforgeable and computationally binding zk-SNARK proofs (PLONK), making it infeasible for users to create valid proofs for fraudulent transactions.</li>\n<li>Smart contracts verify proofs before executing transactions, ensuring only legitimate transactions are processed.</li>\n</ul>\n<p><strong>3. Collusion among storage nodes:</strong></p>\n<ul>\n<li>Mitigated by the distributed storage architecture with multiple nodes maintaining data copies, making it difficult for nodes to collude and provide false data without detection.</li>\n<li>The use of Merkle trees and hash-based commitments allows smart contracts to verify data authenticity.</li>\n</ul>\n<p><strong>4. Smart contract vulnerabilities:</strong></p>\n<ul>\n<li>Addressed by formal verification tools, independent security audits, secure coding practices, access controls, and error handling mechanisms.</li>\n<li>Upgradability and emergency stop mechanisms allow for deploying security patches and freezing contracts in case of severe vulnerabilities.</li>\n</ul>\n<p><strong>5. Privacy leaks:</strong></p>\n<ul>\n<li>Mitigated by the use of zk-SNARKs, ensuring transaction privacy.</li>\n<li>Mixing techniques, anonymity networks, metadata obfuscation, and regular security assessments further enhance privacy protection.</li>\n</ul>\n<p><strong>6. Sybil attacks:</strong></p>\n<ul>\n<li>Inherently resistant due to the use of zk-SNARK proofs, smart contract verification, and the underlying blockchain’s consensus mechanism.</li>\n<li>The system’s design, including proof validity and economic disincentives, makes it infeasible for attackers to create and manipulate multiple identities or payment channels.</li>\n<li>The requirement of fees to set up payment channels and execute transactions further discourages Sybil attacks by making them financially costly for attackers.</li>\n</ul>\n<p><strong>7. Denial-of-Service (DoS) attacks:</strong></p>\n<ul>\n<li>Inherently mitigated by the computational cost of generating zk-SNARK proofs for each transaction, making it impractical for attackers to flood the network with a large number of transactions.</li>\n<li>The decentralized architecture and the resilience of the underlying Ethereum blockchain provide additional protection against DoS attacks.</li>\n</ul>\n<h1><a name=\"scalability-analysis-28\" class=\"anchor\" href=\"https://ethresear.ch#scalability-analysis-28\"></a>Scalability Analysis</h1>\n<p>The proposed decentralized payment network exhibits significant scalability potential due to its innovative use of zero-knowledge proofs (ZKPs), particularly zk-SNARKs, and the absence of traditional consensus mechanisms, which together enable instant finality. In this section, we will provide a detailed mathematical assessment and real-world benchmarks to validate the network’s scalability potential.</p>\n<h2><a name=\"mathematical-formalism-of-tps-scalability-29\" class=\"anchor\" href=\"https://ethresear.ch#mathematical-formalism-of-tps-scalability-29\"></a>Mathematical Formalism of TPS Scalability</h2>\n<p>Let us define the total time per transaction <span class=\"math\">T_{tx}</span> as the sum of the time for proof generation <span class=\"math\">T_{pg}</span>, network latency <span class=\"math\">T_{nl}</span>, and the overhead for contract execution and state updates <span class=\"math\">T_{oh}</span>. Given that we aim for high scalability, we will leverage parallel processing capabilities of nodes to handle multiple channels efficiently.</p>\n<div class=\"math\">\nT_{tx} = T_{pg} + T_{nl} + T_{oh}\n</div>\n<p>Assuming average values for these times, such as:</p>\n<div class=\"math\">\n\\begin{align*}\nT_{pg} &amp; \\approx 50 \\text{ ms} \\\\\nT_{nl} &amp; \\approx 50 \\text{ ms} \\\\\nT_{oh} &amp; \\approx 50 \\text{ ms} \\\\\n\\end{align*}\n</div>\n<p>The total time per transaction can be approximated as:</p>\n<div class=\"math\">\nT_{tx} = 50 \\text{ ms} + 50 \\text{ ms} + 50 \\text{ ms} = 150 \\text{ ms}\n</div>\n<p>Thus, the transactions per second (TPS) per node can be calculated as:</p>\n<div class=\"math\">\nTPS_{\\text{per node}} = \\frac{1}{T_{tx}} = \\frac{1}{150 \\text{ ms} / 1000 \\text{ ms/s}} \\approx 6.67 \\text{ TPS}\n</div>\n<p>If we consider the network scaling linearly with the number of nodes, the total TPS for <span class=\"math\">n</span> nodes can be expressed as:</p>\n<div class=\"math\">\nTPS_{\\text{total}} = TPS_{\\text{per node}} \\times n = 6.67 \\times n\n</div>\n<p>For example, with 100 nodes, the network could achieve:</p>\n<div class=\"math\">\nTPS_{\\text{total}} = 6.67 \\times 100 = 667 \\text{ TPS}\n</div>\n<h2><a name=\"tps-within-channels-30\" class=\"anchor\" href=\"https://ethresear.ch#tps-within-channels-30\"></a>TPS Within Channels</h2>\n<p>To further detail the TPS within individual payment channels, consider that each node can manage multiple channels. Let <span class=\"math\">c</span> denote the number of channels a node can handle, and let <span class=\"math\">T_{channel}</span> represent the time to process a transaction within a channel.</p>\n<div class=\"math\">\nT_{channel} = T_{pg} + T_{nl} + T_{oh} = 70 \\text{ ms} \\quad (\\text{considering optimized conditions})\n</div>\n<p>Thus, the TPS per channel:</p>\n<div class=\"math\">\nTPS_{\\text{per channel}} = \\frac{1}{T_{channel}} = \\frac{1}{70 \\text{ ms} / 1000 \\text{ ms/s}} \\approx 14.29 \\text{ TPS}\n</div>\n<p>If each node can handle <span class=\"math\">c</span> channels, the total TPS per node considering channels would be:</p>\n<div class=\"math\">\nTPS_{\\text{node, channels}} = TPS_{\\text{per channel}} \\times c\n</div>\n<p>Assuming a node can handle 10,000 channels:</p>\n<div class=\"math\">\nTPS_{\\text{node, channels}} = 14.29 \\times 10,000 = 142,900 \\text{ TPS}\n</div>\n<p>For a network with <span class=\"math\">n</span> nodes, the total TPS could be:</p>\n<div class=\"math\">\nTPS_{\\text{total, channels}} = 142,900 \\times n\n</div>\n<h2><a name=\"real-world-micro-benchmarks-31\" class=\"anchor\" href=\"https://ethresear.ch#real-world-micro-benchmarks-31\"></a>Real-World Micro Benchmarks</h2>\n<p>To validate these theoretical calculations, we consider benchmarks from existing state channel implementations:</p>\n<ol>\n<li><strong>Celer Network</strong>: Claims to handle up to 15,000 TPS per node.</li>\n<li><strong>Raiden Network</strong>: Aims for several thousand TPS per node.</li>\n<li><strong>Lightning Network</strong>: Estimates around 1,000 TPS per node in practical scenarios.</li>\n</ol>\n<p>Given these benchmarks, our assumption of handling 10,000 channels per node with approximately 14.29 TPS per channel, resulting in 142,900 TPS per node, is ambitious but within a reasonable range for a highly optimized implementation leveraging zk-SNARKs and efficient contract management.</p>\n<h2><a name=\"potential-bottlenecks-32\" class=\"anchor\" href=\"https://ethresear.ch#potential-bottlenecks-32\"></a>Potential Bottlenecks</h2>\n<p>Despite the promising scalability, several bottlenecks could impact performance:</p>\n<ol>\n<li><strong>Proof Generation and Verification</strong>: While zk-SNARKs are efficient, the complexity of proofs can increase with advanced use cases.</li>\n<li><strong>Network Latency</strong>: Global transactions can introduce delays that affect overall throughput.</li>\n<li><strong>Smart Contract Efficiency</strong>: Inefficiencies in smart contracts can create processing delays.</li>\n<li><strong>Storage and Data Management</strong>: Managing large numbers of channels and associated data could become challenging.</li>\n<li><strong>Node Reliability and Security</strong>: Ensuring the reliability and security of each node is critical.</li>\n</ol>\n<p>Addressing these bottlenecks through ongoing optimization and robust infrastructure will be crucial to achieving the theoretical TPS and ensuring the network’s scalability and robustness.</p>\n<h2><a name=\"summary-33\" class=\"anchor\" href=\"https://ethresear.ch#summary-33\"></a>Summary</h2>\n<p>The proposed decentralized payment network, leveraging zk-SNARKs and instant finality mechanisms, exhibits significant scalability potential. The mathematical formalism and real-world benchmarks indicate that the network can achieve high TPS by efficiently managing multiple channels per node. Continuous optimization and addressing potential bottlenecks will be essential to realizing this potential in practice.</p>\n<h1><a name=\"scalability-comparison-with-existing-layer-2-solutions-34\" class=\"anchor\" href=\"https://ethresear.ch#scalability-comparison-with-existing-layer-2-solutions-34\"></a>Scalability Comparison with Existing Layer 2 Solutions</h1>\n<h3><a name=\"key-features-of-the-proposed-network-35\" class=\"anchor\" href=\"https://ethresear.ch#key-features-of-the-proposed-network-35\"></a>Key Features of the Proposed Network</h3>\n<ol>\n<li><strong>Unilateral Payment Channels:</strong> Enables high transaction throughput by facilitating off-chain transactions.</li>\n<li><strong>Zero-Knowledge Proofs (zk-SNARKs):</strong> Ensures privacy and efficient transaction validity.</li>\n<li><strong>Instant Finality:</strong> Transactions achieve instant finality without on-chain confirmations.</li>\n<li><strong>Partitioned Storage Nodes:</strong> Manages off-chain data efficiently, reducing on-chain storage requirements.</li>\n</ol>\n<h2><a name=\"existing-layer-2-solutions-36\" class=\"anchor\" href=\"https://ethresear.ch#existing-layer-2-solutions-36\"></a>Existing Layer 2 Solutions</h2>\n<p><strong>State Channels (e.g., Lightning Network, Raiden Network):</strong></p>\n<ul>\n<li><strong>Scalability:</strong> High throughput off-chain.</li>\n<li><strong>Finality:</strong> Near-instant off-chain finality.</li>\n<li><strong>Challenges:</strong> Requires channel monitoring and on-chain closures.</li>\n</ul>\n<p><strong>Plasma:</strong></p>\n<ul>\n<li><strong>Scalability:</strong> High throughput with off-chain child chains.</li>\n<li><strong>Finality:</strong> Periodic on-chain commitments.</li>\n<li><strong>Challenges:</strong> Complex exit management and data availability.</li>\n</ul>\n<p><strong>Optimistic Rollups:</strong></p>\n<ul>\n<li><strong>Scalability:</strong> Batches transactions off-chain.</li>\n<li><strong>Finality:</strong> Delayed due to fraud proof periods.</li>\n<li><strong>Challenges:</strong> Requires fraud proof monitoring.</li>\n</ul>\n<p><strong>ZK-Rollups:</strong></p>\n<ul>\n<li><strong>Scalability:</strong> High throughput with off-chain transaction bundling.</li>\n<li><strong>Finality:</strong> Near-instant with zk-SNARKs.</li>\n<li><strong>Challenges:</strong> Complex proof generation.</li>\n</ul>\n<h2><a name=\"comparative-analysis-37\" class=\"anchor\" href=\"https://ethresear.ch#comparative-analysis-37\"></a>Comparative Analysis</h2>\n<p><strong>Throughput and Finality:</strong></p>\n<ul>\n<li>The proposed network achieves high throughput and instant finality, comparable to state channels and ZK-Rollups and superior to Optimistic Rollups.</li>\n</ul>\n<p><strong>Efficiency and Cost:</strong></p>\n<ul>\n<li>More cost-efficient by reducing on-chain transactions and eliminating mining, outperforming state channels and Plasma.</li>\n</ul>\n<p><strong>Data Management:</strong></p>\n<ul>\n<li>Efficient off-chain data management through partitioned storage nodes, similar to Plasma and rollups.</li>\n</ul>\n<p><strong>Security and Privacy:</strong></p>\n<ul>\n<li>Robust security and privacy with zk-SNARKs, comparable to ZK-Rollups and superior to solutions relying on fraud proofs.</li>\n</ul>\n<h1><a name=\"implementation-details-38\" class=\"anchor\" href=\"https://ethresear.ch#implementation-details-38\"></a>Implementation Details</h1>\n<p>The proposed decentralized payment network is implemented using a combination of Rust, TypeScript, and Solidity. The core components, such as the zk-SNARK proof generation and verification, are written in Rust for performance and security reasons. The smart contracts are developed using Solidity, while the frontend and client-side interactions are built with TypeScript.</p>\n<h3><a name=\"specific-zk-snark-construction-39\" class=\"anchor\" href=\"https://ethresear.ch#specific-zk-snark-construction-39\"></a>Specific zk-SNARK Construction</h3>\n<p>The system employs the PLONK zk-SNARK construction, which offers universality, updatability, and efficient proof generation and verification. PLONK allows for the creation of a universal and updateable structured reference string (SRS) that can be reused across multiple circuits or applications, reducing the complexity and coordination overhead associated with repeated trusted setups.</p>\n<p>The PLONK circuits are designed using the arkworks library in Rust, which provides a set of tools and primitives for building zk-SNARK circuits compatible with the PLONK proving system. The library supports efficient constraint generation, witness computation, and proof generation, making it well-suited for the development of the decentralized payment network.</p>\n<h3><a name=\"challenges-and-optimizations-40\" class=\"anchor\" href=\"https://ethresear.ch#challenges-and-optimizations-40\"></a>Challenges and Optimizations</h3>\n<p>One of the main challenges in implementing PLONK is the complexity of designing and optimizing the circuits to take advantage of the universal SRS. This requires a deep understanding of the PLONK framework and the techniques for constructing efficient and secure circuits.</p>\n<p>To address this challenge, the implementation leverages various optimization techniques, such as:</p>\n<ol>\n<li>Constraint system optimization: Minimizing the number of constraints in the circuit by using efficient gate design and layout techniques, such as gate aggregation and constant folding.</li>\n<li>Witness compression: Reducing the size of the witness by using compact data representations and eliminating redundant information.</li>\n<li>Proof aggregation: Batching multiple proofs together to reduce the overall proof size and verification cost.</li>\n</ol>\n<p>These optimizations help to improve the performance and scalability of the PLONK-based zk-SNARK circuits, ensuring that the decentralized payment network can handle a high volume of transactions efficiently.</p>\n<h3><a name=\"integration-with-ethereum-41\" class=\"anchor\" href=\"https://ethresear.ch#integration-with-ethereum-41\"></a>Integration with Ethereum</h3>\n<p>The smart contracts for the payment network are implemented using Solidity and deployed on the Ethereum blockchain. The contracts interact with the PLONK proofs generated by the Rust components through a verification contract that is optimized for the PLONK proving system.</p>\n<p>The verification contract is designed to be gas-efficient and supports batch verification of PLONK proofs, allowing multiple proofs to be verified in a single transaction. This helps to reduce the overall cost and improve the throughput of the system.</p>\n<h3><a name=\"trusted-setup-ceremony-42\" class=\"anchor\" href=\"https://ethresear.ch#trusted-setup-ceremony-42\"></a>Trusted Setup Ceremony</h3>\n<p>As PLONK requires a trusted setup for the universal SRS, a multi-party computation (MPC) ceremony is conducted to generate the SRS. The ceremony involves multiple participants from different organizations and backgrounds, ensuring that no single party has control over the entire setup process.</p>\n<p>The MPC ceremony is organized and facilitated using secure computation frameworks, such as the ZEXE library, which provides a set of tools and protocols for conducting distributed key generation and parameter setup.</p>\n<h4><a name=\"concise-example-private-asset-transfer-43\" class=\"anchor\" href=\"https://ethresear.ch#concise-example-private-asset-transfer-43\"></a>Concise Example: Private Asset Transfer</h4>\n<p>In a private asset transfer, Alice can transfer assets to Bob without revealing the transaction details to the public. Using PLONK, Alice generates a proof π that verifies the validity of the transfer and her sufficient balance without disclosing the transaction amount Δ.</p>\n<p>Transfer <span class=\"math\">T = (A, B, \\pi)</span> where <span class=\"math\">\\pi</span> is the PLONK proof</p>\n<ol>\n<li><span class=\"math\">\\pi \\leftarrow \\text{generateProof}(A, B, \\Delta)</span></li>\n<li>Submit <span class=\"math\">(A, B, \\pi)</span> to the transfer contract</li>\n<li>Contract verifies <span class=\"math\">\\pi</span>\n<ul>\n<li>If <span class=\"math\">\\pi</span> is valid, execute transfer from <span class=\"math\">A</span> to <span class=\"math\">B</span></li>\n<li>Else, reject transfer</li>\n</ul>\n</li>\n</ol>\n<p>The proof <span class=\"math\">\\pi</span> ensures the following conditions:</p>\n<ul>\n<li><span class=\"math\">B_A \\geq \\Delta</span> (Alice’s balance is sufficient)</li>\n<li><span class=\"math\">B_A' = B_A - \\Delta</span> (Alice’s updated balance)</li>\n<li><span class=\"math\">B_B' = B_B + \\Delta</span> (Bob’s updated balance)</li>\n</ul>\n<p>The smart contract executes the transfer only if the proof is valid, ensuring the transfer’s legitimacy without revealing the transaction details.</p>\n<p>By leveraging PLONK, the proposed decentralized payment network achieves a balance between privacy, scalability, and ease of implementation. The universal and updateable nature of PLONK, combined with the optimization techniques and secure trusted setup ceremony, provides a solid foundation for building a privacy-focused and efficient payment system.</p>\n<h1><a name=\"use-cases-for-privacy-44\" class=\"anchor\" href=\"https://ethresear.ch#use-cases-for-privacy-44\"></a>Use Cases for Privacy</h1>\n<h3><a name=\"confidential-voting-systems-45\" class=\"anchor\" href=\"https://ethresear.ch#confidential-voting-systems-45\"></a>Confidential Voting Systems</h3>\n<p>Confidential voting systems are a critical use case for enhanced privacy in decentralized networks. Voting systems must ensure that each vote is anonymous and secure while maintaining the integrity and transparency of the election process. By leveraging zk-SNARKs, our network can provide a solution that guarantees the confidentiality of votes while allowing for public verification of election results.</p>\n<p>In a confidential voting system built on the proposed network, voters would cast their votes through private transactions, with zk-SNARKs proving that each vote is valid and belongs to an eligible voter without revealing the voter’s identity. The votes would be tallied through a series of confidential transactions, with the final result verifiable through the aggregated Merkle roots stored on-chain. This approach ensures that the voting process is transparent and auditable while preserving the privacy of individual voters.</p>\n<h3><a name=\"private-asset-transfers-46\" class=\"anchor\" href=\"https://ethresear.ch#private-asset-transfers-46\"></a>Private Asset Transfers</h3>\n<p>Private asset transfers are another significant use case for enhanced privacy in a decentralized network. These transfers require confidentiality to protect the financial privacy of users, ensuring that transaction details remain private while the integrity of the transfer is verifiable.</p>\n<p>With the proposed network, users can transfer assets through confidential payment channels, with zk-SNARKs proving the validity of the transactions without revealing the amounts or the identities of the parties involved. This feature is particularly valuable for businesses and individuals who wish to keep their financial transactions private, such as in the case of sensitive business deals, wealth management, or personal remittances.</p>\n<h3><a name=\"secure-health-records-management-47\" class=\"anchor\" href=\"https://ethresear.ch#secure-health-records-management-47\"></a>Secure Health Records Management</h3>\n<p>Secure health records management is an essential use case for enhanced privacy, where sensitive health information must be kept confidential while ensuring that authorized parties can verify the records. Using zk-SNARKs, the proposed network can enable the secure storage and sharing of health records while maintaining patient privacy.<br>\nIn this use case, health records would be stored off-chain, with zk-SNARKs proving the authenticity and integrity of the records without revealing their contents. Patients can grant access to their records to authorized parties, such as healthcare providers or insurance companies, through private transactions. The authorized parties can then verify the records’ authenticity using the zk-SNARK proofs, ensuring that the records have not been tampered with while preserving patient confidentiality.</p>\n<h3><a name=\"global-payment-system-48\" class=\"anchor\" href=\"https://ethresear.ch#global-payment-system-48\"></a>Global Payment System</h3>\n<p>A global payment system is perhaps the most scalable and impactful use case for a decentralized network with enhanced privacy. Such a system must provide sufficient privacy to protect user transactions while ensuring transparency and scalability to facilitate mass adoption. By leveraging zk-SNARKs, the proposed network can achieve a balanced privacy level that ensures transaction confidentiality without hindering scalability or regulatory compliance.</p>\n<p>In a global payment system built on the proposed network, users can transact through confidential payment channels, with zk-SNARKs proving the validity of transactions without revealing the amounts or the identities of the parties involved. This privacy level can be customized based on the specific requirements of different jurisdictions, ensuring compliance with local regulations while still preserving user privacy.</p>\n<p>To facilitate cross-border transactions and enable seamless interoperability with existing payment systems, the network can integrate with traditional financial institutions and payment processors through secure off-chain communication channels. These channels can leverage zk-SNARKs to prove the authenticity of transactions and balances without revealing sensitive information, enabling a hybrid approach that combines the benefits of decentralized privacy with the reach and stability of established financial networks.</p>\n<p>By leveraging zk-SNARKs in these use cases, the proposed decentralized payment network can provide enhanced privacy and scalability, making it suitable for a wide range of applications. These examples illustrate how the network can achieve a balance between privacy and transparency, facilitating mass adoption while maintaining the necessary confidentiality.</p>\n<h1><a name=\"conclusion-49\" class=\"anchor\" href=\"https://ethresear.ch#conclusion-49\"></a>Conclusion</h1>\n<p>The proposed decentralized payment network offers:</p>\n<ol>\n<li><strong>Higher Throughput:</strong> Comparable to or exceeding state channels and rollups.</li>\n<li><strong>Instant Finality:</strong> Superior to Optimistic Rollups.</li>\n<li><strong>Cost Efficiency:</strong> Reduces on-chain interactions and eliminates mining.</li>\n<li><strong>Enhanced Privacy:</strong> Matches or surpasses ZK-Rollups.</li>\n</ol>\n<p>The unique combination of features in the proposed network makes it a potentially more scalable and private solution compared to existing Layer 2 systems.<br>\nBy leveraging zk-SNARKs in these use cases, we can provide enhanced privacy and scalability, making our decentralized network suitable for a wide range of applications. These examples illustrate how the network can achieve a balance between privacy and transparency, facilitating mass adoption while maintaining the necessary confidentiality.</p>\n<h1><a name=\"references-50\" class=\"anchor\" href=\"https://ethresear.ch#references-50\"></a>References</h1>\n<ol>\n<li>Poon, J., &amp; Dryja, T. (2016). The Bitcoin Lightning Network: Scalable Off-Chain Instant Payments. <em>Lightning Network Whitepaper</em>. <a href=\"https://lightning.network/lightning-network-paper.pdf\" rel=\"noopener nofollow ugc\">https://lightning.network/lightning-network-paper.pdf</a></li>\n<li>Buterin, V., &amp; Poon, J. (2017). Plasma: Scalable Autonomous Smart Contracts. <em>Plasma Whitepaper</em>. <a href=\"https://plasma.io/plasma.pdf\" rel=\"noopener nofollow ugc\">https://plasma.io/plasma.pdf</a></li>\n<li>Raiden Network Team. (2017). Raiden Network: Fast, Cheap, Scalable Token Transfers for Ethereum. <a href=\"https://raiden.network/101.html\" class=\"inline-onebox\" rel=\"noopener nofollow ugc\">Raiden Network</a></li>\n<li>Celer Network. (2019). Celer Network: Bring Internet Scale to Every Blockchain. <em>Celer Network Whitepaper</em>. <a href=\"https://www.celer.network/doc/CelerNetwork-Whitepaper.pdf\" rel=\"noopener nofollow ugc\">https://www.celer.network/doc/CelerNetwork-Whitepaper.pdf</a></li>\n<li>PLONK Documentation. (n.d.). ZK-SNARKs: PLONK. Retrieved from <a href=\"https://docs.plonk.cafe/\" rel=\"noopener nofollow ugc\">https://docs.plonk.cafe/</a></li>\n<li>Ben-Sasson, E., Chiesa, A., Tromer, E., &amp; Virza, M. (2014). Scalable Zero-Knowledge via Cycles of Elliptic Curves. In <em>International Cryptology Conference</em> (pp. 276-294). Springer, Berlin, Heidelberg.</li>\n<li>Groth, J. (2016). On the Size of Pairing-based Non-interactive Arguments. In <em>Annual International Conference on the Theory and Applications of Cryptographic Techniques</em> (pp. 305-326). Springer, Berlin, Heidelberg.</li>\n<li>Zhang, F., Cecchetti, E., Croman, K., Juels, A., &amp; Shi, E. (2016). Town Crier: An Authenticated Data Feed for Smart Contracts. In <em>Proceedings of the 2016 ACM SIGSAC Conference on Computer and Communications Security</em> (pp. 270-282).</li>\n<li>Ben-Sasson, E., Chiesa, A., Genkin, D., Tromer, E., &amp; Virza, M. (2015). SNARKs for C: Verifying Program Executions Succinctly and in Zero Knowledge. In <em>Annual Cryptology Conference</em> (pp. 90-108). Springer, Berlin, Heidelberg.</li>\n<li>Hioki, L., Dompeldorius, A., &amp; Hashimoto, Y. (2024). Plasma Next: Plasma without Online Requirements. <em>Ethereum Research</em>. Retrieved from <a href=\"https://ethresear.ch/t/plasma-next-plasma-without-online-requirements/18786\" class=\"inline-onebox\">Plasma Next: Plasma without Online Requirements</a></li>\n</ol>\n            <p><small>3 posts - 1 participant</small></p>\n            <p><a href=\"https://ethresear.ch/t/1st-completely-trustless-blockchain-using-pure-math-and-zk-snarks-for-validation-high-censorship-resistance/19756\">Read full topic</a></p>","link":"https://ethresear.ch/t/1st-completely-trustless-blockchain-using-pure-math-and-zk-snarks-for-validation-high-censorship-resistance/19756","pubDate":"Thu, 06 Jun 2024 19:34:00 +0000","discourse:topicPinned":"No","discourse:topicClosed":"No","discourse:topicArchived":"No","guid":{"@isPermaLink":"false","#text":"ethresear.ch-topic-19756"},"source":{"@url":"https://ethresear.ch/t/1st-completely-trustless-blockchain-using-pure-math-and-zk-snarks-for-validation-high-censorship-resistance/19756.rss","#text":"1st completely trustless Blockchain, using pure math and zk-snarks for validation. = High censorship resistance"},"filter":false},{"title":"Is it worth using MEV-Boost?","dc:creator":"Nero_eth","category":"Economics","description":"<h1><a name=\"is-it-worth-using-mev-boost-1\" class=\"anchor\" href=\"https://ethresear.ch#is-it-worth-using-mev-boost-1\"></a>Is it worth using MEV-Boost?</h1>\n<p>To answer that question from an economic perspective, we will look into the APYs.<br>\n&gt; <em>For simplicity, we assume a total of 1 million active validators and ignore sync-committee rewards.</em><br>\n&gt; <em>The underlying data ranges from November 2023 - 6 June 2024 and includes all slots.</em></p>\n<p>First, let’s check the <strong>difference between local block building and using MEV-Boost</strong>.<br>\nWe can see that the block reward is higher for MEV-Boost users:<br>\n</p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/e/9/e91a721ea6757f818e7a0fd840534c63a581145e.png\" data-download-href=\"https://ethresear.ch/uploads/default/e91a721ea6757f818e7a0fd840534c63a581145e\" title=\"reward_comparison (3)\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/e/9/e91a721ea6757f818e7a0fd840534c63a581145e_2_690x316.png\" alt=\"reward_comparison (3)\" data-base62-sha1=\"xg7UrIIoRbKFT6xFOkrE06yGpwG\" width=\"690\" height=\"316\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/e/9/e91a721ea6757f818e7a0fd840534c63a581145e_2_690x316.png, https://ethresear.ch/uploads/default/optimized/3X/e/9/e91a721ea6757f818e7a0fd840534c63a581145e_2_1035x474.png 1.5x, https://ethresear.ch/uploads/default/original/3X/e/9/e91a721ea6757f818e7a0fd840534c63a581145e.png 2x\" data-dominant-color=\"F8E5E4\"></a></div><p></p>\n<p><strong>The median block reward increases from 0.0076 to 0.0380 ETH (400% more).</strong></p>\n<h2><a name=\"what-does-that-mean-on-an-annual-basis-2\" class=\"anchor\" href=\"https://ethresear.ch#what-does-that-mean-on-an-annual-basis-2\"></a>What does that mean on an annual basis?</h2>\n<p>The statistical 2.6 blocks a validator gets to propose per year yield an average of <strong>0.0199 ETH in block rewards</strong>.<br>\nFor MEV-Boost blocks, the 2.6 blocks yield a total of <strong>0.0998 ETH per year</strong>.</p>\n<p>When shown in a pie chart, we can see that the share of the block reward (green) grows from 2.96% to 13.4%, compared to the total expected rewards per year.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/c/4/c452b447c422ed7be7095bd313ef4f9081bcf9c4.png\" data-download-href=\"https://ethresear.ch/uploads/default/c452b447c422ed7be7095bd313ef4f9081bcf9c4\" title=\"rewards_comp_pie\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/c/4/c452b447c422ed7be7095bd313ef4f9081bcf9c4_2_690x316.png\" alt=\"rewards_comp_pie\" data-base62-sha1=\"s0KMbuiLlX2JvfESoEpDSJNXsEc\" width=\"690\" height=\"316\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/c/4/c452b447c422ed7be7095bd313ef4f9081bcf9c4_2_690x316.png, https://ethresear.ch/uploads/default/optimized/3X/c/4/c452b447c422ed7be7095bd313ef4f9081bcf9c4_2_1035x474.png 1.5x, https://ethresear.ch/uploads/default/original/3X/c/4/c452b447c422ed7be7095bd313ef4f9081bcf9c4.png 2x\" data-dominant-color=\"D0DBDF\"></a></div><p></p>\n<h3><a name=\"what-does-that-mean-for-the-apy-3\" class=\"anchor\" href=\"https://ethresear.ch#what-does-that-mean-for-the-apy-3\"></a>What does that mean for the APY?</h3>\n<p>For validators <strong>not using MEV-Boost</strong>, the expected annual revenue is <strong>0.929 ETH.</strong><br>\nFor validators <strong>using MEV-Boost</strong>, the expected annual revenue is <strong>1.009 ETH.</strong><br>\n<strong>These are additional ~8.6% of revenue.</strong></p>\n<p><strong>Using MEV-Boost increases the APR from 2.93% to 3.24%.</strong></p>\n<p>For the <strong>APY</strong> (compounding every epoch):</p>\n<p><span class=\"math\">\\text{APY}_{local\\ builder} = \\left(1 + \\frac{\\text{APR}}{n} \\right)^n - 1  = \\left(1 + \\frac{\\text{0.0297}}{365 \\times 225} \\right)^{365 \\times 225} - 1 = 2.97\\%</span></p>\n<p><span class=\"math\">\\text{APY}_{mevboost} = \\left(1 + \\frac{\\text{APR}}{n} \\right)^n - 1  = \\left(1 + \\frac{\\text{0.0324}}{365 \\times 225} \\right)^{365 \\times 225} - 1 = 3.29\\%</span></p>\n<p><strong>Finally, using MEV-Boost increases the APR from 2.97% to 3.29%.</strong></p>\n<hr>\n<p>Find the code used for this analysis <a href=\"https://github.com/nerolation/is-mevboost-worth-it\">here</a>.</p>\n            <p><small>8 posts - 6 participants</small></p>\n            <p><a href=\"https://ethresear.ch/t/is-it-worth-using-mev-boost/19753\">Read full topic</a></p>","link":"https://ethresear.ch/t/is-it-worth-using-mev-boost/19753","pubDate":"Thu, 06 Jun 2024 16:15:23 +0000","discourse:topicPinned":"No","discourse:topicClosed":"No","discourse:topicArchived":"No","guid":{"@isPermaLink":"false","#text":"ethresear.ch-topic-19753"},"source":{"@url":"https://ethresear.ch/t/is-it-worth-using-mev-boost/19753.rss","#text":"Is it worth using MEV-Boost?"},"filter":false},{"title":"Gossipsub Network Dynamicity through GRAFTs and PRUNEs","dc:creator":"yiannisbot","category":"Networking","description":"<h1><a name=\"summary-tldr-1\" class=\"anchor\" href=\"https://ethresear.ch#summary-tldr-1\"></a>Summary &amp; TL;DR</h1>\n<p>The ProbeLab team (<a href=\"https://probelab.io/\" rel=\"noopener nofollow ugc\">https://probelab.io </a>) is carrying out a study on the performance of Gossipsub in Ethereum’s P2P network. Following from our previous post on the <a href=\"https://ethresear.ch/t/gossip-iwant-ihave-effectiveness-in-ethereums-gossipsusb-network/19686\">“Effectiveness of Gossipsub’s gossip mechanism”</a>, in this post we investigate the frequency of <code>GRAFT</code> and <code>PRUNE</code> messages and the dynamicity in terms of session duration and network stability that results from these protocol primitives. For the purposes of this study, we have built a tool called Hermes (<a href=\"https://github.com/probe-lab/hermes/\" rel=\"noopener nofollow ugc\">GitHub - probe-lab/hermes: A Gossipsub listener and tracer. </a>), which acts as a GossipSub listener and tracer. Hermes subscribes to all relevant pubsub topics and traces all protocol interactions. The results reported here are from a 3.5hr trace.</p>\n<p><strong>Study Description:</strong> The purpose of this study is to determine the frequency between <code>GRAFT</code> and <code>PRUNE</code> messages as a distribution and standard deviation per topic. We measure the session duration between our peer and other peers, split per client and attempt to identify any anomalies (e.g., too short connections) and potential patterns.</p>\n<p><strong>TL;DR:</strong> <strong>Overall, we conclude that Gossipsub is keeping a stable mesh as far as the <code>MeshDegree</code> goes</strong>, barely exceeding the <code>DLow</code> and <code>DHigh</code> thresholds of 6 and 12, respectively, despite increased dynamicity at times (i.e., increased numbers of <code>GRAFTs</code> and <code>PRUNEs</code>). <strong>Teku nodes always tear down connections to our node within a few seconds (or less) and fail to keep any connection running for longer periods of time (even minutes).</strong> This fact is likely to lead to some instability, which, however, doesn’t seem to be impacting the correct operation of the rest of the network.</p>\n<blockquote>\n<p>For more details and results on Ethereum’s network head over to <a href=\"https://probelab.io/\" rel=\"noopener nofollow ugc\">https://probelab.io </a> for discv5 Weekly Network Health Reports.</p>\n</blockquote>\n<h1><a name=\"background-2\" class=\"anchor\" href=\"https://ethresear.ch#background-2\"></a>Background</h1>\n<p>GossipSub is the most widely used libp2p PubSub routing mechanism. Gossipsub includes enhanced PubSub routing that aims to reduce the bandwidth by maintaining fewer connections per subscribed topic (through the mesh) and sending some sporadic message metadata for resilience purposes (through the gossip mechanism). This ensures that despite the message being broadcasted using the shortest latency path (mesh), the peers still have the backup of sharing <code>msg_ids</code> (gossip) to prevent missing messages that have already propagated through the network.</p>\n<p>Because GossipSub reduces the overall number of connected peers by topic, known as meshes, having enough peers on these is crucial for efficient message broadcasting in any network. These meshes work as a connectivity sub-layer under the libp2p connections, as there is no direct map between 1_libp2p_peer_connection ↔ 1_mesh_peer_connection.<br>\nThis differentiation provides efficiency to the protocol, as a peer doesn’t need to “waste” bandwidth sending full messages to more peers than the needed ones while avoiding to spam peers who already shared the same message.</p>\n<p>However, this means that the routing mechanism has to control how many peers it is connected to, or how many it needs to <code>GRAFT</code> (add) or <code>PRUNE</code> (remove) for each mesh, complicating things a little more.</p>\n<p>This report provides insights into the <code>GRAFT</code> and <code>PRUNE</code> events (Network Dynamicity), and RPC calls (Session Duration) that our <code>Hermes</code>-based node [<a href=\"https://github.com/probe-lab/hermes/\" rel=\"noopener nofollow ugc\">link to Hermes GH repo</a>] could track over 3.5 hours while participating in the Holesky testnet.</p>\n<h1><a name=\"results-3\" class=\"anchor\" href=\"https://ethresear.ch#results-3\"></a>Results</h1>\n<h3><a name=\"add-and-remove-peer-events-4\" class=\"anchor\" href=\"https://ethresear.ch#add-and-remove-peer-events-4\"></a>Add and Remove peer events</h3>\n<p>The stability of the network’s mesh relies heavily on the connections that the libp2p host keeps open. The following graph shows the number of <code>ADD_PEER</code> and <code>REMOVE_PEER</code> that the Hermes node tracked during the 3.5 hour run.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/6/9/69d25298153741ab11ad06836c18a6a5e46d85a2.png\" data-download-href=\"https://ethresear.ch/uploads/default/69d25298153741ab11ad06836c18a6a5e46d85a2\" title=\"add-remove-peers-overall\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/6/9/69d25298153741ab11ad06836c18a6a5e46d85a2_2_517x309.png\" alt=\"add-remove-peers-overall\" data-base62-sha1=\"f68KpsTmQ1RkAEVvAwXzR8NJdgC\" width=\"517\" height=\"309\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/6/9/69d25298153741ab11ad06836c18a6a5e46d85a2_2_517x309.png, https://ethresear.ch/uploads/default/optimized/3X/6/9/69d25298153741ab11ad06836c18a6a5e46d85a2_2_775x463.png 1.5x, https://ethresear.ch/uploads/default/original/3X/6/9/69d25298153741ab11ad06836c18a6a5e46d85a2.png 2x\" data-dominant-color=\"F6F4F4\"></a></div><p></p>\n<p>From the plot, we don’t see any particularly inconsistent behaviour or pattern that stands out. The number of connections and disconnections at the libp2p host remains relatively stable around ~40 events per minute.</p>\n<h3><a name=\"graft-and-prune-events-5\" class=\"anchor\" href=\"https://ethresear.ch#graft-and-prune-events-5\"></a><code>GRAFT</code> and <code>PRUNE</code> events</h3>\n<p><code>GRAFT</code> and <code>PRUNE</code> messages define when a peer is added or removed from a mesh we subscribe to. Thus, they directly show the dynamics of the peer connections within a topic mesh.</p>\n<p>The following graph shows the number of <code>GRAFTs</code> and <code>PRUNEs</code> registered by the <code>Hermes</code> node.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/b/7/b727e2a934e16138448ad37108aad42f831ed244.png\" data-download-href=\"https://ethresear.ch/uploads/default/b727e2a934e16138448ad37108aad42f831ed244\" title=\"graft-prune-all-topics\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/b/7/b727e2a934e16138448ad37108aad42f831ed244_2_517x309.png\" alt=\"graft-prune-all-topics\" data-base62-sha1=\"q8gPwXDy3j368eK0Ps6YWGbRZJy\" width=\"517\" height=\"309\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/b/7/b727e2a934e16138448ad37108aad42f831ed244_2_517x309.png, https://ethresear.ch/uploads/default/optimized/3X/b/7/b727e2a934e16138448ad37108aad42f831ed244_2_775x463.png 1.5x, https://ethresear.ch/uploads/default/original/3X/b/7/b727e2a934e16138448ad37108aad42f831ed244.png 2x\" data-dominant-color=\"FAF9F8\"></a></div><p></p>\n<p>We have also split this down by topic, and produced related plots, which however, we don’t include here, as the split is roughly equal among topics.</p>\n<p>We observe that the number of recorded events spikes after the ~2.5 hours of Hermes operation, jumping from peaks of ~100 events per minute to peaks of up to 700-800 events per minute.</p>\n<h3><a name=\"correlation-with-graft-and-prune-rpc-events-6\" class=\"anchor\" href=\"https://ethresear.ch#correlation-with-graft-and-prune-rpc-events-6\"></a>Correlation with <code>GRAFT</code> and <code>PRUNE</code> RPC events</h3>\n<p>After 2 hours of the node being up online, we can see that the GossipSub host tracks mesh connectivity at a higher frequency than during the first hours. Since the RPC calls can include multiple topic <code>GRAFTs</code> or <code>PRUNEs</code>, these events correspond to the sum of original sent and received RPC calls.</p>\n<p>Taking a closer look at the origin of those messages with the following plot, we can see that the most significant number of events belong to <code>RECV_PRUNE</code> and <code>SENT_GRAFTs</code>.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/5/0/50d7b77597f2824a7f9a9c6559bea2f78cfe1b08.png\" data-download-href=\"https://ethresear.ch/uploads/default/50d7b77597f2824a7f9a9c6559bea2f78cfe1b08\" title=\"graft_prune_rpc_collection_all_graft_and_prune_rpc_calls\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/5/0/50d7b77597f2824a7f9a9c6559bea2f78cfe1b08_2_517x309.png\" alt=\"graft_prune_rpc_collection_all_graft_and_prune_rpc_calls\" data-base62-sha1=\"bxamQ8oxg7uUKAvQiuAoCR4dXe0\" width=\"517\" height=\"309\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/5/0/50d7b77597f2824a7f9a9c6559bea2f78cfe1b08_2_517x309.png, https://ethresear.ch/uploads/default/optimized/3X/5/0/50d7b77597f2824a7f9a9c6559bea2f78cfe1b08_2_775x463.png 1.5x, https://ethresear.ch/uploads/default/original/3X/5/0/50d7b77597f2824a7f9a9c6559bea2f78cfe1b08.png 2x\" data-dominant-color=\"F9F9F8\"></a></div><p></p>\n<p>As before, we have also split this down by topic, and produced related plots, which however, we don’t include here, as the split is roughly equal among topics.</p>\n<p>We can see that there is some perturbation to the stability of the meshes due to increased number of <code>GRAFT</code> and <code>PRUNE</code> events at the end of the trace period. There are two possible explanations for this:</p>\n<ul>\n<li>Remote nodes are dropping our connection for whatever reason (low peer score, or just sporadic <code>PRUNE</code> messages because their mesh is full), and our <code>Hermes</code> node counters this drop of peers by sending more <code>GRAFT</code> messages to keep it up with the <code>MeshDegree = 8</code> .</li>\n<li>We are sending too many <code>GRAFT</code> messages to rotate our peers and test the connection to other nodes in the network, which is countered by the remote peers by sending <code>PRUNE</code> messages as their mesh might be full already. Note that <code>Hermes</code> has an upper limit of 500 simultaneous connections, so we expect it to have a higher range of connected peers than other nodes in the network.</li>\n</ul>\n<p>In any case, we do not consider this to be an alarming event and the increased number of events might just be due to increased network activity. We will verify that this is not an alarming case through further experiments in the near future, where we’ll collect traces for a longer period of time.</p>\n<h3><a name=\"mesh-connection-times-7\" class=\"anchor\" href=\"https://ethresear.ch#mesh-connection-times-7\"></a>Mesh connection times</h3>\n<p>It is important to have a mix between steady connections and some rotation degree of these ones within each of the topic meshes. In fact, this level of rotation is the one that can guarantee that a node doesn’t end up eclipsed by malicious actors (although GossipSub-v1.1 does have the gossiping feature as well to overcome eclipse attempts).<br>\nThe following graphs show the average connection times per peer and per mesh.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/6/6/66fb050fc61e3129fb919dd9610a801b39b7ae25.png\" data-download-href=\"https://ethresear.ch/uploads/default/66fb050fc61e3129fb919dd9610a801b39b7ae25\" title=\"connection_stability_cdf_per_topic\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/6/6/66fb050fc61e3129fb919dd9610a801b39b7ae25_2_517x309.png\" alt=\"connection_stability_cdf_per_topic\" data-base62-sha1=\"eH0vA0nEiO5mUfqQ6ocAdOGkhEN\" width=\"517\" height=\"309\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/6/6/66fb050fc61e3129fb919dd9610a801b39b7ae25_2_517x309.png, https://ethresear.ch/uploads/default/optimized/3X/6/6/66fb050fc61e3129fb919dd9610a801b39b7ae25_2_775x463.png 1.5x, https://ethresear.ch/uploads/default/original/3X/6/6/66fb050fc61e3129fb919dd9610a801b39b7ae25.png 2x\" data-dominant-color=\"F9F9F9\"></a></div><p></p>\n<p>Measuring which is the average connection stability at the node level can showcase weird behaviours from the network. In this case, our <code>Hermes</code> run did measure dispersed results were:</p>\n<ul>\n<li>80% of the peers drop the connection after a few seconds of establishing it, although it has to be noted that the high percentage here owes to the spikes we’ve seen towards the end of the trace period in this particular dataset. We do not expect this to be the normal behaviour under “steady state”.</li>\n</ul>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/a/a/aa2b04f9e67c1fa8016566a43b29bf371df1ea0e.png\" data-download-href=\"https://ethresear.ch/uploads/default/aa2b04f9e67c1fa8016566a43b29bf371df1ea0e\" title=\"connection_stability_cdf_per_topic-80\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/a/a/aa2b04f9e67c1fa8016566a43b29bf371df1ea0e_2_517x309.png\" alt=\"connection_stability_cdf_per_topic-80\" data-base62-sha1=\"ohnkZX6RJPrzZHubT89EoYsWpSC\" width=\"517\" height=\"309\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/a/a/aa2b04f9e67c1fa8016566a43b29bf371df1ea0e_2_517x309.png, https://ethresear.ch/uploads/default/optimized/3X/a/a/aa2b04f9e67c1fa8016566a43b29bf371df1ea0e_2_775x463.png 1.5x, https://ethresear.ch/uploads/default/original/3X/a/a/aa2b04f9e67c1fa8016566a43b29bf371df1ea0e.png 2x\" data-dominant-color=\"F8F8F8\"></a></div><p></p>\n<ul>\n<li>10% of the peers remain connected for a total of ~4 minutes.</li>\n</ul>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/8/a/8a01eb6b12aa60b64754879178b983fb20e68bfa.png\" data-download-href=\"https://ethresear.ch/uploads/default/8a01eb6b12aa60b64754879178b983fb20e68bfa\" title=\"connection_stability_cdf_per_topic-10\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/8/a/8a01eb6b12aa60b64754879178b983fb20e68bfa_2_517x309.png\" alt=\"connection_stability_cdf_per_topic-10\" data-base62-sha1=\"jGS0e2fmNaTcWpB9Vs1TRHtHisi\" width=\"517\" height=\"309\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/8/a/8a01eb6b12aa60b64754879178b983fb20e68bfa_2_517x309.png, https://ethresear.ch/uploads/default/optimized/3X/8/a/8a01eb6b12aa60b64754879178b983fb20e68bfa_2_775x463.png 1.5x, https://ethresear.ch/uploads/default/original/3X/8/a/8a01eb6b12aa60b64754879178b983fb20e68bfa.png 2x\" data-dominant-color=\"F9F9F9\"></a></div><p></p>\n<ul>\n<li>the remaining 10% of the connections remain between ~5 mins and 1.6 hours.</li>\n</ul>\n<p>However, these plots do not give the full picture. As we saw with the number of <code>GRAFT</code> and <code>PRUNE</code> messages, there is a time relation on these distributions. What this means is that just because 80% of the connections happen within the first second, doesn’t really mean that they were recently distributed over the trace period. To provide more clarity, we plot the connection duration (in seconds) split in 30min windows over the 3.5hr trace period.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/d/7/d7497c137c7f6a4f77e93f3c5bef2454db964bb5.png\" data-download-href=\"https://ethresear.ch/uploads/default/d7497c137c7f6a4f77e93f3c5bef2454db964bb5\" title=\"connection-duration-30min-window-total\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/d/7/d7497c137c7f6a4f77e93f3c5bef2454db964bb5_2_517x309.png\" alt=\"connection-duration-30min-window-total\" data-base62-sha1=\"uIw5Yim5FCUnVAJqTD4ptHHYHo9\" width=\"517\" height=\"309\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/d/7/d7497c137c7f6a4f77e93f3c5bef2454db964bb5_2_517x309.png, https://ethresear.ch/uploads/default/optimized/3X/d/7/d7497c137c7f6a4f77e93f3c5bef2454db964bb5_2_775x463.png 1.5x, https://ethresear.ch/uploads/default/original/3X/d/7/d7497c137c7f6a4f77e93f3c5bef2454db964bb5.png 2x\" data-dominant-color=\"F1F3F5\"></a></div><p></p>\n<p>Correlating the sudden spikes of GRAFT and PRUNE towards the end of the trace period, we find the following: the connections established over the first 2 hours and a half were indeed longer in duration.</p>\n<p>We have created graphs breaking down the connections by topic, by agent, and by both topic and agent for 30min windows. We present only one representative plot here, as we didn’t see any behaviour that stands out, other than the following:</p>\n<ul>\n<li>Lodestar clearly maintains connections for longer periods of time, followed by Nimbus</li>\n<li>Teku nodes consistently disconnect almost immediately.</li>\n</ul>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/6/7/679381131aa608c213d2e3de19ca87ecfd44454e.png\" data-download-href=\"https://ethresear.ch/uploads/default/679381131aa608c213d2e3de19ca87ecfd44454e\" title=\"connection_duration-30min_user_agents_total\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/6/7/679381131aa608c213d2e3de19ca87ecfd44454e_2_517x309.png\" alt=\"connection_duration-30min_user_agents_total\" data-base62-sha1=\"eMhcKSbvtrn86jfIDLwXRNZBsLQ\" width=\"517\" height=\"309\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/6/7/679381131aa608c213d2e3de19ca87ecfd44454e_2_517x309.png, https://ethresear.ch/uploads/default/optimized/3X/6/7/679381131aa608c213d2e3de19ca87ecfd44454e_2_775x463.png 1.5x, https://ethresear.ch/uploads/default/original/3X/6/7/679381131aa608c213d2e3de19ca87ecfd44454e.png 2x\" data-dominant-color=\"F5F4F4\"></a></div><p></p>\n<p>Both of our observations are also evident from the following table, which includes the percentiles of the total connected time per client (in seconds).</p>\n<div class=\"md-table\">\n<table>\n<thead>\n<tr>\n<th>Percentiles</th>\n<th>p25</th>\n<th>p50</th>\n<th>p80</th>\n<th>p90</th>\n<th>p99</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Grandine</td>\n<td>6.53</td>\n<td>17.22</td>\n<td>31.52</td>\n<td>43.67</td>\n<td>117.36</td>\n</tr>\n<tr>\n<td>Lighthouse</td>\n<td>9.94</td>\n<td>19.82</td>\n<td>36.25</td>\n<td>74.89</td>\n<td>570.02</td>\n</tr>\n<tr>\n<td>Lodestar</td>\n<td>2.06</td>\n<td>7.12</td>\n<td>1768.40</td>\n<td>5855.87</td>\n<td>7165.20</td>\n</tr>\n<tr>\n<td>Nimbus</td>\n<td>200.44</td>\n<td>523.96</td>\n<td>599.88</td>\n<td>599.97</td>\n<td>4157.40</td>\n</tr>\n<tr>\n<td>Prysm</td>\n<td>5.00</td>\n<td>5.00</td>\n<td>175.65</td>\n<td>594.67</td>\n<td>4322.25</td>\n</tr>\n<tr>\n<td>Teku</td>\n<td>0.10</td>\n<td>0.13</td>\n<td>0.64</td>\n<td>1.72</td>\n<td>5.85</td>\n</tr>\n<tr>\n<td>Unknown</td>\n<td>0.07</td>\n<td>0.14</td>\n<td>5.00</td>\n<td>5.22</td>\n<td>5.90</td>\n</tr>\n</tbody>\n</table>\n</div><h3><a name=\"resulting-number-of-peers-per-mesh-8\" class=\"anchor\" href=\"https://ethresear.ch#resulting-number-of-peers-per-mesh-8\"></a>Resulting number of peers per mesh</h3>\n<p>It is important to highlight that despite the spike in network connectivity and the relevant RPC interactions our node has kept a stable range of connections within each of the topic meshes.</p>\n<p>The following graph shows the total number of mesh connections for each topic, binned at 5 minute intervals.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/d/c/dcccaabc9e3ab2c55c355ca18311035e560e9988.png\" data-download-href=\"https://ethresear.ch/uploads/default/dcccaabc9e3ab2c55c355ca18311035e560e9988\" title=\"graft_and_prune_events_collection_mesh_connectivity_for_topics\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/d/c/dcccaabc9e3ab2c55c355ca18311035e560e9988_2_517x309.png\" alt=\"graft_and_prune_events_collection_mesh_connectivity_for_topics\" data-base62-sha1=\"vvhxvhEHUYtWFEXzGn3EArh5qzu\" width=\"517\" height=\"309\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/d/c/dcccaabc9e3ab2c55c355ca18311035e560e9988_2_517x309.png, https://ethresear.ch/uploads/default/optimized/3X/d/c/dcccaabc9e3ab2c55c355ca18311035e560e9988_2_775x463.png 1.5x, https://ethresear.ch/uploads/default/original/3X/d/c/dcccaabc9e3ab2c55c355ca18311035e560e9988.png 2x\" data-dominant-color=\"F6F5F6\"></a></div><p></p>\n<p>The range of connections per topic barely goes below 6, even at the last hour of data, where we’ve seen the spikes in <code>GRAFT</code> and <code>PRUNE</code> events. We can observe that:</p>\n<ul>\n<li>GossipSub is doing a good job at keeping the range of connections around the <code>gossipSubD=8</code>  (between the <code>gossipSubDlo=6</code> and the <code>gossipSubDhi=12</code>).</li>\n<li>This ratio of connections per topic does see a small drop on the last hour of the run, matching the sudden spike of <code>RECV_PRUNEs</code> seen in earlier plots.</li>\n<li>The drop in the number of connections during the last hour does seem related to the fact that the connections opened during this period were actually way shorter than the previous ones.</li>\n</ul>\n<h1><a name=\"conclusions-and-takeaways-9\" class=\"anchor\" href=\"https://ethresear.ch#conclusions-and-takeaways-9\"></a>Conclusions and takeaways</h1>\n<ul>\n<li><strong>Overall, we conclude that Gossipsub is keeping a stable mesh as far as the <code>MeshDegree</code> goes</strong>, barely exceeding the <code>DLow</code> and <code>DHigh</code> thresholds of 6 and 12, respectively, despite increased dynamicity at times (i.e., increased numbers of <code>GRAFTs</code> and <code>PRUNEs</code>).</li>\n<li><strong>Teku nodes always tear down connections to our node within a few seconds (or less) and fail to keep any connection running for longer periods of time (even minutes).</strong> This fact is likely to lead to some instability, which, however, doesn’t seem to be impacting the correct operation of the rest of the network (at least from what we can see so far).</li>\n<li><strong>Our data shows a sudden spike in <code>GRAFT</code> and <code>PRUNE</code> events during the last hour of the study, despite the <code>ADD_PEER</code> and <code>REMOVE_PEER</code> events staying steady over the entire run.</strong> This could suggest that <code>Hermes</code> or the network is struggling to maintain mesh connections with other participants.\n<ul>\n<li>The spike in <code>GRAFTs</code> and <code>PRUNEs</code> generally comes from incoming <code>PRUNE</code> events followed by subsequent outgoing <code>GRAFT</code> events. It is still not clear what triggers this behaviour, i.e., if it’s just an anomaly coming from the strict connectivity limits from remote peers that refuse connections quite often, or if it’s <code>Hermes</code> the one that spams remote peers with <code>GRAFTs</code> more than it should and remote peers in turn respond with <code>PRUNE</code> events.</li>\n<li>We conclude that this incident is interesting to keep an eye on (e.g., nodes end up with stable connections at the Host level, but struggling to keep a healthy number of connections in each mesh) and verify through a longer experiment. However, we do not consider this to be a critical incident, i.e., doesn’t cause any other metric to suffer.</li>\n</ul>\n</li>\n</ul>\n            <p><small>1 post - 1 participant</small></p>\n            <p><a href=\"https://ethresear.ch/t/gossipsub-network-dynamicity-through-grafts-and-prunes/19750\">Read full topic</a></p>","link":"https://ethresear.ch/t/gossipsub-network-dynamicity-through-grafts-and-prunes/19750","pubDate":"Thu, 06 Jun 2024 07:46:13 +0000","discourse:topicPinned":"No","discourse:topicClosed":"No","discourse:topicArchived":"No","guid":{"@isPermaLink":"false","#text":"ethresear.ch-topic-19750"},"source":{"@url":"https://ethresear.ch/t/gossipsub-network-dynamicity-through-grafts-and-prunes/19750.rss","#text":"Gossipsub Network Dynamicity through GRAFTs and PRUNEs"},"filter":false},{"title":"Based Sequencer Selection","dc:creator":"simbro","category":"Layer 2","description":"<p>This is an exploratory proposal for a method of deterministically identifying sequencers on L2s to route transactions to, in order to facilitate universal synchronous composability between L2s. This approach uses the Ethereum base layer as a universal and credibly neutral sequencer selection mechanism, intended as a fallback to based sequencing, in cases where based sequencing may not be suitable for an L2 to adopt fully. This is very much an initial proposal intended for general feedback, discussion and debate.</p>\n<h1><a name=\"proposal-1\" class=\"anchor\" href=\"https://ethresear.ch#proposal-1\"></a>Proposal</h1>\n<p>LimeChain’s proposal on <a href=\"https://ethresear.ch/t/vanilla-based-sequencing/19379\">Vanilla Based Sequencing</a> describes two methods for selecting the sequencer on L2: primary selection, when the current L1 proposer has opted-in to be an L2 sequencer for the rollup, and fallback selection, when the current L1 proposer has <em>not</em> opted-in to be an L2 sequencer for the rollup, and hence some other method is required to select the L2 sequencer.</p>\n<p>In the <a href=\"https://ethresear.ch/t/vanilla-based-sequencing/19379#fallback-selection-12\">fallback selection mechanism</a>, the L2 selects an L1 proposer at random from the other opted-in L1 proposers to be the L2 sequencer. This method will work perfectly well, but limits the possibility for synchronous composability between rollups. A single L1 proposer that is also the designated sequencer on multiple rollups is able to offer guarantees that bundles of transactions will be executed atomically on the respective rollups. In the fallback selection mechanism, there is no longer a single L1 proposer sequencing for two or more rollups at the same time, and instead we have separate and distinct L1 proposers, and guarantees of atomic execution of transactions are no longer possible.</p>\n<p>To address this challenge, I propose to explore the idea of a deterministic sequencer selection function on L1 that can be used by any rollup. This would allow wallets or pre-confirmation gateways to identify which sequencers will be selected when, on which rollups, allowing them to route pre-confirmation requests accordingly.</p>\n<p>The high level idea is that a pre-confirmation gateway can accept a bundle of transactions, typically a pair of transactions to be executed on two distinct rollups, and can route the requests to the relevant sequencers on the respective rollups, obtaining the preconf promises for the user.</p>\n<h1><a name=\"requirements-2\" class=\"anchor\" href=\"https://ethresear.ch#requirements-2\"></a>Requirements</h1>\n<ul>\n<li>\n<p>Sequencers on L2s will need to be recorded via some central registry on L1 (perhaps an extension of the L1 <a href=\"https://ethresear.ch/t/credibly-neutral-preconfirmation-collateral-the-preconfirmation-registry/19634\">pre-confirmation registry</a>), and will need to be able to issue pre-confirmations.</p>\n</li>\n<li>\n<p>Pre-confirmations will probably need to be confirmed in 2 rounds instead of one. The first request is to place a lock on the preconfs (on a very short timeframe, in the order of 100s of milliseconds), and the second is to confirm. This will allow a pre-confirmation gateway (or wallet) to obtain a commitment that both sequencers on their respective rollups will issue a preconf promise, and when the sequencer has commitments from both, it can confirm the preconf requests and receive the preconf promises from both. The nomenclature gets a bit confusing here and will need to be thought about.  Alternatively, another potentially less complicated but less secure approach is to allow the pre-confirmation gateway to cancel a pre-confirmation upon only receiving a preconf promise from one but not both L2 sequencers.</p>\n</li>\n<li>\n<p>There is a deterministic function in a smart contract on L1 which can be used to identify which L2 sequencer is going to be selected when on which rollup. This could leverage <code>prevrandao</code> via <code>block.difficulty</code> to provide a lookahead which L2s use to select sequencers on L2.  This could be as simple as function that acts as a PRF which accepts a lookahead size <span class=\"math\">n</span> measured in slots, and bounded range <span class=\"math\">r</span> corresponding to the number of L2 sequencers, and which references <code>block.difficulty</code> to return a list of random sequencers ids of size <span class=\"math\">n</span>, within the range <span class=\"math\">r</span>.</p>\n</li>\n<li>\n<p>May require some collateral to incentivize L2 sequencers to honor preconf requests, and to keep the L1 registry up-to-date, though this last point could prove difficult to coordinate among L2s and will require some more thought.</p>\n</li>\n</ul>\n<h1><a name=\"rationale-3\" class=\"anchor\" href=\"https://ethresear.ch#rationale-3\"></a>Rationale</h1>\n<p>The fallback sequencer selection will be employed by L2s more frequently in the beginning, until enough L1 proposers opt-in to based sequencing.</p>\n<p><a href=\"https://ethresear.ch/t/based-preconfirmations/17353\">We need at least 20% of Ethereum’s validator set to opt-in to based sequencing in order to have at least 1 proposer per epoch</a>. Moreover, these proposers will need to opt in to being sequencers for a number of rollups (assuming enough rollups will provision for this in their sequencer designs - tbd). All of this is against a background of numerous AVSs that could offer more economically attractive alternatives for proposers to opt into.</p>\n<p>Assuming we do reach the required threshold of 20% of the Ethereum validator set having opted-in to based sequencing (roughly 200K validators), depending on the design of decentralized L2s, they may not be able to support this many sequencers. For L2s that might seek to implement some form of consensus protocol using a validator set with a proposer selection mechanism, it may be impractical to support 200K validators. In this instance, having a credibly neutral sequencer selection mechanism would be helpful.</p>\n<p>Furthermore, the fallback selection mechanism will likely to be continued to be employed by newer or smaller rollups in the future, before they can build a large enough share of L1 proposers that opt-in to being sequencers for their rollups. Again, in this instance, credibly neutral sequencer selection could be appealing.</p>\n<p>The fallback selection by itself doesn’t support universal synchronous composability, but synchronizing sequencer selection across rollups in a credibly neutral way (by using the L1), can facilitate USC.</p>\n<h1><a name=\"risks-and-trade-offs-4\" class=\"anchor\" href=\"https://ethresear.ch#risks-and-trade-offs-4\"></a>Risks and Trade-offs</h1>\n<p>Users will need to trust the crypto-economic guarantees of the respective L2s that they are seeking preconfs of atomic execution of transactions from. Even if the L2 sequencers are also L1 validators (note that they don’t need to be), users will still need to rely on the L2’s security.</p>\n<p>Under the primary selection method of the vanilla based sequencing approach, these security guarantees are improved somewhat, as we are dealing with a single L1 proposer for both rollups, and so their ability to offer guarantees of atomic transaction execution across L2s is improved.</p>\n<p>Assuming that the L1 proposer posts the data from each rollup to the L1, then we also benefit from the subjective finality of those transactions, and so we know within one slot if the respective transactions have been included or not. This also a strong assumption however, as it depends on the volume of transactions on L2, with most rollups waiting until they have enough transactions to completely fill a blob with compressed data, which may not happen within one L1 slot. So again, it falls back to the user relying on the crypto-economic security of the L2s themselves.</p>\n<p>This approach will of course require some buy-in from L2s that will need to implement the fallback sequencer selection, but this is also the case with based sequencing in general.</p>\n<p>A major trade-off is the increased complexity from managing atomic execution guarantees, as described in the requirements section above. This will likely involve a lock-and-confirm mechanism between L2 sequencers and the preconf gateways (or a user’s wallet), whereby the preconf gateway asks the sequencer to put a hold on a preconf for about a second, and then confirms that they want to go ahead with the preconf.</p>\n<h1><a name=\"open-questions-5\" class=\"anchor\" href=\"https://ethresear.ch#open-questions-5\"></a>Open Questions</h1>\n<p>It’s not clear to me exactly how to incentivize L2s or L2 sequencers to keep the registry up-to-date. If an L2 sequencer ceases to participate as an L2 sequencer, the registry will need to reflect this. This challenge is addressed in mteam’s proposal for <a href=\"https://ethresear.ch/t/credibly-neutral-preconfirmation-collateral-the-preconfirmation-registry/19634#penalties-4\">Credibly Neutral Preconfirmation Collateral</a>, and potentially the same registry could be used for L2 sequencers, but this needs to be explored. Using a separate registry could bloat the ecosystem with the redundant overhead of managing multiple registrations for based-sequencing proposers.</p>\n<p>There may be understandable apprehension from the ecosystem if the preconf gateways on L1 are used to route transactions to sequencers on L2s. This will cause even more centralization across the ecosystem, with potentially only 2 or 3 preconf gateways routing transactions across L1 and also a number of L2s. This could be improved through routing to individual sequencers via independent gateways on each L2, but this needs to be explored further.</p>\n<p>This proposal as it stands will not withstand L1 re-orgs.  It is an open question how the sequencer selection mechanism can be impervious to L1 re-orgs.</p>\n<hr>\n<p>All questions, feedback, criticisms are very welcome.</p>\n            <p><small>5 posts - 3 participants</small></p>\n            <p><a href=\"https://ethresear.ch/t/based-sequencer-selection/19747\">Read full topic</a></p>","link":"https://ethresear.ch/t/based-sequencer-selection/19747","pubDate":"Wed, 05 Jun 2024 13:59:19 +0000","discourse:topicPinned":"No","discourse:topicClosed":"No","discourse:topicArchived":"No","guid":{"@isPermaLink":"false","#text":"ethresear.ch-topic-19747"},"source":{"@url":"https://ethresear.ch/t/based-sequencer-selection/19747.rss","#text":"Based Sequencer Selection"},"filter":false},{"title":"An RSA Deterministic Key Generation Scheme: Algorithm and Security Analysis","dc:creator":"AshelyYan","category":"Cryptography","description":"<p>TL;DR: We propose a secure and practical deterministic key generation scheme and pseudorandom number generator, from which RSA keys can be generated to simplify key backup and retrieval.<br>\nThis research is a joint effort from Ethereum Fellows: <a class=\"mention\" href=\"https://ethresear.ch/u/mason-mind\">@Mason-Mind</a> <a class=\"mention\" href=\"https://ethresear.ch/u/georgesheth\">@georgesheth</a> <a class=\"mention\" href=\"https://ethresear.ch/u/dennis\">@dennis</a> <a class=\"mention\" href=\"https://ethresear.ch/u/ashelyyan\">@AshelyYan</a>.</p>\n<h1><a name=\"h-1-introduction-1\" class=\"anchor\" href=\"https://ethresear.ch#h-1-introduction-1\"></a>1. Introduction</h1>\n<p>Traditionally, cryptographic keys are generated using randomness to ensure unpredictability.<br>\nIn contrast, deterministic key generation refers to the process of generating cryptographic keys in a deterministic manner. In deterministic key generation, a single starting point (seed) is used to derive the keys using some Key Derivation Function (KDF). It brings some convenience in key management, however, also security risks and privacy concerns. The advantages can be concluded as follows:</p>\n<ul>\n<li>Streamlined key management: Users can generate a sequence of keys from the initial seed, eliminating the necessity to store multiple keys individually. Instead, they only need to safeguard the initial seed in order to secure all the derived keys.</li>\n<li>Simplified key backup and retrieval: Users can regenerate all the cryptographic keys from the initial seed, which simplifies the key retrieval.</li>\n<li>Meet the industry demand. Industry developers are always looking for this solution and has huge value to the product delivery.</li>\n</ul>\n<p>However, in this function, if the seed is compromised, every derived key becomes vulnerable to potential threats. Therefore, it is important to keep the initial seed secure. Meanwhile, it is essential that the initial seed remains unpredictable to adversaries, for reasons that are self-evident.</p>\n<p>The main difficulty in designing a KDF is the initial keying material. When the source keying material is not uniformly random or pseudorandom, additional preprocessing is needed. In blockchain, there are some applications and solutions. <a href=\"https://eprints.qut.edu.au/82221/1/hdwallet.pdf\" rel=\"noopener nofollow ugc\">Hierarchical Deterministic Bitcoin Wallets</a> provide an interesting way of managing cryptographic keys, which form a tree structure. At the root, there is a randomly generated master seed. Using the deterministic key generation technique outlined in the <a href=\"https://github.com/bitcoin/bips/blob/70d9b07ab80ab3c267ece48f74e4e2250226d0cc/bip-0032.mediawiki\" rel=\"noopener nofollow ugc\">BIP32</a> standard, this master seed can produce child keys. Since all the keys are generated deterministically, the same set of keys can be generated from the master seed. <a href=\"https://argon2.online/#:~:text=Argon2%20is%20cryptographic%20hashing%20algorithm,is%20optimized%20for%20password%20hashing.\" rel=\"noopener nofollow ugc\">Argon2</a> is another popular approach for key derivation. It is designed to be resistant against brute-force attacks. Argon2 improves security by using a salt and a password as inputs. The salt is a unique random value. The purpose of using salt is to prevent attackers from using precomputed tables (rainbow tables) to apply brute-force attacks on passwords. Since unique salts are used, even if two users have the same password, their hashed values are still different.</p>\n<p>In this proposal, we consider a particular problem of deterministic key generation, which generates RSA keys from ECDSA signatures. We assume that each user has an ECDSA private key <span class=\"math\">sk</span>, and wants to generate an RSA key pair. Instead of generating the RSA key pair separately, we make the RSA key pair a deterministic function of <span class=\"math\">sk</span> and a fixed message <span class=\"math\">m</span>. Our goal is to make the RSA keys secure. In particular, we want the probability of RSA key collisions from different users to be negligible. Due to the nature of RSA key generation, it is not enough to generate a single random number and use it directly as the private key. Instead, we need a pseudorandom number generator. Due to this requirement, we cannot use the approaches that we discussed previously.</p>\n<p>To solve this problem, we propose a good deterministic key generation scheme and pseudorandom number generator, from which RSA keys can be generated. From a high level of the scheme, we pick the initial seed to be a signature <span class=\"math\">sig(m, sk)</span>. The hash of the signature is then used as the key of the AES cipher. The algorithm and security analysis can be found as follows.</p>\n<h1><a name=\"h-2-algorithm-2\" class=\"anchor\" href=\"https://ethresear.ch#h-2-algorithm-2\"></a>2. Algorithm</h1>\n<p>Our goal is to generate RSA keys securely and deterministically from ECDSA signatures. To achieve this goal, we use the standard procedure to generate RSA keys and a pseudorandom number generator <span class=\"math\">prng</span>, which provides all sources of randomness. The sequence that <span class=\"math\">prng</span> generates is a deterministic function of the ECDSA private key <span class=\"math\">sk</span> and the message <span class=\"math\">m</span>. Therefore, the same user always generates the same RSA key pair. But from the adversary’s point of view, the sequence that <span class=\"math\">prng</span> generates looks random. Hence the RSA keys are random.</p>\n<p>At a high level, we start with an ECDSA signature. We do not assume that the signature is pseudorandom. Instead, we assume it to be unforgeable. This implies that the signatures form a sufficiently large space. (Otherwise, the brute-force attack would succeed with non-negligible probability.) We also assume that SHA256 is a random oracle, which roughly means that the result of the hash function looks random to an adversary unless the adversary knows the preimage of the function. But since we already assumed that ECDSA signatures are unforgeable, the adversary knows the preimage of the hash function with negligible probability. We can safely conclude that the pseudorandom of the result of the hash function, which we use as the key to AES block cipher. We then get a good pseudorandom number generator, from which random keys can be generated.</p>\n<p>Algorithm 1 describes the details of the algorithm. Given an ECDSA private key <span class=\"math\">sk</span> and a message <span class=\"math\">m</span>, first sign <span class=\"math\">m</span> using <span class=\"math\">sk</span> to get an ECDSA signature <span class=\"math\">sig</span>. We then use SHA256 to hash <span class=\"math\">sig</span> to get a <span class=\"math\">key</span>, and set <span class=\"math\">seed</span> to be the hash of <span class=\"math\">key</span>. A pseudorandom number generator <span class=\"math\">prng_{sig}</span> can thus be obtained using AES encryption. We define <span class=\"math\">AES(seed, key)</span> to be the sequence of AES encryption in counter mode: <span class=\"math\">AES_{ENC}(seed, key)</span>, <span class=\"math\">AES_{ENC}(seed+1, key)</span>, <span class=\"math\">AES_{ENC}(seed+2, key)</span>, <span class=\"math\">\\ldots</span>.</p>\n<pre><code class=\"lang-auto\">Algorithm 1: Deterministic Key Generation\nInput: a fixed message m, secret key sk from ECDSA\nOutput: RSA key pair\nFunction:  detGenKeyPair(m, sk)\nsig = ECDSA_Sign(m, sk)\nkey = SHA256(sig)\nseed = SHA256(key)\nprng_sig = AES(seed, key)\nRSAKeyPair(prng_sig)\n\n</code></pre>\n<p>To generate some RSA key pairs, we use the standard RSA key generation procedure (Algorithm 1). The pseudorandom number generator is responsible for providing all the randomness used in Algorithm 2.</p>\n<pre><code class=\"lang-auto\">Algorithm 2: RSA Key Generation using prng\nFunction:  RSAKeyPair(prng_sig)\np &lt;- prgn while p is not a prime do\np &lt;- prgn\nq &lt;- prgn while q is not a prime do\nq &lt;- prgn\nCompute n = p*q\nCompute l(n) = (p-1)*(q-1)\nPick some e (e and l(n) are relatively prime)\nCompute d: e * d = 1 mod l(n)\nReturn: e, d, n\n\n</code></pre>\n<p>In order to show that <span class=\"math\">detGenKeyPair</span> returns ``good’’ RSA key pairs, we compare our algorithm with a popular reference implementation <span class=\"math\">\\textit{Forge}</span>, which is a native implementation of TLS and various other cryptographic tools in JavaScript. <span class=\"math\">\\textit{Forge}</span> implements a function <span class=\"math\">\\textit{forge.pki.rsa.generateKeyPair}</span>, which generates RSA key pairs. From now on, we will refer to <span class=\"math\">\\textit{forge.pki.rsa.generateKeyPair}</span> as <span class=\"math\">\\textit{generateKeyPair}</span>. Our goal is to show that the key pairs, that <span class=\"math\">deGenKeyPair</span> generates, are as good as the key pairs, which generateKeyPair generates.</p>\n<p>More precisely, we want to show that, for any probabilistic polynomial-time adversary <span class=\"math\">\\mathcal{A}</span>, given Oracle access to the deterministic key generation function <span class=\"math\">deGenKeyPair(\\cdot, \\cdot)</span> and <span class=\"math\">generateKeyPair</span> from <span class=\"math\">generateKeyPair</span>, <span class=\"math\">\\mathcal{A}</span> cannot distinguish between the keys generated by the two oracles.</p>\n<h1><a name=\"h-3-security-analysis-3\" class=\"anchor\" href=\"https://ethresear.ch#h-3-security-analysis-3\"></a>3. Security Analysis</h1>\n<h2><a name=\"h-31-indistinguishability-4\" class=\"anchor\" href=\"https://ethresear.ch#h-31-indistinguishability-4\"></a>3.1 Indistinguishability</h2>\n<p>Firstly, we prove that  adversary <span class=\"math\">\\mathcal{A}</span> cannot distinguish between the keys generated by <span class=\"math\">deGenKeyPair</span> and <span class=\"math\">generateKeyPair</span>.</p>\n<p><em>Theorem 1:</em> For any probabilistic polynomial-time adversary <span class=\"math\">\\mathcal{A}</span>, <span class=\"math\">|Pr[\\mathcal{A}^{deGenKeyPair(\\cdot,\\cdot)}=1]-Pr[\\mathcal{A}^{generateKeyPair(\\cdot)}=1]|</span> is negligible, assuming:</p>\n<p>(1) <span class=\"math\">SHA256</span> is a random oracle.</p>\n<p>(2) <span class=\"math\">ECDSA</span> signatures are unforgeable.</p>\n<p>(3) <span class=\"math\">AES</span> is a pseudorandom function family.</p>\n<p><em>Proof 1:</em> We use proof by contradiction. We show that if the adversary <span class=\"math\">\\mathcal{A}</span> can distinguish between the keys generated by the two procedures, it must be the case that at least one of the assumptions does not hold.</p>\n<p>Suppose that <span class=\"math\">|Pr[\\mathcal{A}^{deGenKeyPair(\\cdot,\\cdot)}=1]-Pr[\\mathcal{A}^{generateKeyPair(\\cdot)}=1]|</span> is non-negligible. Since all the randomness comes from <span class=\"math\">prng_{sig}</span> and <span class=\"math\">prng_{rand}</span>, it must be the case that <span class=\"math\">\\mathcal{A}</span> can distinguish between <span class=\"math\">prng_{sig}</span> and <span class=\"math\">prng_{rand}</span> with non-negligible probability. Recall that <span class=\"math\">prng_{sig}</span> is a sequence obtained by running AES encryption in the <span class=\"math\">\\textit{counter}</span> mode. So <span class=\"math\">prng_{sig}</span> is <span class=\"math\">AES_{Enc}(seed, key)</span>, <span class=\"math\">AES_{Enc}(seed+1, key)</span>, <span class=\"math\">AES_{Enc}(seed+2, key)</span>, etc. Let <span class=\"math\">\\mathcal{K}</span> be the set of all possible keys. There are two possibilities: (i) <span class=\"math\">key</span> is uniformly at random from <span class=\"math\">\\mathcal{K}</span>, which violates our assumption that <span class=\"math\">AES</span> is a pseudorandom function family. (ii) <span class=\"math\">key</span> is not uniformly at random from <span class=\"math\">\\mathcal{K}</span>.</p>\n<p>Suppose that <span class=\"math\">key</span> is not uniformly at random from <span class=\"math\">\\mathcal{K}</span>. According to Algorithm 1, <span class=\"math\">key = SHA256(sig)</span>, where <span class=\"math\">sig=ECDSA\\_Sign(m, sk)</span>. There are two cases to consider. (i) <span class=\"math\">\\mathcal{A}</span> knows <span class=\"math\">sig</span>, which violates our assumption that <span class=\"math\">ECDSA</span> signatures are unforgeable. (ii) <span class=\"math\">\\mathcal{A}</span> does not know <span class=\"math\">sig</span>. This violates our assumption that <span class=\"math\">SHA256</span> is a random oracle.</p>\n<h2><a name=\"h-32-collision-resistance-5\" class=\"anchor\" href=\"https://ethresear.ch#h-32-collision-resistance-5\"></a>3.2 Collision-resistance</h2>\n<p><em>Theorem 2:</em> If the probability of collision of keys generated by <span class=\"math\">generateKeyPair</span> is negligible, the probability of collision of keys generated by <span class=\"math\">deGenKeyPair</span> is also negligible.</p>\n<p><em>Proof 2:</em> We use proof by contradiction. Suppose that the probability of collision of keys generated by <span class=\"math\">generateKeyPair</span> is negligible, and the probability of collision of keys generated by <span class=\"math\">deGenKeyPair</span> is non-negligible. The adversary can generate a set of keys <span class=\"math\">\\mathcal{K}</span>, and count the number of collisions in <span class=\"math\">\\mathcal{K}</span>. If the number of collisions is negligible, then the keys are generated by <span class=\"math\">generateKeyPair</span>, otherwise, they are generated by <span class=\"math\">deGenKeyPair</span>. So the adversary can distinguish between which oracle it is interacting with. But according to Theorem 1, such an adversary does not exist.</p>\n<h2><a name=\"h-33-correctness-6\" class=\"anchor\" href=\"https://ethresear.ch#h-33-correctness-6\"></a>3.3 Correctness</h2>\n<p>Let <span class=\"math\">(e,d,n)</span> be the keys that <span class=\"math\">\\textit{detGenKeyPair}</span> returns. Let <span class=\"math\">m</span> be a message, the encryption function, and the decryption function are defined as follows. <span class=\"math\">RSA_{enc}(m) \\stackrel{def}{=} m^e</span> mod <span class=\"math\">n</span>, <span class=\"math\">RSA_{dec}(m) \\stackrel{def}{=} m^d</span> mod <span class=\"math\">n</span>.</p>\n<p><em>Theorem 3:</em> Let <span class=\"math\">(e, d, n)</span> be any RSA key, which <span class=\"math\">\\textit{detGenKeyPair}</span> returns. For any message <span class=\"math\">m</span>, <span class=\"math\">RSA_{dec}(RSA_{enc}(m)) \\equiv m</span> mod <span class=\"math\">n</span>.</p>\n<p><em>Proof 3:</em> Since <span class=\"math\">l(n) = (p-1)\\times(q-1)</span> and <span class=\"math\">e \\times d = 1</span> mod <span class=\"math\">l(n)</span>, there must exist some integer <span class=\"math\">k</span> s.t. <span class=\"math\">e \\times d = k \\times (p-1) \\times (q-1) + 1</span>. So <span class=\"math\">RSA_{dec}(RSA_{enc}(m)) \\equiv m^{e\\times d}</span> mod <span class=\"math\">n \\equiv m^{ k \\times (p-1) \\times (q-1) + 1}</span> mod <span class=\"math\">n</span>.</p>\n<p><span class=\"math\">RSA_{dec}(RSA_{enc}(m)) \\equiv (m^{ k \\times (q-1)})^{p-1} \\times m</span> mod <span class=\"math\">p \\equiv m</span> mod <span class=\"math\">p</span>, by Fermat’s Little Theorem.</p>\n<p>Similary, <span class=\"math\">RSA_{dec}(RSA_{enc}(m)) \\equiv (m^{ k \\times (p-1)})^{q-1} \\times m</span> mod <span class=\"math\">q \\equiv m</span> mod <span class=\"math\">q</span>, by Fermat’s Little Theorem.</p>\n<p>According to the Chinese Remainder Theorem, <span class=\"math\">RSA_{dec}(RSA_{enc}(m)) \\equiv m</span> mod <span class=\"math\">n</span>.</p>\n<h1><a name=\"h-4-conclusion-7\" class=\"anchor\" href=\"https://ethresear.ch#h-4-conclusion-7\"></a>4. Conclusion</h1>\n<p>Our approach begins by enabling users to sign a fixed message using their ECDSA secret keys, ensuring the unforgeability of these signatures against potential adversaries. Subsequently, we employ SHA256 to hash the generated signatures, producing pseudorandom output, with the assumption that SHA256 behaves as a dependable random oracle. This resulting hash serves as the key input for the AES block cipher, facilitating the creation of our PRNG. We provide rigorous proof of the security of this construction from indistinguishability, collusion-resistance and correctness.</p>\n            <p><small>1 post - 1 participant</small></p>\n            <p><a href=\"https://ethresear.ch/t/an-rsa-deterministic-key-generation-scheme-algorithm-and-security-analysis/19745\">Read full topic</a></p>","link":"https://ethresear.ch/t/an-rsa-deterministic-key-generation-scheme-algorithm-and-security-analysis/19745","pubDate":"Wed, 05 Jun 2024 13:20:32 +0000","discourse:topicPinned":"No","discourse:topicClosed":"No","discourse:topicArchived":"No","guid":{"@isPermaLink":"false","#text":"ethresear.ch-topic-19745"},"source":{"@url":"https://ethresear.ch/t/an-rsa-deterministic-key-generation-scheme-algorithm-and-security-analysis/19745.rss","#text":"An RSA Deterministic Key Generation Scheme: Algorithm and Security Analysis"},"filter":false},{"title":"BlockTech500 Index: Mitigating the greed and centralized mentalities stifling innovation and killing the true ethos","dc:creator":"cryptskii","category":"Meta-innovation","description":"<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/b/4/b45345d09be9f5b1ecace719e29ebfb6e9b9eb41.jpeg\" data-download-href=\"https://ethresear.ch/uploads/default/b45345d09be9f5b1ecace719e29ebfb6e9b9eb41\" title=\"IMG_8324.PNG\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/b/4/b45345d09be9f5b1ecace719e29ebfb6e9b9eb41_2_690x460.jpeg\" alt=\"IMG_8324.PNG\" data-base62-sha1=\"pJem370r1Ir13zPr9zQsM7xTaj7\" width=\"690\" height=\"460\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/b/4/b45345d09be9f5b1ecace719e29ebfb6e9b9eb41_2_690x460.jpeg, https://ethresear.ch/uploads/default/optimized/3X/b/4/b45345d09be9f5b1ecace719e29ebfb6e9b9eb41_2_1035x690.jpeg 1.5x, https://ethresear.ch/uploads/default/optimized/3X/b/4/b45345d09be9f5b1ecace719e29ebfb6e9b9eb41_2_1380x920.jpeg 2x\" data-dominant-color=\"E5DCD3\"></a></div><p></p>\n<h1><a name=\"tldr-1\" class=\"anchor\" href=\"https://ethresear.ch#tldr-1\"></a>TL;DR</h1>\n<h2><a name=\"backround-2\" class=\"anchor\" href=\"https://ethresear.ch#backround-2\"></a>Backround</h2>\n<p>In the early days of banking, the pitch or narrative presented to customers focused on a few key benefits:</p>\n<ol>\n<li>\n<p><strong>Safety and Security:</strong> Banks and early banking institutions like temples or palaces offered a secure place to store valuable commodities, such as grain, precious metals, and other goods. This was particularly important in ancient times when theft and insecurity were common.</p>\n</li>\n<li>\n<p><strong>Convenience:</strong> Banking institutions provided a convenient way to manage financial transactions. Instead of carrying large amounts of money or goods, individuals could deposit their wealth and make transactions through the bank, simplifying trade and commerce.</p>\n</li>\n<li>\n<p><strong>Facilitation of Trade:</strong> By acting as intermediaries, banks facilitated trade by providing loans and credit. This allowed merchants to finance their operations, expand their businesses, and engage in long-distance trade more effectively.</p>\n</li>\n<li>\n<p><strong>Record Keeping:</strong> Banks maintained detailed records of deposits, loans, and other transactions. This provided individuals and businesses with a reliable way to keep track of their financial activities and plan for the future.</p>\n</li>\n<li>\n<p><strong>Financial Services:</strong> Banks offered various financial services, such as currency exchange, loans, and credit. This enabled individuals and businesses to access funds when needed and manage their finances more effectively.</p>\n</li>\n<li>\n<p><strong>Interest and Returns:</strong> Early banks often offered interest on deposits, providing an incentive for people to deposit their money rather than keeping it idle. This also allowed banks to use deposited<br>\nfunds for lending and investment, generating returns for both the bank and the depositor.</p>\n</li>\n<li>\n<p><strong>Stability and <span class=\"math\">Trust</span>:</strong> Over time, reputable banking institutions established a sense of stability and trust. Customers were reassured by the bank’s reliability and the formalized processes they offered, which were often backed by influential entities like governments or wealthy families.</p>\n</li>\n</ol>\n<p>The narrative was centered around the idea that banks provided a <span class=\"math\">safe</span>, <span class=\"math\">convenient</span>(See \"Athens Greece News Post below), and efficient way to manage and grow wealth (whose wealth?), thereby supporting both individual and commercial financial needs.</p>\n<p>That was the Value prop…<br>\n-----------------------------------------------------------------------------------------------------------&gt;</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/a/5/a58b7a35df757d9b12f198dd9220c5fc83bc1094.png\" data-download-href=\"https://ethresear.ch/uploads/default/a58b7a35df757d9b12f198dd9220c5fc83bc1094\" title=\"Screenshot 2024-06-01 at 11.14.40 PM\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/a/5/a58b7a35df757d9b12f198dd9220c5fc83bc1094_2_553x500.png\" alt=\"Screenshot 2024-06-01 at 11.14.40 PM\" data-base62-sha1=\"nCtBULE91eltnNSlWf2auJLAFWQ\" width=\"553\" height=\"500\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/a/5/a58b7a35df757d9b12f198dd9220c5fc83bc1094_2_553x500.png, https://ethresear.ch/uploads/default/optimized/3X/a/5/a58b7a35df757d9b12f198dd9220c5fc83bc1094_2_829x750.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/a/5/a58b7a35df757d9b12f198dd9220c5fc83bc1094_2_1106x1000.png 2x\" data-dominant-color=\"F2F2F2\"></a></div><br>\n-------------------------------------------------------------------&gt;<br>\n<strong>While blockchain technologies advocate for decentralization in terms of architecture and governance, the mechanisms for funding and development can sometimes exhibit centralized characteristics. Here are a few reasons for this and some implications</strong><br>\n-------------------------------------------------------------------&gt;<br>\nBanks aren’t the problem. A bank is just a building. Greed is the problem. It creates a barrier for entry, and an even bigger barrier for innovation to thrive how it should, without sacrificing ideologies just to get funding and then being stuck between getting the funds by joining the “Old Boys Club” or sticking to your moral grounds and ideals but not being able to do anything with it.<p></p>\n<h3><a name=\"stifling-innovation-and-replacing-it-with-what-have-now-become-nothing-but-mere-catch-phrases-decentralization-doesnt-matter-on-its-own-its-just-the-potential-pathway-to-get-what-we-really-need-from-all-this-3\" class=\"anchor\" href=\"https://ethresear.ch#stifling-innovation-and-replacing-it-with-what-have-now-become-nothing-but-mere-catch-phrases-decentralization-doesnt-matter-on-its-own-its-just-the-potential-pathway-to-get-what-we-really-need-from-all-this-3\"></a>Stifling innovation and replacing it with what have now become nothing but mere catch phrases. “Decentralization” doesn’t matter on its own. It’s just the potential pathway to get what we really need from all this:</h3>\n<ul>\n<li>Equality</li>\n<li>Freedom of choice and speech</li>\n<li>Self Sovereignty</li>\n<li>Trust inherently</li>\n</ul>\n<h2><a name=\"why-care-about-decentralization-4\" class=\"anchor\" href=\"https://ethresear.ch#why-care-about-decentralization-4\"></a><strong>Why Care About Decentralization?:</strong></h2>\n<p>Decentralization isn’t just about rejecting centralized control for its own sake. Instead, it addresses several critical societal and operational concerns:</p>\n<ol>\n<li>\n<p><strong>Empowerment and Equity</strong>: Decentralization shifts the power from a centralized authority to multiple stakeholders, enabling a fairer distribution of power. This shift promotes equity, allowing individuals and smaller entities more influence over decisions that affect their lives and operations.</p>\n</li>\n<li>\n<p><strong>Community and Stakeholder Engagement</strong>: By involving more participants in the decision-making process, decentralization enhances community engagement. This involvement can lead to decisions that better reflect the diverse interests and needs of the broader community.</p>\n</li>\n<li>\n<p><strong>Transparency and Accountability</strong>: Decentralized systems often require mechanisms that make operations more transparent and participants more accountable. This openness can reduce corruption and increase trust among stakeholders.</p>\n</li>\n<li>\n<p><strong>Innovation and Diversity of Thought</strong>: Decentralization encourages a wider range of ideas and solutions, fostering innovation. In a decentralized system, individuals and teams have the freedom to experiment and implement diverse solutions, which can lead to more creative and effective outcomes.</p>\n</li>\n<li>\n<p><strong>Resilience Against Failures and Attacks</strong>: A decentralized structure is less prone to systemic failures and cyber attacks. Since there’s no central point of failure, challenges or breaches in one area do not cripple the entire system, making it more robust and reliable.</p>\n</li>\n</ol>\n<p>In summary, when we discuss why we care about decentralization, we’re focusing on building systems that are equitable, inclusive, and designed to serve the broader interests of all stakeholders &amp; users involved, rather than just enhancing the profitability of a few. This approach not only strengthens the system’s ethical foundation but also its operational efficacy and societal impact.</p>\n<h1><a name=\"cause-for-concern-at-the-root-pain-points-for-startups-5\" class=\"anchor\" href=\"https://ethresear.ch#cause-for-concern-at-the-root-pain-points-for-startups-5\"></a>Cause for Concern at the Root (Pain Points for Startups):</h1>\n<h3><a name=\"centralization-in-grant-distribution-6\" class=\"anchor\" href=\"https://ethresear.ch#centralization-in-grant-distribution-6\"></a>Centralization in Grant Distribution</h3>\n<ol>\n<li>\n<p><strong>Resource Allocation</strong>: Even in decentralized networks, there’s often a need to manage resources, including capital, in a way that ensures the ecosystem grows healthily. Foundations often steward these resources because they have the infrastructure to manage and distribute funds effectively.</p>\n</li>\n<li>\n<p><strong>Quality Control</strong>: By funneling grants through foundations or similar bodies, the ecosystem can maintain a certain level of quality and coherence in development. This helps prevent fragmentation and ensures that projects align with the overall strategic goals of the blockchain.</p>\n</li>\n<li>\n<p><strong>Initial Stages of Ecosystem Development</strong>: In the early phases of any blockchain ecosystem, more centralized control can help steer the project towards stability and maturity. As the ecosystem matures, mechanisms can be implemented to decentralize decision-making processes, including funding.</p>\n</li>\n</ol>\n<h3><a name=\"implications-7\" class=\"anchor\" href=\"https://ethresear.ch#implications-7\"></a>Implications</h3>\n<ol>\n<li>\n<p><strong>Gatekeeping</strong>: Centralized funding can lead to gatekeeping, where only projects that align with the specific visions of the grant-giving bodies are funded. This can stifle innovation outside of those parameters.</p>\n</li>\n<li>\n<p><strong>Influence Over Development</strong>: Foundations or core teams can significantly influence the direction of the blockchain’s development through funding decisions. This can potentially conflict with the decentralized ethos of blockchain technology.</p>\n</li>\n<li>\n<p><strong>Dependency</strong>: Relying on central bodies for funding might create dependency, which could be problematic if the goals of the central body change or if it faces financial difficulties.</p>\n</li>\n</ol>\n<h3><a name=\"vc-funding-8\" class=\"anchor\" href=\"https://ethresear.ch#vc-funding-8\"></a>VC Funding</h3>\n<p>Venture capitalists often look for proof of partnerships with established entities and early user adoption as indicators of a startup’s viability and potential for success. These requirements can sometimes push startups into traditional frameworks and infrastructures, even within innovative fields like blockchain.</p>\n<h3><a name=\"why-vcs-value-partnerships-and-user-adoption-9\" class=\"anchor\" href=\"https://ethresear.ch#why-vcs-value-partnerships-and-user-adoption-9\"></a>Why VCs Value Partnerships and User Adoption</h3>\n<ol>\n<li><strong>Risk Mitigation</strong>: Partnerships with established companies can signal that the startup has passed certain due diligence checks, reducing the perceived risk for investors.</li>\n<li><strong>Market Access</strong>: Established partners can provide market access, credibility, and resources that might be difficult for a startup to achieve on its own.</li>\n<li><strong>Validation</strong>: Early user adoption, even on a small scale, serves as a proof of concept that there is market demand for the startup’s offerings.</li>\n</ol>\n<h3><a name=\"challenges-for-startups-10\" class=\"anchor\" href=\"https://ethresear.ch#challenges-for-startups-10\"></a>Challenges for Startups</h3>\n<ol>\n<li><strong>Compromise on Innovation</strong>: To secure partnerships, startups might need to align their products or services more closely with existing systems, which can sometimes water down their innovative aspects.</li>\n<li><strong>Dependency</strong>: Relying on established networks can create dependencies that may inhibit the startup’s ability to pivot or adapt in the future.</li>\n<li><strong>Dilution of Vision</strong>: In trying to meet investor criteria for partnerships and early adoption, startups might stray from their original vision, potentially compromising on the disruptive potential of their technology.</li>\n</ol>\n<p>Even as blockchain aims to decentralize many aspects of technology and finance, the evolution of its ecosystems often requires a blend of centralized and decentralized methods, especially in nascent stages.</p>\n<h3><a name=\"execution-delivery-11\" class=\"anchor\" href=\"https://ethresear.ch#execution-delivery-11\"></a>Execution &amp; Delivery</h3>\n<p>When a business or organization chooses between a “for-profit model” or a “for decentralization” model, it’s not just selecting a financial framework but also defining its core values and operational principles. The choice reflects the entity’s commitment either to maximizing profits for shareholders or to spreading power and benefits more evenly across its network of participants. We are still a long way from achieving this.</p>\n<h1><a name=\"proposed-mitigation-strategy-12\" class=\"anchor\" href=\"https://ethresear.ch#proposed-mitigation-strategy-12\"></a>Proposed Mitigation Strategy</h1>\n<p>In the rapidly evolving blockchain and cryptocurrency ecosystem, promising projects with strong technical fundamentals often struggle to gain visibility and attract resources. The space is increasingly dominated by hype-driven speculation and over-commercialization, leading to the proliferation of “meme coins” and other assets with little intrinsic value unlocked. This trend disadvantages serious developers and innovators, hindering the growth of truly transformative technologies.</p>\n<p>To address this issue, we propose the creation of a “BlockTech500” decentralized index fund that selects ranks for blockchain assets based on rigorous technical reviews and quantitative metrics. By shifting focus to fundamental technical strengths, this index aims to surface undervalued projects, provide a more efficient allocation of capital, and align incentives between investors and developers building the future foundations of Web3.</p>\n<h2><a name=\"key-benefits-13\" class=\"anchor\" href=\"https://ethresear.ch#key-benefits-13\"></a>Key Benefits</h2>\n<ul>\n<li>Amplifying developer mindshare and attracting talent to technically meritorious projects.</li>\n<li>Providing an alternative to hype-based speculation and promoting fundamental value investing.</li>\n<li>Leveraging the wisdom of technical experts in a scalable, decentralized manner.</li>\n<li>Enabling a community-led governance model for index curation and evolution.</li>\n</ul>\n<h2><a name=\"index-methodology-14\" class=\"anchor\" href=\"https://ethresear.ch#index-methodology-14\"></a>Index Methodology</h2>\n<h3><a name=\"quantitative-review-criteria-15\" class=\"anchor\" href=\"https://ethresear.ch#quantitative-review-criteria-15\"></a>Quantitative Review Criteria</h3>\n<p><strong>Definition:</strong> Let <span class=\"math\">P = \\{p_1, p_2, \\ldots, p_n\\}</span> be the set of candidate blockchain projects. Each project <span class=\"math\">p_i</span> is evaluated across <span class=\"math\">m</span> criteria <span class=\"math\">C = \\{c_1, c_2, \\ldots, c_m\\}</span>, which include:</p>\n<p><strong>Primary Criteria:</strong></p>\n<ol>\n<li><strong>Decentralization</strong>: Measured by node distribution, consensus mechanism robustness, Nakamoto coefficient. Denote as <span class=\"math\">c_1(p_i)</span>.</li>\n<li><strong>Scalability</strong>: Quantified by transaction throughput, block latency, state storage efficiency. Denote as <span class=\"math\">c_2(p_i)</span>.</li>\n<li><strong>Privacy</strong>: Assessed by the strength of privacy primitives, data obfuscation techniques, zero-knowledge proof schemes. Denote as <span class=\"math\">c_3(p_i)</span>.</li>\n<li><strong>Security</strong>: Score incorporating cryptographic primitives, attack resistance, formal verification, bug bounty programs. Denote as <span class=\"math\">c_4(p_i)</span>.</li>\n<li><strong>Innovation</strong>: Evaluates novel consensus algorithms, virtual machine architectures, smart contract languages. Denote as <span class=\"math\">c_5(p_i)</span>.</li>\n<li><strong>Censorship Resistance</strong>: Measures the cost and difficulty of censoring transactions, smart contracts, and user activity. Denote as <span class=\"math\">c_6(p_i)</span>.</li>\n<li><strong>Productivity</strong>: Quantifies developer productivity based on gas efficiency, contract deployment cost, tooling quality. Denote as <span class=\"math\">c_7(p_i)</span>.</li>\n</ol>\n<p><strong>Tiebreaker Criteria:</strong></p>\n<ol>\n<li><strong>Community Engagement</strong>: Aggregated from platform usage, transaction volume, social sentiment. Denote as <span class=\"math\">c_8(p_i)</span>.</li>\n<li><strong>Adoption</strong>: Quantified by dApp ecosystem growth, institutional partnerships. Denote as <span class=\"math\">c_9(p_i)</span>.</li>\n<li><strong>Exposure</strong>: Measures brand awareness, media coverage, search interest. Denote as <span class=\"math\">c_{10}(p_i)</span>.</li>\n</ol>\n<h3><a name=\"data-aggregation-16\" class=\"anchor\" href=\"https://ethresear.ch#data-aggregation-16\"></a>Data Aggregation</h3>\n<p>On-chain metrics for the above criteria are computed using SQL queries on data indexed by Dune Analytics:</p>\n<pre><code class=\"lang-sql\">-- Calculate Nakamoto coefficient\nSELECT \n  1.0 - sum(power(balance / total_balance, 2)) AS nakamoto_coeff\nFROM (\n  SELECT \n    sum(value) AS balance \n  FROM addresses a\n  GROUP BY 1\n  ORDER BY 1 DESC\n  LIMIT (SELECT greatest(1, ceil(0.01 * count(distinct address))) FROM addresses)\n) t, (SELECT sum(value) AS total_balance FROM addresses) t2;\n</code></pre>\n<p>Off-chain data from Github, social media, and VC deal flow are integrated to derive a holistic project view.</p>\n<h3><a name=\"scoring-weighting-17\" class=\"anchor\" href=\"https://ethresear.ch#scoring-weighting-17\"></a>Scoring &amp; Weighting</h3>\n<p>A weighted sum of criteria scores ranks each project:</p>\n<div class=\"math\">\nS(p_i) = \\sum_{j=1}^{m} w_j \\cdot c_j(p_i)\n</div>\n<p>with weights <span class=\"math\">w_j</span> satisfying <span class=\"math\">\\sum_j w_j = 1</span> and higher weight on primary criteria.</p>\n<h2><a name=\"index-rebalancing-via-versus-battles-18\" class=\"anchor\" href=\"https://ethresear.ch#index-rebalancing-via-versus-battles-18\"></a>Index Rebalancing via Versus Battles</h2>\n<h3><a name=\"reputation-and-rewards-19\" class=\"anchor\" href=\"https://ethresear.ch#reputation-and-rewards-19\"></a>Reputation and Rewards</h3>\n<p><strong>Voters</strong>:</p>\n<ul>\n<li>\n<p>Users who vote correctly (i.e., their vote aligns with the final outcome) see an increase in their reputation score, while users who vote incorrectly lose reputation.</p>\n</li>\n<li>\n<p>The magnitude of the reputation change for voters is constant, regardless of the number of ranks skipped in the challenge.</p>\n</li>\n<li>\n<p>Voters’ rewards are determined strictly by their voting reputation weights, with higher reputation scores leading to higher rewards for correct votes.</p>\n</li>\n</ul>\n<p><strong>Proposers</strong>:</p>\n<ul>\n<li>\n<p>If a proposer initiates a challenge and the challenger token wins, the proposer’s reputation weight increases by a fixed amount, regardless of the number of ranks skipped. The proposer’s reward is calculated as follows:</p>\n</li>\n<li>\n<p>for each rank skipped, the proposer receives an additional 1x their initial bet (e.g., if the proposer challenged a token one rank above and won, their reward would be 2x their initial bet; if they challenged a token two ranks above and won, their reward would be 3x their initial bet).</p>\n</li>\n<li>\n<p>If the proposer initiates a challenge and the higher-ranked token maintains its position, the proposer loses their bet and also loses reputation weight. The reputation weight loss for proposers is 1x for each rank skipped in the challenge.</p>\n</li>\n</ul>\n<h1><a name=\"workflow-example-20\" class=\"anchor\" href=\"https://ethresear.ch#workflow-example-20\"></a>Workflow Example</h1>\n<p>Consider the following example of a proposer-initiated versus match:</p>\n<p><strong>Voters</strong>:</p>\n<ul>\n<li>\n<p>Users who voted correctly (i.e., in alignment with the final outcome) see an increase in their reputation score.</p>\n</li>\n<li>\n<p>The magnitude of this increase is constant, regardless of the number of ranks skipped in the challenge. Users with higher reputation scores receive higher rewards for their correct votes. Users who voted incorrectly lose reputation.</p>\n</li>\n</ul>\n<p><strong>Proposer</strong>:</p>\n<ul>\n<li>\n<p>If the challenger token <span class=\"math\">t_C</span> wins, the proposer’s reputation weight increases by a fixed amount, and their reward is calculated as follows:</p>\n</li>\n<li>\n<p>they receive their initial bet of <span class=\"math\">1000</span> tokens plus an additional <span class=\"math\">1000</span> tokens for skipping one rank, resulting in a total reward of <span class=\"math\">2000</span> tokens (2x their initial bet).</p>\n</li>\n<li>\n<p>If the higher-ranked token <span class=\"math\">t_A</span> maintains its position, the proposer loses their bet of 1000 tokens and 1x reputation weight, as the challenged token was one rank above the challenger.</p>\n</li>\n</ul>\n<h2><a name=\"governance-incentives-21\" class=\"anchor\" href=\"https://ethresear.ch#governance-incentives-21\"></a>Governance &amp; Incentives</h2>\n<p>BlockTech500 is governed by a DAO that votes on disputed versus results, proposals, and criteria adjustments.</p>\n<h3><a name=\"initial-index-composition-and-asset-addition-process-22\" class=\"anchor\" href=\"https://ethresear.ch#initial-index-composition-and-asset-addition-process-22\"></a>Initial Index Composition and Asset Addition Process</h3>\n<p>The initial composition of the <span class=\"math\">BlockTech500</span> index will be determined through a rigorous, multi-stage process designed to identify the most technically meritorious blockchain projects at the time of launch. Let <span class=\"math\">\\mathcal{U}</span> denote the universe of all eligible blockchain assets, and let <span class=\"math\">\\mathcal{I}_0 \\subseteq \\mathcal{U}</span> represent the initial index composition.</p>\n<p>As the blockchain ecosystem evolves over time, it will be necessary to periodically update the index composition to reflect the emergence of new technically meritorious projects. To this end, we propose the following asset addition process.</p>\n<p>This two-part methodology, consisting of a rigorous initial selection process and an ongoing asset addition/removal mechanism, is designed to maintain the <span class=\"math\">BlockTech500</span> index’s compositional legitimacy over time. By subjecting all assets, both initial and subsequent, to the same comprehensive technical evaluation process, we ensure that the index remains a true reflection of the most meritorious projects in the evolving blockchain landscape.</p>\n<p>Moreover, the use of a diverse panel of independent experts (DAO Governance Delegates) which need to be nominated and win enough user votes to be in the top voted on nominees so that they are allowed to stake <span class=\"math\">X</span> tokens and become a delegate and a transparent, scoring system helps to mitigate potential biases and conflicts of interest in the index construction process. The inclusion of a deliberative weight-setting process allows for the incorporation of qualitative expert judgment while still maintaining a high degree of objectivity and repeatability. To become a delegate of the DAO you must stake <span class=\"math\">X</span> amount of tokens and they must vote among themselves to come up with dispute resolutions. they too have rep scores, but not weighted ones in the sense of voting power. but those always opposing the majority vote, would risk being replaced for underperformance at each quarterly review and nomination and election cycle of delegates. as the lowest performing ones could be replaced by new nominees if the voters lean that way</p>\n<p>Ultimately, while no index construction methodology is perfect, we believe that the proposed approach strikes an appropriate balance between rigor, objectivity, and adaptability. By carefully managing the initial index composition and instituting a robust asset addition process, the <span class=\"math\">BlockTech500</span> index can serve as a legitimate and enduring benchmark for technical merit in the dynamic world of blockchain technology.</p>\n<h1><a name=\"comparisons-23\" class=\"anchor\" href=\"https://ethresear.ch#comparisons-23\"></a>Comparisons</h1>\n<p>Sure, let’s correct that section with a comparison to Messari.</p>\n<hr>\n<p><strong>Messari vs. BlockTech 500 Index</strong></p>\n<ol>\n<li>\n<p><strong>Decentralization:</strong></p>\n<ul>\n<li>\n<p><strong>Messari:</strong> Provides comprehensive research and data analysis on various blockchain projects, including decentralization metrics. Messari evaluates node distribution, consensus mechanisms, and other decentralization factors to assess the overall robustness and security of blockchain networks.</p>\n</li>\n<li>\n<p><strong>BlockTech 500 Index:</strong> Evaluates projects on decentralization by examining node distribution, consensus mechanism robustness, and the Nakamoto coefficient. This ensures that projects are judged on their true decentralization and security merits, similar to Messari’s approach.</p>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>Community Engagement:</strong></p>\n<ul>\n<li>\n<p><strong>Messari:</strong> Engages the community through detailed research reports, market analysis, and data dashboards. While it provides extensive insights and allows user interactions, it does not incorporate direct community voting for project evaluations.</p>\n</li>\n<li>\n<p><strong>BlockTech 500 Index:</strong> Incorporates versus voting challenges where the community actively participates in ranking decisions, increasing engagement and ensuring the community’s voice plays a crucial role in project evaluations. This gamified approach can drive higher community involvement compared to Messari.</p>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>Indexing Mechanisms:</strong></p>\n<ul>\n<li>\n<p><strong>Messari:</strong> Focuses on providing in-depth research, market data, and analysis for blockchain projects. Messari offers tools and resources for tracking project metrics, market performance, and industry trends, but it does not maintain a dedicated index ranking system based purely on technical evaluations.</p>\n</li>\n<li>\n<p><strong>BlockTech 500 Index:</strong> Provides a structured, transparent ranking system that evaluates projects based on a wide range of technical criteria, helping highlight technically strong projects and providing them with the necessary visibility. The index aims to shift focus to fundamental technical strengths, offering an alternative to hype-driven market rankings.</p>\n</li>\n</ul>\n</li>\n</ol>\n<p>By focusing on core technical attributes such as decentralization, scalability, privacy, and security, the BlockTech 500 Index can highlight projects that are technically robust and innovative, similar to how Messari provides detailed insights but with an added layer of community-driven evaluation and gamified engagement.</p>\n<h2><a name=\"the-graph-network-24\" class=\"anchor\" href=\"https://ethresear.ch#the-graph-network-24\"></a>The Graph Network</h2>\n<p><strong>1. Decentralization:</strong></p>\n<ul>\n<li>\n<p><strong>The Graph</strong>: Uses a network of nodes to index data from multiple blockchains, relying on economic incentives through the Graph Token (GRT) to maintain decentralization. Indexers stake GRT to participate, and curators signal high-quality subgraphs by staking GRT.</p>\n</li>\n<li>\n<p><strong>BlockTech 500 Index</strong>: Emphasizes decentralization through comprehensive technical evaluations, including scalability, privacy, security, innovation, censorship resistance, and productivity.</p>\n</li>\n</ul>\n<p><strong>2. Community Engagement:</strong></p>\n<ul>\n<li>\n<p><strong>The Graph</strong>: Community engagement is driven through the roles of curators, indexers, and delegators. Each role is incentivized to participate and ensure the quality of the indexed data. Curators earn rewards for identifying valuable subgraphs.</p>\n</li>\n<li>\n<p><strong>BlockTech 500 Index</strong>: Adds an interactive element to community participation with versus voting challenges. This direct involvement can drive more engagement and a sense of ownership among community members.</p>\n</li>\n</ul>\n<p><strong>3. Indexing Mechanisms:</strong></p>\n<ul>\n<li>\n<p><strong>The Graph</strong>: Provides a decentralized indexing and querying protocol for blockchain data, using GraphQL to make the data easily accessible. Indexers stake tokens to ensure data reliability, and the system uses economic incentives to maintain integrity.</p>\n</li>\n<li>\n<p><strong>BlockTech 500 Index</strong>: While not a data indexing protocol, it offers a comprehensive ranking system based on technical evaluations, aiming to provide visibility and credibility to technically strong projects, which might otherwise be overlooked due to a lack of community engagement or exposure.</p>\n</li>\n</ul>\n<hr>\n<h3><a name=\"currently-there-arent-any-cryptocurrency-ranking-and-review-dapps-or-tools-that-allow-for-this-level-of-gamification-and-precision-where-high-quality-decentralized-community-level-insights-which-can-be-incentivized-in-such-an-exact-approach-as-head-to-head-comparisons-which-are-broken-down-even-further-into-categories-25\" class=\"anchor\" href=\"https://ethresear.ch#currently-there-arent-any-cryptocurrency-ranking-and-review-dapps-or-tools-that-allow-for-this-level-of-gamification-and-precision-where-high-quality-decentralized-community-level-insights-which-can-be-incentivized-in-such-an-exact-approach-as-head-to-head-comparisons-which-are-broken-down-even-further-into-categories-25\"></a>Currently there aren’t any Cryptocurrency ranking and review dapps or tools that allow for this level of gamification and precision where high quality decentralized community level insights which can be incentivized in such an exact approach as head to head comparisons which are broken down even further into categories.</h3>\n<hr>\n<h1><a name=\"advantages-benefits-26\" class=\"anchor\" href=\"https://ethresear.ch#advantages-benefits-26\"></a>Advantages &amp; Benefits</h1>\n<h3><a name=\"increasing-visibility-and-credibility-27\" class=\"anchor\" href=\"https://ethresear.ch#increasing-visibility-and-credibility-27\"></a>Increasing Visibility and Credibility</h3>\n<ol>\n<li>\n<p><strong>Highlighting Technical Merit</strong>: By focusing on core technical attributes such as decentralization, scalability, privacy, and security, the index brings attention to projects that are technically robust and innovative, even if they have not yet built a large community or gained significant exposure.</p>\n<ul>\n<li><strong>Case Study</strong>: Projects like Algorand and Polkadot, which are technically advanced, have benefitted from increased visibility through rankings and technical evaluations despite initially having smaller communities compared to giants like Ethereum.</li>\n</ul>\n</li>\n<li>\n<p><strong>Attracting Funding and Partnerships</strong>: Being featured in a prestigious, technically-focused index like the BlockTech 500 can attract investors and partnerships. Investors often look for technically sound projects that have the potential for growth. This can provide the necessary capital for these projects to further develop their community and market presence.</p>\n<ul>\n<li><strong>Example</strong>: Technical excellence often attracts venture capital interest. For example, projects that focus on innovative consensus algorithms or novel scalability solutions can secure funding from tech-savvy investors looking for the next breakthrough.</li>\n</ul>\n</li>\n</ol>\n<h3><a name=\"facilitating-community-growth-28\" class=\"anchor\" href=\"https://ethresear.ch#facilitating-community-growth-28\"></a>Facilitating Community Growth</h3>\n<ol>\n<li>\n<p><strong>Building Trust</strong>: Inclusion in the BlockTech 500 Index can serve as a stamp of approval for technical quality, helping to build trust among potential users and developers. This can drive community engagement as more individuals and organizations feel confident in participating.</p>\n<ul>\n<li><strong>Impact</strong>: Trust can lead to increased participation from developers and users, which is crucial for community growth. Projects with high technical ratings can see a surge in developer interest, leading to more contributions and improvements.</li>\n</ul>\n</li>\n<li>\n<p><strong>Leveraging Exposure</strong>: The exposure from being listed in the BlockTech 500 can help technically strong projects that lack marketing prowess or community engagement to gain visibility. This can lead to organic growth as more people become aware of the project’s potential and start contributing to or using the technology.</p>\n<ul>\n<li><strong>Example</strong>: Innovative blockchain projects that receive media coverage and analyst attention due to their technical merits can experience a significant increase in community interest and engagement.</li>\n</ul>\n</li>\n</ol>\n<h3><a name=\"addressing-the-innovation-gap-29\" class=\"anchor\" href=\"https://ethresear.ch#addressing-the-innovation-gap-29\"></a>Addressing the Innovation Gap</h3>\n<ol>\n<li>\n<p><strong>Encouraging Innovation</strong>: By recognizing and rewarding technical innovation, the index encourages projects to focus on developing new technologies and solutions. This can lead to a healthier blockchain ecosystem with a variety of robust, innovative projects.</p>\n<ul>\n<li><strong>Outcome</strong>: Projects that might have otherwise remained unnoticed due to their lack of marketing can gain the spotlight, promoting a diverse range of solutions and technologies in the blockchain space.</li>\n</ul>\n</li>\n<li>\n<p><strong>Support for Undervalued Projects</strong>: Projects that are technically sound but undervalued in the market due to lack of exposure can benefit from the structured and transparent evaluation provided by the BlockTech 500 Index. This can help level the playing field, ensuring that technical merit is recognized and rewarded.</p>\n<ul>\n<li><strong>Benefit</strong>: This helps ensure that good technology does not go unnoticed and that resources are allocated more efficiently within the blockchain ecosystem.</li>\n</ul>\n</li>\n</ol>\n<p>In conclusion, the <span class=\"math\">BlockTech500</span> Index can significantly help projects that are strong in innovation and technical aspects but lack in community and other tiebreaker attributes. By providing these projects with increased visibility and credibility, the index can attract funding and partnerships, build community trust, and ultimately ensure that technical excellence is recognized and rewarded.</p>\n            <p><small>3 posts - 1 participant</small></p>\n            <p><a href=\"https://ethresear.ch/t/blocktech500-index-mitigating-the-greed-and-centralized-mentalities-stifling-innovation-and-killing-the-true-ethos/19713\">Read full topic</a></p>","link":"https://ethresear.ch/t/blocktech500-index-mitigating-the-greed-and-centralized-mentalities-stifling-innovation-and-killing-the-true-ethos/19713","pubDate":"Sun, 02 Jun 2024 06:35:43 +0000","discourse:topicPinned":"No","discourse:topicClosed":"No","discourse:topicArchived":"No","guid":{"@isPermaLink":"false","#text":"ethresear.ch-topic-19713"},"source":{"@url":"https://ethresear.ch/t/blocktech500-index-mitigating-the-greed-and-centralized-mentalities-stifling-innovation-and-killing-the-true-ethos/19713.rss","#text":"BlockTech500 Index: Mitigating the greed and centralized mentalities stifling innovation and killing the true ethos"},"filter":false},{"title":"Integrating Governance Tokens and Memecoins: A Dual-Token System for Enhanced Blockchain Efficiency and Stability","dc:creator":"cryptskii","category":"Economics","description":"<h1><a name=\"tldr-1\" class=\"anchor\" href=\"https://ethresear.ch#tldr-1\"></a>TL;DR</h1>\n<h2><a name=\"background-2\" class=\"anchor\" href=\"https://ethresear.ch#background-2\"></a>Background</h2>\n<p>In the evolving landscape of blockchain technology, different types of tokens serve distinct purposes, creating unique economic dynamics and challenges. Governance tokens and memecoins are two prominent types of tokens with contrasting roles:</p>\n<ol>\n<li>\n<p><strong>Governance Tokens</strong>: These tokens are typically used for voting, decision-making, and protocol governance within a blockchain network. They hold significant importance in controlling and influencing the network’s future direction. However, their critical role often results in low transaction frequency, as holders prefer to retain them for strategic governance purposes rather than regular transactions. This low velocity can lead to decreased liquidity and underutilization of their potential as a medium of exchange.</p>\n</li>\n<li>\n<p><strong>Memecoins</strong>: Designed for high-frequency transactions, memecoins are intended to be used as everyday transactional currency. They offer fast transaction times and are widely adopted for various payment activities. Despite their high velocity and liquidity, memecoins usually do not contribute to the network’s security or governance, leading to a separation between transactional utility and network governance.</p>\n</li>\n</ol>\n<p>This dichotomy creates a fragmented token economy where neither type of token fully exploits its potential, affecting the overall efficiency and stability of the blockchain ecosystem. Governance tokens remain largely inactive in everyday commerce, while memecoins, although frequently used, do not enhance the security or governance of the network.</p>\n<h2><a name=\"problem-3\" class=\"anchor\" href=\"https://ethresear.ch#problem-3\"></a>Problem</h2>\n<p>The key challenge within blockchain systems employing governance tokens and memecoins e.g. <span class=\"math\">(DOGE)</span> or “<span class=\"math\">Dogecoin</span>” revolve around the distinct usage intentions and transaction demands for each type of token. Governance tokens, typically used for voting and protocol governance, often lack incentives for regular transactions due to their importance in network control. This can lead to decreased liquidity and underutilization of the tokens’ potential as a medium of exchange. Conversely, memecoins are designed for high-frequency transactions but might not contribute significantly to network security or governance. This dichotomy results in a fragmented token economy where neither type fully exploits its potential, thus affecting the overall efficiency and stability of the blockchain ecosystem.</p>\n<h2><a name=\"proposal-4\" class=\"anchor\" href=\"https://ethresear.ch#proposal-4\"></a>Proposal</h2>\n<p>To address these issues, an innovative system design is proposed dubbed “<span class=\"math\">TTTs</span>” or <strong>“Turtle Time Tokens”</strong>. <span class=\"math\">(TTTs)</span> have intentionally delayed transaction confirmation times to harmonize the economic roles of governance tokens and memecoins. By intentionally extending the confirmation time for governance token transactions, their velocity can be decreased, promoting value stability and encouraging use in strategic, high-value transactions or staking for governance purposes. Conversely, memecoins can serve as the primary medium for everyday transactions due to their faster confirmations, enhancing the blockchain’s usability and liquidity.</p>\n<p>This dual-token system aims to create a balanced distribution of token utility across different network activities, fostering a robust economic environment that supports both governance and rapid transaction needs. The decoupling of governance and transactional roles enhances the efficiency and stability of the blockchain ecosystem, ensuring that each token type serves its intended purpose effectively.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/e/5/e5c5edd5c4d97aa8cb0c718003700faed4f7b44f.jpeg\" data-download-href=\"https://ethresear.ch/uploads/default/e5c5edd5c4d97aa8cb0c718003700faed4f7b44f\" title=\"Screenshot 2024-06-01 at 1.14.24 PM\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/e/5/e5c5edd5c4d97aa8cb0c718003700faed4f7b44f_2_495x500.jpeg\" alt=\"Screenshot 2024-06-01 at 1.14.24 PM\" data-base62-sha1=\"wMFoUkJClZXRAl9zN1YhaElUgDd\" width=\"495\" height=\"500\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/e/5/e5c5edd5c4d97aa8cb0c718003700faed4f7b44f_2_495x500.jpeg, https://ethresear.ch/uploads/default/optimized/3X/e/5/e5c5edd5c4d97aa8cb0c718003700faed4f7b44f_2_742x750.jpeg 1.5x, https://ethresear.ch/uploads/default/optimized/3X/e/5/e5c5edd5c4d97aa8cb0c718003700faed4f7b44f_2_990x1000.jpeg 2x\" data-dominant-color=\"7C8674\"></a></div><p></p>\n<h2><a name=\"breakdown-5\" class=\"anchor\" href=\"https://ethresear.ch#breakdown-5\"></a>Breakdown</h2>\n<p>The proposed solution aims to integrate the economic roles of governance tokens and memecoins more cohesively by altering transaction confirmation times and restricting the staking capabilities of the chosen memecoin being used as the native payment token, enhances the distinct utility of each token type, promoting a balanced and efficient blockchain ecosystem.</p>\n<h3><a name=\"governance-tokens-6\" class=\"anchor\" href=\"https://ethresear.ch#governance-tokens-6\"></a>Governance Tokens:</h3>\n<p>By intentionally extending the confirmation time for governance token transactions, we can decrease their velocity, thus stabilizing their value and encouraging their use in more deliberate, high-value transactions or staking for governance purposes. This design leverages longer confirmation times to disincentivize frivolous use and preserve the tokens for strategic decisions and network support. Governance tokens, therefore, become more valuable for long-term network governance and security.</p>\n<h3><a name=\"wrapped-memecoins-7\" class=\"anchor\" href=\"https://ethresear.ch#wrapped-memecoins-7\"></a>Wrapped Memecoins:</h3>\n<p>Wrapped Dogecoin (wDOGE) and similar memecoins can serve as the primary medium for everyday transactions due to their faster confirmations, enhancing the blockchain’s usability and liquidity. To maintain this liquidity and usability, wrapped memecoins would be blocked from staking capabilities. This restriction ensures that memecoins remain liquid and readily available for transactions, preventing them from being locked up in staking contracts. By keeping memecoins out of staking, the focus for staking and network security remains on governance tokens.</p>\n<h3><a name=\"benefits-of-the-dual-token-system-8\" class=\"anchor\" href=\"https://ethresear.ch#benefits-of-the-dual-token-system-8\"></a>Benefits of the Dual-Token System</h3>\n<ol>\n<li>\n<p><strong>Balanced Token Utility</strong>:</p>\n<ul>\n<li><strong>Governance Tokens</strong>: Used for high-value transactions, governance, and staking. Extended confirmation times encourage strategic use and value stability.</li>\n<li><strong>Wrapped Memecoins</strong>: Used for everyday transactions with fast confirmations, ensuring high liquidity and usability. Blocking staking capabilities maintains their transactional focus.</li>\n</ul>\n</li>\n<li>\n<p><strong>Economic Stability</strong>:</p>\n<ul>\n<li><strong>Governance Tokens</strong>: Reduced velocity and increased stability due to longer confirmation times.</li>\n<li><strong>Wrapped Memecoins</strong>: Enhanced value stability as their valuation is decoupled from the fluctuating underlying value of the protocol’s governance aspects.</li>\n</ul>\n</li>\n<li>\n<p><strong>Security and Compensation</strong>:</p>\n<ul>\n<li><strong>Transaction Fees</strong>: The application of gas fees on memecoin transactions ensures that network validators are adequately compensated, maintaining network security and operational integrity without the need for memecoins to contribute directly to governance.</li>\n<li><strong>Staking Focus</strong>: Governance tokens are the primary focus for staking, enhancing network security and governance efficiency.</li>\n</ul>\n</li>\n</ol>\n<h3><a name=\"implementation-9\" class=\"anchor\" href=\"https://ethresear.ch#implementation-9\"></a>Implementation</h3>\n<ol>\n<li>\n<p><strong>Governance Token Design</strong>:</p>\n<ul>\n<li>Implement extended confirmation times for governance token transactions.</li>\n<li>Design smart contracts for staking governance tokens to secure the network and participate in protocol governance.</li>\n</ul>\n</li>\n<li>\n<p><strong>Wrapped Memecoin Design</strong>:</p>\n<ul>\n<li>Ensure fast confirmation times for memecoin transactions.</li>\n<li>Implement smart contracts that block staking capabilities for wrapped memecoins, ensuring their liquidity and transactional focus.</li>\n</ul>\n</li>\n<li>\n<p><strong>Economic and Security Models</strong>:</p>\n<ul>\n<li>Develop models to calculate optimal confirmation times and transaction fees to balance liquidity, stability, and network security.</li>\n<li>Create incentives for validators to process both governance token and memecoin transactions, ensuring robust network security.</li>\n</ul>\n</li>\n</ol>\n<p>By integrating these design choices, the proposed solution promotes a more balanced distribution of token utility across different network activities, fostering a robust economic environment that supports both governance and rapid transaction needs. This dual-token system enhances the overall efficiency and stability of the blockchain ecosystem, ensuring that each token type serves its intended purpose effectively.</p>\n<h3><a name=\"utility-expansion-and-demand-10\" class=\"anchor\" href=\"https://ethresear.ch#utility-expansion-and-demand-10\"></a>Utility Expansion and Demand</h3>\n<div class=\"math\">\nU = \\sum_{i=1}^{n} u_i\n</div>\n<p>where <span class=\"math\">u_i</span> represents a specific use case the token enables. All else equal, a higher <span class=\"math\">U</span> should correspond to increased demand <span class=\"math\">D</span>, which we can model simply as:</p>\n<div class=\"math\">\nD = \\alpha U - \\beta P + \\epsilon\n</div>\n<p>where <span class=\"math\">P</span> is the token price, <span class=\"math\">\\alpha</span>, <span class=\"math\">\\beta</span> are coefficients representing the sensitivity of demand to utility and price respectively, and <span class=\"math\">\\epsilon</span> captures all other demand factors. Therefore, the increase in utility from permitting <span class=\"math\">T_g</span> transactions should boost demand for governance tokens by <span class=\"math\">\\alpha \\Delta U</span>.</p>\n<h3><a name=\"value-stability-and-velocity-impacts-11\" class=\"anchor\" href=\"https://ethresear.ch#value-stability-and-velocity-impacts-11\"></a>Value Stability and Velocity Impacts</h3>\n<p>With intentionally long confirmation times <span class=\"math\">\\tau_g</span> for <span class=\"math\">T_g</span> transactions creating a natural disincentive for using governance tokens in everyday payments and commerce compared to the memecoin with <span class=\"math\">\\tau_m</span> confirmations. This should reduce the velocity <span class=\"math\">V_g</span> of governance tokens. From the equation of exchange:</p>\n<div class=\"math\">\nMV = PQ\n</div>\n<p>where <span class=\"math\">M</span> is money supply, <span class=\"math\">V</span> is velocity, <span class=\"math\">P</span> is price level, and <span class=\"math\">Q</span> is real economic output transacted in the token. Reduced <span class=\"math\">V_g</span> puts upward pressure on <span class=\"math\">P_g</span>. Compared to memecoins used for payments, this dynamic could make governance token prices <span class=\"math\">P_g</span> more stable.</p>\n<p>We can quantify the velocity difference as follows. Let <span class=\"math\">\\lambda_g</span> be the fraction of <span class=\"math\">M_g</span> governance tokens transacted per unit time and <span class=\"math\">\\lambda_m</span> be the equivalent for <span class=\"math\">M_m</span> memecoins. Assuming the confirmation time drives usage, the expected velocities are:</p>\n<div class=\"math\">\nV_g = \\frac{\\lambda_g}{\\tau_g}, \\quad V_m = \\frac{\\lambda_m}{\\tau_m}\n</div>\n<p>So the velocity ratio simplifies to:</p>\n<div class=\"math\">\n\\frac{V_g}{V_m} = \\frac{\\lambda_g \\tau_m}{\\lambda_m \\tau_g}\n</div>\n<p>If <span class=\"math\">\\lambda_g \\approx \\lambda_m</span> (similar transaction demand) but <span class=\"math\">\\tau_g \\gg \\tau_m</span>, then <span class=\"math\">V_g \\ll V_m</span>. Memecoins should have much higher velocity and be the dominant medium of exchange.</p>\n<h3><a name=\"fee-revenue-and-security-budget-12\" class=\"anchor\" href=\"https://ethresear.ch#fee-revenue-and-security-budget-12\"></a>Fee Revenue and Security Budget</h3>\n<p>However, the governance token transactions <span class=\"math\">T_g</span>, though slower, still generate fee revenue for validators. If <span class=\"math\">T_g</span> transactions are a fraction <span class=\"math\">\\phi</span> of all transactions and the average fee is <span class=\"math\">\\bar{f}</span>, then the expected security budget from governance token usage is:</p>\n<div class=\"math\">\nB_g = \\phi \\bar{f} \\lambda_g M_g\n</div>\n<p>Compared to a system with only memecoins, this design increases the total security budget by <span class=\"math\">B_g</span>, without inflating <span class=\"math\">V_m</span> and putting downward pressure on <span class=\"math\">P_m</span>. The security ratio between the two tokens is:</p>\n<div class=\"math\">\n\\frac{B_g}{B_m} = \\frac{\\phi \\lambda_g M_g}{(1 - \\phi) \\lambda_m M_m}\n</div>\n<p>Even if <span class=\"math\">\\phi</span> and <span class=\"math\">M_g</span> are small compared to memecoins, this can still be a significant security contribution, especially if governance tokens have a higher average transaction size and therefore higher <span class=\"math\">\\bar{f}</span>.</p>\n<h3><a name=\"user-experience-and-economic-incentives-13\" class=\"anchor\" href=\"https://ethresear.ch#user-experience-and-economic-incentives-13\"></a>User Experience and Economic Incentives</h3>\n<p>The contrasting confirmation times <span class=\"math\">\\tau_g</span> and <span class=\"math\">\\tau_m</span> create a natural UX and economic incentive for users to treat the two tokens differently in their activities:</p>\n<pre data-code-wrap=\"algorithm\"><code class=\"lang-plaintext\">Algorithm 1 User Token Selection\n\nv ← value of transaction\nut ← user’s time preference\nif v is low and ut prefers fast settlement then\n    Use memecoin\nelse\n    if staking or network utility dominates then\n        Use governance token\n    else\n        Use either based on other factors\n    end if\nend if\n</code></pre>\n<p>Users are incentivized to use memecoins for everyday small transactions given the faster <span class=\"math\">\\tau_m</span> confirmations. Conversely, governance staking and protocol utility create a strong incentive to hold governance tokens despite their slower transactability.</p>\n<p>In essence, the system economically “prices in” the opportunity cost of using scarce governance tokens in transactions through the longer confirmation times <span class=\"math\">\\tau_g</span>. This encourages efficient allocation between staking and transacting. At the margin, a user should only transact a governance token if the economic gain exceeds the time value and staking opportunity cost.</p>\n<h3><a name=\"memecoin-stability-and-single-purpose-design-14\" class=\"anchor\" href=\"https://ethresear.ch#memecoin-stability-and-single-purpose-design-14\"></a>Memecoin Stability and Single-Purpose Design</h3>\n<p>As mentioned, a key factor in a memecoin’s potential stability is its focused, single-purpose design optimized for payments. Unlike governance tokens or more complex multi-purpose tokens, a memecoin like Dogecoin aims to excel at one core function: facilitating fast, cheap, and reliable transactions.</p>\n<p>This specialization has several potential benefits for stability:</p>\n<ol>\n<li><strong>Reduced Exposure to Protocol-Level Risks</strong>: By being used across multiple networks, a memecoin can diversify its risk exposure. Even if a particular network experiences issues or a decline in the perceived value of its governance token, the memecoin’s value may remain more stable given its usage and acceptance on other chains.</li>\n<li><strong>Network Effect and Lindy Effect</strong>: As a memecoin gains adoption as a payment method across multiple platforms, it can benefit from a strong network effect. The more users and merchants accept it, the more valuable and stable it becomes. Over time, this can create a self-reinforcing cycle of stability (the Lindy effect).</li>\n<li><strong>Decoupling from Platform Innovation</strong>: A payment-focused memecoin’s value is less strongly coupled to the technological progress and innovations of any single platform. As long as it continues to meet its core payment functionality, its value can remain relatively stable even if some networks advance faster than others.</li>\n</ol>\n<p>We can formalize this concept of a memecoin’s “stability advantage” <span class=\"math\">SA</span> over a platform-specific governance token as follows:</p>\n<div class=\"math\">\nSA = \\frac{\\sigma_g}{\\sigma_m}\n</div>\n<p>where <span class=\"math\">\\sigma_g</span> is the price volatility of the governance token and <span class=\"math\">\\sigma_m</span> is the price volatility of the memecoin. All else equal, we would expect <span class=\"math\">SA &gt; 1</span> for a widely adopted memecoin used across many platforms.</p>\n<h3><a name=\"quantifying-cross-platform-adoption-15\" class=\"anchor\" href=\"https://ethresear.ch#quantifying-cross-platform-adoption-15\"></a>Quantifying Cross-Platform Adoption</h3>\n<p>The stability advantage of a cross-platform memecoin depends heavily on the degree and distribution of its adoption across networks. We can quantify this “adoption spread” <span class=\"math\">A_s</span> as:</p>\n<div class=\"math\">\nA_s = 1 - \\sum_{i=1}^{N} \\left(\\frac{T_i}{T}\\right)^2\n</div>\n<p>where <span class=\"math\">N</span> is the total number of networks the memecoin is used on, <span class=\"math\">T_i</span> is the transaction volume on the <span class=\"math\">i</span>-th network, and <span class=\"math\">T</span> is the total transaction volume across all networks.</p>\n<p><span class=\"math\">A_s</span> ranges from 0 to <span class=\"math\">1 - \\frac{1}{N}</span>, with higher values indicating more evenly spread adoption. An <span class=\"math\">A_s</span> close to 0 means the memecoin is heavily dominated by usage on a single network, while a value close to <span class=\"math\">1 - \\frac{1}{N}</span> indicates relatively equal adoption across all <span class=\"math\">N</span> networks.</p>\n<p>Putting it together, we can propose a simple model for the stability <span class=\"math\">S</span> of a cross-platform memecoin:</p>\n<div class=\"math\">\nS = k \\cdot A_s \\cdot SA\n</div>\n<p>where <span class=\"math\">k</span> is a constant reflecting other factors like overall cryptocurrency market conditions. This suggests that a memecoin’s stability is driven by both its inherent stability advantage over platform-specific tokens and the breadth of its adoption across platforms.</p>\n<h3><a name=\"factors-contributing-to-stability-16\" class=\"anchor\" href=\"https://ethresear.ch#factors-contributing-to-stability-16\"></a>Factors Contributing to Stability</h3>\n<ol>\n<li>\n<p><strong>Increased Liquidity</strong>:</p>\n<ul>\n<li><strong>Widespread Use</strong>: As <span class=\"math\">wDOGE</span> is adopted across multiple blockchains, its liquidity would increase. High liquidity typically reduces price volatility, as large trades can be absorbed without significantly affecting the price.</li>\n<li><strong>Liquidity Pools</strong>: Enhanced liquidity pools and decentralized exchanges on multiple blockchains would facilitate seamless conversion and trading, further stabilizing the price.</li>\n</ul>\n</li>\n<li>\n<p><strong>Broad Network Effect</strong>:</p>\n<ul>\n<li><strong>Adoption and Usage</strong>: The more widely <span class=\"math\">wDOGE</span> is used, the stronger its network effect becomes. As more merchants, users, and platforms accept and use <span class=\"math\">wDOGE</span> for payments, its utility and trust increase, contributing to price stability.</li>\n<li><strong>Lindy Effect</strong>: The longer <span class=\"math\">wDOGE</span> is used successfully, the more likely it is to continue being used, enhancing its reputation and perceived stability.</li>\n</ul>\n</li>\n<li>\n<p><strong>Diversified Risk</strong>:</p>\n<ul>\n<li><strong>Cross-Platform Stability</strong>: By being used on multiple blockchains, $wDOGE$’s value is less tied to the performance or issues of any single blockchain. This diversification reduces the risk of value fluctuations due to problems on one specific network.</li>\n<li><strong>Decoupling from Governance</strong>: Since <span class=\"math\">wDOGE</span> is not used for governance or staking, its value is decoupled from the complexities and risks associated with network governance decisions and staking economics.</li>\n</ul>\n</li>\n</ol>\n<h3><a name=\"economic-model-for-stability-17\" class=\"anchor\" href=\"https://ethresear.ch#economic-model-for-stability-17\"></a>Economic Model for Stability</h3>\n<ol>\n<li>\n<p><strong>Supply and Demand Dynamics</strong>:</p>\n<ul>\n<li><strong>Stable Demand</strong>: As <span class=\"math\">wDOGE</span> becomes a preferred payment token across multiple blockchains, the consistent demand for transactions helps stabilize its value.</li>\n<li><strong>Predictable Supply</strong>: Assuming the supply of wrapped Dogecoin is managed effectively (e.g., through minting and burning mechanisms that maintain a 1:1 peg with the original Dogecoin), the predictability in supply further contributes to price stability.</li>\n</ul>\n</li>\n<li>\n<p><strong>Velocity of Money</strong>:</p>\n<ul>\n<li><strong>High Velocity</strong>: <span class=\"math\">wDOGE</span> ’s use in frequent, everyday transactions ensures high velocity. According to the equation of exchange <span class=\"math\">(MV = PQ)</span> (where <span class=\"math\">(M)</span> is money supply, <span class=\"math\">(V)</span> is velocity, <span class=\"math\">(P)</span> is price level, and <span class=\"math\">(Q)</span> is real output), high velocity helps maintain a stable <span class=\"math\">(P)</span> if <span class=\"math\">(Q)</span> (transaction volume) is also high and stable.</li>\n<li><strong>Transactional Stability</strong>: As <span class=\"math\">wDOGE</span> is used primarily for payments, the consistent transaction volume across multiple blockchains contributes to its price stability.</li>\n</ul>\n</li>\n</ol>\n<h3><a name=\"benefits-of-stabilized-wdoge-for-payments-18\" class=\"anchor\" href=\"https://ethresear.ch#benefits-of-stabilized-wdoge-for-payments-18\"></a>Benefits of Stabilized <span class=\"math\">wDOGE</span> for Payments</h3>\n<ol>\n<li>\n<p><strong>Reliable Medium of Exchange</strong>:</p>\n<ul>\n<li><strong>Price Stability</strong>: With reduced volatility, <span class=\"math\">wDOGE</span> becomes a more reliable medium of exchange, encouraging its use in everyday transactions without concerns over significant value changes.</li>\n<li><strong>Merchant Adoption</strong>: Merchants are more likely to accept a stable token for payments, reducing the risk of loss due to price fluctuations.</li>\n</ul>\n</li>\n<li>\n<p><strong>User Confidence</strong>:</p>\n<ul>\n<li><strong>Trust and Acceptance</strong>: Stability fosters trust among users, making them more comfortable holding and transacting with <span class=\"math\">wDOGE</span>.</li>\n<li><strong>Wider Adoption</strong>: As user confidence grows, wider adoption follows, creating a positive feedback loop that further stabilizes the token’s value.</li>\n</ul>\n</li>\n<li>\n<p><strong>Integration with Financial Systems</strong>:</p>\n<ul>\n<li><strong>Easier Integration</strong>: A stable payment token can be more easily integrated with traditional financial systems, such as point-of-sale systems, online payment gateways, and financial services.</li>\n<li><strong>Regulatory Compliance</strong>: Stability can also make it easier to comply with regulatory requirements, as regulators often favor less volatile assets for payment purposes.</li>\n</ul>\n</li>\n</ol>\n<p><em>Widespread adoption of  e.g. <span class=\"math\">wDOGE</span> across multiple blockchains has the potential to significantly stabilize its value, making it an even more effective and reliable payment token. The increased liquidity, broad network effect, diversified risk, and stable supply and demand dynamics contribute to this stability. A stable Memecoin enhances user confidence, encourages merchant adoption, and facilitates integration with traditional financial systems, promoting its use as a preferred medium of exchange in the cryptocurrency ecosystem.</em></p>\n<h2><a name=\"advantages-19\" class=\"anchor\" href=\"https://ethresear.ch#advantages-19\"></a>Advantages</h2>\n<p>Allowing fungible governance tokens to be spent but with slower confirmations than memecoins is a powerful tokenomic design pattern. It creates a natural separation in token utility and incentivizes staking while still harnessing transactional usage for security. More broadly, it illustrates how subtle technical choices like confirmation times can be deeply interlinked with a cryptocurrency’s economic structure and incentives.</p>\n<h2><a name=\"applications-20\" class=\"anchor\" href=\"https://ethresear.ch#applications-20\"></a>Applications</h2>\n<p>Improving our understanding of these tokenomic principles can help inform the rational engineering of future blockchain networks. Despite these challenges, the potential of a widely adopted, cross-platform memecoin to achieve relative stability compared to platform-specific tokens remains compelling. As decentralized networks continue to evolve, observing the dynamics of payment-focused memecoins like <span class=\"math\">Dogecoin</span> can provide valuable insights into the future of cryptocurrency stability and adoption.</p>\n<h2><a name=\"comparisons-21\" class=\"anchor\" href=\"https://ethresear.ch#comparisons-21\"></a>Comparisons</h2>\n<p>The proposed dual-token system with differentiated confirmation times using <span class=\"math\">TTTs</span> for governance tokens and memecoins like <span class=\"math\">DOGE</span>, is a novel approach to harmonizing the economic roles of different token types in blockchain networks. To better understand its potential impact and significance, it’s essential to compare it with other leading concepts and approaches in this area.</p>\n<ol>\n<li>\n<p><strong>Dual-Token Economies</strong>: The idea of using multiple token types within a single blockchain ecosystem is not new. Several projects, such as Decred and Cosmos, have implemented dual-token economies to separate the roles of staking, governance, and transactions. However, the proposed system takes this concept further by introducing differentiated confirmation times to optimize the utility and stability of each token type.</p>\n</li>\n<li>\n<p><strong>Stablecoin Designs</strong>: Stablecoins, such as Tether <span class=\"math\">(USDT)</span> and USD Coin <span class=\"math\">(USDC)</span>, have gained popularity as a means to mitigate the volatility of cryptocurrencies. These tokens are typically pegged to a stable asset, like the US dollar, to maintain a consistent value. While the proposed system’s memecoin (e.g., <span class=\"math\">wDOGE</span>) is not explicitly designed as a stablecoin, its focus on payments and stability shares some similarities with stablecoin concepts. The key difference lies in the approach to achieving stability - through widespread adoption and decoupling from governance, rather than an explicit peg.</p>\n</li>\n<li>\n<p><strong>Velocity Reduction Mechanisms</strong>: Some projects have explored mechanisms to reduce token velocity and encourage holding, such as transaction fees, demurrage, or time-locked staking. The proposed system’s extended confirmation times for governance tokens can be seen as a novel velocity reduction mechanism that aligns with the token’s intended use case. This approach is more organically tied to the network’s economic incentives compared to external mechanisms.</p>\n</li>\n<li>\n<p><strong>Interoperability and Cross-Chain Adoption</strong>: The proposed system emphasizes the importance of widespread adoption of memecoins like <span class=\"math\">wDOGE</span> across multiple blockchains. This aligns with the growing trend of interoperability and cross-chain solutions in the blockchain space. Projects like Polkadot, Cosmos, and Chainlink are working on enabling seamless communication and value transfer between different blockchains. The proposed system can leverage these advancements to facilitate the widespread adoption and stability of memecoins.</p>\n</li>\n<li>\n<p><strong>Economic Incentive Design</strong>: The field of tokenomics focuses on designing incentive structures that align the behavior of network participants with the overall goals of the system. The proposed dual-token system is a prime example of economic incentive design, as it creates a clear separation of roles and incentives for governance token holders and memecoin users. This approach is in line with the ongoing research and experimentation in the field of tokenomics.</p>\n</li>\n</ol>\n<p>While the proposed system introduces novel concepts, such as differentiated confirmation times and the specific focus on memecoins like wDOGE, it also builds upon and complements existing approaches in the blockchain space. The emphasis on stability, interoperability, and incentive alignment is consistent with the general direction of the industry.</p>\n<h2><a name=\"conclusion-22\" class=\"anchor\" href=\"https://ethresear.ch#conclusion-22\"></a>Conclusion</h2>\n<p>The design choices for blockchain governance and payment tokens have far-reaching implications for network dynamics, user behavior, and overall economic stability. By leveraging different confirmation times for governance and payment tokens, we can create a balanced ecosystem that encourages efficient token usage, enhances security, and promotes long-term stability. Further research and comparative analysis will continue to refine these models and inform the development of robust and scalable blockchain systems.</p>\n            <p><small>3 posts - 1 participant</small></p>\n            <p><a href=\"https://ethresear.ch/t/integrating-governance-tokens-and-memecoins-a-dual-token-system-for-enhanced-blockchain-efficiency-and-stability/19707\">Read full topic</a></p>","link":"https://ethresear.ch/t/integrating-governance-tokens-and-memecoins-a-dual-token-system-for-enhanced-blockchain-efficiency-and-stability/19707","pubDate":"Sat, 01 Jun 2024 17:16:48 +0000","discourse:topicPinned":"No","discourse:topicClosed":"No","discourse:topicArchived":"No","guid":{"@isPermaLink":"false","#text":"ethresear.ch-topic-19707"},"source":{"@url":"https://ethresear.ch/t/integrating-governance-tokens-and-memecoins-a-dual-token-system-for-enhanced-blockchain-efficiency-and-stability/19707.rss","#text":"Integrating Governance Tokens and Memecoins: A Dual-Token System for Enhanced Blockchain Efficiency and Stability"},"filter":false},{"title":"Strawmanning Based Preconfirmations","dc:creator":"linoscope","category":"Layer 2","description":"<p>By <a href=\"https://twitter.com/linoscope\" rel=\"noopener nofollow ugc\">Lin Oshitani</a> (Nethermind Research). Thanks to <a href=\"https://twitter.com/ConorMcMenamin9\" rel=\"noopener nofollow ugc\">Conor</a> and <a href=\"https://www.linkedin.com/in/aikaterini-panagiota-stouka/\" rel=\"noopener nofollow ugc\">Aikaterini</a> for the detailed discussions and review. Thanks also to <a href=\"https://twitter.com/smartprogrammer\" rel=\"noopener nofollow ugc\">Ahmad</a> and  <a href=\"https://twitter.com/Brechtpd\" rel=\"noopener nofollow ugc\">Brecht</a> for their review and comments. This work was partly funded by Taiko. The views expressed are my own and do not necessarily reflect those of the reviewers or Taiko.</p>\n<h1><a name=\"introduction-1\" class=\"anchor\" href=\"https://ethresear.ch#introduction-1\"></a>Introduction</h1>\n<p><a href=\"https://ethresear.ch/t/based-rollups-superpowers-from-l1-sequencing/15016/\">Based sequencing</a> provides a credibly neutral shared sequencer layer that enables composability among rollups and between rollups and L1. Additionally, <a href=\"https://ethresear.ch/t/based-preconfirmations/17353\">based preconfirmations</a> provide fast preconfirmation services on top of based sequencing, significantly enhancing the user experience as a result. However, compared to non-preconfirming based sequencing, naive implementations of based preconfirmations introduce negative externalities that require thoughtful consideration. Although issues have been highlighted in works such as <a href=\"https://www.youtube.com/watch?v=b3o2YP6sxpg\" rel=\"noopener nofollow ugc\">this Bell Curve episode</a> (mainly in the context of non-based sequencers) and <a href=\"https://research.chainbound.io/examining-the-based-sequencing-spectrum\" rel=\"noopener nofollow ugc\">this write-up</a> from Chainbound, we believe the topic remains largely underexplored.</p>\n<p>In this post, we will analyze a simple “strawman” preconfirmation setup, identify its shortcomings, and shed light on the challenges that future solutions must address.</p>\n<h1><a name=\"the-strawman-2\" class=\"anchor\" href=\"https://ethresear.ch#the-strawman-2\"></a>The Strawman</h1>\n<p>The strawman based preconfirmation setup is as follows:</p>\n<ul>\n<li>The L1 proposer may or may not delegate the preconf right to some external entity.\n<ul>\n<li>We use the term <em>preconfer</em> to describe the entity providing preconfirmations, which can either be the L1 proposer itself or an entity delegated from the L1 proposer.</li>\n</ul>\n</li>\n<li>The preconfer handles preconfirmations by providing two endpoints:\n<ul>\n<li>Request endpoint: For users and searchers to request preconfirmations.</li>\n<li>Promise endpoint: For streaming the preconf results to the public. It enables the preconfirmation requester to promptly receive the result while allowing other users to stay updated on the latest preconfirmed state before initiating their own preconfirmations.</li>\n</ul>\n</li>\n<li>Users will include a “preconf tip” to the requests to incentivize preconfers to provide preconfirmations.</li>\n<li>The preconfer preconfirms transactions primarily on a first-come-first-serve basis.</li>\n</ul>\n<p><img src=\"https://ethresear.ch/uploads/default/original/3X/6/2/62f461e44a685f6ecf9401c8c6ad62689a826ec1.jpeg\" alt=\"Based Preconf (2) (1)\" data-base62-sha1=\"e7onuIzRDpwD9KD1j3CE3w7YPDP\" width=\"649\" height=\"282\"></p>\n<p>Furthermore, because they are significantly more complex to design and implement, we focus solely on execution promises. Execution promises guarantee the exact sequence and state of a transaction. In contrast, inclusion promises only ensure that a transaction will be included without specifying the conditions of its inclusion.</p>\n<h1><a name=\"the-problems-3\" class=\"anchor\" href=\"https://ethresear.ch#the-problems-3\"></a>The Problems</h1>\n<p>We will cover six problems with the strawman based preconfirmation design:</p>\n<ul>\n<li>Problem 1: Latency races</li>\n<li>Problem 2: Congestion</li>\n<li>Problem 3: Tip pricing</li>\n<li>Problem 4: Fair exchange</li>\n<li>Problem 5: Liveness</li>\n<li>Problem 6: Early auctions</li>\n</ul>\n<h2><a name=\"problem-1-latency-races-4\" class=\"anchor\" href=\"https://ethresear.ch#problem-1-latency-races-4\"></a><strong>Problem 1: Latency races</strong></h2>\n<p>Whoever has the lowest latency to the preconfer gains all the MEV <a href=\"https://docs.cow.fi/mevblocker/concepts/mev-concepts/what-is-backrunning\" rel=\"noopener nofollow ugc\">back-running profit</a>. This is because they can:</p>\n<ol>\n<li>Be the first to obtain the latest state of the chain through the promise endpoint and</li>\n<li>be the first to insert their back-run transaction via the request endpoint.</li>\n</ol>\n<p>This structure has historically <a href=\"https://academic.oup.com/qje/article/130/4/1547/1916146\" rel=\"noopener nofollow ugc\">incentivized <em>latency races</em></a>, where network participants strive to minimize latency to the limit. Eventually, this would lead to searchers choosing to colocate or vertically integrate with preconfers, which significantly risks the network’s <a href=\"https://collective.flashbots.net/t/decentralized-crypto-needs-you-to-be-a-geographical-decentralization-maxi/1385\" rel=\"noopener nofollow ugc\">geographical decentralization</a>.</p>\n<p>Such latency races have been a long-lasting concern for existing centralized sequencers. For example, the Arbitrum team has explored the idea of <a href=\"https://github.com/OffchainLabs/nitro/pull/1504\" rel=\"noopener nofollow ugc\">implementing Proof of Work</a> (PoW) where they grant fast connections to participants who succeed in PoW while imposing artificial delays on participants who do not. However, this proposal encountered <a href=\"https://research.arbitrum.io/t/thoughts-on-arbitrums-proposal-to-score-connections-by-pow/8121\" rel=\"noopener nofollow ugc\">backlash from the community</a> due to the substantial economic waste introduced.</p>\n<h2><a name=\"problem-2-congestion-5\" class=\"anchor\" href=\"https://ethresear.ch#problem-2-congestion-5\"></a>Problem 2: Congestion</h2>\n<p>Given that L2 transaction fees are typically low, searchers may choose to avoid latency races altogether and instead flood the rollup with probabilistic arbitrage attempts. This can be done by spamming an arbitrage contract that attempts an arbitrage and rollbacks if it fails. In Solana, where the fee is extremely low, it has been <a href=\"https://www.jito.network/blog/solving-the-mev-problem-on-solana-a-guide-for-stakers/#:~:text=Solana%20validators%20are%20wasting%20more%20than%2058%25%20of%20their%20time%20processing%20failed%20arbitrages\" rel=\"noopener nofollow ugc\">reported</a> that validators waste ~58% of their time processing such failed arbitrage transactions.</p>\n<p>This would result in a situation resembling pre-Flashbots <a href=\"https://arxiv.org/abs/1904.05234\" rel=\"noopener nofollow ugc\">priority gas auctions</a>, where the competition among searchers congests the block space with failed arbitrage transactions, ultimately driving up gas fees for regular users.</p>\n<h2><a name=\"problem-3-tip-pricing-6\" class=\"anchor\" href=\"https://ethresear.ch#problem-3-tip-pricing-6\"></a>Problem 3: Tip pricing</h2>\n<p>The preconfer must solve an <a href=\"https://hackmd.io/@EspressoSystems/bft-and-proposer-promised-preconfirmations#:~:text=online%20MEV%20maximization%20problem\" rel=\"noopener nofollow ugc\">online MEV problem</a>, where they decide whether to preconf a transaction with no/limited visibility to other transactions that compete for the same position. For example, suppose the preconfer receives a preconf request with 1 ETH tip. How would the preconfer know that the tip is appropriately priced? Should they accept the tip and preconf immediately or wait for a while in case there is another request with a higher tip?</p>\n<h2><a name=\"problem-4-fair-exchange-7\" class=\"anchor\" href=\"https://ethresear.ch#problem-4-fair-exchange-7\"></a>Problem 4: Fair exchange</h2>\n<p>The preconfer can withhold preconf promises and not return them to the user in a timely manner. Note that preconfers are incentivized to withhold preconf promises as much as possible to maximize their opportunity to reorder and insert transactions, thereby increasing their MEV.</p>\n<p>As an extreme example, the preconfer could withhold all promises during its window (12 sec or more), reorder and inject txs as it wishes, and only publish the promises when the final tx batch is submitted to L1.</p>\n<h2><a name=\"problem-5-liveness-8\" class=\"anchor\" href=\"https://ethresear.ch#problem-5-liveness-8\"></a>Problem 5: Liveness</h2>\n<p>For the case when the proposer delegates the preconfirming rights to an external preconfer, the liveness and censorship resistance of the preconfirmations will rely solely on this single external entity for the duration of the preconfer’s slot(s).</p>\n<h2><a name=\"problem-6-early-auctions-9\" class=\"anchor\" href=\"https://ethresear.ch#problem-6-early-auctions-9\"></a>Problem 6: Early auctions</h2>\n<p>Any system with L1 composable preconfirmations (i.e., preconfirmation of L1 transactions) will likely result in <em>preconfer-builder integration,</em> where preconfer and builder become the same entity. This is for two reasons:</p>\n<ul>\n<li>With L1 preconfirmations, most cross-domain MEV, including CEX-DEX arbitrage, will be captured through preconfirmed transactions.\n<ul>\n<li>Considering the bulk of MEV revenue comes from CEX-DEX arbitrage, this means that most MEV revenue will be secured through preconfirmations. Consequently, the revenue from building the non-preconfirmed portion of the block will be greatly reduced.</li>\n</ul>\n</li>\n<li>Preconfed L1 transactions must be included at the top of the current block.\n<ul>\n<li>Inserting any transactions before a preconfirmed transaction could alter the state anticipated by the preconfirmation, potentially invalidating the preconfirmation guarantee. This means builders must constantly incorporate the latest preconfed transactions into their blocks, which would be extremely difficult, if not unfeasible.</li>\n</ul>\n</li>\n</ul>\n<p>Combined with preconf delegation happening ahead of the proposer’s slot, preconfer-builder integration leads us to a world where L1 proposers delegate their preconfirmation rights <em>and block-building rights</em> to the same external entity <em>ahead of time</em> for their slot.</p>\n<p>Selecting the block builder in advance, known as <em>early auctions</em>, contrasts sharply with the current MEV-Boost PBS pipeline, where block builders are dynamically chosen <em>just-in-time</em> (<em>JIT</em>) within the slot through block auctions. More details comparing JIT auctions and early auctions can be found <a href=\"https://collective.flashbots.net/t/when-to-sell-your-blocks/2814\" rel=\"noopener nofollow ugc\">here</a>.</p>\n<p>The goal of based sequencing is to inherit the security of L1. However, with based preconfirmations, we risk altering the security landscape of the underlying L1 itself. Although early auctions might not be entirely detrimental (further research and experimentation are needed), they represent a fundamental shift from the current MEV-Boost builder market. Therefore, they should be introduced with great care, especially when introduced off-protocol, where control over centralization tendencies is limited.</p>\n<h1><a name=\"conclusion-10\" class=\"anchor\" href=\"https://ethresear.ch#conclusion-10\"></a>Conclusion</h1>\n<p>We observed that naive implementations of preconfirmations can lead to various negative externalities. As with all things in blockchains, trade-offs are inevitable. However, such negative effects should be mitigated as much as possible and, when needed, introduced as a deliberate choice, not an accident.</p>\n<p>At Nethermind, along with our collaborators, we are actively researching solutions that address the issues outlined in this document. Stay tuned for more updates!</p>\n            <p><small>1 post - 1 participant</small></p>\n            <p><a href=\"https://ethresear.ch/t/strawmanning-based-preconfirmations/19695\">Read full topic</a></p>","link":"https://ethresear.ch/t/strawmanning-based-preconfirmations/19695","pubDate":"Fri, 31 May 2024 11:43:01 +0000","discourse:topicPinned":"No","discourse:topicClosed":"No","discourse:topicArchived":"No","guid":{"@isPermaLink":"false","#text":"ethresear.ch-topic-19695"},"source":{"@url":"https://ethresear.ch/t/strawmanning-based-preconfirmations/19695.rss","#text":"Strawmanning Based Preconfirmations"},"filter":false},{"title":"Gossip IWANT/IHAVE Effectiveness in Ethereum's Gossipsusb network","dc:creator":"yiannisbot","category":"Networking","description":"<h1><a name=\"summary-tldr-1\" class=\"anchor\" href=\"https://ethresear.ch#summary-tldr-1\"></a>Summary &amp; TL;DR</h1>\n<p>The ProbeLab team (<a href=\"https://probelab.io\" rel=\"noopener nofollow ugc\">https://probelab.io</a>) is carrying out a study on the performance of Gossipsub in Ethereum’s P2P network. This post is reporting the first of a list of metrics that the team will be diving into, namely, how efficient is Gossipsub’s gossip mechanism. For the purposes of this study, we have built a tool called Hermes (<a href=\"https://github.com/probe-lab/hermes/\" class=\"inline-onebox\" rel=\"noopener nofollow ugc\">GitHub - probe-lab/hermes: A Gossipsub listener and tracer.</a>), which acts as a GossipSub listener and tracer. Hermes subscribes to all relevant pubsub topics and traces all protocol interactions. The results reported here are from a 3.5hr trace.</p>\n<p><strong>Study Description:</strong> The purpose of this study is to identify the ratio between the number of <code>IHAVE</code> messages sent and the number of <code>IWANT</code> messages received from our node. This should be done both in terms of overall messages, but also in terms of <code>msgIDs</code>. This metric will give us an overview of the effectiveness of Gossipsub’s gossip mechanism, i.e., how useful the bandwidth consumed by gossip messages really is.</p>\n<p><strong>TL;DR:</strong> <strong>The effectiveness of Gossipsub’s gossip mechanism, i.e., the <code>IHAVE</code> and <code>IWANT</code> message exchange is not efficient in the Ethereum network.</strong> Message ratios between Sent <code>IHAVEs</code> and Received <code>IWANTs</code> can reach to more than 1:50 for some topics. Suggested optimisations and things to investigate to improve effectiveness are given at the end of this report.</p>\n<h2><a name=\"overall-results-sent-ihaves-vs-received-iwant-2\" class=\"anchor\" href=\"https://ethresear.ch#overall-results-sent-ihaves-vs-received-iwant-2\"></a>Overall Results - Sent IHAVEs vs Received IWANT</h2>\n<p>The plots below do not differentiate between different topics. They present aggregates over all topics. The ratio of sent <code>IHAVEs</code> vs received <code>IWANTs</code> does not seem extreme (top plot) with a ratio of less than 1:2, but digging deeper into the number of <code>msgIDs</code> carried by those <code>IHAVE</code> and <code>IWANT</code> messages shows a different picture (middle plot). The ratio itself for all three topics are given in the third (bottom plot), where we see that especially for the beacon_block topic the ratio is close to 1:100 and going a lot higher at times.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/2/7/27e3878da92a987de30755da843003d2390d2852.png\" data-download-href=\"https://ethresear.ch/uploads/default/27e3878da92a987de30755da843003d2390d2852\" title=\"gossip_control_msgs_sent_ihave_vs_recv_iwant_messages\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/2/7/27e3878da92a987de30755da843003d2390d2852_2_517x309.png\" alt=\"gossip_control_msgs_sent_ihave_vs_recv_iwant_messages\" data-base62-sha1=\"5GS6guu22d7JvCUaDaT4M9KpCjE\" width=\"517\" height=\"309\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/2/7/27e3878da92a987de30755da843003d2390d2852_2_517x309.png, https://ethresear.ch/uploads/default/optimized/3X/2/7/27e3878da92a987de30755da843003d2390d2852_2_775x463.png 1.5x, https://ethresear.ch/uploads/default/original/3X/2/7/27e3878da92a987de30755da843003d2390d2852.png 2x\" data-dominant-color=\"F9F8F8\"></a></div><p></p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/1/6/169e349eb5bf6f5eae425791f895e9ae32a5a41d.png\" data-download-href=\"https://ethresear.ch/uploads/default/169e349eb5bf6f5eae425791f895e9ae32a5a41d\" title=\"gossip_control_msgs_sent_ihave_vs_recv_iwant_message_ids\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/1/6/169e349eb5bf6f5eae425791f895e9ae32a5a41d_2_517x309.png\" alt=\"gossip_control_msgs_sent_ihave_vs_recv_iwant_message_ids\" data-base62-sha1=\"3e5spcR8uui86liVE47bS1wp1oN\" width=\"517\" height=\"309\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/1/6/169e349eb5bf6f5eae425791f895e9ae32a5a41d_2_517x309.png, https://ethresear.ch/uploads/default/optimized/3X/1/6/169e349eb5bf6f5eae425791f895e9ae32a5a41d_2_775x463.png 1.5x, https://ethresear.ch/uploads/default/original/3X/1/6/169e349eb5bf6f5eae425791f895e9ae32a5a41d.png 2x\" data-dominant-color=\"F6F6F6\"></a></div><p></p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/a/3/a37bfd19efcd740d899634ae0d27a92413c2cb2e.png\" data-download-href=\"https://ethresear.ch/uploads/default/a37bfd19efcd740d899634ae0d27a92413c2cb2e\" title=\"gossip_control_msgs_ration_of_sent_ihave_vs_recv_iwant_message_ids_all_topics\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/a/3/a37bfd19efcd740d899634ae0d27a92413c2cb2e_2_517x309.png\" alt=\"gossip_control_msgs_ration_of_sent_ihave_vs_recv_iwant_message_ids_all_topics\" data-base62-sha1=\"nkfth88x4NjdAsKzgTt6Hkoeym2\" width=\"517\" height=\"309\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/a/3/a37bfd19efcd740d899634ae0d27a92413c2cb2e_2_517x309.png, https://ethresear.ch/uploads/default/optimized/3X/a/3/a37bfd19efcd740d899634ae0d27a92413c2cb2e_2_775x463.png 1.5x, https://ethresear.ch/uploads/default/original/3X/a/3/a37bfd19efcd740d899634ae0d27a92413c2cb2e.png 2x\" data-dominant-color=\"F9F6F4\"></a></div><p></p>\n<h2><a name=\"per-topic-results-sent-ihaves-vs-received-iwant-3\" class=\"anchor\" href=\"https://ethresear.ch#per-topic-results-sent-ihaves-vs-received-iwant-3\"></a>Per Topic Results - Sent IHAVEs vs Received IWANT</h2>\n<p>Next, we’re diving into the ratio <em>per topic</em> to get a better understanding of the gossip effectiveness for each topic. We’re presenting the overall number as well as the ratio per topic. The ratio of sent <code>IHAVEs</code> vs received <code>IWANTs</code> is more extreme and reaches an average of close to 1:100 for the <code>beacon_block</code> topic, 1:10 for the <code>beacon_aggregate_and_proof</code> topic and 1:6 for the <code>sync_committee_contribution_and_proof</code> topic.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/0/b/0b1d31747dac95b38c72afe9858fb9211ded447c.png\" data-download-href=\"https://ethresear.ch/uploads/default/0b1d31747dac95b38c72afe9858fb9211ded447c\" title=\"gossip_control_msgs_sent_ihave_vs_recv_iwant_message_ids_69ae0e99_beacon_block\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/0/b/0b1d31747dac95b38c72afe9858fb9211ded447c_2_517x309.png\" alt=\"gossip_control_msgs_sent_ihave_vs_recv_iwant_message_ids_69ae0e99_beacon_block\" data-base62-sha1=\"1AjNuB7chyphAJT4OYkyGtGgHZa\" width=\"517\" height=\"309\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/0/b/0b1d31747dac95b38c72afe9858fb9211ded447c_2_517x309.png, https://ethresear.ch/uploads/default/optimized/3X/0/b/0b1d31747dac95b38c72afe9858fb9211ded447c_2_775x463.png 1.5x, https://ethresear.ch/uploads/default/original/3X/0/b/0b1d31747dac95b38c72afe9858fb9211ded447c.png 2x\" data-dominant-color=\"F9F7F6\"></a></div><p></p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/d/5/d5ac836932182c36c9ef2f0097bc2c27a8b39beb.png\" data-download-href=\"https://ethresear.ch/uploads/default/d5ac836932182c36c9ef2f0097bc2c27a8b39beb\" title=\"gossip_control_msgs_sent_ihave_vs_recv_iwant_message_ids_69ae0e99_beacon_aggregate_and_proof\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/d/5/d5ac836932182c36c9ef2f0097bc2c27a8b39beb_2_517x309.png\" alt=\"gossip_control_msgs_sent_ihave_vs_recv_iwant_message_ids_69ae0e99_beacon_aggregate_and_proof\" data-base62-sha1=\"uufjaWfUlpHVPGvVHcFjTbzJLqX\" width=\"517\" height=\"309\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/d/5/d5ac836932182c36c9ef2f0097bc2c27a8b39beb_2_517x309.png, https://ethresear.ch/uploads/default/optimized/3X/d/5/d5ac836932182c36c9ef2f0097bc2c27a8b39beb_2_775x463.png 1.5x, https://ethresear.ch/uploads/default/original/3X/d/5/d5ac836932182c36c9ef2f0097bc2c27a8b39beb.png 2x\" data-dominant-color=\"FAF9F9\"></a></div><p></p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/a/a/aa5d777e133a0cf20446b3e978d7060fbc4a8086.png\" data-download-href=\"https://ethresear.ch/uploads/default/aa5d777e133a0cf20446b3e978d7060fbc4a8086\" title=\"gossip_control_msgs_sent_ihave_vs_recv_iwant_message_ids_69ae0e99_sync_committee_contribution_and_proof\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/a/a/aa5d777e133a0cf20446b3e978d7060fbc4a8086_2_517x309.png\" alt=\"gossip_control_msgs_sent_ihave_vs_recv_iwant_message_ids_69ae0e99_sync_committee_contribution_and_proof\" data-base62-sha1=\"oj7q8DBeVJwr1Jguwh6YR9Tcm46\" width=\"517\" height=\"309\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/a/a/aa5d777e133a0cf20446b3e978d7060fbc4a8086_2_517x309.png, https://ethresear.ch/uploads/default/optimized/3X/a/a/aa5d777e133a0cf20446b3e978d7060fbc4a8086_2_775x463.png 1.5x, https://ethresear.ch/uploads/default/original/3X/a/a/aa5d777e133a0cf20446b3e978d7060fbc4a8086.png 2x\" data-dominant-color=\"F9F8F7\"></a></div><p></p>\n<p>It is clear that there is an excess of <code>IHAVE</code> messages sent compared to the usefulness that these provide in terms of received <code>IWANT</code> messages. There’s at least a 10x bandwidth consumption that we could optimise for if we reduced the ratios especially for the <code>beacon_block</code> and <code>beacon_aggregate_and_proof</code> topics.</p>\n<p>The <code>beacon_aggregate_and_proofs</code> topic sends hundreds of thousands of <code>message_ids</code> over the wire in a minute, with very few <code>IWANT</code> messages in return. The ratio of sent <code>IHAVE</code> <code>msgIDs</code> to the received <code>IWANT msgIDs</code> stays around 10 times bigger.</p>\n<h2><a name=\"overall-results-received-ihave-vs-sent-iwant-4\" class=\"anchor\" href=\"https://ethresear.ch#overall-results-received-ihave-vs-sent-iwant-4\"></a>Overall Results - Received IHAVE vs Sent IWANT</h2>\n<p>The situation is even more extreme for the case of Received <code>IHAVE</code> vs Sent <code>IWANT</code> messages in terms of overhead. We include below the overall results only, as well as the ratios per topic. We consider that the ratios are even higher here because our node is rather well-connected (keeps connections to 250 peers) and therefore is more likely to be included in the <code>GossipFactor</code> fraction of peers that are chosen to send gossip to (i.e., <code>IHAVEs</code>). This in turn means that we must be receiving lots of duplicate <code>msgIDs</code> in those <code>IHAVE</code> messages. Digging into the number of duplicate messages are subject to a different metric further down in this report.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/e/8/e8bfe2c7e1e5061cc1e6189027c61cb561e5ebff.png\" data-download-href=\"https://ethresear.ch/uploads/default/e8bfe2c7e1e5061cc1e6189027c61cb561e5ebff\" title=\"gossip_control_msgs_recv_ihave_vs_sent_iwant_messages\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/e/8/e8bfe2c7e1e5061cc1e6189027c61cb561e5ebff_2_517x309.png\" alt=\"gossip_control_msgs_recv_ihave_vs_sent_iwant_messages\" data-base62-sha1=\"xcZSYvske1XnexqrEXJ6DiGeMeH\" width=\"517\" height=\"309\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/e/8/e8bfe2c7e1e5061cc1e6189027c61cb561e5ebff_2_517x309.png, https://ethresear.ch/uploads/default/optimized/3X/e/8/e8bfe2c7e1e5061cc1e6189027c61cb561e5ebff_2_775x463.png 1.5x, https://ethresear.ch/uploads/default/original/3X/e/8/e8bfe2c7e1e5061cc1e6189027c61cb561e5ebff.png 2x\" data-dominant-color=\"F9F9FA\"></a></div><p></p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/d/7/d7221f99eab26664812e8a7b8a5af32da2457f1a.png\" data-download-href=\"https://ethresear.ch/uploads/default/d7221f99eab26664812e8a7b8a5af32da2457f1a\" title=\"gossip_control_msgs_recv_ihave_vs_sent_iwant_message_ids\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/d/7/d7221f99eab26664812e8a7b8a5af32da2457f1a_2_517x309.png\" alt=\"gossip_control_msgs_recv_ihave_vs_sent_iwant_message_ids\" data-base62-sha1=\"uH9LrKJX2vCMAuQjSkOn6KnoS5s\" width=\"517\" height=\"309\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/d/7/d7221f99eab26664812e8a7b8a5af32da2457f1a_2_517x309.png, https://ethresear.ch/uploads/default/optimized/3X/d/7/d7221f99eab26664812e8a7b8a5af32da2457f1a_2_775x463.png 1.5x, https://ethresear.ch/uploads/default/original/3X/d/7/d7221f99eab26664812e8a7b8a5af32da2457f1a.png 2x\" data-dominant-color=\"F5F6F7\"></a></div><p></p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/9/3/93bb45e0850316dea9fa50186848459a21d1d3bd.png\" data-download-href=\"https://ethresear.ch/uploads/default/93bb45e0850316dea9fa50186848459a21d1d3bd\" title=\"gossip_control_msgs_ration_of_recv_ihave_vs_sent_iwant_message_ids_all_topics\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/9/3/93bb45e0850316dea9fa50186848459a21d1d3bd_2_517x309.png\" alt=\"gossip_control_msgs_ration_of_recv_ihave_vs_sent_iwant_message_ids_all_topics\" data-base62-sha1=\"l4TpX9YgaXH7AEezMiRQc931Qst\" width=\"517\" height=\"309\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/9/3/93bb45e0850316dea9fa50186848459a21d1d3bd_2_517x309.png, https://ethresear.ch/uploads/default/optimized/3X/9/3/93bb45e0850316dea9fa50186848459a21d1d3bd_2_775x463.png 1.5x, https://ethresear.ch/uploads/default/original/3X/9/3/93bb45e0850316dea9fa50186848459a21d1d3bd.png 2x\" data-dominant-color=\"F6F3F1\"></a></div><p></p>\n<h2><a name=\"anomalies-5\" class=\"anchor\" href=\"https://ethresear.ch#anomalies-5\"></a>Anomalies</h2>\n<p>Gossipsub messages should always be assigned to a particular topic, as not all peers are subscribed to all topics. Having a topic helps with correctly identifying invalid messages and avoiding overloading of peers with messages they’re not interested in.</p>\n<p>We have consistently seen throughout the duration of the experiment both <code>IHAVE</code> and <code>IWANT</code> messages sent to our node with an empty topic. Both of these are considered anomalies, especially given that the <code>IWANT</code> messages we received were for <code>msgIDs</code> that we didn’t advertise through an <code>IHAVE</code> message earlier.</p>\n<p>Digging deeper into the results, we have seen that 49 out of the 55 peers that we received messages with an empty topic were Teku nodes. We have started the following Github issue to surface the anomaly: <a href=\"https://github.com/libp2p/jvm-libp2p/issues/361\" class=\"inline-onebox\" rel=\"noopener nofollow ugc\">Possible Bug on GossipSub implementation that makes sharing `IHAVE` control messages with empty topics · Issue #361 · libp2p/jvm-libp2p · GitHub</a>, which has been fixed: <a href=\"https://github.com/libp2p/jvm-libp2p/pull/365\" class=\"inline-onebox\" rel=\"noopener nofollow ugc\">Set topicID on outbound IHAVE and ignore inbound IHAVE for unknown topic by StefanBratanov · Pull Request #365 · libp2p/jvm-libp2p · GitHub</a>.</p>\n<h2><a name=\"takeaways-6\" class=\"anchor\" href=\"https://ethresear.ch#takeaways-6\"></a>Takeaways</h2>\n<ul>\n<li>The average effectiveness ratio of the gossip functionality is higher than 1:10 across topics, which is not ideal.</li>\n<li>Messages that are generated less frequently (such as <code>beacon_block</code> topic messages) are primarily propagated through the mesh and less through gossip (<code>IHAVE/IWANT</code> messages), hence the higher ratios, which reach up to 1:100 for this particular topic.</li>\n<li>GossipSub control messages are relevant, but we identify two different use-cases for GossipSub that don’t benefit in the same way from all these control messages:\n<ul>\n<li>Big but less frequent messages → more prone to <code>DUPLICATED</code> messages, but with less overhead on the <code>IHAVE</code> control side. The gossiping effectiveness is rather small here.</li>\n<li>Small but very frequent messages → add significant overhead on the bandwidth usage as many more <code>msg_ids</code> are added in each <code>IHAVE</code> message.</li>\n</ul>\n</li>\n</ul>\n<h2><a name=\"optimisation-potential-7\" class=\"anchor\" href=\"https://ethresear.ch#optimisation-potential-7\"></a>Optimisation Potential</h2>\n<p>Clearly, having an effectiveness ratio of 1:10 or even less, i.e., consuming &gt;10x more bandwidth for <code>IHAVE/IWANT</code> messages than actually needed, is not ideal. Three directions for improvement have been identified, although none of them has been implemented, tested, or simulated.</p>\n<ol>\n<li>Bloom filters: instead of sending <code>msgIDs</code> in <code>IHAVE/IWANT</code> messages, peers can send a bloom filter of the messages that they have received within the “message window history”.</li>\n<li>Adjust <code>GossipsubHistoryGossip</code> factor from 3 to 2: This requires some more testing, but it’s a straightforward item to consider. This parameter, set to 3 by default [<a href=\"https://github.com/libp2p/go-libp2p-pubsub/blob/048a4d30d0c3c00829181fd81aa697eb60497448/gossipsub.go#L39\" rel=\"noopener nofollow ugc\">link</a>], defines for how many heartbeats do we send <code>IHAVE</code> messages for. Sending messages for 3 heartbeats ago obviously increases the number of messages with questionable return (i.e., how many <code>IWANT</code> messages do we receive in return).</li>\n<li>Adaptive <code>GossipFactor</code> per topic: As per the original go implementation of Gossipsub [<a href=\"https://github.com/libp2p/go-libp2p-pubsub/blob/048a4d30d0c3c00829181fd81aa697eb60497448/gossipsub.go#L115\" rel=\"noopener nofollow ugc\">link</a>], the <code>GossipFactor</code> affects how many peers we will emit gossip to at each heartbeat. The protocol sends gossip to <code>GossipFactor * (total number of non-mesh peers)</code>. Making this a parameter that is adaptive to the ratio of Sent <code>IHAVE</code> vs Received <code>IWANT</code> messages per topic can greatly reduce the overhead seen.\n<ol>\n<li>Nodes sharing lots of <code>IHAVE</code> messages with very few <code>IWANT</code> messages in return could reduce the factor (saving bandwidth).</li>\n<li>Nodes receiving a significant amount of <code>IWANT</code> messages through gossip could actually increase the <code>GossipFactor</code> accordingly to help out the rest of the network.</li>\n<li>There is further adjustments that can be made if a node detects that a big part of its messages come from <code>IWANT</code> messages that it sends. These could revolve around increasing the mesh size <code>D</code>, or rotating the peers it has in its mesh.</li>\n</ol>\n</li>\n</ol>\n<p>For more details and results on Ethereum’s network head over to <a href=\"https://probelab.io\" rel=\"noopener nofollow ugc\">https://probelab.io</a>.</p>\n            <p><small>3 posts - 3 participants</small></p>\n            <p><a href=\"https://ethresear.ch/t/gossip-iwant-ihave-effectiveness-in-ethereums-gossipsusb-network/19686\">Read full topic</a></p>","link":"https://ethresear.ch/t/gossip-iwant-ihave-effectiveness-in-ethereums-gossipsusb-network/19686","pubDate":"Thu, 30 May 2024 06:21:28 +0000","discourse:topicPinned":"No","discourse:topicClosed":"No","discourse:topicArchived":"No","guid":{"@isPermaLink":"false","#text":"ethresear.ch-topic-19686"},"source":{"@url":"https://ethresear.ch/t/gossip-iwant-ihave-effectiveness-in-ethereums-gossipsusb-network/19686.rss","#text":"Gossip IWANT/IHAVE Effectiveness in Ethereum's Gossipsusb network"},"filter":false},{"title":"DamFi: Introducing On-Chain Autonomous Funds (OAFs), Blockchain's Answer to ETFs","dc:creator":"Depooty","category":"Applications","description":"<p>Abstract:<br>\nDamFi introduces a decentralized protocol facilitating On-Chain Autonomous Funds (OAFs), akin to ETFs but tailored for the DeFi ecosystem. By leveraging Zero-Knowledge Proofs (ZKPs) for enhanced computational capabilities, DamFi ensures efficient and trustless fund operations. Moreover, DamFi can integrate with external DeFi protocols like EigenLayer, and theoretically any other DeFi protocol, to maximize investment flexibility and diversification.</p>\n<p>Motivation:<br>\nThe motivation behind creating DamFi stemmed from a desire to simplify the investment process for the average person. In traditional finance, ETFs provide a straightforward way to invest in a diversified portfolio with minimal effort. However, the DeFi space lacked a comparable analogue due to the limitations of smart contract technology. With the advent of Zero-Knowledge Proofs (ZKPs), we recognized an opportunity to overcome these limitations. ZKPs enable efficient off-chain computations with proofs uploaded on-chain, allowing us to create On-Chain Autonomous Funds (OAFs) that function similarly to ETFs, making decentralized investing accessible and straightforward for everyone.</p>\n<p>Introduction:<br>\nCurrent crypto investment management often requires significant user involvement and active management. DamFi addresses this by offering automated, on-chain investment funds that adapt to market conditions without requiring constant oversight, making them ideal for both novice and experienced investors.</p>\n<p>Core Features:</p>\n<ol>\n<li>\n<p>On-Chain Autonomous Funds (OAFs):</p>\n<ul>\n<li>Automated rebalancing and management of crypto assets.</li>\n<li>Designed to function similarly to traditional ETFs in a decentralized context.</li>\n<li>Diversified investing solution for both retail and institutional investors.</li>\n</ul>\n</li>\n<li>\n<p>Zero-Knowledge Proofs (ZKPs):</p>\n<ul>\n<li>ZKPs enhance computational capabilities by performing calculations off-chain.</li>\n<li>Proofs are uploaded on-chain to ensure efficient and trustless operations.</li>\n</ul>\n</li>\n<li>\n<p>Integration with External DeFi Protocols:</p>\n<ul>\n<li>Supports integration with protocols like EigenLayer, where tokens will be staked.</li>\n<li>Potential to leverage major DeFi protocols such as Aave, offering extensive investment<br>\nopportunities.</li>\n</ul>\n</li>\n<li>\n<p>Chainlink Oracles:</p>\n<ul>\n<li>Utilizing Chainlink’s decentralized oracle network to ensure accurate and reliable off-chain data<br>\nfeeds.</li>\n<li>Enables secure and verifiable price feeds and other external data, enhancing the robustness of<br>\nfund operations.</li>\n</ul>\n</li>\n</ol>\n<p>Fund Offerings:</p>\n<ul>\n<li>Heritage Dam: Focuses on Bitcoin (BTC) and Ethereum (ETH) investments.</li>\n<li>Castor Credit Dam: Invests in a range of DeFi protocols.</li>\n<li>Grateful Dam: Specializes in Liquid Staked Derivatives.</li>\n</ul>\n<p>Fund Management:</p>\n<ul>\n<li>Funds are set to rebalance every x days or when weights deviate by x%, depending on the specific fund’s rules.</li>\n</ul>\n<p>Future Developments:</p>\n<ul>\n<li>Customizable investment strategies tailored to user preferences.</li>\n<li>“Funds of Funds” structure, where users can invest in multiple funds, increasing their exposure and diversification.</li>\n<li>Users will have the ability to choose whether to utilize integrated external protocols, how often their funds rebalance, what coins are included, and the associated fees.</li>\n<li>Theoretical possibility to create a “fund of funds” to mimic a crypto S&amp;P 500.</li>\n</ul>\n<p>Community and Governance:</p>\n<ul>\n<li>Currently, no community governance, but plans to establish a DAO and introduce a governance token in the future.</li>\n</ul>\n<p>Technical Overview:<br>\nDamFi’s architecture employs smart contracts for autonomous fund management. The integration of ZKPs ensures efficient off-chain computations, while the proofs are uploaded on-chain for verification. This modular approach enhances security, scalability, and adaptability in the evolving DeFi landscape.</p>\n<p>Partnerships and Collaborations:</p>\n<ul>\n<li>We are partnered with Ora and utilizing their ZKPs to ensure the computational efficiency and security of our protocol.<br>\n- Currently in talks with a few others but not ready to announce them yet.</li>\n</ul>\n<p>Testnet Launch and Airdrop:<br>\nWe are excited to announce the launch of the DamFi testnet. To celebrate this milestone, we will conduct an airdrop to reward early adopters and contributors in the future. Please take a look at <a href=\"https://damfi.io\" rel=\"noopener nofollow ugc\">https://damfi.io</a> and launch the app!</p>\n<p>Currently working are our rebalancing dams and staking in the “earn” tab</p>\n<p>Call to Action:<br>\nWe invite the community to provide feedback, engage in discussions, and explore the potential of DamFi. Your insights will be crucial as we refine our protocol and expand its capabilities. Also, please take a look at our Galxe campaign here <a href=\"https://app.galxe.com/quest/bWoZSfxBrF3XJdWufqSvRj?hideFooter&amp;id=54487&amp;step=1\" class=\"inline-onebox\" rel=\"noopener nofollow ugc\">Join DamFi on Galxe</a></p>\n<p>Contact Information:<br>\nFor more details, visit our website at <a href=\"http://Damfi.io\" rel=\"noopener nofollow ugc\">Damfi.io</a> or join our community here: <a href=\"https://linktr.ee/damfi\" class=\"inline-onebox\" rel=\"noopener nofollow ugc\">damfi | Twitter | Linktree</a><br>\nLet’s collaborate to shape the future of decentralized finance.</p>\n<p>Conclusion:<br>\nDamFi represents a significant advancement in the DeFi space, offering secure, automated, and flexible investment options. By integrating with external DeFi protocols, we provide users with unparalleled opportunities to diversify and optimize their portfolios.</p>\n<p>Thank you for your interest in DamFi. We look forward to your feedback and support.</p>\n<p>Thanks,<br>\nDamFi Team</p>\n            <p><small>1 post - 1 participant</small></p>\n            <p><a href=\"https://ethresear.ch/t/damfi-introducing-on-chain-autonomous-funds-oafs-blockchains-answer-to-etfs/19681\">Read full topic</a></p>","link":"https://ethresear.ch/t/damfi-introducing-on-chain-autonomous-funds-oafs-blockchains-answer-to-etfs/19681","pubDate":"Wed, 29 May 2024 19:45:00 +0000","discourse:topicPinned":"No","discourse:topicClosed":"No","discourse:topicArchived":"No","guid":{"@isPermaLink":"false","#text":"ethresear.ch-topic-19681"},"source":{"@url":"https://ethresear.ch/t/damfi-introducing-on-chain-autonomous-funds-oafs-blockchains-answer-to-etfs/19681.rss","#text":"DamFi: Introducing On-Chain Autonomous Funds (OAFs), Blockchain's Answer to ETFs"},"filter":false},{"title":"MagicSpend++ Spend Now, Debit Later","dc:creator":"vaibhavchellani","category":"Applications","description":"<h2><a name=\"introduction-1\" class=\"anchor\" href=\"https://ethresear.ch#introduction-1\"></a>Introduction</h2>\n<p>The current smart wallet experience for users is not suited for transacting in a world with hundreds or thousands of rollups. It forces an average Ethereum user to deal with fragmented assets, forcing them to manage fragments of their assets across 100+ rollups along with complexities like GAS, bridging &amp; RPCs for every transaction.</p>\n<blockquote>\n<p>For example, today it takes over <strong>30+ clicks in the wallet &amp; over 40+ minutes</strong> for a user to use an app on another chain with the swapping, bridging of tokens &amp; GAS, switching RPCs, and other actions involved.</p>\n</blockquote>\n<p>There are several standards today for smart contract wallets. Users send signed UserOps that are bundled together and sent on-chain. It also enables users to pay gas fees using ERC-20 tokens (e.g. USDC) instead of ETH by allowing a third party to sponsor their gas fees.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/d/6/d696cf1819e42dfa3424b84e0c8360da38183915.jpeg\" data-download-href=\"https://ethresear.ch/uploads/default/d696cf1819e42dfa3424b84e0c8360da38183915\" title=\"image\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/d/6/d696cf1819e42dfa3424b84e0c8360da38183915_2_690x275.jpeg\" alt=\"image\" data-base62-sha1=\"uClhH1sWX81FibeR9e8FT5UQFZH\" width=\"690\" height=\"275\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/d/6/d696cf1819e42dfa3424b84e0c8360da38183915_2_690x275.jpeg, https://ethresear.ch/uploads/default/optimized/3X/d/6/d696cf1819e42dfa3424b84e0c8360da38183915_2_1035x412.jpeg 1.5x, https://ethresear.ch/uploads/default/optimized/3X/d/6/d696cf1819e42dfa3424b84e0c8360da38183915_2_1380x550.jpeg 2x\" data-dominant-color=\"F8F8F8\"></a></div><p></p>\n<p>The current smart wallet experience for users is not suited for transacting in a world with hundreds or thousands of rollups. It restricts the extent of abstraction to just one single rollup instead of thousands of rollups. It forces an average Ethereum user to deal with fragmented assets, forcing them to manage fragments of their assets across 100+ rollups along with complexities like bridging &amp; RPCs for every transaction.</p>\n<h3><a name=\"magicspend-2\" class=\"anchor\" href=\"https://ethresear.ch#magicspend-2\"></a>MagicSpend++</h3>\n<p>We propose MagicSpend++, a framework to allow users to magically spend on any chain instantly, without worrying about which chains their tokens are on.</p>\n<p>MagicSpend++ leverages the existing Account Abstraction standard and builds on Coinbase’s work on MagicSpend - an innovative approach to allow users to leverage their assets held on Coinbase Exchange &amp; utilize them on-chain.</p>\n<p>MagicSpend++ fundamentally enables users to have a <em>Chain Abstracted Balance (CAB)</em> instead of isolated token balances across chains. Users can use their CAB to transact instantly on any chain with a signature. No fragmentation, no bridging, no GAS, no latency.  It’s magic. <img src=\"https://ethresear.ch/images/emoji/facebook_messenger/dizzy.png?v=12\" title=\":dizzy:\" class=\"emoji\" alt=\":dizzy:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>\n<p>Smart wallet users with MagicSpend++ get:</p>\n<ul>\n<li>A unified single balance across chains that users can spend anywhere</li>\n<li>Completely gas-less experience</li>\n<li>Instant single chain experience - NO CROSS CHAIN, NO BRIDGING, ZERO LATENCY</li>\n</ul>\n<h3><a name=\"fundamental-primitive-time-locked-vaults-3\" class=\"anchor\" href=\"https://ethresear.ch#fundamental-primitive-time-locked-vaults-3\"></a>Fundamental Primitive — Time-locked Vaults</h3>\n<p>In order for tokens to enter the Chain Abstracted Balance, they need to be locked in their smart wallets. Users can withdraw funds back to their <strong>Externally Owned Accounts (EOAs)</strong> after a configurable delay. While locked, the assets remain usable via the smart-account on any chain at any time. <strong>This one-time step required-to onboard as a part of deposit to SCW workflow, it is not required every-time before the assets are used.</strong><br>\nAll assets deposited represent the user’s Chain Abstracted Balance (CAB). This chain abstracted balance can now be spent on any-chain via userOps, without bridging, just like how you would spend these assets as if they were on the chain you are acting on.</p>\n<blockquote>\n<p>Your 100USDC@Optimism, 100USDC@Polygon, 100USDC@Arbitrum, 100USDC@Base, 100 USDC@ethereum all merge together into 400USDC, ready to be spent anywhere.</p>\n</blockquote>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/7/7/77765f9c7d128996817736249125fd859f3710f6.jpeg\" data-download-href=\"https://ethresear.ch/uploads/default/77765f9c7d128996817736249125fd859f3710f6\" title=\"image\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/7/7/77765f9c7d128996817736249125fd859f3710f6_2_690x295.jpeg\" alt=\"image\" data-base62-sha1=\"h2OqQryNE0ThucXV1gIr806Q72u\" width=\"690\" height=\"295\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/7/7/77765f9c7d128996817736249125fd859f3710f6_2_690x295.jpeg, https://ethresear.ch/uploads/default/optimized/3X/7/7/77765f9c7d128996817736249125fd859f3710f6_2_1035x442.jpeg 1.5x, https://ethresear.ch/uploads/default/optimized/3X/7/7/77765f9c7d128996817736249125fd859f3710f6_2_1380x590.jpeg 2x\" data-dominant-color=\"EDF4EE\"></a></div><p></p>\n<h3><a name=\"key-concept-spend-now-debit-later-4\" class=\"anchor\" href=\"https://ethresear.ch#key-concept-spend-now-debit-later-4\"></a><strong>Key concept – Spend Now, Debit Later</strong></h3>\n<p>Conceptually it’s pretty similar to how AA works today with a small difference. User sends UserOp to perform an target chain, just like they would if they had funds on the same chain. Paymasters can now fund the userOp with not just gas but with additional funds to facilitate the on-chain execution of the UserOp. Paymaster then goes and claims it from the chain abstracted balance.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/8/5/85d1025c1eb22df5366dedd8449865387901327e.jpeg\" data-download-href=\"https://ethresear.ch/uploads/default/85d1025c1eb22df5366dedd8449865387901327e\" title=\"image\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/8/5/85d1025c1eb22df5366dedd8449865387901327e_2_690x427.jpeg\" alt=\"image\" data-base62-sha1=\"j5NiPDanx1UZ2EZxBTNYgAjMwEu\" width=\"690\" height=\"427\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/8/5/85d1025c1eb22df5366dedd8449865387901327e_2_690x427.jpeg, https://ethresear.ch/uploads/default/optimized/3X/8/5/85d1025c1eb22df5366dedd8449865387901327e_2_1035x640.jpeg 1.5x, https://ethresear.ch/uploads/default/optimized/3X/8/5/85d1025c1eb22df5366dedd8449865387901327e_2_1380x854.jpeg 2x\" data-dominant-color=\"F0F2E8\"></a></div><p></p>\n<h3><a name=\"how-it-works-high-level-overview-5\" class=\"anchor\" href=\"https://ethresear.ch#how-it-works-high-level-overview-5\"></a><strong>How it works - high level overview</strong></h3>\n<p>Say Alice wants to purchase a NFT on BASE using her 1000USDC Chain-Abstracted-Balance:</p>\n<ul>\n<li>Alice sends a signed UserOp to purchase the NFT on BASE</li>\n<li>Paymaster checks(offchain) if there are sufficient funds with Alice in her chain abstracted balance and authorizes usage of paymaster funds via a special_signature</li>\n<li>UserOp is sent to bundler with paymasterAndData containing the special_signature that allows the SCW to pull funds from the paymaster’s pool of liquidity on BASE</li>\n<li>UserOp is normally executed onchain leveraging the paymaster funds, SCW leverages withdrawGasExcess(special_signature) to pull funds from paymaster</li>\n<li>Paymaster can now debit the respective funds from Alice’s chain abstracted balance in custody of smart-wallets (whichever chain or multiple-chains that they are on)</li>\n</ul>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/c/d/cdfdad93b81b35b2a546ea19f28e38c2990dd52d.jpeg\" data-download-href=\"https://ethresear.ch/uploads/default/cdfdad93b81b35b2a546ea19f28e38c2990dd52d\" title=\"image\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/c/d/cdfdad93b81b35b2a546ea19f28e38c2990dd52d_2_690x317.jpeg\" alt=\"image\" data-base62-sha1=\"tohnOzYUGrbP9s4JdrhcukbtAfP\" width=\"690\" height=\"317\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/c/d/cdfdad93b81b35b2a546ea19f28e38c2990dd52d_2_690x317.jpeg, https://ethresear.ch/uploads/default/optimized/3X/c/d/cdfdad93b81b35b2a546ea19f28e38c2990dd52d_2_1035x475.jpeg 1.5x, https://ethresear.ch/uploads/default/optimized/3X/c/d/cdfdad93b81b35b2a546ea19f28e38c2990dd52d_2_1380x634.jpeg 2x\" data-dominant-color=\"F1F3F3\"></a></div><p></p>\n<h3><a name=\"not-cross-chain-but-chain-abstraction-6\" class=\"anchor\" href=\"https://ethresear.ch#not-cross-chain-but-chain-abstraction-6\"></a>Not Cross-chain but Chain Abstraction</h3>\n<p>This removes a lot of the pain a user faces today: figure out swap, bridge, buy new gas paying asset and only then will you get to use this new thing. This is dumb and holding back new innovation from taking off. A DEX can be 10x more capital efficient but without liquidity/volume it doesn’t matter.</p>\n<p>Chain abstracted wallets provide various 10x improvements for users:</p>\n<ul>\n<li>User asset-balances across chains are combined into one <strong>Chain Abstracted Balance</strong></li>\n<li>Balance is instantly usable anywhere, zero bridging latency</li>\n</ul>\n<p>This is completely different than any cross-chain implementations where wallets integrate bridges likes Across, Stargate, etc.</p>\n<p>Cross-chain implementations are push-based where users start with a fragmented balance on one chain and “push” their tokens to another. On the other hand, MagicSpend++ is pull based where the user simply uses an app and their funds are pulled by the paymaster later. It’s like Spend first, debit later.</p>\n<p>This has various implications for the end users.</p>\n<div class=\"md-table\">\n<table>\n<thead>\n<tr>\n<th>Cross-Chain Accounts (push)</th>\n<th>Chain Abstracted Balance (pull)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Asset fragmentation still persists across chains. Users still have to think about fragmented assets on different chains</td>\n<td>Single Chain Abstracted Balance</td>\n</tr>\n<tr>\n<td>Bridging latency-  Users sign a UserOp on the source chain, wait for source chain finality before tx is processed on target chain</td>\n<td>Instant finality- User sign a UserOp on the target chain which is fulfilled immediately. No need to wait for finality on source chain.</td>\n</tr>\n<tr>\n<td>Failure on dest chains - UserOp can fail mid-bridging. Users get stuck with arbitrary funds on target chain in this case</td>\n<td>Guaranteed execution - user funds are deducted from the balance only if their transaction is successful</td>\n</tr>\n<tr>\n<td>Users get tied into trust properties of the bridge for settlement</td>\n<td>Users have tighter control over security where they can configure how paymasters can settle</td>\n</tr>\n</tbody>\n</table>\n</div><h2><a name=\"diving-deeper-7\" class=\"anchor\" href=\"https://ethresear.ch#diving-deeper-7\"></a>Diving Deeper</h2>\n<p>All we really need to enable this is a new module that creates a vault with configurable withdraw delay such that users can deposit into this vault but only withdraw after a time period, the funds deposited are still usable by the user but in a chain-abstracted fashion. These vaults can be on multiple chains and all the balances will add up and be usable as one.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/2/9/299b49a7fa6fbf3619fbdc0c3b6cc846342ec7b9.jpeg\" data-download-href=\"https://ethresear.ch/uploads/default/299b49a7fa6fbf3619fbdc0c3b6cc846342ec7b9\" title=\"image\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/2/9/299b49a7fa6fbf3619fbdc0c3b6cc846342ec7b9_2_690x376.jpeg\" alt=\"image\" data-base62-sha1=\"5W4hhiizinXxtWS3EXaaQIL150Z\" width=\"690\" height=\"376\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/2/9/299b49a7fa6fbf3619fbdc0c3b6cc846342ec7b9_2_690x376.jpeg, https://ethresear.ch/uploads/default/optimized/3X/2/9/299b49a7fa6fbf3619fbdc0c3b6cc846342ec7b9_2_1035x564.jpeg 1.5x, https://ethresear.ch/uploads/default/optimized/3X/2/9/299b49a7fa6fbf3619fbdc0c3b6cc846342ec7b9_2_1380x752.jpeg 2x\" data-dominant-color=\"F4F4F3\"></a></div><p></p>\n<p>A good example to start with is Alice wants to mint an NFT on Ethereum worth 100 USDC, lets assume the deposit into the SCW was already done on Base 1000 blocks ago</p>\n<ul>\n<li>Alice goes to the NFT mint site, and wants to insta buy</li>\n<li>Alice clicks mint button the paymaster service checks locked userBalance on all vaults across chains and sends back a special_signature</li>\n<li><code>paymasterAndData</code> ****will be set to whatever paymaster service application/user opts into just like today, the data however includes the special_signature provided by the paymaster</li>\n<li>This userOp is sent to bundler → entrypoint</li>\n<li>Entrypoint calls validateUserOp() on the SCW and does the usual operations</li>\n<li>When Entrypoint calls validatePaymasterUserOp(……special_signature)</li>\n<li>Post the usual validations, the paymaster validates the signature and sets a map(address⇒amount) to allow userOp.sender withdraw the amount (which will be the SCW)</li>\n<li>The SCW will then leveraging the <code>withdrawGasExcess</code> method pull funds from the paymaster and execute the userOp that buys the NFT</li>\n<li>In the postOp operation\n<ul>\n<li>mapping(address⇒amount) set earlier will be deleted to ensure no double spends</li>\n<li>an execution proof will be sent by the sender contract on L1 to an L2 or multiple L2s via the native-rollup-connections\n<ul>\n<li>execution proof is simply a proof to convince chainA of some execution that happened on chainB, think light-client proofs, ZKPs etc</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>Funds will be then deducted from the userVault and given to paymaster</li>\n</ul>\n<aside>\n💡 Interesting thing to note here, while the paymasters are forwarding funds to the user, they are not taking ANY reorg risk since there is no source chain tx for a userOp that is trying to spend, its credit now, debit later\n</aside>\n<h2><a name=\"limitations-and-solutions-8\" class=\"anchor\" href=\"https://ethresear.ch#limitations-and-solutions-8\"></a>Limitations and Solutions</h2>\n<p>While the above mechanism works great and accomplishes the desired goals, the approach has limitations with paymaster availability &amp; settlement flexibility. Smart-Wallets can by-pass these limitations using Socket’s MOFA.</p>\n<ul>\n<li><strong>Single Paymaster Weak</strong>: User gets locked into a single paymaster and if paymaster doesn’t have liquidity userOps will not be executed. SCWs can instead delegate paymaster election to Socket’s MOFA to tap into a global network of competing paymasters and sidestep liquidity and efficiency issues. With MOFA, multiple paymasters compete to fulfill incoming UserOps, which means more paymasters, more liquidity &amp; more execution. Single paymaster weak, paymasters together strong.</li>\n<li><strong>Restrictive Settlement Options</strong>: Its quite important in the chain-abstracted world for users signing userOps or developers building SCWs to have the ability to expand to new chains quickly, to be able to make their own tradeoffs(security, cost, latency). Standardisation around settlement allows for users and developers to handle both expansion and tradeoff selection in a transparent fashion.</li>\n</ul>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/3/5/35964d42692a8fd042edb63452bab73015cbf3c1.jpeg\" data-download-href=\"https://ethresear.ch/uploads/default/35964d42692a8fd042edb63452bab73015cbf3c1\" title=\"image\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/3/5/35964d42692a8fd042edb63452bab73015cbf3c1_2_690x416.jpeg\" alt=\"image\" data-base62-sha1=\"7E3kdjjA0mf65c2bKTF4ahMF72h\" width=\"690\" height=\"416\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/3/5/35964d42692a8fd042edb63452bab73015cbf3c1_2_690x416.jpeg, https://ethresear.ch/uploads/default/optimized/3X/3/5/35964d42692a8fd042edb63452bab73015cbf3c1_2_1035x624.jpeg 1.5x, https://ethresear.ch/uploads/default/optimized/3X/3/5/35964d42692a8fd042edb63452bab73015cbf3c1_2_1380x832.jpeg 2x\" data-dominant-color=\"F5F5F4\"></a></div><p></p>\n<h2><a name=\"acknowledgements-9\" class=\"anchor\" href=\"https://ethresear.ch#acknowledgements-9\"></a>Acknowledgements</h2>\n<p>We think magic-spend++ enables complete chain-abstraction, where users dont have to care where their assets are.</p>\n<p>Thank you to the following people for the many discussions, reviews and idea-sharing which lead to the creation of this proposal(in no particular order):</p>\n<p>Wilson Cusack, Pierce Harger, Uma(<span class=\"mention\">@pumatheuma</span>), Alex Watts, Partha, Ahmed Al-Balaghi, Sachin Tomar, Ivo Georgiev, Theo Gonella, Derek Chiang, Kristof Gazso, Ankit and Stephane, Kakusan, Bapireddy, Aniket Jindal</p>\n<p>We are keen to work with existing AA players building bundlers, paymasters and existing solvers/paymasters, wallets, dapps and together be at a place where no one needs to bridge anymore. If anyone is interested in magic-spend++ or chain-abstraction in general we have a public group here to talk about it: <a href=\"https://t.me/+QygeBurngS4wODNl\" rel=\"noopener nofollow ugc\">https://t.me/+QygeBurngS4wODNl</a></p>\n<p>Account Abstraction → Chain Abstraction journey begins now</p>\n<h2><a name=\"faqs-10\" class=\"anchor\" href=\"https://ethresear.ch#faqs-10\"></a>FAQs</h2>\n<ul>\n<li>Are paymasters becoming solvers/fillers here?\n<ul>\n<li>Solvers/Fillers in cross-chain setting for eg as used in Across, DLN and other intent based protocols are entities that front liquidity and take on reorg risk in return of fees, paymasters in the AA world are not needed to take on reorg risk and here paymasters arent exposed to reorg risk either, so no they arent the same</li>\n</ul>\n</li>\n<li>What risks/trust-assumptions are here for users?\n<ul>\n<li>Users only need to trust the proof-system for security here and there is no additional off-chain security, magic-spend++ can leverage ZKPs, rollup-messengers to have an extremely trust-minimised setup</li>\n</ul>\n</li>\n</ul>\n            <p><small>14 posts - 6 participants</small></p>\n            <p><a href=\"https://ethresear.ch/t/magicspend-spend-now-debit-later/19678\">Read full topic</a></p>","link":"https://ethresear.ch/t/magicspend-spend-now-debit-later/19678","pubDate":"Wed, 29 May 2024 19:00:10 +0000","discourse:topicPinned":"No","discourse:topicClosed":"No","discourse:topicArchived":"No","guid":{"@isPermaLink":"false","#text":"ethresear.ch-topic-19678"},"source":{"@url":"https://ethresear.ch/t/magicspend-spend-now-debit-later/19678.rss","#text":"MagicSpend++ Spend Now, Debit Later"},"filter":false},{"title":"Practical, Trustless, Bitcoin Bridge","dc:creator":"cryptskii","category":"Cryptography","description":"<h2><a name=\"tldr-1\" class=\"anchor\" href=\"https://ethresear.ch#tldr-1\"></a>TL;DR</h2>\n<p>This proposal presents a practical trustless Bitcoin bridge using Nillion’s NMC (Nil Message Compute) protocol. The bridge leverages secure encryption, secret sharing, and cross-chain witness validation to enable the secure and decentralized transfer of Bitcoin to other blockchains.</p>\n<h2><a name=\"background-2\" class=\"anchor\" href=\"https://ethresear.ch#background-2\"></a>Background</h2>\n<p>Interoperability between different blockchains is crucial for the growing decentralized ecosystem. Trustless bridges allow secure transfers of assets and information across blockchain networks without relying on a central trusted authority. Nillion’s NMC protocol provides a framework for creating such trustless bridges.</p>\n<h2><a name=\"proposal-3\" class=\"anchor\" href=\"https://ethresear.ch#proposal-3\"></a>Proposal</h2>\n<p>The proposed trustless Bitcoin bridge consists of the following steps:</p>\n<ol>\n<li>\n<p><strong>Initial Encryption</strong>:</p>\n<ul>\n<li>\n<p>The Bitcoin secret key <span class=\"math\">( K )</span> is encrypted using a symmetric encryption scheme <span class=\"math\">( E = (\\text{Enc}, \\text{Dec}) )</span> with a condition-based ciphertext <span class=\"math\">( C )</span> dependent on a predefined condition <span class=\"math\">( \\Phi )</span> on a separate blockchain, such as Ethereum:</p>\n<p><span class=\"math\">C = \\text{Enc}(K, \\Phi)</span></p>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>Generating Particles</strong>:</p>\n<ul>\n<li>\n<p>A One-Time Mask (OTM) is applied to the ciphertext <span class=\"math\">( C )</span> to generate masked particles <span class=\"math\">\\{p_i\\}_{i=1}^n</span>:</p>\n<p><span class=\"math\">p_i = C \\oplus b_i \\quad \\forall i \\in [1, n]</span></p>\n<p>where <span class=\"math\">\\{b_i\\}_{i=1}^n</span> are random blinding factors.</p>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>Blinding Factor Sharing</strong>:</p>\n<ul>\n<li>\n<p>Linear Secret Sharing (LSS) is used to distribute the blinding factors <span class=\"math\">\\{b_i\\}_{i=1}^n</span> among a decentralized network of nodes <span class=\"math\">\\{N_i\\}_{i=1}^n</span>.</p>\n</li>\n<li>\n<p>Polynomials <span class=\"math\">f_i(x)</span> of degree <span class=\"math\">t</span> are constructed for each blinding factor <span class=\"math\">b_i</span>:</p>\n<p><span class=\"math\">f_i(x) = b_i + a_1 x + a_2 x^2 + \\cdots + a_t x^t</span></p>\n</li>\n<li>\n<p><span class=\"math\">n</span> shares <span class=\"math\">\\{s_{i,j}\\}_{j=1}^n</span> are generated for each blinding factor <span class=\"math\">b_i</span> by evaluating <span class=\"math\">f_i(x)</span> at distinct points <span class=\"math\">x_j \\in \\mathbb{F}_p</span>:</p>\n<p><span class=\"math\">s_{i,j} = f_i(x_j) \\quad \\forall j \\in [1, n]</span></p>\n</li>\n<li>\n<p>The shares are distributed to the corresponding nodes <span class=\"math\">N_j</span>.</p>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>Particle Distribution</strong>:</p>\n<ul>\n<li>The masked particles <span class=\"math\">\\{p_i\\}_{i=1}^n</span> are distributed across the decentralized network of nodes <span class=\"math\">\\{N_i\\}_{i=1}^n</span>.</li>\n<li>Each node <span class=\"math\">N_i</span> holds a single particle <span class=\"math\">p_i</span>.</li>\n</ul>\n</li>\n<li>\n<p><strong>Witness Condition Validation</strong>:</p>\n<ul>\n<li>Upon fulfillment of the predefined condition <span class=\"math\">\\Phi</span> on the Ethereum blockchain, a witness proof <span class=\"math\">\\pi</span> is generated.</li>\n<li>Nodes validate the witness proof <span class=\"math\">\\pi</span> to initiate the reconstruction process.</li>\n</ul>\n</li>\n<li>\n<p><strong>Reconstruction and Decryption</strong>:</p>\n<ul>\n<li>\n<p>Nodes collaborate to reconstruct the blinding factors <span class=\"math\">\\{b_i\\}_{i=1}^n</span> using the LSS shares:</p>\n<p><span class=\"math\">b_i = \\sum_{j \\in I} s_{i,j} \\prod_{k \\in I \\setminus \\{j\\}} \\frac{x_k}{x_k - x_j}</span></p>\n<p>where <span class=\"math\">I \\subseteq [1, n]</span> and <span class=\"math\">|I| = t + 1</span>.</p>\n</li>\n<li>\n<p>With the reconstructed blinding factors <span class=\"math\">\\{b_i\\}_{i=1}^n</span>, nodes unmask their particles <span class=\"math\">p_i</span> to recover the original ciphertext <span class=\"math\">C</span>:</p>\n<p><span class=\"math\">C = p_i \\oplus b_i \\quad \\forall i \\in [1, n]</span></p>\n</li>\n<li>\n<p>The recovered ciphertext <span class=\"math\">C</span> is decrypted using <span class=\"math\">\\text{Dec}</span> and the condition <span class=\"math\">\\Phi</span> to obtain the Bitcoin secret key <span class=\"math\">K</span>:</p>\n<p><span class=\"math\">K = \\text{Dec}(C, \\Phi)</span></p>\n</li>\n</ul>\n</li>\n</ol>\n<h2><a name=\"advantages-4\" class=\"anchor\" href=\"https://ethresear.ch#advantages-4\"></a>Advantages</h2>\n<p>The proposed trustless Bitcoin bridge has several advantages:</p>\n<ul>\n<li><strong>Decentralization</strong>: The use of a decentralized network of nodes eliminates the need for a central trusted authority.</li>\n<li><strong>Security</strong>: The encryption and secret sharing techniques ensure the confidentiality and integrity of the Bitcoin secret key.</li>\n<li><strong>Cross-chain interoperability</strong>: The bridge enables the secure transfer of Bitcoin to other blockchains, such as Ethereum, based on predefined conditions.</li>\n<li><strong>Fault tolerance</strong>: The use of Linear Secret Sharing provides fault tolerance, as the secret can be reconstructed even if some nodes are unavailable or malicious.</li>\n</ul>\n<h2><a name=\"applications-5\" class=\"anchor\" href=\"https://ethresear.ch#applications-5\"></a>Applications</h2>\n<p>The trustless Bitcoin bridge has various applications, including:</p>\n<ul>\n<li><strong>Cross-chain asset transfers</strong>: Enabling the seamless transfer of Bitcoin to other blockchains for use in decentralized applications (DApps) and decentralized finance (DeFi) protocols.</li>\n<li><strong>Atomic swaps</strong>: Facilitating atomic swaps between Bitcoin and other cryptocurrencies without the need for a trusted intermediary.</li>\n<li><strong>Conditional payments</strong>: Allowing for conditional Bitcoin payments based on events or conditions on other blockchains.</li>\n</ul>\n<h2><a name=\"conclusion-6\" class=\"anchor\" href=\"https://ethresear.ch#conclusion-6\"></a>Conclusion</h2>\n<p>The proposed trustless Bitcoin bridge using Nillion’s NMC protocol provides a secure, decentralized, and interoperable solution for transferring Bitcoin across different blockchain networks. By leveraging cryptographic techniques such as encryption, secret sharing, and cross-chain witness validation, the bridge ensures the integrity and confidentiality of the transferred assets. This proposal opens up new possibilities for cross-chain asset transfers, atomic swaps, and conditional payments, further enhancing the interoperability and composability of the decentralized ecosystem.</p>\n<p><a href=\"https://cognizium.io/uploads/resources/Nillion%20-%20A%20Secure%20Processing%20Layer%20for%20Web3%20-%202022%20Feb.pdf\" rel=\"noopener nofollow ugc\">Nillion Whitepaper</a></p>\n            <p><small>4 posts - 2 participants</small></p>\n            <p><a href=\"https://ethresear.ch/t/practical-trustless-bitcoin-bridge/19676\">Read full topic</a></p>","link":"https://ethresear.ch/t/practical-trustless-bitcoin-bridge/19676","pubDate":"Wed, 29 May 2024 17:16:41 +0000","discourse:topicPinned":"No","discourse:topicClosed":"No","discourse:topicArchived":"No","guid":{"@isPermaLink":"false","#text":"ethresear.ch-topic-19676"},"source":{"@url":"https://ethresear.ch/t/practical-trustless-bitcoin-bridge/19676.rss","#text":"Practical, Trustless, Bitcoin Bridge"},"filter":false},{"title":"FAQ: Ethereum issuance reduction","dc:creator":"aelowsson","category":"Economics","description":"<h1><a name=\"faq-ethereum-issuance-reduction-1\" class=\"anchor\" href=\"https://ethresear.ch#faq-ethereum-issuance-reduction-1\"></a>FAQ: Ethereum issuance reduction</h1>\n<h2><a name=\"overview-2\" class=\"anchor\" href=\"https://ethresear.ch#overview-2\"></a>Overview</h2>\n<p>When it comes to the premise of reducing issuance, there are many important questions to consider. Having studied these questions extensively, I thought it would be fruitful to address them one by one, providing detailed answers as needed. I post on Ethresearch to facilitate debate, and will try to respond to any questions you may have (including new questions suitable for an extended FAQ).</p>\n<p>Some concepts of staking economics that have just been discussed in passing previously are given a more extensive review. These include: <a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#h-5-time-quantity-policy-35\">time–quantity policies</a> where the reward curve slowly drifts (and other potential endgame policies), <a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#illustrating-hypothetical-distributions-of-reservation-yields-26\">distributions of reservation yields</a> among solo stakers and delegating stakers, and the <a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#why-not-dynamically-adjust-the-yield-with-a-mechanism-like-eip-1559-to-guarantee-some-fixed-target-participation-level-16\">downsides of using a vanilla EIP-1559</a> mechanism to target some specific stake participation. Quick link to all questions:</p>\n<ul>\n<li><a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#why-should-ethereum-reduce-its-issuance-4\">Why should Ethereum reduce its issuance?</a></li>\n<li><a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#what-about-economic-security-more-stake-makes-ethereum-more-secure-right-8\">What about economic security? More stake makes Ethereum more secure right?</a></li>\n<li><a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#what-is-a-desirable-issuance-reduction-for-the-near-future-9\">What is a desirable issuance reduction for the near future?</a></li>\n<li><a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#why-not-dynamically-adjust-the-yield-with-a-mechanism-like-eip-1559-to-guarantee-some-fixed-target-participation-level-16\">Why not dynamically adjust the yield with a mechanism like EIP-1559 to guarantee some fixed target participation level?</a></li>\n<li><a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#how-will-a-reduction-in-issuance-affect-the-composition-of-the-staking-set-21\">How will a reduction in issuance affect the composition of the staking set?</a></li>\n<li><a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#what-is-the-endgame-issuance-policy-28\">What is the endgame issuance policy?</a></li>\n<li><a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#why-not-just-prevent-new-stakers-from-joining-36\">Why not just prevent new stakers from joining?</a></li>\n<li><a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#can-stakers-profit-from-a-reduced-issuance-and-what-is-the-relevance-and-impact-of-the-realproportional-yield-37\">Can stakers profit from a reduced issuance and what is the relevance and impact of the real/proportional yield?</a></li>\n<li><a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#some-users-think-that-more-yield-is-more-fun-and-like-to-collect-yield-on-their-eth-why-not-lean-into-this-43\">Some users think that more yield is more fun and like to collect yield on their ETH. Why not lean into this?</a></li>\n</ul>\n<p>It is beneficial to read the answers in the order that they are presented, but they still stand on their own.</p>\n<h2><a name=\"faq-3\" class=\"anchor\" href=\"https://ethresear.ch#faq-3\"></a>FAQ</h2>\n<h3><a name=\"why-should-ethereum-reduce-its-issuance-4\" class=\"anchor\" href=\"https://ethresear.ch#why-should-ethereum-reduce-its-issuance-4\"></a>Why should Ethereum reduce its issuance?</h3>\n<h4><a name=\"overview-5\" class=\"anchor\" href=\"https://ethresear.ch#overview-5\"></a>Overview</h4>\n<p>At the most basic level, stake participation is growing beyond requirements for <a href=\"https://ethresear.ch/t/reward-curve-with-tempered-issuance-eip-research-post/19171#h-51-economic-security-30\">economic security</a>, and paying people to do something that is not necessary always comes with downsides. To be more specific, there are two fundamental reasons for reducing issuance:</p>\n<ol>\n<li>To reduce costs for users, including costs for hardware, risks and opportunity costs, taxes, etc. By maintaining the current reward curve, Ethereum compels users to incur higher costs than necessary for securing the network. Reducing issuance will improve welfare by eliminating implied costs that may very well amount to more than a billion dollars per year.</li>\n<li>To improve Ethereum at the macro level. If everyone stakes, one entity or a cartel might come to exercise control over a large proportion of all ETH. This can reduce security since it becomes harder for the social layer to hold such entities accountable. The potential proliferation of liquid staking tokens (LSTs) may also impede ETH as trustless money, fostering monopolization and making Ethereum a less desirable blockchain to build on.</li>\n</ol>\n<p>The answer will now take a closer look at these two aspects.</p>\n<h4><a name=\"h-1-reduced-costs-raise-welfare-6\" class=\"anchor\" href=\"https://ethresear.ch#h-1-reduced-costs-raise-welfare-6\"></a>1. Reduced costs raise welfare</h4>\n<p>Review Figure 1 (example with more details <a href=\"https://ethresear.ch/t/reward-curve-with-tempered-issuance-eip-research-post/19171#h-21-user-utility-9\">here</a>), featuring a <a href=\"https://ethresear.ch/t/properties-of-issuance-level-consensus-incentives-and-variability-across-potential-reward-curves/18448\">hypothetical future supply curve</a> in blue. The supply curve indicates the amount of stake deposited <span class=\"math\">D</span> at various staking yields <span class=\"math\">y</span>. It captures the implied marginal cost of staking. What that means is that every ETH holder is positioned along the supply curve according to how high cost they assign to staking, with their required yield reflecting that cost. Relevant costs include hardware and other resources, upkeep, the acquisition of technical knowledge, illiquidity, trust in third parties and other factors increasing the risk premium, various opportunity costs, taxes, etc. The area above the supply curve indicates the stakers’ surplus (what they actually gain). The area below the supply curve—the supply curve’s integral—indicates the costs assigned to staking (the marginal staker would not stake at a yield below the supply curve).</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/e/5/e587ae3810f916ac663314fe3227c696b945acc4.png\" data-download-href=\"https://ethresear.ch/uploads/default/e587ae3810f916ac663314fe3227c696b945acc4\" title=\"Figure 1\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/e/5/e587ae3810f916ac663314fe3227c696b945acc4_2_690x410.png\" alt=\"Figure 1\" data-base62-sha1=\"wKw2amSYoguXC8n487AjJVkXRNa\" width=\"690\" height=\"410\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/e/5/e587ae3810f916ac663314fe3227c696b945acc4_2_690x410.png, https://ethresear.ch/uploads/default/optimized/3X/e/5/e587ae3810f916ac663314fe3227c696b945acc4_2_1035x615.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/e/5/e587ae3810f916ac663314fe3227c696b945acc4_2_1380x820.png 2x\" data-dominant-color=\"E7E8F5\"></a></div><p></p>\n<p><strong>Figure 1.</strong> Implied cost (blue) and surplus (grey) of staking under a hypothetical future supply curve. A change in issuance policy shifts the equilibrium from the black square to the green circle. The cost reduction (dark blue) leads to aggregate welfare improvement as long as the protocol remains secure and decentralized, and the reduction in surplus (dark grey) simply shifts some utility from stakers to everyone.</p>\n<p>Two reward curves are shown, with maximum extractable value (MEV) added to the staking yield. In this FAQ, MEV will be 300k ETH/year (close to the average over the last few years) and include priority fees. By maintaining the current reward curve in black, Ethereum compels users to incur higher costs than necessary for securing the network. Adopting the <a href=\"https://ethresear.ch/t/reward-curve-with-tempered-issuance-eip-research-post/19171\">green reward curve</a> eliminates the costs represented by the dark blue area (around 450 000 ETH), thus improving welfare. The issued ETH covered for hardware expenses, taxes, reduced liquidity and risks that users would choose to sidestep under a lower yield. With the green curve, they can, and the benefits are shared by everyone, including remaining stakers. This creates value for all token holders through a reduction in newly minted ETH. It may seem strange that it matters how many new ETH that are created. But imagine if every ETH was converted to 10 ETH tomorrow so that there were 1.2 billion instead of 120 million ETH in total. Then every ETH would be around 10 times less valuable. What matters is the proportion of all ETH that you hold; a concept that we will get back to in a subsequent <a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#proportional-yield-40\">answer</a>. There is also a surplus shift from stakers to everyone from a change in issuance policy, indicated by the darker grey area. That ETH indeed previously benefited stakers, since it was taken from everyone (in the form of newly minted ETH), and then given specifically to them.</p>\n<p>It is common to treat the issuance reduction achieved by removing the dark blue area the same as when removing the dark grey area. When not explicitly highlighting the reduction in costs among those that stop staking as the issuance falls, value may appear to merely shift from one class of users to another in the form of a gain or loss in <a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675/1#proportional-yield-40\">real/proportional yield</a>. Issued tokens are redistributed among a different quantity of stakers, not creating any new value at the aggregate level. Without a division into cost and surplus, the <a href=\"https://notes.ethereum.org/@anderselowsson/Foundations-of-MVI\">welfare gain</a> can get lost in translation, especially if it is not otherwise implied by remarking on the outcome among all users at the different equilibria. In a subsequent <a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#can-stakers-profit-from-a-reduced-issuance-and-what-is-the-relevance-and-impact-of-the-realproportional-yield-37\">answer</a>, the different effects will be studied more closely.</p>\n<p>Slashing risks or any bugs that would effectively burn the stake are from an “accounting perspective” less attributable as a pure cost at the aggregate protocol level, and taxes will by their nature increase costs for a user when its surplus rises. But the general principle of capturing costs below the supply curve as the issuance that does not generate any surplus to stakers is very useful for understanding staking economics and welfare.</p>\n<p>What <a href=\"https://notes.ethereum.org/@anderselowsson/Foundations-of-MVI#Let-the-best-money-win\">happens when we impose unnecessary costs</a>  on our users? If they are forced to select between incurring these costs as stakers, or to subject themselves to an increased dilution under equilibrium, they might simply decide to use another blockchain, where the imposed costs are lower. This would of course affect both token holders and anyone building on Ethereum negatively. Ethereum operates in a free market and must always strive to perfect the user experience.</p>\n<h4><a name=\"h-2-macro-perspective-7\" class=\"anchor\" href=\"https://ethresear.ch#h-2-macro-perspective-7\"></a>2. Macro perspective</h4>\n<p>A <a href=\"https://en.wikipedia.org/wiki/True_cost_accounting\">true cost accounting</a> must also incorporate the <a href=\"https://notes.ethereum.org/@anderselowsson/MinimumViableIssuance#Benefits-of-MVI-from-a-macro-perspective\">macro perspective</a>. An LST exceeding critical thresholds regarding the <em>proportion</em> of stake under its control may compromise the consensus mechanism. Outsized profits from blockspace are here a <a href=\"https://notes.ethereum.org/@djrtwo/risks-of-lsd#Stratum-for-cartelization\">stratum for cartelization</a>. But if everyone is compelled to stake, an entity or cartel of entities may also gain control over a significant proportion of the <em>total</em> ETH—propelled by network externalities such as the money function of an LST. These externalities are a stratum for cartelization extending outside of the consensus mechanism. The compromised institution also sits one layer above, namely the social layer.</p>\n<p>It became apparent with <a href=\"https://en.wikipedia.org/wiki/The_DAO\">The DAO</a> that if the proportion of the total circulating supply affected by an outcome grows sufficiently large, then the social layer may waver on its commitment to the underlying intended consensus process. An LST might grow “<a href=\"https://x.com/weboftrees/status/1710713959362252884\">too big to fail</a>” in the eyes of the Ethereum social layer. If the community can no longer effectively intervene in the event of a 51% attack, then Vitalik’s <a href=\"https://www.youtube.com/watch?v=8DHGOlIlMvc&amp;t=1938s\">warning system</a> and Danny’s <a href=\"https://notes.ethereum.org/@djrtwo/risks-of-lsd#Risks-on-Capital-vs-Risks-to-Protocol\">recourses</a> may not be effective. Staking becomes so ubiquitous that the social consensus mechanism is overloaded. It is a special and in a way inverted case of issues Vitalik <a href=\"https://vitalik.eth.limo/general/2023/05/21/dont_overload.html\">previously warned about</a>.</p>\n<p>The macro perspective also extends beyond consensus. If one or a few LSTs overtake as money in the Ethereum ecosystem, they will embed themselves across every layer and application. An economy that is not powered by a <a href=\"https://x.com/fradamt/status/1760808900792594593\">trustless asset</a> is arguably not as <a href=\"https://ethresear.ch/t/circulating-supply-equilibrium-for-ethereum-and-minimum-viable-issuance-during-the-proof-of-stake-era/10954#631-money-lego-25\">resilient</a>, regardless of if the consensus process itself is never threatened. The applications powering the money will gain an outsized influence over the applications using the money, and Ethereum will become a less desirable blockchain to build and develop on.</p>\n<h3><a name=\"what-about-economic-security-more-stake-makes-ethereum-more-secure-right-8\" class=\"anchor\" href=\"https://ethresear.ch#what-about-economic-security-more-stake-makes-ethereum-more-secure-right-8\"></a>What about economic security? More stake makes Ethereum more secure right?</h3>\n<p>It is true that up to a certain point, more stake makes Ethereum more secure. But even before reaching this point, the marginal increase in security from adding another validator brings less utility to users than the utility loss stemming from the numerous downsides of excessive issuance (see the <a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#why-should-ethereum-reduce-its-issuance-4\">previous answer</a>) that negatively affect users, builders, and holders of the ETH token. Ethereum’s economic security will in the long term inherently be linked to the ability of ETH to retain its value. A holistic perspective is therefore important also when considering economic security. This is underscored by reflecting on the early days of Ethereum, when the ETH token was much less valuable. Eight years ago, In May 2016, <a href=\"https://blog.ethereum.org/2016/05/09/on-settlement-finality\">Vitalik deliberated on</a> the value that Ethereum can and cannot secure at a stake participation of 30%. At the time, the market cap of the ETH token was roughly 500 times lower than today, and the economic security that Ethereum could offer was therefore limited. Increasing stake participation from 30% to 60% would only increase the value of 1/3 of the stake (the threshold for the ability to delay finality) from $70M to $140M. This highlights that once the proportion staked has risen above insignificant levels, it will ultimately be Ethereum’s role in the world economy, and the ether’s role in the Ethereum economy, that determines the economic security.</p>\n<p>In a recent AMA, Justin Drake <a href=\"https://www.reddit.com/r/ethereum/comments/191kke6/comment/kh79gh1\">suggested</a> that a stake participation of 1/4 (30M ETH) is appropriate. Vitalik Buterin <a href=\"https://www.reddit.com/r/ethereum/comments/191kke6/comment/kh7do9k/\">concurred</a>, but also added a personal note of finding 1/8 (15M ETH) fine. As the quantity of stake grows, the prospects for high economic security in the long term gradually begin to diminish. It seems reasonable to argue that Ethereum would have higher economic security twenty years from now with a reward curve that sees the deposit size settle on 30M ETH staked than at 90M ETH—as long as the composition of the staking set remains viable. Beyond certain limits, even short-term security begins to degrade, in line with the reasoning around the <a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#h-2-macro-perspective-7\">macro perspective</a>. The social layer may lose its neutrality and credibility as the ultimate arbitrator against attacks from dominant SSPs. At the other end, even long-term security will be negatively affected if users are not incentivized to add another validator while that brings positive utility: a blockchain with poor short-term security from too little stake becomes undesirable to build on as well.</p>\n<p>The outlined considerations hint at a <a href=\"https://twitter.com/weboftrees/status/1585641193982918656\">range</a> within which it is desirable to keep stake participation. There is no single ideal quantity because Ethereum can adapt its security expenditures based on the prevailing price of security, something which is facilitated through a reward curve. The staking yield should be very high at 15M ETH to ensure sufficient participation. When the quantity of stake is 60M ETH, the staking yield should be very low, to dissuade additional staking. At 30M ETH staked, the staking yield can be set in between these extremes, at a level that makes an equilibrium likely. Note that the total security expenditure (issuance, <span class=\"math\">Y_i</span>) potentially can remain rather fixed as the issuance yield <span class=\"math\">y_i</span> varies, since the issued tokens will be distributed to more stakers when more stake is deposited, thus bringing down the yield. This relationship is expressed by the equation <span class=\"math\">Y_i=y_iD</span>. Economic security is also discussed <a href=\"https://ethresear.ch/t/reward-curve-with-tempered-issuance-eip-research-post/19171#h-51-economic-security-30\">here</a>.</p>\n<h3><a name=\"what-is-a-desirable-issuance-reduction-for-the-near-future-9\" class=\"anchor\" href=\"https://ethresear.ch#what-is-a-desirable-issuance-reduction-for-the-near-future-9\"></a>What is a desirable issuance reduction for the near future?</h3>\n<h4><a name=\"overview-10\" class=\"anchor\" href=\"https://ethresear.ch#overview-10\"></a>Overview</h4>\n<p>It is desirable to adopt a reward curve situated within the yellow area in Figures 2-4 below. It can be done using a reward curve with tempered issuance (slowly falling as the amount of stake increases) as exemplified in green or a reward curve with capped issuance with examples shown in pink. A reward curve below the yellow area would make the influence of MEV rather troublesome because block proposal rights would bring in relatively more value than attestations, and might also not be warranted at this point. A reward curve above the yellow area might not be sufficiently impactful relative to the potentially fractious governance process that comes with changing issuance policy.</p>\n<h4><a name=\"influence-of-mev-11\" class=\"anchor\" href=\"https://ethresear.ch#influence-of-mev-11\"></a>Influence of MEV</h4>\n<p>Any change to the reward curve should account for MEV. Forcing a low quantity of stake is undesirable if the MEV is not at the same time burned, as explored in a <a href=\"https://ethresear.ch/t/properties-of-issuance-level-consensus-incentives-and-variability-across-potential-reward-curves/18448\">recent write-up</a>, and the following <a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#variability-for-solo-stakers-23\">answer</a>. If issuance yield is reduced to strictly enforce an equilibrium in the presence of high MEV, block proposal rights may be the only remaining source of revenue. This would significantly increase the <a href=\"https://ethresear.ch/t/properties-of-issuance-level-consensus-incentives-and-variability-across-potential-reward-curves/18448#h-43-variability-with-fixed-supply-and-varied-demand-15\">relative standard deviation</a> in staking yield for non-pooled stakers, disadvantaging solo stakers. At some point, stakers may simply <a href=\"https://ethresear.ch/t/properties-of-issuance-level-consensus-incentives-and-variability-across-potential-reward-curves/18448/2\">stop attesting</a>. Additional changes to the consensus mechanism would be required to preserve micro incentives when the issuance yield becomes too low. A staking fee taken out each epoch in my view then seems like the best option and would promote “<a href=\"https://ethresear.ch/t/properties-of-issuance-level-consensus-incentives-and-variability-across-potential-reward-curves/18448/11#introduction-1\">incentive invariance</a>”. Non-pooled stakers would then need to lose ETH each epoch even under a low positive issuance yield, in the hope that they may be assigned to propose a block. A simple solution, useful for example under reward curves at the lower edge or a bit below the yellow area, is to <a href=\"https://ethresear.ch/t/properties-of-issuance-level-consensus-incentives-and-variability-across-potential-reward-curves/18448/2\">increase penalties</a> for missed attestations.</p>\n<h4><a name=\"a-reasonable-range-12\" class=\"anchor\" href=\"https://ethresear.ch#a-reasonable-range-12\"></a>A reasonable range</h4>\n<p>What then are the more moderate options that can be contemplated at the present? Figure 2 shows a range in yellow that is reasonable to target currently. Below this range, block proposals will generate more than half of the rewards under the present level of MEV, which could be an uncomfortably high level. Above this range, the change is rather small, and the potentially fractious governance process of changing the reward curve might not be worthwhile. There are also some options that push down the staking yield slightly further at high quantities of stake, which cannot be fully ruled out, discussed <a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#h-3-cut-issuance-33\">here</a>.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/b/5/b56eb9daa51f177a7470ecb60ec01edf619417f0.png\" data-download-href=\"https://ethresear.ch/uploads/default/b56eb9daa51f177a7470ecb60ec01edf619417f0\" title=\"Figure 2\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/b/5/b56eb9daa51f177a7470ecb60ec01edf619417f0_2_690x404.png\" alt=\"Figure 2\" data-base62-sha1=\"pT1EolLP20g4d9eu44AvkEQu8sU\" width=\"690\" height=\"404\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/b/5/b56eb9daa51f177a7470ecb60ec01edf619417f0_2_690x404.png, https://ethresear.ch/uploads/default/optimized/3X/b/5/b56eb9daa51f177a7470ecb60ec01edf619417f0_2_1035x606.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/b/5/b56eb9daa51f177a7470ecb60ec01edf619417f0_2_1380x808.png 2x\" data-dominant-color=\"F9F8F7\"></a></div><p></p>\n<p><strong>Figure 2.</strong> A reasonable issuance range in yellow achieved through a reward curve with tempered issuance (green) or capped issuance (pink).</p>\n<h4><a name=\"reward-curve-with-tempered-issuance-green-13\" class=\"anchor\" href=\"https://ethresear.ch#reward-curve-with-tempered-issuance-green-13\"></a>Reward curve with tempered issuance (green)</h4>\n<p>The current reward curve in black follows the equation for issuance yield <span class=\"math\">y_i = cF/\\sqrt{D}</span>, with the constant <span class=\"math\">c\\approx2.6</span> and the base reward factor set to <span class=\"math\">F=64</span>. Yearly issuance is always <span class=\"math\">Y_i=y_iD</span>. The <a href=\"https://ethresear.ch/t/reward-curve-with-tempered-issuance-eip-research-post/19171\">reward curve with tempered issuance</a> in green is created by division with <span class=\"math\">1+D/k</span>, thus:</p>\n<div class=\"math\">\ny_i = \\frac{cF}{\\sqrt{D}(1+D/k)},\n</div>\n<p>with <span class=\"math\">k</span> set to <span class=\"math\">2^{25}</span>. The variable <span class=\"math\">k</span> defines participation at peak issuance, which also becomes the point where issuance is halved, indicated by the lower cross at around 33.6M ETH. The dashed green reward curve makes a small change to the computation, subtracting a fixed constant <span class=\"math\">k_2</span> from <span class=\"math\">D</span> (minimum 0) when computing the new term. This constant was here set to <span class=\"math\">k_2=2^{23}</span>. The idea is to provide stronger guarantees of a sufficient quantity of stake and thus security. While this is very unlikely to be required, it might still make the governance process of finding an agreement on the change easier. A similar effect can also be achieved by using a reward curve of a <a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#h-3-cut-issuance-33\">higher order</a>.</p>\n<h4><a name=\"reward-curve-with-capped-issuance-pink-14\" class=\"anchor\" href=\"https://ethresear.ch#reward-curve-with-capped-issuance-pink-14\"></a>Reward curve with capped issuance (pink)</h4>\n<p>In pink are reward curves with capped issuance (shorter write-up <a href=\"https://notes.ethereum.org/@anderselowsson/Reward-curve-with-capped-issuance\">here</a>). The cap <span class=\"math\">D_c</span> defines stake participation when issuance diverges from the current reward curve and flatlines. The lowest setting within the sought range is <span class=\"math\">D_c=2^{23}</span> (8.4M ETH) indicated by a dotted curve and the highest is <span class=\"math\">D_c=2^{24}</span> (16.8M ETH) indicated by a full curve. One interesting detail is that Vitalik Buterin’s <a href=\"https://ethresear.ch/t/simplified-active-validator-cap-and-rotation-proposal/9022\">active validator cap and rotation proposal</a> from March 2021 has the same effect on issuance as when applying <span class=\"math\">D_c=2^{24}</span>. One benefit of this reward curve is thus its long history, potentially being the first serious proposal for tempering the growth in the actively participating stake. The reader might find the comment section on that post interesting, with early thinking on Ethereum’s circulating supply equilibrium, targeting a participation ratio, and variable validator balances. The dashed pink curve corresponds to the viable option of $D_c=15$M ETH. The midpoint, <span class=\"math\">2^{23}\\sqrt{2}</span> might also be interesting (not plotted).</p>\n<h4><a name=\"staking-yield-and-outlook-15\" class=\"anchor\" href=\"https://ethresear.ch#staking-yield-and-outlook-15\"></a>Staking yield and outlook</h4>\n<p>Figure 3 shows the staking yield <span class=\"math\">y=y_i+y_v</span>, including MEV yield <span class=\"math\">y_v</span> at the current level of 300k ETH of MEV per year, for some of the previously outlined reward curves (retained color and line style). In blue is the same <a href=\"https://ethresear.ch/t/properties-of-issuance-level-consensus-incentives-and-variability-across-potential-reward-curves/18448\">hypothetical future supply curve</a> as in Figure 1. It is intended to illustrate what the supply curve might look like a few years from now, as a way to understand how an equilibrium might form. The faint blue line may then be the supply curve after another few years have passed and the <a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#h-1-reduced-costs-raise-welfare-6\">costs associated with staking</a> have fallen even further. The difference in equilibrium yield between the two reward curves will depend on the slope of the supply curve and, as illustrated, may not be that significant, here amounting to 0.5%.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/d/5/d52b39d2492b418b75da0e6f8e56248845a6f497.png\" data-download-href=\"https://ethresear.ch/uploads/default/d52b39d2492b418b75da0e6f8e56248845a6f497\" title=\"Figure 3\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/d/5/d52b39d2492b418b75da0e6f8e56248845a6f497_2_690x413.png\" alt=\"Figure 3\" data-base62-sha1=\"upMjm4CpDkAFJwcTmwE3vWGsnqL\" width=\"690\" height=\"413\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/d/5/d52b39d2492b418b75da0e6f8e56248845a6f497_2_690x413.png, https://ethresear.ch/uploads/default/optimized/3X/d/5/d52b39d2492b418b75da0e6f8e56248845a6f497_2_1035x619.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/d/5/d52b39d2492b418b75da0e6f8e56248845a6f497_2_1380x826.png 2x\" data-dominant-color=\"F9F9F9\"></a></div><p></p>\n<p><strong>Figure 3.</strong> Staking yield from the outlined reward curves, inclusive of MEV of 300k ETH per year. Two hypothetical supply curves are indicated in blue.</p>\n<p>Figure 4 instead shows only issuance yield, with no rewards from MEV. If MEV burn (e.g., <a href=\"https://ethresear.ch/t/mev-burn-a-simple-design/15590\">1</a>, <a href=\"https://ethresear.ch/t/execution-tickets/17944\">2</a>, <a href=\"https://mirror.xyz/barnabe.eth/QJ6W0mmyOwjec-2zuH6lZb0iEI2aYFB9gE-LHWIMzjQ\">3</a>) is successfully implemented, the staking yield could approach these levels. However, MEV burn is at a rather early research stage with no guarantee of success, and some parts of the MEV such as consensus-layer preconfirmations may never be burned. The figure illustrates that the equilibrium staking yield could also decrease due to a continued fall in the supply curve, after another few years have passed. The combined effect brings down the staking yield to 1.76% in this hypothetical scenario, but it is still within 0.5% of the equilibrium yield with the current reward curve.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/a/7/a78f450914605d6e7e6462b23cefdf71a737e7c2.png\" data-download-href=\"https://ethresear.ch/uploads/default/a78f450914605d6e7e6462b23cefdf71a737e7c2\" title=\"Figure 4\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/a/7/a78f450914605d6e7e6462b23cefdf71a737e7c2_2_690x413.png\" alt=\"Figure 4\" data-base62-sha1=\"nUiGRNZY1tYR5OmeduXyX2vh7Ee\" width=\"690\" height=\"413\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/a/7/a78f450914605d6e7e6462b23cefdf71a737e7c2_2_690x413.png, https://ethresear.ch/uploads/default/optimized/3X/a/7/a78f450914605d6e7e6462b23cefdf71a737e7c2_2_1035x619.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/a/7/a78f450914605d6e7e6462b23cefdf71a737e7c2_2_1380x826.png 2x\" data-dominant-color=\"F9F9F9\"></a></div><p></p>\n<p><strong>Figure 4.</strong> Issuance yield <span class=\"math\">y_i</span> under the outlined reward curves. This is also the staking yield if all MEV has been successfully burned, a scenario that may not materialize. Two hypothetical supply curves are indicated in blue.</p>\n<p>It can be noted that the reduced staking yield from MEV burn makes an equilibrium at a desirable quantity of stake rather likely, even if the supply curve continues to fall. Therefore, adopting something close to the dashed green reward curve, followed up by MEV burn a little later, could bring Ethereum to a stage where the quantity of stake is tempered and remains firmly below 60M ETH, likely closer to 30M ETH. This does not mean that this reward curve necessarily must remain in place. But the reward curve should give us plenty of time to continue the debate on the “endgame” issuance policy (see <a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#what-is-the-endgame-issuance-policy-28\">this answer</a> without having to worry about the quantity of stake growing debilitatingly high.</p>\n<h3><a name=\"why-not-dynamically-adjust-the-yield-with-a-mechanism-like-eip-1559-to-guarantee-some-fixed-target-participation-level-16\" class=\"anchor\" href=\"https://ethresear.ch#why-not-dynamically-adjust-the-yield-with-a-mechanism-like-eip-1559-to-guarantee-some-fixed-target-participation-level-16\"></a>Why not dynamically adjust the yield with a mechanism like EIP-1559 to guarantee some fixed target participation level?</h3>\n<h4><a name=\"overview-17\" class=\"anchor\" href=\"https://ethresear.ch#overview-17\"></a>Overview</h4>\n<p>One common suggestion is that Ethereum should use a mechanism like EIP-1559 to automatically adjust the yield, ensuring that the stake participation is kept at some specific targeted level. Allowing the market to set the issuance yield may seem more neutral, taking away control from developers. Of course, this merely shifts the problem to defining one specific appropriate quantity of stake instead. And what is worse, it constrains Ethereum to purchase an equal amount of security, regardless of its cost. Arguably, there is not one specific appropriate quantity of stake, because the price of the security (the equilibrium issuance level) also matters.</p>\n<p>As <a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#what-about-economic-security-more-stake-makes-ethereum-more-secure-right-8\">previously discussed</a>, the marginal increase in security from adding another validator provides diminishing utility as the quantity of stake increases. At some point, the utility loss of excessive issuance becomes greater than the utility gain from more security. Clearly, that point will depend also on the cost of the security. Another concern with a target participation level is that it gives stakers incentives to discouragement attack Ethereum to drive up the issuance, in one version operating as a union. Trying to rectify these flaws will ultimately recreate some form of reward curve, because it is in many ways a more sophisticated solution.</p>\n<h4><a name=\"a-fixed-target-participation-level-is-a-vertical-reward-curve-with-subpar-budgeting-18\" class=\"anchor\" href=\"https://ethresear.ch#a-fixed-target-participation-level-is-a-vertical-reward-curve-with-subpar-budgeting-18\"></a>A fixed target participation level is a vertical reward curve with subpar budgeting</h4>\n<p>When the yield adjusts dynamically to enforce some specific target participation level, the mechanism behaves similar to a vertical reward curve in the long run. Any such mechanism will of course adapt gradually to avoid too big changes in yield from small shifts in the supply curve, but the equilibrium ultimately returns to a point where the supply curve intersects the vertical “dynamic” reward curve. Two such reward curves are illustrated in magenta in Figure 5, one where the target has been set to 30M ETH staked and one at 60M ETH staked. The figure presumes 300k ETH in MEV per year. A regular reward curve “Endgame (3)” presented in <a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#h-3-cut-issuance-33\">another answer</a> is instead shown in purple.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/e/d/eda4f937fd7c3ad86d90391f07bebe06e845ba7d.png\" data-download-href=\"https://ethresear.ch/uploads/default/eda4f937fd7c3ad86d90391f07bebe06e845ba7d\" title=\"Figure 5\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/e/d/eda4f937fd7c3ad86d90391f07bebe06e845ba7d_2_690x427.png\" alt=\"Figure 5\" data-base62-sha1=\"xUiC6zqBjQZzBs6FYpsih9yMo5D\" width=\"690\" height=\"427\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/e/d/eda4f937fd7c3ad86d90391f07bebe06e845ba7d_2_690x427.png, https://ethresear.ch/uploads/default/optimized/3X/e/d/eda4f937fd7c3ad86d90391f07bebe06e845ba7d_2_1035x640.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/e/d/eda4f937fd7c3ad86d90391f07bebe06e845ba7d_2_1380x854.png 2x\" data-dominant-color=\"F8F6F9\"></a></div><p></p>\n<p><strong>Figure 5.</strong> Equilibria under various supply curves in blue when using a fixed target participation level (magenta), a reward curve with cut issuance (purple), or the current reward curve (black). Green circles represent desirable outcomes, red crosses undesirable outcomes, and yellow triangles are outcomes somwehere in between. As captured by the red crosses, a fixed target does not facilitate proper budgeting.</p>\n<p>Three hypothetical supply curves are shown in blue, intended to illustrate what the outcome would be under vastly different scenarios. With a 30M target under a high supply curve, an equilibrium forms at a 2.87% staking yield; a desirable outcome under the presence of MEV as marked by a green circle. Under the outlined medium supply curve, an equilibrium forms at 1.87% instead. This might be perceived as slightly problematic because MEV will constitute 53.5% of the total staking rewards. As a result, block proposals bring home around 59.3% of all rewards under the current consensus specification, and so the equilibrium is marked by a yellow triangle to indicate a medium outcome. Yet, it is rather close to being classified as a green circle in my view.  The equilibrium under the low supply curve at a 0.5% staking yield is marked by a red cross to indicate undesirability. This equilibrium happens under a negative issuance yield since the MEV yield is 1%. Non-pooled stakers (e.g., most solo stakers) must then lose money each epoch in the hope of eventually being assigned to propose a block.</p>\n<p>With a 60M target under the high supply curve, an equilibrium forms at a 4.6% staking yield. This is very undesirable. Ethereum would in this scenario issue 2.45M ETH per year when the equilibrium issuance of 0.56M ETH at 30M ETH would be sufficient. The downside of course is the unnecessary <a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#h-1-reduced-costs-raise-welfare-6\">costs</a> that Ethereum is subjecting its users to. For the users, this manifests as being coerced into taking on some of those costs as a staker, or otherwis see their savings eroded by dilution. The equilibrium for the medium supply curve is also undesirable for the same reason. The equilibrium at the low supply curve however seems acceptable, at a staking yield of 1.11%. The MEV is a bit high at 45% of the rewards, and indeed the proposer gets 51.8% of the expected staking yield. Yet this seems acceptable in order to keep the quantity of stake from growing too high under a low supply curve, where 60M ETH is already undesirably high.</p>\n<p>The problem with a dynamic reward curve and a specific target is that the associated vertical shape may lead to undesirable staking equilibria. The reader will note that by using the purple reward curve denoted as “Endgame (3)”, an acceptable equilibrium is reached under all three supply curves, as marked by green circles. If the supply curve is higher, an equilibrium with a low quantity of stake is attained, ensuring that the costs to Ethereum’s users do not grow too large. If the supply curve is lower, the quantity of stake is allowed to grow to ensure that a reasonable issuance yield is provided to stakers. This also enables Ethereum to ensure a viable <a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#how-will-a-reduction-in-issuance-affect-the-composition-of-the-staking-set-21\">composition of the staking set</a>.</p>\n<p>The future level of the supply curve will always be unknown, and the reward curve (the demand curve) must therefore be designed to produce acceptable outcomes in any reasonable scenario. A desirable reward curve can in a way be understood as the <a href=\"https://en.wikipedia.org/wiki/Expansion_path\">expansion path</a> that optimizes between yield and stake participation across potential supply curves, as <a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#philosophical-underpinnings-of-the-optimization-problem-30\">outlined</a> in a subsequent answer. The current reward curve is shown in black and will as indicated produce excessive issuance (costs to users), while also leading to an undesirably high quantity of stake under lower supply curves.</p>\n<p>Ethereum is currently researching MEV burn. This would alleviate some of the concerns with particular equilibria leading to excessive proportions of MEV. The outcome under full MEV burn is shown in Figure 6.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/a/d/ad0efa8c8105ee179411f4738864f1b0eb46223a.png\" data-download-href=\"https://ethresear.ch/uploads/default/ad0efa8c8105ee179411f4738864f1b0eb46223a\" title=\"Figure 6\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/a/d/ad0efa8c8105ee179411f4738864f1b0eb46223a_2_690x427.png\" alt=\"Figure 6\" data-base62-sha1=\"oGWH2bNyI44d8PtENkBGBa9Fkvw\" width=\"690\" height=\"427\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/a/d/ad0efa8c8105ee179411f4738864f1b0eb46223a_2_690x427.png, https://ethresear.ch/uploads/default/optimized/3X/a/d/ad0efa8c8105ee179411f4738864f1b0eb46223a_2_1035x640.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/a/d/ad0efa8c8105ee179411f4738864f1b0eb46223a_2_1380x854.png 2x\" data-dominant-color=\"F8F6F9\"></a></div><p></p>\n<p><strong>Figure 6.</strong> Equilibria under MEV burn for various supply curves in blue when using a fixed target participation level (magenta), a reward curve with cut issuance (purple), or the current reward curve (black). Green circles represent desirable outcomes, red crosses undesirable outcomes, and yellow triangles are outcomes somwehere in between.</p>\n<p>Equilibria at lower staking yields when 30M ETH is staked are less problematic if there is no MEV. For example, non-pooled stakers would receive positive rewards each epoch. The equilibrium under the low supply curve is still marked by a yellow triangle. It could be fair to mark it by a green circle, but in my opinion, we might wish to let the quantity of stake expand somewhat under these supply curves. This gives a higher equilibrium yield and will give better guarantees of a viable composition of the staking set. One way to understand it is that the reward curve helps absorbs all delegating stakers with a low reservation yield to ensure that the yield remains viable for solo staking.</p>\n<p>Figure 7 below plots the total yearly rewards (corresponding here also to total issuance, since MEV burn is in place in this example). The excessively high issuance under high supply curves and a fixed target of 60M ETH is very problematic. Likewise concerning the high issuance under low supply curves with the current reward curve. Note that the really problematic outcomes for the current reward curve instead happens under low supply curves, because it is designed to increase issuance as the quantity of stake increases.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/e/f/efce4de2bd9c71175c7d7feab5aaed4b212ab564.png\" data-download-href=\"https://ethresear.ch/uploads/default/efce4de2bd9c71175c7d7feab5aaed4b212ab564\" title=\"Figure 7\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/e/f/efce4de2bd9c71175c7d7feab5aaed4b212ab564_2_690x423.png\" alt=\"Figure 7\" data-base62-sha1=\"ydq7sbqm0umxC2bSM7Z9T1pgaFu\" width=\"690\" height=\"423\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/e/f/efce4de2bd9c71175c7d7feab5aaed4b212ab564_2_690x423.png, https://ethresear.ch/uploads/default/optimized/3X/e/f/efce4de2bd9c71175c7d7feab5aaed4b212ab564_2_1035x634.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/e/f/efce4de2bd9c71175c7d7feab5aaed4b212ab564_2_1380x846.png 2x\" data-dominant-color=\"F8F6F9\"></a></div><p></p>\n<p><strong>Figure 7.</strong> Yearly issuance under MEV burn for various supply curves in blue when using a fixed target participation level (magenta), a reward curve with cut issuance (purple), or the current reward curve (black). Green circles represent desirable outcomes, red crosses undesirable outcomes, and yellow triangles are outcomes somwehere in between. A fixed target of 60M ETH (magenta) will lead to excessive issuance if the supply curve is higher.</p>\n<h4><a name=\"a-fixed-target-participation-level-may-incite-stakers-to-attack-ethereum-19\" class=\"anchor\" href=\"https://ethresear.ch#a-fixed-target-participation-level-may-incite-stakers-to-attack-ethereum-19\"></a>A fixed target participation level may incite stakers to attack Ethereum</h4>\n<p>The previous section established the downside of not attaching a proper budgeting mechanism to Ethereum’s security expenditures. It may lead to Ethereum overpaying for security, or paying so little that solo stakers needlessly are driven out. Some may consider concerns around solo staking overblown, and feel that the benefit of a specific target outweighs, because Ethereum will at least have some specific participation level that has been deemed appropriate by the community. The issue with a fixed target is however a little deeper. Stakers need to come to consensus under <a href=\"https://vitalik.eth.limo/general/2017/07/16/triangle_of_harm.html\">listener–speaker fault equivalence</a>, something that opens up avenues for <a href=\"https://github.com/ethereum/research/blob/4a3bc39e11acede672770475ab254a1a882a5bbe/papers/discouragement/discouragement.pdf\">discouragement attacks</a>. The protocol cannot ascertain who is at fault for a failed consensus message delivery. An attacker can therefore act maliciously against honest consensus participants to deprive them of rewards, subsequently profiting as they leave and the staking yield increases. There exists various avenues even for <a href=\"https://ethresear.ch/t/properties-of-issuance-level-consensus-incentives-and-variability-across-potential-reward-curves/18448/11\">minority discouragement attacks</a> at the present.</p>\n<p>With a fixed target participation level that adapts relatively quickly, the “<a href=\"https://ethresear.ch/t/reward-curve-with-tempered-issuance-eip-research-post/19171#h-53-discouragement-attacks-32\"><span class=\"math\">p_i</span>-elasticity</a>” becomes infinite. The incentives for discouragement attacks are then <a href=\"https://x.com/VitalikButerin/status/1542162089304784897\">maximized</a>; less stake must leave to drive up the yield. A related concept is <a href=\"https://ethresear.ch/t/reward-curve-with-tempered-issuance-eip-research-post/19171#h-54-cartelization-attacks-33\">cartelization attacks</a>, consisting of SSPs working together to try to reduce quantity staked, potentially also among themselves. When issuance increases with a reduction in quantity staked (<span class=\"math\">p_i&gt;1</span>), all stakers could try to agree to reduce their stake, and everyone would be better off (as long as new entrants are kept out or discouraged). This framing can provide a suitable backdrop for convincing the social layer to not interfere when a staking cartel tries to inhibit Ethereum’s permissionlessness, utilizing discouragement attacks.</p>\n<p>The importance of discouragement attacks should not be overblown, but it is unnecessary to open up for them when safer designs so easily can be achieved. It is particularly striking that under the strict target, attacking the consensus through censorship can generate what is essentially an infinite-money glitch without breaking validity.</p>\n<h4><a name=\"rectifying-the-outlined-flaws-recreates-a-subpar-reward-curve-20\" class=\"anchor\" href=\"https://ethresear.ch#rectifying-the-outlined-flaws-recreates-a-subpar-reward-curve-20\"></a>Rectifying the outlined flaws recreates a subpar reward curve</h4>\n<p>To protect against stakers turning the consensus mechanism into a money-printing machine, the protocol might of course impose some maximum yield beyond which no further increases are deemed necessary (besides relying on the social layer and the threat of intervention). For good measure, the issuance policy may also define a floor, so that stakers always receive some yield, ensuring a viable composition of the staking set. Figure 8 plots this new hypothetical updated fixed target reward curve (once again ignoring the time component). The ceiling was set to 5% and the floor to 0.25%.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/8/e/8e184ff8b0b2682e4e76bbc975a16e402aa847a8.png\" data-download-href=\"https://ethresear.ch/uploads/default/8e184ff8b0b2682e4e76bbc975a16e402aa847a8\" title=\"Figure 8\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/8/e/8e184ff8b0b2682e4e76bbc975a16e402aa847a8_2_690x427.png\" alt=\"Figure 8\" data-base62-sha1=\"kh1TaBytwOwCzvwxCshanX58ND2\" width=\"690\" height=\"427\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/8/e/8e184ff8b0b2682e4e76bbc975a16e402aa847a8_2_690x427.png, https://ethresear.ch/uploads/default/optimized/3X/8/e/8e184ff8b0b2682e4e76bbc975a16e402aa847a8_2_1035x640.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/8/e/8e184ff8b0b2682e4e76bbc975a16e402aa847a8_2_1380x854.png 2x\" data-dominant-color=\"F7F6F9\"></a></div><p></p>\n<p><strong>Figure 8.</strong> A fixed target participation level with upper and lower limits, attempting to rectify some issues of the design shown in Figures 5-7. However, a reward curve remains the better solution.</p>\n<p>The mechanism now prevents the infinite-money glitch, and gives stakers at least some guaranteed yield. However, it arguably remains flawed, with improper budgeting. The incentives for discouragement attacks and cartelization attacks are still unnecessarily pronounced in the vertical part of the curve. The fixed floor and ceiling should instead have the smooth characteristics of a reward curve, gradually increasing or decreasing as the utility function changes.</p>\n<p>The outlined flaws do not mean that there is no value in a dynamic approach; it is possible to combine it with a reward curve. The idea would be to allow the reward curve to drift/bend at longer time scales, ultimately being influenced by a separate target reward curve. Such a “<a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#h-5-time-quantity-policy-35\">time–quantity policy</a>” is explored in the answer on the <a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#what-is-the-endgame-issuance-policy-28\">staking economics endgame</a>.</p>\n<h3><a name=\"how-will-a-reduction-in-issuance-affect-the-composition-of-the-staking-set-21\" class=\"anchor\" href=\"https://ethresear.ch#how-will-a-reduction-in-issuance-affect-the-composition-of-the-staking-set-21\"></a>How will a reduction in issuance affect the composition of the staking set?</h3>\n<h4><a name=\"overview-22\" class=\"anchor\" href=\"https://ethresear.ch#overview-22\"></a>Overview</h4>\n<p>This depends on how sensitive relevant groups such as solo stakers and delegating stakers are to low staking yields and high variability. One concern is unfavorable economies of scale for solo stakers at low yields. At the same time, the delegating staker subjects itself to unique risks when trusting a third party with its ETH, and may for this reason also be hesitant to stake if the yield goes too low. There is furthermore a dynamic at play wherein delegated staking becomes relatively more favorable as the quantity of stake grows. There is thus a multitude of conflicting economic forces to consider. One way to approach this complex subject is by comparing distributions that attempt to capture the willingness to stake at different yields among solo stakers and delegating stakers, as shown, for example, in Figure 11 below.</p>\n<p>It is important to understand the probabilistic nature of issuance policy, and that the design ultimately tries to optimize outcomes under any scenario (e.g., a lower or higher supply curve). As outlined in <a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#philosophical-underpinnings-of-the-optimization-problem-30\">another answer</a>, a suitable reward curve can in this context be understood as the expansion path across potential supply curves that optimally balances trade-offs. One of these trade-offs is the equilibrium composition of the staking set. With this viewpoint and in light of potential concerns, an equilibrium at 30M ETH can be desirable, but still not enforced by economic capping. Under a particularly low supply curve, the quantity of stake can be allowed to expand. The composition of the staking set must thus ultimately be analyzed and optimized for across two dimensions, both issuance level and quantity of stake.</p>\n<h4><a name=\"variability-for-solo-stakers-23\" class=\"anchor\" href=\"https://ethresear.ch#variability-for-solo-stakers-23\"></a>Variability for solo stakers</h4>\n<p>If issuance is moderated, a larger part of rewards will stem from REV, and the relative variability in staking rewards will therefore increase. This affects solo stakers negatively since they cannot effortlessly rely on pooling for smoothing out variability. A review of how variability affects the solo staker is offered in a previous write-up on <a href=\"https://ethresear.ch/t/properties-of-issuance-level-consensus-incentives-and-variability-across-potential-reward-curves/18448#h-4-variability-in-rewards-for-solo-stakers-12\">properties of issuance level</a>. It seems reasonable to assume that stakers may be more <a href=\"https://ethresear.ch/t/properties-of-issuance-level-consensus-incentives-and-variability-across-potential-reward-curves/18448#h-43-variability-with-fixed-supply-and-varied-demand-15\">more sensitive to variance at lower staking yields</a>—the <em>relative</em> variability matters. This of course certainly holds true under an equilibrium where the issuance yield is negative but the staking yield (which includes REV) is positive—for example when instituting economic capping (<a href=\"https://notes.ethereum.org/@vbuterin/single_slot_finality#Economic-capping-of-total-deposits\">1</a>, <a href=\"https://ethresear.ch/t/endgame-staking-economics-a-case-for-targeting/18751\">2</a>). Solo stakers that do not pool their execution layer rewards will then need to lose ETH each epoch in the hope of being assigned to propose a block. Since MEV yield is shared among stakers, it rises with a lower quantity of stake, and such an equilibrium therefore becomes increasingly more likely the lower the economic cap is set, because the MEV yield can then still be a sufficient incentive on its own. Relative variability is one of the reasons for pursuing the more moderate reward curves discussed in a <a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#what-is-a-desirable-issuance-reduction-for-the-near-future-9\">previous answer</a> before MEV burn is in place. This does not mean that a low economic cap will be enforced afterward, merely that it is much more feasible once MEV burn is in place.</p>\n<h4><a name=\"equilibrium-yield-and-the-proportion-of-solo-stakers-24\" class=\"anchor\" href=\"https://ethresear.ch#equilibrium-yield-and-the-proportion-of-solo-stakers-24\"></a>Equilibrium yield and the proportion of solo stakers</h4>\n<p>Ethereum wants to retain solo stakers, at least when measured as a proportion of all stakers. The anticipated outcome of a reduction in issuance level is that less ETH will be staked by both delegating and solo stakers, relative to the outcome when issuance is not reduced (<a href=\"https://ethresear.ch/t/properties-of-issuance-level-consensus-incentives-and-variability-across-potential-reward-curves/18448/12#the-complex-conundrum-of-retaining-solo-stakers-1\">1</a>, <a href=\"https://ethereum-magicians.org/t/electra-issuance-curve-adjustment-proposal/18825/11\">2</a>). A concern is if there might be a staking yield below which solo stakers in particular would drop off due to, e.g., the relatively higher fixed costs associated with solo staking.</p>\n<p>Take for example <a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#staking-yield-and-outlook-15\">Figure 3</a> as a starting point. It is not clear whether the proportion of solo stakers is lower at a hypothetical equilibrium of around 36M ETH staked and a staking yield of 2.44% (green dashed reward curve with tempered issuance) than at around 50M ETH staked and a staking yield of 2.94% (black current reward curve). If solo stakers leave en masse below a yield of 2.6%, then a staking yield of 2.44% at 36M ETH staked will give a lower proportion than when the yield is 2.94% at 50M ETH staked. This is of course something to take seriously. Economies of scale are hard to design away in a decentralized blockchain.</p>\n<p>There are however also some arguments as to why a more restrictive reward curve could give a higher or at least similar proportion of solo stakers:</p>\n<ul>\n<li>Dominant SSPs have <a href=\"https://twitter.com/weboftrees/status/1710719496971862072\">better economies of scale at higher quantities staked</a>, increasing their cost advantage over solo stakers.</li>\n<li>Likewise, the <a href=\"https://x.com/weboftrees/status/1710712326117097785\">positive network externality of the money function</a> grows with quantity staked, and with it the competitive advantage of dominant LST-issuing SSPs.</li>\n<li>Furthermore, the principal–agent problem associated with an LST may seem less risky if everyone else also uses the LST, with the expectation that the social layer will waver on its commitment to the intended consensus process in the event of a failure.</li>\n<li>Risks could very well price out delegating stakers earlier than solo stakers as the yield falls. For example, if a large enough subset of potential delegators believe that there is a 1% risk of failure over a year for the LST they wish to hold, then favorable economies of scale or liquidity can be insufficient as a competitive edge. Self-custody is undeniably <a href=\"https://x.com/nero_eth/status/1766354381543292985\">important</a> to a relevant proportion of ETH token holders; this factor should not be overlooked when evaluating the staking supply side.</li>\n<li>On a similar theme, if the yield becomes negative, there is still an altruistic motive for solo staking.  The delegating staker will either need to take on a loss or face adverse selection. An SSP that subsidizes delegators will do so under the expectation of future profits, which may be attained by monopolizing some critical function, or worse, by attacking the consensus. An SSP profiting from restaking could just as well profit using non-staked ETH.</li>\n<li>Token holders with enough ETH and the technical ability to solo stake are not necessarily abundant, implying a <a href=\"https://twitter.com/weboftrees/status/1710723555476803643\">soft upper bound</a> on the solo staked quantity. It can be argued that if this pool is more or less depleted, then relatively <a href=\"https://ethresear.ch/t/endgame-staking-economics-a-case-for-targeting/18751#supply-side-give-me-eth-and-have-my-stake-4\">few of the new stakers</a> will be solo stakers as the supply curve falls and <span class=\"math\">D</span> increases under the current policy. Still, concerning this particular argument, it should be remembered that if the yield is reduced substantially to halt the increase in <span class=\"math\">D</span>, there is no guarantee of retaining a larger proportion of solo stakers in the long run. This ultimately depends on the finer-grained distribution of reservation yields among them, as explored in the next subsection.</li>\n</ul>\n<p>Issuance policy should be focused on long-term objectives and not rely on short-term remedies. This also relates to the presently rather valuable solo staking airdrops, if they can be expected to cease. Yet, Ethereum’s evolving consensus mechanism may look different in ten years, with different requirements for staking anyway—there may even be different classes of validators (<a href=\"https://ethresear.ch/t/unbundling-staking-towards-rainbow-staking/18683\">1</a>, <a href=\"https://notes.ethereum.org/bW2PeHdwRWmeYjCgCJJdVA\">2</a>)—so circumstances of the present and in the near-term future cannot be completely ignored. For example, it must be acknowledged that if the yield falls, the impact of any solo-staking airdrops will multiply. As an example, if their expected value is 1% per year, and the staking yield falls from 4% to 1%, then airdrops will go from giving solo stakers a 25 % higher revenue than the delegating staker to giving a 100% higher revenue.</p>\n<p>An additional nuance can also be added to the fourth bullet point: some solo stakers stake quite a bit more than 32 ETH, and these may be more resilient to low yields. Finally note that solo stakers who do not own their hardware may still enjoy some external economies of scale; home stakers on the contrary are directly affected by hardware costs.</p>\n<p>At a fundamental level, the <a href=\"https://x.com/weboftrees/status/1710723376233304391\">conjecture</a> is that the relative distribution of reservation yields may differ between different classes of stakers. This then leads to different proportions of solo stakers under different issuance policies. But whether one policy is better than the other in this respect cannot be ascertained and may also vary over the forthcoming decade.</p>\n<h4><a name=\"relative-distribution-of-reservation-yields-25\" class=\"anchor\" href=\"https://ethresear.ch#relative-distribution-of-reservation-yields-25\"></a>Relative distribution of reservation yields</h4>\n<p>This subsection will explain the conjecture from the previous paragraph by visualizing some hypothetical distributions of reservation yields among different classes of stakers. Naturally, such distributions emerge from some fundamental functions capturing the willingness to supply stake, which ultimately depends on the composition of those seeking exposure to the ETH asset and how they value various costs associated with staking. I will present such models at a later date. These visualizations will simply illustrate what the distributions might look like based on the ideas presented in the previous subsection, without quantifying the actual underlying economic forces.</p>\n<p>The notion of a “reservation yield” is lent from labor economics, in which <a href=\"https://en.wikipedia.org/wiki/Reservation_wage\">reservation wages</a> influence the quantity of supplied labor across wage (the labor supply curve). Staking economics and labor economics have some similarities; after all, staking is work done to maintain the consensus process, and stakers—just as workers—can under certain circumstances cartelize (i.e., a labor union/cartelization attack) as discussed in a <a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#a-fixed-target-participation-level-may-incite-stakers-to-attack-ethereum-19\">previous answer</a>. The laborer’s valuation of their leisure time to some extent then corresponds to the premium that the token holder attaches to non-staked ETH. It should however be mentioned that the “reservation yield” here applies to a “prospective” token holder. The purpose is to capture the specific yield at which some token would be staked, but it must be recognized that the actual token holder might change due to changing circumstances.</p>\n<p>A specified reservation yield is assumed to apply under the equilibrium formed also when accounting for other stakers’ reservation yields, and stake will not switch staking modality across staking yield. Also note that the reservation yield represents what the staking yield must be, and is not a staker’s profit, because there are also costs/fees. The example is intended to capture what the distributions might hypothetically look like a few years from now, assuming that a functioning MEV burn is in place and that airdrops to solo stakers unfortunately have become less ubiquitous.</p>\n<h4><a name=\"illustrating-hypothetical-distributions-of-reservation-yields-26\" class=\"anchor\" href=\"https://ethresear.ch#illustrating-hypothetical-distributions-of-reservation-yields-26\"></a>Illustrating hypothetical distributions of reservation yields</h4>\n<p>The dotted line in Figure 9 shows a hypothetical distribution of reservation yields for solo stakers, with staking yield on the x-axis. Presumably, not many stakers have a zero or negative reservation yield. A tiny few might be inclined to stake even if there are no direct monetary incentives provided by the consensus mechanism (a staking yield of 0), perhaps to defend or attack the network. But these incentives are not something that Ethereum would like to rely on. As the staking yield rises, each marginal increase brings in a larger subset of ETH token holders as solo stakers. The pool of prospective solo stakers then gradually depletes as the overall staking participation rate increases, the curve peaks (here at around 2%), and an increase in yield will ultimately not bring in many new stakers.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/2/5/2539759699b9ada34cf8bacbbc7ab9c5d5d5cee1.png\" data-download-href=\"https://ethresear.ch/uploads/default/2539759699b9ada34cf8bacbbc7ab9c5d5d5cee1\" title=\"Figure 9\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/2/5/2539759699b9ada34cf8bacbbc7ab9c5d5d5cee1_2_690x440.png\" alt=\"Figure 9\" data-base62-sha1=\"5jiLTiSmhYA1H4Xaydjg8tm5bWh\" width=\"690\" height=\"440\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/2/5/2539759699b9ada34cf8bacbbc7ab9c5d5d5cee1_2_690x440.png, https://ethresear.ch/uploads/default/optimized/3X/2/5/2539759699b9ada34cf8bacbbc7ab9c5d5d5cee1_2_1035x660.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/2/5/2539759699b9ada34cf8bacbbc7ab9c5d5d5cee1_2_1380x880.png 2x\" data-dominant-color=\"FBFBFB\"></a></div><p></p>\n<p><strong>Figure 9.</strong> Hypothetical distribution of reservation yields among solo stakers.</p>\n<p>Figure 10 instead shows with a dashed line what the distribution of reservation yields among prospective delegating stakers may look like. The distribution might generally have a more positive skew. The idea is (a little simplified) that the last quartile of stakers favor liquidity and might not have the technical ability to solo stake, whereas favorable economies of scale bring a sharper increase at lower yields. The previously illustrated hypothetical distribution of solo stakers is also included in the plot, but they are relatively fewer, so it is hard to compare the shapes.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/f/9/f9870c9aacc3ea85b539eee5aef947bdcaa7f135.png\" data-download-href=\"https://ethresear.ch/uploads/default/f9870c9aacc3ea85b539eee5aef947bdcaa7f135\" title=\"Figure 10\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/f/9/f9870c9aacc3ea85b539eee5aef947bdcaa7f135_2_690x440.png\" alt=\"Figure 10\" data-base62-sha1=\"zBqen0VxeevewpLMRKfVSOW7Dmt\" width=\"690\" height=\"440\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/f/9/f9870c9aacc3ea85b539eee5aef947bdcaa7f135_2_690x440.png, https://ethresear.ch/uploads/default/optimized/3X/f/9/f9870c9aacc3ea85b539eee5aef947bdcaa7f135_2_1035x660.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/f/9/f9870c9aacc3ea85b539eee5aef947bdcaa7f135_2_1380x880.png 2x\" data-dominant-color=\"FAFBFB\"></a></div><p></p>\n<p><strong>Figure 10.</strong> Hypothetical distribution of reservation yields among delegating stakers (dashed line). The distribution for solo stakers from the previous Figure 9 is also included (dotted line).</p>\n<p>To make comparisons easier, Figure 11 instead shows both distributions normalized to represent an equal share of all ETH. Still, remember that these curves are just an attempt to illustrate the ideas presented in the previous subsection, and as such are hypothetical. But this caveat might on the other hand always be applicable, even under more deliberate models. The relative comparison of distributions captures the notion that a smaller proportion of delegating stakers would be willing to stake at a negative yield, given the potential for adverse selection and less clear altruistic motive. But then the distribution might shoot up quicker than for solo stakers as the yield becomes positive, due to the favorable economies of scale of delegated staking. As the yield increases further, solo staking comes into play,  but then dwindles, because the last quantile of stakers are unwilling to give up liquidity or technically unable to solo stake. The proportion of solo stakers might thus vary intermittently.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/d/9/d925ec1e2e8ebaa5bbd273a65864dd38e3c7f31c.png\" data-download-href=\"https://ethresear.ch/uploads/default/d925ec1e2e8ebaa5bbd273a65864dd38e3c7f31c\" title=\"Figure 11\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/d/9/d925ec1e2e8ebaa5bbd273a65864dd38e3c7f31c_2_690x440.png\" alt=\"Figure 11\" data-base62-sha1=\"uYYRhdd9K8ka2TZYkc4EXT5D50g\" width=\"690\" height=\"440\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/d/9/d925ec1e2e8ebaa5bbd273a65864dd38e3c7f31c_2_690x440.png, https://ethresear.ch/uploads/default/optimized/3X/d/9/d925ec1e2e8ebaa5bbd273a65864dd38e3c7f31c_2_1035x660.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/d/9/d925ec1e2e8ebaa5bbd273a65864dd38e3c7f31c_2_1380x880.png 2x\" data-dominant-color=\"F9FBFA\"></a></div><p></p>\n<p><strong>Figure 11.</strong> Hypothetical distribution of reservation yields for solo stakers and delegating stakers, normalized to represent an equal share of all ETH.</p>\n<p>Having reviewed two hypothetical distributions, it is now time to review how the proportion of solo stakers evolves across staking yield under them. The cumulative distributions are then computed, seeing that a staker will stake at any yield above their reservation yield. These are shown in Figure 12. A way to understand these plots is that the initial distribution is treated as a probability density function (PDF), and its corresponding cumulative distribution function (CDF) then is computed.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/9/3/93e096f548a3831aaaf37ad43a856a15459f9c20.png\" data-download-href=\"https://ethresear.ch/uploads/default/93e096f548a3831aaaf37ad43a856a15459f9c20\" title=\"Figure 12\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/9/3/93e096f548a3831aaaf37ad43a856a15459f9c20_2_690x432.png\" alt=\"Figure 12\" data-base62-sha1=\"l6bmTGTNudfrRjqu47tXLZHmehG\" width=\"690\" height=\"432\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/9/3/93e096f548a3831aaaf37ad43a856a15459f9c20_2_690x432.png, https://ethresear.ch/uploads/default/optimized/3X/9/3/93e096f548a3831aaaf37ad43a856a15459f9c20_2_1035x648.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/9/3/93e096f548a3831aaaf37ad43a856a15459f9c20_2_1380x864.png 2x\" data-dominant-color=\"F8F9FA\"></a></div><p></p>\n<p><strong>Figure 12.</strong> Hypothetical cumulative distribution of reservation yields for solo stakers (dotted), delegating stakers (dashed), and in aggregate (full).</p>\n<p>The proportion of solo stakers is simply the solo staking CDF divided by the aggregate CDF, as shown in Figure 13. It is not asserted here that this particular outcome would materialize, but it is illustrative of the kind of concepts present in the debate. There is a higher proportion of solo stakers at negative yields, but then some valley at low staking yields due to economies of scale. It can emerge, e.g., if the delegating stakers’ assigned risk premium is more dispersed than the fixed cost structure of solo stakers. Proponents of a higher issuance level would suggest that this valley exists and is pronounced (when removing solo-staking airdrops), but there are many nuances beyond economies of scale to consider, as previously outlined. In any case, it is not clear that the effect would necessarily be that significant.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/f/8/f8a84787ba689a3a8ef081323ae4486cd24af15f.png\" data-download-href=\"https://ethresear.ch/uploads/default/f8a84787ba689a3a8ef081323ae4486cd24af15f\" title=\"Figure 13\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/f/8/f8a84787ba689a3a8ef081323ae4486cd24af15f_2_690x414.png\" alt=\"Figure 13\" data-base62-sha1=\"ztIWStkfTXiU2uFSU8U7apEix8r\" width=\"690\" height=\"414\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/f/8/f8a84787ba689a3a8ef081323ae4486cd24af15f_2_690x414.png, https://ethresear.ch/uploads/default/optimized/3X/f/8/f8a84787ba689a3a8ef081323ae4486cd24af15f_2_1035x621.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/f/8/f8a84787ba689a3a8ef081323ae4486cd24af15f_2_1380x828.png 2x\" data-dominant-color=\"FBFBFB\"></a></div><p></p>\n<p><strong>Figure 13.</strong> Hypothetical proportion of solo stakers across staking yield.</p>\n<p>Since each point of the supply curve represents the reservation yield of the marginal staker, the cumulative distribution of reservation yields actually corresponds to the supply curve. To make this clear, simply flip the axes of Figure 12 to have yield on the y-axis and stake on the x-axis. The supply curve then emerges in its more common presentation, as shown in blue in Figure 14. Two reward curves are included with no MEV—the current reward curve in black and the moderate reward curve with capped issuance at <span class=\"math\">D_c=</span> 15M ETH from a <a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#reward-curve-with-capped-issuance-pink-14\">previous answer</a>. Two hypothetical equilibria are indicated by squares, at the intersection of the aggregate supply curve and these reward curves. The participation ratio of solo stakers and delegating stakers are simply found along the horizontal line extending from the equilibrium, at the point where this line intersects the associated set supply curve (circles).</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/b/8/b8003d3d076f41753ef0acffd1f5b492318fba10.png\" data-download-href=\"https://ethresear.ch/uploads/default/b8003d3d076f41753ef0acffd1f5b492318fba10\" title=\"Figure 14\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/b/8/b8003d3d076f41753ef0acffd1f5b492318fba10_2_690x412.png\" alt=\"Figure 14\" data-base62-sha1=\"qfKmL1LY1lDXqC4nyd5hcEmLtC0\" width=\"690\" height=\"412\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/b/8/b8003d3d076f41753ef0acffd1f5b492318fba10_2_690x412.png, https://ethresear.ch/uploads/default/optimized/3X/b/8/b8003d3d076f41753ef0acffd1f5b492318fba10_2_1035x618.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/b/8/b8003d3d076f41753ef0acffd1f5b492318fba10_2_1380x824.png 2x\" data-dominant-color=\"F9F8FB\"></a></div><p></p>\n<p><strong>Figure 14.</strong> Cumulative distribution of reservation yields, here illustrated as a supply curve in blue, with flipped axes from Figure 12. Set supply curves for delegating stakers and solo stakers are also indicated. Stake participation of each class (circles) are found at the horizontal line extending from the equilibrium (squares).</p>\n<p>Note that the hypothetical distributions here presented only give one specific supply curve. Under another lower supply curve, the distributions would presumably be compressed such that many features, e.g., the transition to favoring delegated staking, emerge at a lower yield. I have been working for quite some time on a complex probabilistic model trying to unify these considerations, and hope to present it in a while. This topic is certain to receive further attention also from other researchers (e.g., <a href=\"https://cyber.fund/content/mvi-grants\">1</a>, <a href=\"https://ethereum-magicians.org/t/electra-issuance-curve-adjustment-proposal/18825/17\">2</a>, <a href=\"https://ethresear.ch/t/initial-analysis-of-stake-distribution/19014\">3</a>).</p>\n<h4><a name=\"equilibrium-yield-and-the-broader-composition-of-the-staking-set-27\" class=\"anchor\" href=\"https://ethresear.ch#equilibrium-yield-and-the-broader-composition-of-the-staking-set-27\"></a>Equilibrium yield and the broader composition of the staking set</h4>\n<p>The relationship between issuance level and diversity in SSPs also entails a <a href=\"https://twitter.com/weboftrees/status/1710723555476803643\">trade-off</a> between economies of scale and factors such as the positive network externality of the money function. Offering a positive yield beyond 30M ETH is helpful for alleviating concerns that a major SSP with a structural advantage such as a centralized exchange (CEX)—perhaps leveraging some hypothetical staked ETF—can push up their proportion of the stake to critical levels. At the same time, the risks of centralization around such entities should not be disproportionately emphasized over other risk scenarios. There are already today SSPs attaining critical proportions of the stake by leveraging network externalities onchain, ostensibly foregoing profits in the pursuit of monopolization. This type of structural advantage could also grow with higher issuance, and stifling that before native ETH possibly is in the minority relative to one LST must be considered as a net positive to the community. When weighing these trade-offs, an issuance level that invariably forces any outcome—whether a very low or very high quantity staked—does not seem desirable.</p>\n<p>Each SSP, reaching for a specific market segment, incurs unique costs besides the cost of running staking nodes, with a wide variety ranging from compliance to software. Indeed, CEXes have somewhat of a local monopoly on their customers-as-delegators, and the opportunity cost of keeping fees competitive with any onchain option is presumably so high that it does not represent the profit-maximizing strategy. What is clear is that competition for delegated stake will unfold across diverse market segments, and perfect competition is not a reasonable assumption. If the cost of operating a node is not prohibitively high relative to the income that the SSP can make from running it, then variety in preferences and circumstances between delegators will take a central role in shaping the composition of the staking set. The concern is therefore only valid with a yield that goes close to 0 or negative at a low quantity of stake. No SSP can reasonably outcompete all others at an equilibrium staking yield of, e.g., 2% at 30M ETH staked.</p>\n<h3><a name=\"what-is-the-endgame-issuance-policy-28\" class=\"anchor\" href=\"https://ethresear.ch#what-is-the-endgame-issuance-policy-28\"></a>What is the endgame issuance policy?</h3>\n<h4><a name=\"overview-29\" class=\"anchor\" href=\"https://ethresear.ch#overview-29\"></a>Overview</h4>\n<p>Certain parts of the endgame have a rather broad agreement. Firstly, Ethereum should transition to using <span class=\"math\">d</span> (referred to in this text as the deposit ratio or stake participation ratio) in the equation for the reward curve instead of <span class=\"math\">D</span> (deposit size or quantity staked). This can simply be done (<a href=\"https://x.com/weboftrees/status/1710728179260731715\">1</a>, <a href=\"https://warpcast.com/anderselowsson/0xad4454fd\">2</a>) by swapping out <span class=\"math\">D</span> for <span class=\"math\">d</span> in the equation for the reward curve, and normalizing by including the circulating supply at the time of the swap, once the circulating supply <a href=\"https://ethresear.ch/t/endgame-staking-economics-a-case-for-targeting/18751#how-to-set-the-target-in-relative-staking-ratio-instead-of-absolute-fixed-eth-amount-terms-20\">begins to be tracked</a> at the consensus layer. The main reason for this transition is that the long-run staking equilibrium under reward curves that adapt to <span class=\"math\">D</span> instead of <span class=\"math\">d</span> is ultimately also influenced by the <a href=\"https://ethresear.ch/t/circulating-supply-equilibrium-for-ethereum-and-minimum-viable-issuance-during-the-proof-of-stake-era/10954\">circulating supply equilibrium</a>, since the circulating supply will <a href=\"https://www.youtube.com/watch?v=LtEMabS0Oas&amp;t=1187s\">drift</a> to <a href=\"https://twitter.com/weboftrees/status/1710725744651825281\">balance</a> supply, demand, and protocol income.</p>\n<p>Secondly, Ethereum should pursue MEV burn. As explained in the previous answers (<a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#influence-of-mev-11\">1</a>, <a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#variability-for-solo-stakers-23\">2</a>), this will reduce relative variability and is a prerequisite for being able to reduce the staking yield substantially without causing too much concern for non-pooled stakers. As the answer soon turns to reduced issuance, it must be remembered that there is no direct financial motive for staking if the <a href=\"https://x.com/weboftrees/status/1710720809797407063\">endogenous staking yield</a> (MEV + issuance + airdrops) is negative. An equilibrium at negative issuance attracting a sufficiently large quantity of stake should thus still involve a positive expected endogenous yield. One concern is that the variability in MEV then involves non-pooled stakers taking on small losses each epoch while they wait for being assigned to special duties (note that variability in airdrops are not resolved by pooling). But there are many other reasons for MEV burn as well, as explored by <a href=\"https://notes.ethereum.org/cA3EzpNvRBStk1JFLzW8qg\">Francesco</a>, <a href=\"https://ethresear.ch/t/mev-burn-a-simple-design/15590\">Justin</a>, as well as <a href=\"https://ethresear.ch/t/dr-changestuff-or-how-i-learned-to-stop-worrying-and-love-mev-burn/17384\">Mike, Toni, and Justin</a>.</p>\n<p>The endgame when it comes to issuance level is currently a subject of debate but does indeed by all accounts involve an issuance reduction. The options can roughly be divided into five different categories:</p>\n<ol>\n<li><strong>Do nothing</strong>; an alternative that must always be part of the conversation, but which is becoming increasingly less attractive assuming that staking costs continue to fall and the quantity of stake increases further.</li>\n<li><strong>Temper issuance</strong>; but to a level that is perfectly sufficient also under the presence of MEV.</li>\n<li><strong>Cut issuance</strong>; an option situated in between (2) and (4). Does not institute an economic capping, but makes a high quantity of stake incredibly unlikely by lowering the yield substantially.</li>\n<li><strong>Economic capping</strong>, by letting the staking yield go to negative infinity at some desirable quantity of stake.</li>\n<li><strong>A time–quantity policy</strong>; where the reward curve is allowed to slowly alter/bend in response to changes in the supply curve.</li>\n</ol>\n<p>Among these options, (2) is becoming increasingly desirable at this point in my view. There is then a sliding scale from (3) to (4), where stricter reward curves are advantageous due to their ability to offer guarantees on the quantity of stake, while some restrictive settings at the same time also require more deliberations. There can be merits to an economic cap (4), ideally then after MEV burn, but in my view not at a too low quantity of stake. Some examples will be illustrated.  Category (5) has not yet received much study and will be presented a little deeper. The answer will now briefly review the philosophical underpinnings of the optimization problem, and then take a closer look at each of the five categories.</p>\n<h4><a name=\"philosophical-underpinnings-of-the-optimization-problem-30\" class=\"anchor\" href=\"https://ethresear.ch#philosophical-underpinnings-of-the-optimization-problem-30\"></a>Philosophical underpinnings of the optimization problem</h4>\n<p>The reward curve is in essence an attempt to optimize between all known trade-offs (long-run and short-run economic security, low costs, a viable composition of the staking set, reward variability, etc.), ensuring a utility-maximizing equilibrium under any supply curve. One way to understand the issue is thus that each hypothetical supply curve (low as well as high) has one optimal equilibrium, and the reward curve should intersect each supply curve at this point.</p>\n<p>In economics, an <a href=\"https://en.wikipedia.org/wiki/Expansion_path\">expansion path</a> connects optimal input combinations across output level, and an <a href=\"https://en.wikipedia.org/wiki/Income%E2%80%93consumption_curve\">income expansion path</a> selects the optimal consumption bundles across income. A suitable reward curve is the expansion path that optimizes all known trade-offs associated with high/low yield and stake participation across potential supply curves. <a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#a-fixed-target-participation-level-is-a-vertical-reward-curve-with-subpar-budgeting-18\">Figures 5-8</a> in a previous answer illustrated the concept under three supply curves at different levels, where an optimal equilibrium could be found under all three using a reward curve from endgame (3).</p>\n<p>As <a href=\"https://ethresear.ch/t/properties-of-issuance-level-consensus-incentives-and-variability-across-potential-reward-curves/18448/2\">framed by Vitalik</a> in a similar context: if a reward curve is designed such that some specific equilibrium is made possible, then that equilibrium should first have been deemed acceptable. In particular, it should ideally be the optimal equilibrium for the prevailing supply curve. But it must then also be noted that not only the <em>level</em>, but also the <em>shape</em> of the supply curve will matter. The reason is that the shape will influence which alternatives a specific equilibrium point can be substituted for when optimizing. There is a difference between the almost horizontal supply curve between 30M and 120M ETH in figures by <a href=\"https://ethresear.ch/t/endgame-staking-economics-a-case-for-targeting/18751#implications-of-targeting-14\">Caspar and Ansgar</a>, and the supply curves in this post that slope almost vertically upwards towards 120M ETH. In the former case, setting a negative yield at 30M ETH will seem like a more natural solution, because an economic cap at a low quantity of stake might not matter to solo stakers anyway, regardless of if the supply curve is lower or higher.</p>\n<h4><a name=\"h-1-do-nothing-31\" class=\"anchor\" href=\"https://ethresear.ch#h-1-do-nothing-31\"></a>1. Do nothing</h4>\n<p>This option remains valid while the quantity of stake remains reasonably close to 30M ETH (1/4 of the stake), previously discussed as a potential limit. There is a switching barrier associated with changing the issuance policy of a decentralized blockchain. The potential for discontent is higher if the switch takes place too close to previously discussed limits. But as mentioned in another answer, it seems reasonable to assume that the current quantity of stake of 32M ETH will not hold in the long run, as staking costs (broadly defined) fall. A threshold that would fit neatly with the notion of operating on powers of two is <span class=\"math\">2^{25}</span> ETH, corresponding to 33.6M ETH. Once this threshold is exceeded (or on the path of being exceeded) when doing nothing, then doing something seems like a better option to me.</p>\n<p>Excessive incentives for staking, beyond what is necessary for security, can unfortunately over time turn into <a href=\"https://en.wikipedia.org/wiki/Subsidy#Perverse_subsidies\">perverse subsidies</a>. In a scenario where the application layer is built around excessive staking yield, the Ethereum economy will arguably not have proper trustless foundations, as <a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#h-2-macro-perspective-7\">previously discussed</a>.</p>\n<p>One thing to keep track of before deciding to “not do nothing”, and to “do something”, is the progress of MEV burn. A reduction in issuance should not take place at the same hard fork as when incorporating MEV burn. If MEV burn is very close to being ready, then this can be accounted for under certain circumstances. But MEV burn is still at an early research stage. One path is therefore to shortly institute a moderate reduction in issuance, a year or two before MEV burn, and then let MEV burn make another dent in the staking yield.</p>\n<h4><a name=\"h-2-temper-issuance-32\" class=\"anchor\" href=\"https://ethresear.ch#h-2-temper-issuance-32\"></a>2. Temper issuance</h4>\n<p>This option is presented in a <a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#what-is-a-desirable-issuance-reduction-for-the-near-future-9\">previous answer</a>. In summary, it represents a “safe” issuance reduction that will not increase relative variability too much for non-pooled stakers, providing a relevant staking yield for stakers across the full range. The option provides a sufficiently big reduction in issuance to make the associated governance process worth it—and small enough to make that process potentially easier. The option will still substantially temper the growth in the quantity of stake. Together with MEV burn, it can reasonably constitute an endgame issuance policy, in the sense that the quantity of stake remains close to 30M ETH and firmly below 60M ETH. However, this does not mean that (2) necessarily must be an endgame. Reducing the issuance even further at higher quantities of stake as in (3) and (4) will after MEV burn seem like a reasonable option. However, proceeding further than (2), for example to (4), would then need to be a separate discussion. There is a simple “on-switch” that could be used for such a transition, as discussed in the associated <a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#h-4-economic-capping-34\">subsection</a>.</p>\n<h4><a name=\"h-3-cut-issuance-33\" class=\"anchor\" href=\"https://ethresear.ch#h-3-cut-issuance-33\"></a>3. Cut issuance</h4>\n<p>I refer here to the option situated in between economic capping and tempered issuance as “cut issuance”. The limits of this category are a bit diffuse, but it attempts to capture reward curves that are intended potentially for an Ethereum with MEV burn, that still does not pursue economic capping. Figure 15 shows three examples, with the pink curve close to category (2) and the violet reward curve bordering on category (4). The current reward curve is shown in black and the limits of the <a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#reward-curve-with-capped-issuance-pink-14\">capped issuance curves</a> that are part of (2) are indicated in grey for reference.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/1/a/1a87d89d8db34f6a5950f3d7f9e7432b152249b4.png\" data-download-href=\"https://ethresear.ch/uploads/default/1a87d89d8db34f6a5950f3d7f9e7432b152249b4\" title=\"Figure 15\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/1/a/1a87d89d8db34f6a5950f3d7f9e7432b152249b4_2_690x392.png\" alt=\"Figure 15\" data-base62-sha1=\"3MHsIPhmByxsaob4sdllU1D1vyQ\" width=\"690\" height=\"392\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/1/a/1a87d89d8db34f6a5950f3d7f9e7432b152249b4_2_690x392.png, https://ethresear.ch/uploads/default/optimized/3X/1/a/1a87d89d8db34f6a5950f3d7f9e7432b152249b4_2_1035x588.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/1/a/1a87d89d8db34f6a5950f3d7f9e7432b152249b4_2_1380x784.png 2x\" data-dominant-color=\"FAF9FA\"></a></div><p></p>\n<p><strong>Figure 15.</strong> Three reward curves that cut issuance substantially, without definitely capping stake participation.</p>\n<p>The pink and purple curves rely on the same strategy of making as small adjustments as possible to the current protocol, as <a href=\"https://ethresear.ch/t/properties-of-issuance-level-consensus-incentives-and-variability-across-potential-reward-curves/18448#h-52-exploration-of-alternative-reward-curves-20\">previously introduced</a>. The pink curve has the equation</p>\n<div class=\"math\">\ny_i = \\frac{cF}{\\sqrt{D}+(D/k)^2}\n</div>\n<p>with <span class=\"math\">k=2^{19}</span>. The purple curve has the equation</p>\n<div class=\"math\">\ny_i = \\frac{cF}{\\sqrt{D}(1+(D/k)^2)}\n</div>\n<p>with <span class=\"math\">k=38\\times10^6</span>. All reward curves in the figure have <span class=\"math\">F=64</span>. One idea behind these sorts of reward curves that would have a positive issuance yield across the full range also after MEV burn has been instituted is to provide guarantees to solo stakers that the issuance yield will always stay positive. Of course, the staking yield (issuance + MEV) should intuitively always stay positive, since there is no point in staking unless the <a href=\"https://x.com/weboftrees/status/1710720809797407063\">endogenous yield</a> is positive. But the guarantees here pertain to issuance yield, meaning that solo stakers might always be able to enjoy a positive yield on a more regular basis (even without being assigned as proposer from time to time) under circumstances where some MEV still remains (due to, e.g., a partial MEV burn or consensus layer preconfirmations).</p>\n<p>The violet curve subtracts <span class=\"math\">(D/k_2)^2</span> from the purple curve, with <span class=\"math\">k_2=9\\times10^8</span>. The effect is that the staking yield gradually turns negative, without ever going to negative infinity. This is a more restrained way to use negative yields. In reality the effects would be very similar. Some hypothetical benefits are that the equilibrium cannot happen at a point where the yield falls very sharply at the limit (influenced by a high MEV scenario) and that stakers will have better guarantees of not encountering a double-digit negative yield (which of course should not happen anyway). A downside is that there are no hard guarantees of capping the quantity of stake. Figure 16 shows the staking yield (inclusive of 300k ETH in execution layer rewards per year) and Figure 17 shows the issuance yield (no MEV).</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/2/f/2f98e52e5dca73a297848e9d17a7a7a3fa00522b.png\" data-download-href=\"https://ethresear.ch/uploads/default/2f98e52e5dca73a297848e9d17a7a7a3fa00522b\" title=\"Figure 16\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/2/f/2f98e52e5dca73a297848e9d17a7a7a3fa00522b_2_690x421.png\" alt=\"Figure 16\" data-base62-sha1=\"6N415QkIdBJSHrpElpWjdPsEaxB\" width=\"690\" height=\"421\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/2/f/2f98e52e5dca73a297848e9d17a7a7a3fa00522b_2_690x421.png, https://ethresear.ch/uploads/default/optimized/3X/2/f/2f98e52e5dca73a297848e9d17a7a7a3fa00522b_2_1035x631.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/2/f/2f98e52e5dca73a297848e9d17a7a7a3fa00522b_2_1380x842.png 2x\" data-dominant-color=\"FBF9FB\"></a></div><p></p>\n<p><strong>Figure 16.</strong> Staking yield under three reward curves that cut issuance.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/d/6/d6b587dda3da7de95e2bba2194c886e3414cef73.png\" data-download-href=\"https://ethresear.ch/uploads/default/d6b587dda3da7de95e2bba2194c886e3414cef73\" title=\"Figure 17\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/d/6/d6b587dda3da7de95e2bba2194c886e3414cef73_2_690x421.png\" alt=\"Figure 17\" data-base62-sha1=\"uDp6BeVqstzibbLE3RJuYW0saqv\" width=\"690\" height=\"421\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/d/6/d6b587dda3da7de95e2bba2194c886e3414cef73_2_690x421.png, https://ethresear.ch/uploads/default/optimized/3X/d/6/d6b587dda3da7de95e2bba2194c886e3414cef73_2_1035x631.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/d/6/d6b587dda3da7de95e2bba2194c886e3414cef73_2_1380x842.png 2x\" data-dominant-color=\"FAF9FA\"></a></div><p></p>\n<p><strong>Figure 17.</strong> Issuance yield under three reward curves that cut issuance.</p>\n<h4><a name=\"h-4-economic-capping-34\" class=\"anchor\" href=\"https://ethresear.ch#h-4-economic-capping-34\"></a>4. Economic capping</h4>\n<p>Economic capping was <a href=\"https://notes.ethereum.org/@vbuterin/single_slot_finality#Economic-capping-of-total-deposits\">introduced by Vitalik</a> as a way to guarantee that the quantity of stake does not grow beyond some set limit. A more extensive write-up on economic capping was recently provided by <a href=\"https://ethresear.ch/t/endgame-staking-economics-a-case-for-targeting/18751\">Caspar and Ansgar</a>, including the <a href=\"https://ethereum-magicians.org/t/electra-issuance-curve-adjustment-proposal/18825\">notion</a> of applying (4) after (2). Vitalik’s reward curve can be generalized to</p>\n<div class=\"math\">\ny_i = \\frac{cF}{\\sqrt{D}} - \\frac{cF_c}{\\sqrt{l-D}},\n</div>\n<p>here adapting the equation to a format that easily can be incorporated directly into the protocol spec. The first term is the current reward curve, and the second term is subtracted from it. Since the second term will go to infinity when the limit <span class=\"math\">l=D</span>, the staking yield will go to negative infinity at that point, capping the quantity of stake. Vitalik used <span class=\"math\">l=2^{25}</span>. The variable <span class=\"math\">F_c</span> shapes the magnitude of the reduction leading up to the cap, and was set to 32 in Vitalik’s curve (implied by <span class=\"math\">0.5\\times64</span> in his equation). Figures 18-21 show this reward curve in red.</p>\n<p>The first term of Vitalik’s equation can be swapped out for some other reward curve, as desired, to allow Ethereum to produce a desirable issuance in the critical region around 20M-40M ETH where an equilibrium is the most desirable. Using the purple curve from the previous subsection gives the equation</p>\n<div class=\"math\">\ny_i = \\frac{cF}{\\sqrt{D}(1+(D/k)^2)} - \\frac{cF_c}{\\sqrt{l-D}}.\n</div>\n<p>Figure 18 shows reward curves produced from this equation with a cap set at <span class=\"math\">l=</span> 60M ETH (1/2 of the stake; orange), <span class=\"math\">l=</span> 80M ETH (2/3 of the stake; yellow) and <span class=\"math\">l=</span> 90M ETH (3/4 of the stake; lime). All curves have <span class=\"math\">k=2^{26}</span> and <span class=\"math\">F_c=2^4</span>.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/a/c/acd10c958eb64613b93af29254285a5ae3e453a4.png\" data-download-href=\"https://ethresear.ch/uploads/default/acd10c958eb64613b93af29254285a5ae3e453a4\" title=\"Figure 18\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/a/c/acd10c958eb64613b93af29254285a5ae3e453a4_2_690x392.png\" alt=\"Figure 18\" data-base62-sha1=\"oEO0F16IN2LNZBqF901GosyHW1S\" width=\"690\" height=\"392\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/a/c/acd10c958eb64613b93af29254285a5ae3e453a4_2_690x392.png, https://ethresear.ch/uploads/default/optimized/3X/a/c/acd10c958eb64613b93af29254285a5ae3e453a4_2_1035x588.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/a/c/acd10c958eb64613b93af29254285a5ae3e453a4_2_1380x784.png 2x\" data-dominant-color=\"FAFAF9\"></a></div><p></p>\n<p><strong>Figure 18.</strong> Issuance under reward curves that institute economic capping. The red reward curve is Vitalik’s previous proposal, and the other three reward curves cap the deposit size at 60M ETH, 80M ETH and 90M ETH respectively.</p>\n<p>Figure 19 shows the staking yield (inclusive of 300k ETH in MEV per year) and Figure 20 shows the issuance yield (no MEV).</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/3/4/34bba12643b42be838c836a562b7d7b2ef8d21eb.png\" data-download-href=\"https://ethresear.ch/uploads/default/34bba12643b42be838c836a562b7d7b2ef8d21eb\" title=\"Figure 19\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/3/4/34bba12643b42be838c836a562b7d7b2ef8d21eb_2_690x421.png\" alt=\"Figure 19\" data-base62-sha1=\"7wuP0OmmHuRIGJ8IIah8zgZ9Fgv\" width=\"690\" height=\"421\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/3/4/34bba12643b42be838c836a562b7d7b2ef8d21eb_2_690x421.png, https://ethresear.ch/uploads/default/optimized/3X/3/4/34bba12643b42be838c836a562b7d7b2ef8d21eb_2_1035x631.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/3/4/34bba12643b42be838c836a562b7d7b2ef8d21eb_2_1380x842.png 2x\" data-dominant-color=\"FAFAF9\"></a></div><p></p>\n<p><strong>Figure 19.</strong> Staking yield including 300k ETH in MEV under reward curves that institute economic capping. The red reward curve is Vitalik’s previous proposal, and the other three reward curves cap the deposit size at 60M ETH, 80M ETH and 90M ETH respectively.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/1/3/13d0da8e236c04ff6086dcd429b85f6f56a2cf9a.png\" data-download-href=\"https://ethresear.ch/uploads/default/13d0da8e236c04ff6086dcd429b85f6f56a2cf9a\" title=\"Figure 20\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/1/3/13d0da8e236c04ff6086dcd429b85f6f56a2cf9a_2_690x421.png\" alt=\"Figure 20\" data-base62-sha1=\"2PixpTquehkzBOMqOE29Jplb5AS\" width=\"690\" height=\"421\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/1/3/13d0da8e236c04ff6086dcd429b85f6f56a2cf9a_2_690x421.png, https://ethresear.ch/uploads/default/optimized/3X/1/3/13d0da8e236c04ff6086dcd429b85f6f56a2cf9a_2_1035x631.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/1/3/13d0da8e236c04ff6086dcd429b85f6f56a2cf9a_2_1380x842.png 2x\" data-dominant-color=\"FAFAF9\"></a></div><p></p>\n<p><strong>Figure 20.</strong> Issuance yield under reward curves that institute economic capping. The red reward curve is Vitalik’s previous proposal, and the other three reward curves cap the deposit size at 60M ETH, 80M ETH and 90M ETH respectively.</p>\n<p>A cap at a low quantity of stake under MEV is not desirable, due to among other things the high relative variability, as discussed in previous answers (<a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#influence-of-mev-11\">1</a>, <a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#variability-for-solo-stakers-23\">2</a>). In my view, if Ethereum is to pursue economic capping, then reward curves that institute the cap at or above 60M ETH seem more promising, even after MEV burn. This will allow the quantity of stake to expand somewhat under particularly low supply curves. Yet, having a cap offers an ultimate guarantee and this can be very useful from a <a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#h-2-macro-perspective-7\">macro perspective</a>. At some higher stake participation, the <a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#philosophical-underpinnings-of-the-optimization-problem-30\">expansion path</a> should therefore arguably venture into negative issuance yields (which will still lead to a <a href=\"https://x.com/weboftrees/status/1710720809797407063\">positive endogenous staking yield</a> under equilibrium), and this expansion path could then ultimately reach such a low negative territory that it can only be reached with an economic cap. In simpler terms, the negative aspects of stake participation growing very large are worse than the negative aspects of having a very low issuance yield.</p>\n<p>A beneficial feature of the presented equation system is that the cap would not involve some completely new equation, and can instead be conceived of as an “on-switch” when moving from (2) to (4). An example is shown in Figure 21, where the <a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#reward-curve-with-tempered-issuance-green-13\">previously presented</a> dashed green tempered issuance curve is updated by simply adding Vitalik’s cap term with <span class=\"math\">l</span> equal to 60M ETH, 80M ETH and 90M ETH respectively, setting <span class=\"math\">F_c=10</span>.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/f/a/fa300b09b139ef69a04bb500e66bf232faca0f9e.png\" data-download-href=\"https://ethresear.ch/uploads/default/fa300b09b139ef69a04bb500e66bf232faca0f9e\" title=\"Figure 21\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/f/a/fa300b09b139ef69a04bb500e66bf232faca0f9e_2_690x421.png\" alt=\"Figure 21\" data-base62-sha1=\"zHgizkNAh756uTllitMcAxG4xA2\" width=\"690\" height=\"421\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/f/a/fa300b09b139ef69a04bb500e66bf232faca0f9e_2_690x421.png, https://ethresear.ch/uploads/default/optimized/3X/f/a/fa300b09b139ef69a04bb500e66bf232faca0f9e_2_1035x631.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/f/a/fa300b09b139ef69a04bb500e66bf232faca0f9e_2_1380x842.png 2x\" data-dominant-color=\"F9FAF9\"></a></div><p></p>\n<p><strong>Figure 21.</strong> Switching on an economic cap. The reward curve with tempered issuance illustrated by a dashed green line is updated by adding a cap term limiting the quantity of stake to 60M ETH, 80M ETH and 90M ETH respectively (full green lines). Vitalik’s original reward curve for economic capping is shown in red.</p>\n<h4><a name=\"h-5-time-quantity-policy-35\" class=\"anchor\" href=\"https://ethresear.ch#h-5-time-quantity-policy-35\"></a>5. Time–quantity policy</h4>\n<p>Adding the dimension of <em>time</em> to the dimension of <em>quantity</em> is also worthy of consideration as an endgame, as described in the last paragraph of <a href=\"https://ethresear.ch/t/reward-curve-with-tempered-issuance-eip-research-post/19171#h-63-the-unknown-endgame-39\">Section 6.3</a> of a previous write-up. Under a time–quantity policy, the reward curve facing the user on shorter time scales can have a moderate predefined shape, but the whole curve is allowed to <a href=\"https://x.com/weboftrees/status/1710728448543523219\">gradually adapt</a> to changes in the supply curve, implied by the equilibrium. The mechanism is enforced by letting one or two of the variables defining the curve drift as a response to the deposit ratio deviating from some target. This drift can trivially be instituted as a small tick change each epoch, with a size that may or may not depend on the scale of the deviation.</p>\n<p>One key realization is that the reward curve variables should change slowly, with larger effects taking place at a time scale of years or even decades. There are a few reasons for this, related to issues discussed in a <a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#why-not-dynamically-adjust-the-yield-with-a-mechanism-like-eip-1559-to-guarantee-some-fixed-target-participation-level-16\">previous answer</a> when targeting a fixed quantity of stake. Discouragement attacks and cartelization attacks may become less attractive if there is no immediate response in terms of an issuance increase. Furthermore, the protocol will produce a more stable yield if the short-run reward curve is flatter. From a communication perspective, the mechanism always provides a clear trajectory, whereas trying to rely <em>only on time</em> makes issuance trajectories harder to interpret. Finally, the mechanism provides a natural way to transition from one issuance policy to another without causing disruptions. One clear downside is added complexity in the design. As will be shown by the end of this subsection, it is also possible to more strictly retain the notion of budgeting by not relying on a fixed target, instead relying on an underlying target reward curve.</p>\n<p>Figure 22 shows yearly issuance under a time–quantity policy. For this example, the reward curve with tempered issuance <a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#reward-curve-with-tempered-issuance-green-13\">previously presented</a> was used as a potential starting point in dashed green. A target of 30M ETH is marked by a dark grey vertical line, situated in between the blue crosses. If the quantity of stake is higher than the target, a cap similar to those described in the previous subsection slowly comes into play, gradually shifting the reward curve as indicated in light green, pushing down the yield. Over infinite time, with some fixed supply curve, the equilibrium will be situated either on the grey vertical line or the black curves at the edge that describes the maximum and minimum allowed settings for the reward curve. In this example, that corresponds to the current reward curve as a maximum and a cap at 80M ETH as the minimum (2/3 of the stake). It should be noted that a time–quantity policy does not require that the minimum reward curve institutes economic capping. In a way, this strategy is even more suitable in scenarios where there is no definite guarantee of some cap anyway.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/2/9/2967cb780e20fb051e64a7bbf7198bcc7baf67b5.png\" data-download-href=\"https://ethresear.ch/uploads/default/2967cb780e20fb051e64a7bbf7198bcc7baf67b5\" title=\"Figure 22\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/2/9/2967cb780e20fb051e64a7bbf7198bcc7baf67b5_2_690x411.png\" alt=\"Figure 22\" data-base62-sha1=\"5UhXfpLpw9Z5SKV3OxD8z4wW9BH\" width=\"690\" height=\"411\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/2/9/2967cb780e20fb051e64a7bbf7198bcc7baf67b5_2_690x411.png, https://ethresear.ch/uploads/default/optimized/3X/2/9/2967cb780e20fb051e64a7bbf7198bcc7baf67b5_2_1035x616.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/2/9/2967cb780e20fb051e64a7bbf7198bcc7baf67b5_2_1380x822.png 2x\" data-dominant-color=\"F8FAF9\"></a></div><p></p>\n<p><strong>Figure 22.</strong> Issuance under a time–quantity policy with a cap. The issuance level will react to changes in the deposited stake along the trajectory of the green reward curves. However, over infinite time scales, if the supply curve is held fixed, the reward curve adjusts such that it enforces an equilibrium along the black path.</p>\n<p>The same policy is shown in Figure 23 for issuance yield. On an infinite time scale, the user would be facing a reward curve constituting the upper black curve, followed by the grey vertical line, and concluding with the lower black curve. However, at a time scale of months or perhaps a year or two, the user faces a reward curve along one of the green faint lines, which instantly reacts to direct changes in the quantity of stake. Over time scales of several years, the user faces something in between—a smoothed-out version of the current trajectory, drifting towards the black and grey parts of the reward curve.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/3/8/3873c05b46373aa8710e704853aaf6fa7b99455f.png\" data-download-href=\"https://ethresear.ch/uploads/default/3873c05b46373aa8710e704853aaf6fa7b99455f\" title=\"Figure 23\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/3/8/3873c05b46373aa8710e704853aaf6fa7b99455f_2_690x422.png\" alt=\"Figure 23\" data-base62-sha1=\"83oJxEiklAX55BNkAk0vG3G8IvJ\" width=\"690\" height=\"422\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/3/8/3873c05b46373aa8710e704853aaf6fa7b99455f_2_690x422.png, https://ethresear.ch/uploads/default/optimized/3X/3/8/3873c05b46373aa8710e704853aaf6fa7b99455f_2_1035x633.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/3/8/3873c05b46373aa8710e704853aaf6fa7b99455f_2_1380x844.png 2x\" data-dominant-color=\"F8FAF8\"></a></div><p></p>\n<p><strong>Figure 23.</strong> Issuance yield under a time quantity policy with a cap. A further description is provided in the figure text of Figure 22.</p>\n<p>One idea behind the time–quantity policy is that the supply curve might slowly fall as the relative costs associated with staking decrease, and that we cannot then enforce some specific quantity of stake over time without having the reward curve close to vertical. As previously discussed, one reason why a vertical reward curve seems undesirable is the high “<span class=\"math\">p_i</span>-elasticity” that it brings.</p>\n<p>Even if some specific quantity of stake is optimal, there might also be budgeting considerations in the long run. After all, the notion of not overpaying for security was stipulated as a benefit of using a reward curve in the first place. Figure 24 shows issuance under a smooth time–quantity policy with a cap. It attempts to achieve the best of both worlds: a stricter range in the long run that still has some notion of budgeting incorporated; a flatter reward curve for the short run, moderating fluctuations in yield/issuance, and budgeting based on recent steady states of the supply curve. The black curve is the target reward curve at infinite time scales. In the short run, the protocol will still operate according to a green reward curve, adapting the yield to a change in the quantity of stake.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/d/2/d21549907a63ac113784b2290f2acb935f37b0ba.png\" data-download-href=\"https://ethresear.ch/uploads/default/d21549907a63ac113784b2290f2acb935f37b0ba\" title=\"Figure 24\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/d/2/d21549907a63ac113784b2290f2acb935f37b0ba_2_690x411.png\" alt=\"Figure 24\" data-base62-sha1=\"tYtSmf91wNu0ZVy7ipgIecps3RE\" width=\"690\" height=\"411\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/d/2/d21549907a63ac113784b2290f2acb935f37b0ba_2_690x411.png, https://ethresear.ch/uploads/default/optimized/3X/d/2/d21549907a63ac113784b2290f2acb935f37b0ba_2_1035x616.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/d/2/d21549907a63ac113784b2290f2acb935f37b0ba_2_1380x822.png 2x\" data-dominant-color=\"F9FAF9\"></a></div><p></p>\n<p><strong>Figure 24.</strong> Issuance under a smooth time–quantity policy with a cap. The issuance level will react to changes in the deposited stake along the trajectory of the green reward curves. However, over infinite time scales, if the supply curve is held fixed, the reward curve adjusts such that it enforces an equilibrium along the black path.</p>\n<p>The same policy is shown in Figure 25 for issuance yield.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/0/6/06393998baef620274207416cf58d2397685a60d.png\" data-download-href=\"https://ethresear.ch/uploads/default/06393998baef620274207416cf58d2397685a60d\" title=\"Figure 25\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/0/6/06393998baef620274207416cf58d2397685a60d_2_690x422.png\" alt=\"Figure 25\" data-base62-sha1=\"T3t425ZRKzGCpElAPBO9KLZMbr\" width=\"690\" height=\"422\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/0/6/06393998baef620274207416cf58d2397685a60d_2_690x422.png, https://ethresear.ch/uploads/default/optimized/3X/0/6/06393998baef620274207416cf58d2397685a60d_2_1035x633.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/0/6/06393998baef620274207416cf58d2397685a60d_2_1380x844.png 2x\" data-dominant-color=\"F8F9F8\"></a></div><p></p>\n<p><strong>Figure 25.</strong> Issuance under a smooth time–quantity policy with a cap. A further description is provided in the figure text of Figure 24.</p>\n<p>Time–quantity policies have not yet been researched and debated, and whether or not the added complexity is worth it will be resolved during future discussions.</p>\n<h3><a name=\"why-not-just-prevent-new-stakers-from-joining-36\" class=\"anchor\" href=\"https://ethresear.ch#why-not-just-prevent-new-stakers-from-joining-36\"></a>Why not just prevent new stakers from joining?</h3>\n<p>Someone in control of a validator then holds a “staking license”, akin to a taxi license or a rental apartment under rent control. This will create side markets, and solo stakers are not necessarily well-suited for navigating those conditions. Such a quasi-permissioned system will generally enable stakers “on the inside” to exercise undue control over the chain and can lead to rent-seeking behavior.</p>\n<h3><a name=\"can-stakers-profit-from-a-reduced-issuance-and-what-is-the-relevance-and-impact-of-the-realproportional-yield-37\" class=\"anchor\" href=\"https://ethresear.ch#can-stakers-profit-from-a-reduced-issuance-and-what-is-the-relevance-and-impact-of-the-realproportional-yield-37\"></a>Can stakers profit from a reduced issuance and what is the relevance and impact of the real/proportional yield?</h3>\n<h4><a name=\"overview-38\" class=\"anchor\" href=\"https://ethresear.ch#overview-38\"></a>Overview</h4>\n<p>Stakers hold the underlying ETH, and can <a href=\"https://ethresear.ch/t/reward-curve-with-tempered-issuance-eip-research-post/19171#h-64-the-proportion-that-matters-to-eth-holders-40\">profit</a> if an issuance reduction improves Ethereum such that the native asset becomes more valuable. Furthermore, stakers are diluted from newly issued tokens just like everyone else. Therefore, if a high issuance compels many to stake, those that would have staked also at a lower issuance—with fewer stakers competing for the yield—might benefit at a lower issuance. It is by no means certain that the proportion of the ETH that a remaining staker attains will increase from a reduction in issuance (positive <span class=\"math\">y_p</span> as defined below), but any potential loss will be much more modest than what is implied by the change in issuance yield. The condition is illustrated with an isoproportion map in Figure 28.</p>\n<h4><a name=\"welfare-gain-stakers-as-eth-owners-39\" class=\"anchor\" href=\"https://ethresear.ch#welfare-gain-stakers-as-eth-owners-39\"></a>Welfare gain – stakers as ETH owners</h4>\n<p>When discussing the effect of issuance policy on stakers, it is first important to recognize that they own the underlying ETH. The native asset of a well-designed decentralized blockchain is more valuable than that of a poorly designed one. In the following subsections, the proportional yield/real yield will be analyzed, accounting for issuance and burn. But it is ultimately Ethereum’s ability to power the world economy that will affect the ETH token holder the most, including the staker. The real “real yield” incorporates the change in value of the underlying ETH—including any staking yield—relative to a relevant consumer price index. It is indeed very useful to have sound native money in an economic system. And the best sound money will not encumber its users to research the reliability of various SSPs, track staking income and see it taxed, or risk being wiped out in a slashing event or other failure.</p>\n<h4><a name=\"proportional-yield-40\" class=\"anchor\" href=\"https://ethresear.ch#proportional-yield-40\"></a>Proportional yield</h4>\n<p>Review Figure 26, an updated version of <a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#h-1-reduced-costs-raise-welfare-6\">Figure 1</a>. Once again, the effect of a change in issuance under equilibrium is reviewed, with the welfare improvement represented by the dark blue area. The height of the dark grey area represents the loss in yield <span class=\"math\">y</span> for stakers, captured by the red arrow. But when issuance is reduced, everyone is also rewarded with a proportional share of the combined dark blue and dark grey area, in the form of a reduction to the issuance rate <span class=\"math\">i</span>.</p>\n<p>The figure illustrates the impact of a change in issuance on ETH holders by taking the dark blue area and the dark grey area and creating a rectangle extending across the full circulating supply (120M ETH). All token holders gain according to the height of this area, shown by an orange arrow. If that height surpasses the height of the dark grey area, the staker will gain a higher proportion of the circulating supply from a reduction in issuance, otherwise it will not.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/c/0/c07e23557a6d6ede60faa43a1ac3b99052814a83.png\" data-download-href=\"https://ethresear.ch/uploads/default/c07e23557a6d6ede60faa43a1ac3b99052814a83\" title=\"Figure 26\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/c/0/c07e23557a6d6ede60faa43a1ac3b99052814a83_2_673x500.png\" alt=\"Figure 26\" data-base62-sha1=\"rsRVh41GVKGUQEih9bC3Uc4eRVh\" width=\"673\" height=\"500\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/c/0/c07e23557a6d6ede60faa43a1ac3b99052814a83_2_673x500.png, https://ethresear.ch/uploads/default/optimized/3X/c/0/c07e23557a6d6ede60faa43a1ac3b99052814a83_2_1009x750.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/c/0/c07e23557a6d6ede60faa43a1ac3b99052814a83_2_1346x1000.png 2x\" data-dominant-color=\"E7E7F4\"></a></div><p></p>\n<p><strong>Figure 26.</strong> Implied cost (blue) and surplus (grey) of staking under a hypothetical future supply curve. A change in issuance policy shifts the equilibrium from the black square to the green circle. The cost reduction (dark blue) leads to aggregate welfare improvement as long as the protocol remains secure and decentralized, and the reduction in surplus (dark grey) simply shifts some utility from stakers to everyone. The remaining stakers lose out on yield (red arrow). They however gain from a reduction in the inflation rate (orange arrow), represented by the combined dark blue and grey area extended across the full 120M ETH supply.</p>\n<p>The issuance rate is formed as <span class=\"math\">i=y_id</span>, where <span class=\"math\">y_i</span> is the issuance yield and <span class=\"math\">d</span> is the proportion of the circulating supply that is staked. It was indeed the change in both <span class=\"math\">d</span> and <span class=\"math\">y_i</span> that determined the height of the orange arrow in Figure 26 (the change in <span class=\"math\">i</span>). The issuance rate affects the circulating supply inflation rate according to <span class=\"math\">s=i-b</span>. In essence, <span class=\"math\">s</span> captures the percentage change over a year to how many ETH that exist. This means that <span class=\"math\">s</span> rises if the issuance rate is high. Conversely, <span class=\"math\">s</span> falls if a lot of ETH is burned through EIP-1559; this post will use the approximate burn rate <span class=\"math\">b=0.008</span> since The Merge in the examples. The effect on token holders can be calculated using the equation presented in my <a href=\"https://notes.ethereum.org/@anderselowsson/MinimumViableIssuance#Benefits-of-MVI-to-user-utility\">thread</a> on minimum viable issuance:</p>\n<div class=\"math\">\ny_p = \\frac{1+y}{1+s}-1.\n</div>\n<p>The proportional yield <span class=\"math\">y_p</span>, also referred to as the <a href=\"https://ethresear.ch/t/endgame-staking-economics-a-case-for-targeting/18751#real-yield-the-real-deal-10\">real yield</a> can be computed for both stakers and non-stakers, in the latter case with <span class=\"math\">y=0</span>. It can be interpreted as the <a href=\"https://en.wikipedia.org/wiki/Fisher_equation\">Fisher equation</a> adapted to Ethereum. A simple approximation, applicable at lower yields, is <span class=\"math\">y_p=y-s</span>.</p>\n<h4><a name=\"illustrating-the-change-in-welfare-and-proportional-yield-41\" class=\"anchor\" href=\"https://ethresear.ch#illustrating-the-change-in-welfare-and-proportional-yield-41\"></a>Illustrating the change in welfare and proportional yield</h4>\n<p>Figure 27 again illustrates what happens under a reduction in issuance to ETH holders, using the same supply and demand curves as in Figure 26. There are three categories: the remaining <em>stakers</em>, the <em>de-stakers</em> between the green circle and black square on the supply curve, and those who were <em>non-stakers</em> already from the beginning. The idea is to compare <span class=\"math\">y_p</span> at the two different equilibria for all token holders, as it changes from <span class=\"math\">y^b_p</span> (black square) to <span class=\"math\">y^a_p</span> (green circle). If <span class=\"math\">y^a_p</span> is higher, the token holder benefits, otherwise it incurs losses. The comparison gives a change in cardinal utility as</p>\n<div class=\"math\">\nu’=\\frac{1+y^a_p}{1+y^b_p}-1.\n</div>\n<p>However, one addition is required: use the <a href=\"https://notes.ethereum.org/@anderselowsson/MinimumViableIssuance#Benefits-of-MVI-to-user-utility\">reservation yield</a> as <span class=\"math\">y</span> for those who stop staking when computing <span class=\"math\">y^a_p</span>. Below that yield, they do not stake anyway, so they suffer no additional loss in utility as the yield decreases further. As shown in the bottom pane, de-stakers will under this definition derive a higher utility at the new equilibrium, with non-stakers clearly better off.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/a/2/a2330abe0b83f23e396a5e32c03e02f69a7aee2b.png\" data-download-href=\"https://ethresear.ch/uploads/default/a2330abe0b83f23e396a5e32c03e02f69a7aee2b\" title=\"Figure 27\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/a/2/a2330abe0b83f23e396a5e32c03e02f69a7aee2b_2_690x465.png\" alt=\"Figure 27\" data-base62-sha1=\"n8SHQ8LwP2pE0XzKcGD7cC2eoqf\" width=\"690\" height=\"465\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/a/2/a2330abe0b83f23e396a5e32c03e02f69a7aee2b_2_690x465.png, https://ethresear.ch/uploads/default/optimized/3X/a/2/a2330abe0b83f23e396a5e32c03e02f69a7aee2b_2_1035x697.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/a/2/a2330abe0b83f23e396a5e32c03e02f69a7aee2b_2_1380x930.png 2x\" data-dominant-color=\"F7F6F6\"></a></div><p></p>\n<p><strong>Figure 27.</strong> The change in <span class=\"math\">y</span> and <span class=\"math\">s</span> between two hypothetical equilibria is utilized to isolate a change in cardinal utility <span class=\"math\">u'</span> for all token holders. Stakers are subjected to a reduction in yield <span class=\"math\">y</span>, but the reduction in the inflation rate <span class=\"math\">s</span> is similar, so they are left unaffected (<span class=\"math\">y_p</span> stays the same). De-stakers incur no further loss in utility once <span class=\"math\">y</span> falls below their reservation yield. They benefit together with non-stakers from the reduction in <span class=\"math\">s</span>.</p>\n<p>The orange arrows in the bottom pane once again illustrate how a reduction in <span class=\"math\">s</span> increases utility for everyone—that’s from removing the dark grey and dark blue areas in the previous figure. The red arrows illustrate how a decrease in yield reduces utility for stakers, corresponding to the height of that dark grey area in Figure 26. For the de-stakers, the red arrows become very short as that dark grey area narrows, even though they forfeited all yield. That’s because their costs went to 0 as well.</p>\n<p>The height of <span class=\"math\">u’</span> thus captures the change in <span class=\"math\">y_p</span> for stakers and non-stakers, and the size of the orange area captures the welfare gain, ultimately deriving from a cost reduction to Ethereum’s users (note that the orange area extends further up to 120M ETH). While stakers may be left unaffected by a reduction in issuance in terms of the proportion of the circulating supply they retain, they can <a href=\"https://notes.ethereum.org/@anderselowsson/Foundations-of-MVI#Let-the-best-money-win\">still gain</a>, because the utility of the ETH asset has increased, in accordance with the size of the orange region. The purpose of <a href=\"https://notes.ethereum.org/@anderselowsson/MinimumViableIssuance#Benefits-of-MVI-to-user-utility\">introducing</a> this figure in my original thread on minimum viable issuance was to encapsulate these insights (welfare gain + proportional yield) in one plot.</p>\n<h4><a name=\"the-isoproportion-map-42\" class=\"anchor\" href=\"https://ethresear.ch#the-isoproportion-map-42\"></a>The isoproportion map</h4>\n<p>Clearly the shape of the supply curve will be influential when determining if stakers gain from a reduction in issuance. Stakers benefit from an issuance increase under steep supply curves where no new stakers enter if the yield <span class=\"math\">y</span> goes up. Stakers do not benefit under flat supply curves where a slight bump to the yield makes a ton of new stakers enter, creating circulating supply inflation <span class=\"math\">s</span> in the process. In economics, it is common to use diagrams to illustrate trade-offs by drawing lines along which conditions remain constant, similar to contour lines on a topographical map indicating equal elevation. Figure 28 shows such a map, with “isoproportion lines” indicating where <span class=\"math\">y_p</span> stays the same. Each line is drawn according to the following equation:</p>\n<div class=\"math\">\ny = \\frac{y_p-(1+y_p)(v+b)}{1-d-y_pd},\\quad \\quad  y_p&lt;\\frac{1-d}{d}.\n</div>\n<p>It is <a href=\"https://ethresear.ch/t/reward-curve-with-tempered-issuance-eip-research-post/19171#h-44-the-isoproportion-map-28\">formed</a> by reworking the equation for <span class=\"math\">y_p</span>. The variable <span class=\"math\">v</span> here represents the “MEV rate” constituting MEV as a proportion of the circulating supply. The equation implies the basic condition for profitability that can be imposed on the supply curve under any equilibrium (e.g., via derivation and analysis of elasticities).</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/a/f/af7fe425f7474fe388e4544ac9a9bcc0d5f5f701.jpeg\" data-download-href=\"https://ethresear.ch/uploads/default/af7fe425f7474fe388e4544ac9a9bcc0d5f5f701\" title=\"Figure 28\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/a/f/af7fe425f7474fe388e4544ac9a9bcc0d5f5f701_2_690x414.jpeg\" alt=\"Figure 28\" data-base62-sha1=\"p2xyU3xKDVLoIWTmNLsRHggH0pb\" width=\"690\" height=\"414\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/a/f/af7fe425f7474fe388e4544ac9a9bcc0d5f5f701_2_690x414.jpeg, https://ethresear.ch/uploads/default/optimized/3X/a/f/af7fe425f7474fe388e4544ac9a9bcc0d5f5f701_2_1035x621.jpeg 1.5x, https://ethresear.ch/uploads/default/optimized/3X/a/f/af7fe425f7474fe388e4544ac9a9bcc0d5f5f701_2_1380x828.jpeg 2x\" data-dominant-color=\"F7F6F6\"></a></div><p></p>\n<p><strong>Figure 28.</strong> An isoproportion map illustrating the conditions under which stakers can attain a higher proportion of the circulating supply from a change in issuance policy. If the slope of the corresponding grey isoproportion line is steeper than the slope of the supply curve under equilibrium, stakers benefit from a reduction in issuance. The red area is at a lower elevation on the map than the orange area even though the staking yield is higher, and thus a worse equilibrium for stakers.</p>\n<p>Review the purple dashed isoporoportion line. Stakers get a real staking yield of 1.7% anywhere on this line, although the staking yield and stake participation vary. The red region lies below the line, so ending up there is worse for stakers than ending up in the orange region above the line, even though the staking yield is higher in the entire red region than in the orange region. When nearly everyone stakes, the supply curve must be almost vertical for stakers to benefit from an increase in issuance yield, since the supply inflation rate will increase nearly as much. The orange arrow points towards higher elevation on the isoproportion map, and the ideal equilibrium for stakers lies in the top left corner. But unfortunately for stakers, an equilibrium must lie on the supply curve. Now look at the purple full isoproportion line.</p>\n<p>The hypothetical supply curve in blue from the earlier Figures 26-27 intersects both the current reward curves (black) and reward curve with tempered issuance (green) along this line—the equilibria (black square and green circle) are thus at the same “elevation”. This explains why stakers were unaffected in the previous discussion. The highest elevation of the supply curve is marked by a blue star, situated between the two equilibria.  At this point, the supply curve is tangent to the corresponding isoproportion line. Plots by <a href=\"https://ethereum-magicians.org/t/electra-issuance-curve-adjustment-proposal/18825#proposal-for-electra-issuance-curve-adjustment-3\">Caspar and Ansgar</a> as well as <a href=\"https://notes.ethereum.org/@mikeneuder/subsol#3-Scaled-Root-Curve-alternative-issuance\">Mike</a> of the green reward curve are useful for showing how its elevation (<span class=\"math\">y_p</span>) varies across stake participation (without incorporating MEV or burn). This is akin to sampling its value from the map across stake participation.</p>\n<p>How might the supply curve evolve going forward? Use your intuition to outline its shape and check where your imaginary supply curve reaches the highest elevation on the map (as marked by the star). That’s where the reward curve should intersect the supply curve for stakers to gain the highest proportion of the circulating supply. However, also remember the lessons from the earlier discussion: stakers also gain by holding the native token of a well-designed cryptocurrency that remains secure and imposes low aggregate costs on its users.</p>\n<h3><a name=\"some-users-think-that-more-yield-is-more-fun-and-like-to-collect-yield-on-their-eth-why-not-lean-into-this-43\" class=\"anchor\" href=\"https://ethresear.ch#some-users-think-that-more-yield-is-more-fun-and-like-to-collect-yield-on-their-eth-why-not-lean-into-this-43\"></a>Some users think that more yield is more fun and like to collect yield on their ETH. Why not lean into this?</h3>\n<p>This answer will extend the previous answers (<a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#can-stakers-profit-from-a-reduced-issuance-and-what-is-the-relevance-and-impact-of-the-realproportional-yield-37\">1</a>, <a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675#h-1-reduced-costs-raise-welfare-6\">2</a>), and the reader is encouraged to first review them to understand how excessive issuance as well as dilution affects token holders.</p>\n<p>The notion of <a href=\"https://en.wikipedia.org/wiki/Behavioral_economics#Bounded_rationality\">bounded rationality</a> helps to explain why some users may prefer a scenario with lower <span class=\"math\">y_p</span>, where the yield is raised but the supply inflation rate (which users have a harder time to track) rises even more. Behavioral economics can be helpful in this way for explaining why some economic agents act irrationally, perhaps for lack of education or time to deliberate on a topic. But Ethereum should not harness people’s bounded understanding of yield, and keep it high to trick users into thinking that they gain something, when they do in fact not. It is instead important to educate people on these matters so that user utility is not degraded for some hypothetical short-term gain, which is unlikely to materialize. More yield is not more fun. An optimally designed Ethereum is more fun.</p>\n            <p><small>1 post - 1 participant</small></p>\n            <p><a href=\"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675\">Read full topic</a></p>","link":"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675","pubDate":"Wed, 29 May 2024 15:20:10 +0000","discourse:topicPinned":"No","discourse:topicClosed":"No","discourse:topicArchived":"No","guid":{"@isPermaLink":"false","#text":"ethresear.ch-topic-19675"},"source":{"@url":"https://ethresear.ch/t/faq-ethereum-issuance-reduction/19675.rss","#text":"FAQ: Ethereum issuance reduction"},"filter":false},{"title":"Big blocks, blobs, and reorgs","dc:creator":"Nero_eth","category":"Sharding","description":"<h1><a name=\"big-blocks-blobs-and-reorgs-1\" class=\"anchor\" href=\"https://ethresear.ch#big-blocks-blobs-and-reorgs-1\"></a>Big blocks, blobs, and reorgs</h1>\n<p>With <a href=\"https://www.eip4844.com/\">EIP-4844</a> going live, Ethereum effectively increased its transaction throughput by providing dedicated space for rollups to post their data down to L1.</p>\n<p>Blobs are now the main contributor to the block size, while the average beacon block size (excluding blobs) went down from ~<span class=\"math\">125</span> KB to ~<span class=\"math\">90</span> KB.</p>\n<p><strong>In the chart below, one can see the impact of blobs on the data throughput of Ethereum:</strong></p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/9/9/992968f3269c56752a8fc1ce4805ff35f91c1f03.png\" data-download-href=\"https://ethresear.ch/uploads/default/992968f3269c56752a8fc1ce4805ff35f91c1f03\" title=\"block_content_over_time\"><img src=\"https://ethresear.ch/uploads/default/original/3X/9/9/992968f3269c56752a8fc1ce4805ff35f91c1f03.png\" alt=\"block_content_over_time\" data-base62-sha1=\"lQVLWZ4FMxYJeVwnWoejm9qmj7R\" width=\"690\" height=\"394\" data-dominant-color=\"CFDBD9\"></a></div><p></p>\n<p>Such an increase in throughput is expected to push certain “weaker” validators to their limits. Thus, we want to answer the question “<em>Do blobs contribute to reorgs and if so, by how much?</em>”</p>\n<p>For the following analysis, I’m relying on a node to parse data in real-time (head of chain) and check the contents of blocks that were eventually reorged.</p>\n<p><strong>The earliest data point considered for the following analysis is slot <span class=\"math\">8,992,385</span> (May 3, 2024), which gives us around 4 weeks of data.</strong><br>\n<strong>In total, we observe <span class=\"math\">487</span> reorgs and a total of ~<span class=\"math\">184,000</span> slots in this time span.</strong></p>\n<h3><a name=\"snappy-compressed-blocks-2\" class=\"anchor\" href=\"https://ethresear.ch#snappy-compressed-blocks-2\"></a>Snappy compressed blocks</h3>\n<p>First, let’s compare the <strong>snappy compressed block size of blocks</strong> that were reorged vs those that made it into the canonical chain.<br>\nIn particular, we’re interested in whether reorged blocks were on average larger than those that weren’t reorged.</p>\n<p><em>In this context, we’re referring to reorgs as valid blocks that the respective proposer proposed but that were eventually orphaned by consecutive proposers.</em></p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/6/5/65e2f3539a7b27774ccc3e9027f94040b7a393ac.png\" data-download-href=\"https://ethresear.ch/uploads/default/65e2f3539a7b27774ccc3e9027f94040b7a393ac\" title=\"boxplot2\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/6/5/65e2f3539a7b27774ccc3e9027f94040b7a393ac_2_690x229.png\" alt=\"boxplot2\" data-base62-sha1=\"exksKup1zgj9hoFIz2M9ZPqz7zK\" width=\"690\" height=\"229\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/6/5/65e2f3539a7b27774ccc3e9027f94040b7a393ac_2_690x229.png, https://ethresear.ch/uploads/default/optimized/3X/6/5/65e2f3539a7b27774ccc3e9027f94040b7a393ac_2_1035x343.png 1.5x, https://ethresear.ch/uploads/default/original/3X/6/5/65e2f3539a7b27774ccc3e9027f94040b7a393ac.png 2x\" data-dominant-color=\"F8F8F9\"></a></div><p></p>\n<p>Based on the above graph, we <strong>cannot</strong> see a significant difference in the median block size of reorged and not-reorged blocks. Focusing on the <span class=\"math\">75\\%</span> quantile and the upper whiskers which are defined as <span class=\"math\">Q_{75} \\times 1.5\\ IQR</span>, we do see reorged blocks being larger than not reorged ones. This was expected (bigger blocks lead to bigger struggles), however, as visible in this <a href=\"https://ethresear.ch/t/on-increasing-the-block-gas-limit/18567\">earlier analysis</a> on block sizes, the effects were reduced with 4844 going live.</p>\n<h3><a name=\"blobs-3\" class=\"anchor\" href=\"https://ethresear.ch#blobs-3\"></a>Blobs</h3>\n<p>Next, let’s look into blobs. With the go-live of EIP-4844, most rollups switched from using calldata to blobs, shifting the majority of posted data from the EL payload to blobs.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/d/c/dcb946af5f97726ad19040528abaff69748f11e8.png\" data-download-href=\"https://ethresear.ch/uploads/default/dcb946af5f97726ad19040528abaff69748f11e8\" title=\"boxplot3\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/d/c/dcb946af5f97726ad19040528abaff69748f11e8_2_690x229.png\" alt=\"boxplot3\" data-base62-sha1=\"vuBZJD0HqcvCHWbcuJWyC6wZaRi\" width=\"690\" height=\"229\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/d/c/dcb946af5f97726ad19040528abaff69748f11e8_2_690x229.png, https://ethresear.ch/uploads/default/optimized/3X/d/c/dcb946af5f97726ad19040528abaff69748f11e8_2_1035x343.png 1.5x, https://ethresear.ch/uploads/default/original/3X/d/c/dcb946af5f97726ad19040528abaff69748f11e8.png 2x\" data-dominant-color=\"F9F9F9\"></a></div><p></p>\n<p>Based on the above boxplots, we can see that most <strong>reorged</strong> blocks contained <span class=\"math\">6</span> blobs. Seeing more reorgs for blocks with <span class=\"math\">6</span> blobs is kind of expected as those blocks were approximately <strong>7 times larger than the average block pre-4844</strong>.</p>\n<p><strong>The same pattern is evident when visualizing the percentage of reorged blocks over the number of blobs per block.</strong></p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/3/2/32857ee973ca2a11247e2f25384b6b45b2b6be2e.png\" data-download-href=\"https://ethresear.ch/uploads/default/32857ee973ca2a11247e2f25384b6b45b2b6be2e\" title=\"reorgrate_over_blobs\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/3/2/32857ee973ca2a11247e2f25384b6b45b2b6be2e_2_690x301.png\" alt=\"reorgrate_over_blobs\" data-base62-sha1=\"7cVSZ2uNkB2Ls1359Lvbr65s58W\" width=\"690\" height=\"301\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/3/2/32857ee973ca2a11247e2f25384b6b45b2b6be2e_2_690x301.png, https://ethresear.ch/uploads/default/original/3X/3/2/32857ee973ca2a11247e2f25384b6b45b2b6be2e.png 1.5x, https://ethresear.ch/uploads/default/original/3X/3/2/32857ee973ca2a11247e2f25384b6b45b2b6be2e.png 2x\" data-dominant-color=\"CCD9D3\"></a></div><p></p>\n<p>Comparing the percentage of reorged blocks with <span class=\"math\">0</span> and <span class=\"math\">6</span> blobs, we can see that the probability of a reorg is more than <strong><span class=\"math\">3</span> times larger.</strong></p>\n<p>In this context, it’s important to check what the distribution of blobs per block looks like. The “extreme” cases of <span class=\"math\">0</span> or <span class=\"math\">6</span> blobs per block might heavily impact the perceived impact of blobs on reorgs.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/7/8/78cfeeac384e4d699dd3776ba954dd95dffbda24.png\" data-download-href=\"https://ethresear.ch/uploads/default/78cfeeac384e4d699dd3776ba954dd95dffbda24\" title=\"blobs_per_block_ist\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/7/8/78cfeeac384e4d699dd3776ba954dd95dffbda24_2_690x265.png\" alt=\"blobs_per_block_ist\" data-base62-sha1=\"heKMWoxyAqItD0mVvJZCRMMT820\" width=\"690\" height=\"265\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/7/8/78cfeeac384e4d699dd3776ba954dd95dffbda24_2_690x265.png, https://ethresear.ch/uploads/default/optimized/3X/7/8/78cfeeac384e4d699dd3776ba954dd95dffbda24_2_1035x397.png 1.5x, https://ethresear.ch/uploads/default/original/3X/7/8/78cfeeac384e4d699dd3776ba954dd95dffbda24.png 2x\" data-dominant-color=\"E1E8E5\"></a></div><p></p>\n<p>As visible in the above histogram, which shows the distribution of blobs per block in May 2024, most blocks contained either <span class=\"math\">0</span> or <span class=\"math\">6</span> blobs.</p>\n<h3><a name=\"regression-analysis-4\" class=\"anchor\" href=\"https://ethresear.ch#regression-analysis-4\"></a>Regression Analysis</h3>\n<p>To quantify the impact of blobs on reorgs, we can apply a simple logistic regression.</p>\n<p>In addition to the (1) uncompressed block size, (2) snappy compressed block size, (3) gas used per block and (4) number of transactions and (5) blobs per block, we also put different CL clients as dummy variables into the regression model.<br>\nAll dependent variables are z-score scaled and the Lighthouse client is part of the intercept.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/5/2/5270b626e19b685b050d293245984a8e0700ba11.png\" data-download-href=\"https://ethresear.ch/uploads/default/5270b626e19b685b050d293245984a8e0700ba11\" title=\"logit\"><img src=\"https://ethresear.ch/uploads/default/original/3X/5/2/5270b626e19b685b050d293245984a8e0700ba11.png\" alt=\"logit\" data-base62-sha1=\"bLiDqt1fU6P2TGMdG48tbmQW6t3\" width=\"690\" height=\"368\" data-dominant-color=\"EDEDED\"></a></div><p></p>\n<p>Looking at the intercept (const), the baseline log-odds of a reorg when all other predictors are at their mean indicates a very low baseline probability of a reorg happening.<br>\nTo put that in numbers, empirically around <span class=\"math\">0.27\\%</span> of all blocks in May 2024 were reorged.</p>\n<p>Next, let’s focus on the dependent variables, considering <span class=\"math\">p \\le 0.01</span> as a significant result.</p>\n<p><strong>Blobs</strong>, <strong>size_compressed</strong>, and <strong>nr_txs</strong> have significant impacts on the probability of a reorg.</p>\n<ul>\n<li>Each additional blob and each additional byte in size_compressed increases the probability of a reorg.</li>\n<li><code>size</code>, <code>gas_used</code> and other client variables (Nimbus, Prysm) do not have significant impacts (compared to the Lighthouse client).</li>\n</ul>\n<p>For each increase in blobs by the standard deviation of blobs (<span class=\"math\">=2.33</span>), the log-odds of a block being reorged increase by <span class=\"math\">1.2582</span>.<br>\nThe baseline probability of a reorg, with all dependent variables at their mean, is approximately <span class=\"math\">0.27\\%</span>. This would mean that an increase in blobs by one standard deviation (<span class=\"math\">=2.33</span>) results in the probability of a reorg increasing from approximately <span class=\"math\">0.27\\%</span> to <span class=\"math\">0.59\\%</span>, representing an increase of about <span class=\"math\">0.32</span> percentage points.</p>\n<h3><a name=\"clients-5\" class=\"anchor\" href=\"https://ethresear.ch#clients-5\"></a>Clients</h3>\n<p><strong>Notably, the number of reorgs is in general very low and even lower for “minority” clients such as Lodestar and Teku. Thus a few Lodestar or Teku users that are playing timing games could already impact this result.</strong></p>\n<p><strong>Thus, the following result must be taken with a grain of salt.</strong></p>\n<p><strong>For the Lodestar client:</strong></p>\n<ul>\n<li>The log-odds of a reorg increase by <span class=\"math\">0.9814</span> when using the Lodestar client.</li>\n<li>This corresponds to an odds ratio of approximately <span class=\"math\">2.667</span>, indicating that the odds of a reorg are about <span class=\"math\">166.7\\%</span> higher when using the Lodestar client.</li>\n<li>The baseline probability of a reorg is approximately <span class=\"math\">0.27\\%</span>. When using the Lodestar client, this probability increases to approximately <span class=\"math\">0.45\\%</span>, an increase of about <span class=\"math\">0.178</span> percentage points.</li>\n</ul>\n<p><strong>For the Teku client:</strong></p>\n<ul>\n<li>The log-odds of a reorg increase by <span class=\"math\">0.5629</span> when using the Teku client.</li>\n<li>This corresponds to an odds ratio of approximately <span class=\"math\">1.756</span>, indicating that the odds of a reorg are about <span class=\"math\">75.6\\%</span> higher when using the Teku client.</li>\n<li>The baseline probability of a reorg is approximately <span class=\"math\">0.27\\%</span>. When using the Teku client, this probability increases to approximately <span class=\"math\">0.3\\%</span>, an increase of about <span class=\"math\">0.027</span> percentage points.</li>\n</ul>\n<p>For the <strong>Nimbus</strong> and <strong>Prysm</strong> clients, we do not see a significant impact on reorgs compared to <strong>Lighthouse</strong>.</p>\n<h2><a name=\"next-steps-6\" class=\"anchor\" href=\"https://ethresear.ch#next-steps-6\"></a>Next Steps</h2>\n<ul>\n<li><strong>Call for reproduction</strong>: Please reproduce my analysis. Working with a lot of data can be dirty. Working with data that disappears from the chain after a block was reorged is even dirtier. Thus, view this as an initial attempt to dive into the “blobs vs reorgs” topic.</li>\n<li><strong>More data</strong>: 4844 is still very young and I plan to reproduce this analysis in a few months to verify the results using more data.</li>\n<li><strong>Filter for client bugs</strong>: A small bug in a client can significantly impact the result. Same applies to validators playing <strong>timing games, honest reorg strategies, and EL clients</strong>.</li>\n<li><strong>What about relays and builders</strong>: Check why we see either 0 or 6 blobs, the extreme cases, so often, and what the <strong>builder</strong> and <strong>relay</strong> behavior is in those scenarios.</li>\n<li>Check how <strong>efficiently blobs are used</strong> and if <strong>sharing blob space</strong> among multiple entities could increase efficiency.</li>\n</ul>\n            <p><small>1 post - 1 participant</small></p>\n            <p><a href=\"https://ethresear.ch/t/big-blocks-blobs-and-reorgs/19674\">Read full topic</a></p>","link":"https://ethresear.ch/t/big-blocks-blobs-and-reorgs/19674","pubDate":"Wed, 29 May 2024 13:05:59 +0000","discourse:topicPinned":"No","discourse:topicClosed":"No","discourse:topicArchived":"No","guid":{"@isPermaLink":"false","#text":"ethresear.ch-topic-19674"},"source":{"@url":"https://ethresear.ch/t/big-blocks-blobs-and-reorgs/19674.rss","#text":"Big blocks, blobs, and reorgs"},"filter":false},{"title":"Advantage of Pipelining Consensus and Execution: Delayed Execution","dc:creator":"terence","category":"Block proposer","description":"<p><em><strong>Related work</strong></em></p>\n<ol>\n<li><a href=\"https://ethresear.ch/t/payload-timeliness-committee-ptc-an-epbs-design/16054\">Payload Timeliness Committee (PTC): An EPBS Design</a>, by Mike and Francesco – July 2023</li>\n<li><a href=\"https://ethresear.ch/t/payload-boosts-in-epbs/18769\">Payload Boosts in EPBS</a>, by Potuz – Feb 2024</li>\n<li><a href=\"https://www.paradigm.xyz/2024/04/reth-perf\" rel=\"noopener nofollow ugc\">reth: High-Performance Ethereum Implementation</a>, by Georgios – April 2024</li>\n<li><a href=\"https://hackmd.io/@potuz/rJ9GCnT1C\" rel=\"noopener nofollow ugc\">EPBS Annotated Spec Guide</a>, by Potuz – April 2023</li>\n<li><a href=\"https://ethresear.ch/t/builder-reveal-timing-game-in-epbs/19424\">Builder Reveal Timing Game in EPBS</a>, by Terence – April 2024</li>\n<li><a href=\"https://hackmd.io/@ttsao/epbs-annotated-validator\" rel=\"noopener nofollow ugc\">Annotated Validator Guide for EPBS</a>, by Terence – April 2024</li>\n</ol>\n<h2><a name=\"background-1\" class=\"anchor\" href=\"https://ethresear.ch#background-1\"></a>Background</h2>\n<p>Pipelining consensus and execution validations into different stages is a lesser known concept in Ethereum today, but it may become crucial in the future, especially in any Proposer-Builder Separation (PBS) roadmap, whether it’s block auction, slot auction, or ticket auction. As this separation seems inevitable in the long term, what does it mean to separate and pipeline consensus and execution validations into different stages? This post will explore the details, going into the benefits and downsides.</p>\n<p>Since Ethereum moved to <a href=\"https://ethereum.org/en/developers/docs/consensus-mechanisms/pos/\" rel=\"noopener nofollow ugc\">proof of stake</a>, a node runs two pieces of software: <a href=\"https://ethereum.org/en/roadmap/merge/#merging-with-mainnet\" rel=\"noopener nofollow ugc\">a consensus client and an execution client</a>. The consensus client verifies the consensus part of the block, while the execution client verifies the execution part. Although the validations are separated in two different software, the validation result is coupled. If either the consensus validation or the execution validation fails, the whole block fails. Timeline-wise, both validations must be completed before the <span class=\"math\">AttestationDeadline</span> (4 seconds into the beacon slot) for the block to be considered as <a href=\"https://eth2book.info/capella/part3/forkchoice/#whats-a-fork-choice\" rel=\"noopener nofollow ugc\">head</a> for the attestation vote. This separation of concern for the two layers allows a node to verify consensus and execution in parallel. But despite parallel validation, both the consensus and execution parts of the block <strong>MUST</strong> be validated before the <span class=\"math\">AttestationDeadline</span>. Currently, the average block arrives at the 1 to 2-second mark into the slot, giving the running node less than 2 seconds to complete the verifications. This is called the <strong>validation</strong> <strong>hot path</strong>.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/5/9/59b830c5f23687d39a664ce8187c4d5672bbee06.png\" data-download-href=\"https://ethresear.ch/uploads/default/59b830c5f23687d39a664ce8187c4d5672bbee06\" title=\"Screenshot 2024-05-23 at 6.47.57 AM\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/5/9/59b830c5f23687d39a664ce8187c4d5672bbee06_2_690x307.png\" alt=\"Screenshot 2024-05-23 at 6.47.57 AM\" data-base62-sha1=\"cNH7w2Sst6mgVuNQzWLEToDO19Q\" width=\"690\" height=\"307\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/5/9/59b830c5f23687d39a664ce8187c4d5672bbee06_2_690x307.png, https://ethresear.ch/uploads/default/optimized/3X/5/9/59b830c5f23687d39a664ce8187c4d5672bbee06_2_1035x460.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/5/9/59b830c5f23687d39a664ce8187c4d5672bbee06_2_1380x614.png 2x\" data-dominant-color=\"1B2121\"></a></div><br>\n<em>How long it took the beacon block + execution payload to arrive on my local NUC node</em><p></p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/c/7/c7581900ce6df801b5261dc709b5344e35480859.png\" data-download-href=\"https://ethresear.ch/uploads/default/c7581900ce6df801b5261dc709b5344e35480859\" title=\"Screenshot 2024-05-23 at 6.50.00 AM\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/c/7/c7581900ce6df801b5261dc709b5344e35480859_2_690x308.png\" alt=\"Screenshot 2024-05-23 at 6.50.00 AM\" data-base62-sha1=\"srtLqFOjmQm64wkn9IEjZT1QLSV\" width=\"690\" height=\"308\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/c/7/c7581900ce6df801b5261dc709b5344e35480859_2_690x308.png, https://ethresear.ch/uploads/default/optimized/3X/c/7/c7581900ce6df801b5261dc709b5344e35480859_2_1035x462.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/c/7/c7581900ce6df801b5261dc709b5344e35480859_2_1380x616.png 2x\" data-dominant-color=\"1B2020\"></a></div><br>\n<em>How long it took the execution layer client to finish processing the execution payload on my local NUC node</em><p></p>\n<h2><a name=\"consensus-and-execution-pipelining-in-pbs-2\" class=\"anchor\" href=\"https://ethresear.ch#consensus-and-execution-pipelining-in-pbs-2\"></a>Consensus and execution pipelining in PBS</h2>\n<p>In this section, we’ll focus on block-auction-based EPBS. The anatomy of a 12 second beacon chain slot changes to the following:</p>\n<ul>\n<li>Second 0: proposer broadcasts a consensus block that commits to the builder’s block</li>\n<li>Second 3: <span class=\"math\">AttestationDeadline</span> for the consensus block to be processed; beacon attester casts vote. If the consensus block is not processed on time, the beacon attester votes for an older slot block as head</li>\n<li>Second 6: builder reveals the winning execution block</li>\n<li>Second 9: <span class=\"math\">PtcDeadline</span> for the execution block to be seen; <a href=\"https://ethresear.ch/t/payload-timeliness-committee-ptc-an-epbs-design/16054\">PTC</a> attester casts vote that the builder revealed the execution block on time without verifying the block, only the verify block hash. If the builder fails to reveal, the PTC attester votes the current slot contains an empty execution block</li>\n</ul>\n<p>Now let’s examine how <strong>different consensus actors</strong> perceive their time under the new anatomy:</p>\n<p>As a <strong>proposer</strong> for the current slot, assuming block propagation takes 1 second, I have 2 seconds left for everyone to verify the consensus block. Note that only the consensus block needs to be propagated here, not the execution block, so the network load is lighter. The processing time is also reduced as it is bound by consensus validation, not the worst case of either consensus or execution validation.</p>\n<p>As a <strong>beacon attester</strong> for the current slot, I cast my vote on the consensus block that is head at the 3-second mark Instead of 4-second mark before. Nothing else changes here.</p>\n<p>As a winning <strong>builder</strong> for the current slot, I reveal my execution block at the 6-second mark. I may choose to withhold my execution block to gain a <a href=\"https://ethresear.ch/t/payload-boosts-in-epbs/18769\">withhold boost</a> if the beacon block is very weak, but I will reveal it as long as there is 40% of the current slot beacon committee voted for my execution header as canonical.</p>\n<p>As a <strong>PTC attester</strong> for the current slot, I cast my vote on the execution block revealed on time and verify that the execution block hash is valid. I don’t need to perform complete execution verification tasks like heavy state root validation before casting my vote. More on how PTC attester votes <a href=\"https://hackmd.io/@ttsao/epbs-annotated-validator#PTC-attestation-duty\" rel=\"noopener nofollow ugc\">here</a>.</p>\n<p>As a <strong>builder</strong> trying to win the next slot, as soon as the current slot builder reveals its winning execution block, I can begin building. This happens in less than 6 seconds. Before I build my block, I need to verify that the execution block I’m building on is valid.</p>\n<p>As a <strong>proposer</strong> for the next slot, I package the current slot PTC attestations into my block and pick the best bid that reflects my local chain view, which includes the beacon head root and execution reveal status. I should also verify the execution block to ensure I do not choose a header that builds on top of an invalid execution block as a parent.</p>\n<h2><a name=\"execution-validation-hot-path-3\" class=\"anchor\" href=\"https://ethresear.ch#execution-validation-hot-path-3\"></a>Execution validation hot path</h2>\n<p>Now you ask… <strong>When is the deadline to verify the execution block for slot</strong> <span class=\"math\">n</span>? As it turns out, you don’t need to complete verifying the execution until slot <span class=\"math\">n+1</span>'s beacon attestation deadline. (Cheaper validations like block hash can still be done) If the <span class=\"math\">n+1</span> proposer reveals the consensus block that builds on top of the execution payload and the attester casts its vote on the beacon block, the attesters will apply the builder’s boost to the execution block if the previous PTC has voted reveal on time and the execution block is valid. This represents a significant paradigm shift from today’s mental model.</p>\n<p>To summarize:</p>\n<ul>\n<li>Proposer proposes consensus block <span class=\"math\">B_c</span> that commits header <span class=\"math\">h</span></li>\n<li>Beacon attesters verify <span class=\"math\">B_c</span> and cast votes</li>\n<li>Builder reveals execution block <span class=\"math\">B_e</span></li>\n<li>PTC attesters cast votes for <span class=\"math\">B_e</span> being on time and having a valid block hash</li>\n<li>Proposer proposes <span class=\"math\">B_{c+1}</span> that builds on top of { <span class=\"math\">B_c</span>, <span class=\"math\">B_e</span>}</li>\n<li>Beacon attesters verify <span class=\"math\">B_{c+1}</span> is valid, and if there are sufficient votes to signal <span class=\"math\">B_e</span> revealed on time, then <span class=\"math\">B_e</span> is valid. If that is true, then <span class=\"math\">RevealBoost</span> is applied to <span class=\"math\">B_e</span>, and <span class=\"math\">ProposeBoost</span> is applied to <span class=\"math\">B_{c+1}</span></li>\n</ul>\n<p>Here is a table to compare the timings with those of today.</p>\n<div class=\"md-table\">\n<table>\n<thead>\n<tr>\n<th></th>\n<th>Today</th>\n<th>ePBS</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Time to verify consensus block validity for slot <span class=\"math\">n</span></td>\n<td>3s</td>\n<td>2s</td>\n</tr>\n<tr>\n<td>Time to verify execution block reveal on time for slot <span class=\"math\">n</span></td>\n<td>3s</td>\n<td>3s</td>\n</tr>\n<tr>\n<td>Time to verify execution block validity for slot <span class=\"math\">n</span></td>\n<td>3s</td>\n<td>9s</td>\n</tr>\n<tr>\n<td>Time to build next block for slot <span class=\"math\">n+1</span></td>\n<td>8s</td>\n<td>5s</td>\n</tr>\n</tbody>\n</table>\n</div><h2><a name=\"benefits-of-pipelining-consensus-and-execution-4\" class=\"anchor\" href=\"https://ethresear.ch#benefits-of-pipelining-consensus-and-execution-4\"></a>Benefits of pipelining consensus and execution</h2>\n<ul>\n<li>Less network load at peak: Consensus and execution blocks are sent at different times. Blobs can even be sent earlier than reveal time.</li>\n<li>Less processing load at peak: Consensus and execution blocks are processed and verified at different times.</li>\n<li>More importantly, the execution layer has more time for state root computation without <a href=\"https://www.paradigm.xyz/2024/04/reth-perf#improving-the-state-commitment\" rel=\"noopener nofollow ugc\">diverging from Ethereum L1 state root behavior</a>. This provides an easy execution state root performance increase without needing complex constructions like parallelized state root, less frequent state root, or trailing state root. You get this state root performance increase for free under ePBS without major execution layer overhaul and without second-order effects on light clients, L2 bridges, and other protocols that rely on frequent account and storage proofs.</li>\n</ul>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/9/d/9d58d9498b0d901cd675aaef0191266650ae476d.png\" data-download-href=\"https://ethresear.ch/uploads/default/9d58d9498b0d901cd675aaef0191266650ae476d\" title=\"Screenshot 2024-05-23 at 6.41.27 AM\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/9/d/9d58d9498b0d901cd675aaef0191266650ae476d_2_690x186.png\" alt=\"Screenshot 2024-05-23 at 6.41.27 AM\" data-base62-sha1=\"mrXjRXPlIJX0rezu0fvc0fQ0GyF\" width=\"690\" height=\"186\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/9/d/9d58d9498b0d901cd675aaef0191266650ae476d_2_690x186.png, https://ethresear.ch/uploads/default/optimized/3X/9/d/9d58d9498b0d901cd675aaef0191266650ae476d_2_1035x279.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/9/d/9d58d9498b0d901cd675aaef0191266650ae476d_2_1380x372.png 2x\" data-dominant-color=\"E8E9E9\"></a></div><br>\n<em>Top: block production today. Bottom: block production under block-auction based ePBS.</em><p></p>\n<p>One downside that is worth mentioning is that builders competing for the next slot now have less time to prepare for the block. Assuming honest builder behavior and no <a href=\"https://ethresear.ch/t/builder-reveal-timing-game-in-epbs/19424\">builder timing games</a>, this time decreases from today’s 8 seconds to 6 seconds.</p>\n<p>I hope this post was able to illustrate the key point that by separating consensus and execution into different stages, the network reaps additional benefits like those mentioned above. This is one positive side effect of PBS, although it may not have been what PBS was initially intended to solve. Given that there’s more time to process the execution block, it’s up to the execution layer to innovate and determine what benefits it could bring, such as increasing the gas limit once state growth has a clear solution or other improvements.</p>\n            <p><small>3 posts - 2 participants</small></p>\n            <p><a href=\"https://ethresear.ch/t/advantage-of-pipelining-consensus-and-execution-delayed-execution/19668\">Read full topic</a></p>","link":"https://ethresear.ch/t/advantage-of-pipelining-consensus-and-execution-delayed-execution/19668","pubDate":"Tue, 28 May 2024 13:35:02 +0000","discourse:topicPinned":"No","discourse:topicClosed":"No","discourse:topicArchived":"No","guid":{"@isPermaLink":"false","#text":"ethresear.ch-topic-19668"},"source":{"@url":"https://ethresear.ch/t/advantage-of-pipelining-consensus-and-execution-delayed-execution/19668.rss","#text":"Advantage of Pipelining Consensus and Execution: Delayed Execution"},"filter":false},{"title":"Proof of Value, governance for dApps and tokenomics","dc:creator":"zhous","category":"Decentralized exchanges","description":"<p>We’ve been developing since 2019, and Proof of Value, a brand new consensus mechanism,  is at the core of our project, DAism, and it stands out as a crucial innovation in the realm of decentralized governance for dApps and tokenomics.</p>\n<p>Tokenomics primarily refers to investment trading activities and financial behaviors associated with dApps.</p>\n<p><a href=\"https://gamma.app/docs/What-is-Proof-of-Value-y5jaiy0hj5bdqzb\" class=\"onebox\" target=\"_blank\" rel=\"noopener nofollow ugc\">https://gamma.app/docs/What-is-Proof-of-Value-y5jaiy0hj5bdqzb</a></p>\n<p>Feel free to share your thoughts and questions below, or to have a try on the <a href=\"https://test.daism.io/\" rel=\"noopener nofollow ugc\">test version of DAism</a>, or to join our <a href=\"https://discord.com/invite/YF7c7m4C4Y\" rel=\"noopener nofollow ugc\">Discord server</a> (you can also find the links on the deck).</p>\n            <p><small>1 post - 1 participant</small></p>\n            <p><a href=\"https://ethresear.ch/t/proof-of-value-governance-for-dapps-and-tokenomics/19666\">Read full topic</a></p>","link":"https://ethresear.ch/t/proof-of-value-governance-for-dapps-and-tokenomics/19666","pubDate":"Tue, 28 May 2024 09:03:07 +0000","discourse:topicPinned":"No","discourse:topicClosed":"No","discourse:topicArchived":"No","guid":{"@isPermaLink":"false","#text":"ethresear.ch-topic-19666"},"source":{"@url":"https://ethresear.ch/t/proof-of-value-governance-for-dapps-and-tokenomics/19666.rss","#text":"Proof of Value, governance for dApps and tokenomics"},"filter":false},{"title":"Plasma Next Next (Beetlejuice Beetlejuice)","dc:creator":"cryptskii","category":"Plasma","description":"<p>Building off <a href=\"https://ethresear.ch/t/plasma-next-plasma-without-online-requirements/18786\">Plasma Next</a></p>\n<h2><a name=\"abstract-1\" class=\"anchor\" href=\"https://ethresear.ch#abstract-1\"></a>Abstract</h2>\n<p>Presenting a novel blockchain scaling solution by integrating the concepts of instant finality, similar to the Lightning Network, with the EigenLayer approach for efficient use of locked funds. This combination addresses various drawbacks associated with current blockchain scaling solutions, enhancing capital efficiency, reducing operational complexity, minimizing operator risk, and extending the scope of statelessness while providing instant, secure transaction finality. We provide rigorous mathematical formalisms, proofs, algorithms, and detailed analysis to demonstrate the viability and advantages of this approach.</p>\n<h3><a name=\"instant-finality-2\" class=\"anchor\" href=\"https://ethresear.ch#instant-finality-2\"></a>Instant Finality</h3>\n<p>The system ensures that transactions are confirmed instantly, akin to the Lightning Network, providing immediate transaction finality and security. This is achieved through the use of off-chain payment channels and conditional payments verified by zero-knowledge proofs (ZKPs).</p>\n<p><strong>Definition 1 (Payment Channel):</strong> A payment channel is a bilateral off-chain mechanism that allows two parties to conduct multiple transactions without committing each transaction to the blockchain. The initial and final states of the channel are recorded on-chain.</p>\n<p><strong>Definition 2 (Conditional Payment):</strong> A conditional payment is a transaction where the transfer of funds is contingent upon the satisfaction of a predefined condition, which can be verified using a ZKP.</p>\n<h3><a name=\"unified-staking-pool-3\" class=\"anchor\" href=\"https://ethresear.ch#unified-staking-pool-3\"></a>Unified Staking Pool</h3>\n<p>A unified liquidity pool is utilized, where funds are staked by operators and users and dynamically allocated across multiple channels and transactions, optimizing the use of locked funds. This approach improves capital efficiency and reduces the risk of liquidity shortages.</p>\n<p><strong>Definition 3 (Unified Staking Pool):</strong> A unified staking pool is a smart contract that aggregates staked funds from multiple participants and dynamically allocates these funds across various payment channels based on demand.</p>\n<h3><a name=\"recursive-proofs-and-smart-contracts-4\" class=\"anchor\" href=\"https://ethresear.ch#recursive-proofs-and-smart-contracts-4\"></a>Recursive Proofs and Smart Contracts</h3>\n<p>Recursive zero-knowledge proofs (ZKPs) and smart contracts are employed to securely manage and verify cross-channel transactions, ensuring efficient and scalable verification.</p>\n<p><strong>Definition 4 (Recursive ZKP):</strong> A recursive ZKP is a proof system that allows for the aggregation of multiple proofs into a single proof, enabling efficient verification of cross-channel transactions.</p>\n<h2><a name=\"prerequisites-5\" class=\"anchor\" href=\"https://ethresear.ch#prerequisites-5\"></a>Prerequisites</h2>\n<p>To fully understand the proposed solution, readers should be familiar with the following concepts:</p>\n<ul>\n<li>Blockchain technology and its scalability issues</li>\n<li>The Lightning Network and off-chain payment channels</li>\n<li>Zero-knowledge proofs (ZKPs) and their applications in blockchain</li>\n<li>Smart contract functionality and deployment</li>\n</ul>\n<h3><a name=\"implementation-details-6\" class=\"anchor\" href=\"https://ethresear.ch#implementation-details-6\"></a>Implementation Details</h3>\n<h4><a name=\"instant-finality-mechanism-7\" class=\"anchor\" href=\"https://ethresear.ch#instant-finality-mechanism-7\"></a>Instant Finality Mechanism</h4>\n<p><strong>Payment Channels:</strong> We implement payment channels similar to the Lightning Network, where transactions between parties are confirmed off-chain instantly. The channel balance can be formally expressed as:</p>\n<p><span class=\"math\">\\text{Balance}_{\\text{final}} = \\text{Balance}_{\\text{initial}} + \\sum_{i=1}^{n} \\text{Transaction}_i</span></p>\n<p><strong>Theorem 1 (Payment Channel Security):</strong> Given a secure signature scheme and a reliable blockchain, payment channels guarantee that the final balance reflects the sum of all valid transactions, preventing unauthorized transfers.</p>\n<p><strong>Proof 1:</strong> The proof follows from the security of the underlying signature scheme and the immutability of the blockchain. Each transaction is signed by both parties, ensuring authenticity and non-repudiation. The initial and final states of the channel are recorded on the blockchain, providing a tamper-proof ledger. Therefore, the final balance is secure and reflects the sum of all valid transactions.</p>\n<p><strong>Conditional Payments with ZKPs:</strong> We utilize ZKPs to create conditions for payment finality that are verified instantly. A ZKP for a conditional payment can be represented as:</p>\n<p><span class=\"math\">\\text{ZKP}(\\text{Transaction}_i, \\text{Condition}) \\Rightarrow \\text{Transaction}_i \\text{ is final}</span></p>\n<p><strong>Theorem 2 (Conditional Payment Security):</strong> Given a secure ZKP system, conditional payments ensure that transactions are finalized if and only if the predefined conditions are met, preventing unauthorized transfers.</p>\n<p><strong>Proof 2:</strong> The proof relies on the soundness and completeness of the ZKP system. Soundness ensures that a proof can only be generated if the condition is indeed satisfied, preventing false positives. Completeness guarantees that a valid proof can always be generated when the condition is met, preventing false negatives. Therefore, conditional payments are secure and finalize transactions only when the predefined conditions are fulfilled.</p>\n<h4><a name=\"unified-staking-pool-and-dynamic-allocation-8\" class=\"anchor\" href=\"https://ethresear.ch#unified-staking-pool-and-dynamic-allocation-8\"></a>Unified Staking Pool and Dynamic Allocation</h4>\n<p><strong>Stake Management:</strong> Operators and users stake their funds into a unified pool managed by a smart contract. The dynamic allocation of staked funds can be formalized as:</p>\n<p><strong>Algorithm 1 Dynamic allocation of staked funds</strong></p>\n<pre><code class=\"lang-auto\">Require: StakedFunds, Channels, Demand\n1: for each Channel ∈ Channels do\n2: Allocate(Channel, Demand(Channel))\n3: end for\n</code></pre>\n<p><strong>Lemma 1 (Allocation Efficiency):</strong> The dynamic allocation algorithm ensures that staked funds are allocated to channels based on their demand, minimizing idle capital and optimizing liquidity utilization.</p>\n<p><strong>Proof 3:</strong> The allocation algorithm iterates over all channels and allocates funds based on the demand for each channel. By dynamically adjusting the allocation according to demand, the algorithm minimizes the amount of idle capital and optimizes the utilization of staked funds. This improves overall liquidity efficiency.</p>\n<h4><a name=\"liquidity-sharing-9\" class=\"anchor\" href=\"https://ethresear.ch#liquidity-sharing-9\"></a>Liquidity Sharing</h4>\n<p>The unified pool allows for dynamic allocation of liquidity to various channels and bulk-token-transfers based on demand, optimizing the use of staked funds.</p>\n<p><strong>Theorem 3 (Liquidity Sharing Security):</strong> The unified staking pool and dynamic allocation mechanism ensure secure and efficient sharing of liquidity across channels, preventing unauthorized access to staked funds.</p>\n<p><strong>Proof 4:</strong> The security of liquidity sharing relies on the integrity of the smart contract managing the unified staking pool. The smart contract enforces access control mechanisms, ensuring that only authorized entities can allocate or transfer funds. Dynamic allocation is performed based on predefined rules and demand metrics, preventing arbitrary or malicious allocations. Therefore, liquidity sharing through the unified staking pool is secure and efficient.</p>\n<h3><a name=\"cross-channel-guarantees-and-security-10\" class=\"anchor\" href=\"https://ethresear.ch#cross-channel-guarantees-and-security-10\"></a>Cross-Channel Guarantees and Security</h3>\n<p><strong>Recursive ZKPs for Aggregation:</strong> We aggregate proofs from multiple transactions and channels into a single proof using recursive ZKPs. This ensures efficient and scalable verification, expressed as:</p>\n<p><span class=\"math\">\\text{RecursiveZKP} = \\bigoplus_{i=1}^{n} \\text{ZKP}(\\text{Transaction}_i)</span></p>\n<p>where <span class=\"math\">(\\bigoplus)</span> denotes the recursive aggregation operation.</p>\n<p><strong>Theorem 4 (Recursive ZKP Security):</strong> Recursive ZKPs provide secure and efficient aggregation of proofs from multiple transactions and channels, ensuring the integrity of cross-channel verifications.</p>\n<p><strong>Proof 5:</strong> The security of recursive ZKPs stems from the properties of the underlying ZKP system. Recursive composition preserves the soundness and completeness of individual proofs, ensuring that the aggregated proof is valid if and only if all constituent proofs are valid. Moreover, recursive aggregation reduces the verification complexity, as the verifier only needs to check a single aggregated proof instead of verifying each proof independently. Therefore, recursive ZKPs enable secure and efficient cross-channel verification.</p>\n<h3><a name=\"smart-contract-hierarchies-11\" class=\"anchor\" href=\"https://ethresear.ch#smart-contract-hierarchies-11\"></a>Smart Contract Hierarchies</h3>\n<p>We implement a hierarchy of smart contracts to manage the allocation and reallocation of funds, ensuring secure and efficient cross-channel transactions.</p>\n<p><strong>Definition 5 (Smart Contract Hierarchy):</strong> A smart contract hierarchy is a layered structure of interconnected smart contracts that manage the allocation and reallocation of funds across channels. Higher-level contracts control the overall liquidity distribution, while lower-level contracts handle channel-specific operations.</p>\n<p><strong>Theorem 5 (Smart Contract Hierarchy Security):</strong> The smart contract hierarchy ensures secure and efficient management of cross-channel transactions, preventing unauthorized access and enforcing consistent state transitions.</p>\n<p><strong>Proof 6:</strong> The security of the smart contract hierarchy relies on the correctness and integrity of the individual smart contracts. Each contract is carefully designed and audited to ensure that it performs its intended functions and maintains a consistent state. The hierarchical structure allows for modular control and error containment, as issues in one contract can be isolated and resolved without affecting the entire system. Access control mechanisms and state transition rules are enforced at each level, preventing unauthorized modifications. Therefore, the smart contract hierarchy provides a secure and efficient framework for managing cross-channel transactions.</p>\n<h4><a name=\"o1-state-growth-mechanism-12\" class=\"anchor\" href=\"https://ethresear.ch#o1-state-growth-mechanism-12\"></a>O(1) State Growth Mechanism</h4>\n<p>To achieve O(1) state growth, we leverage Merkle proofs to manage state updates efficiently. Instead of recording each transaction directly on-chain, we record the Merkle root of bulk-token-transfers. This approach ensures that the state growth per block is constant, regardless of the number of transactions.</p>\n<p><strong>Process:</strong> When a set of transactions occurs, they are organized into a Merkle tree. The Merkle root of this tree is then recorded on-chain. Subsequent state updates only need to include the new Merkle root, significantly reducing the data stored on-chain.</p>\n<p><strong>Mathematical Formalism:</strong> Let <span class=\"math\">( T_1, T_2, \\ldots, T_n )</span> be a set of transactions. These transactions are used to construct a Merkle tree <span class=\"math\">( M )</span>, with the Merkle root <span class=\"math\">( R )</span>. The state update process can be described as:</p>\n<p><span class=\"math\">\\text{State}_{\\text{new}} = \\text{State}_{\\text{old}} \\cup \\{R\\}</span></p>\n<p>where <span class=\"math\">( R )</span> is the Merkle root of the current set of transactions. This ensures that the state growth is limited to the size of the Merkle root, typically 32 bytes, achieving O(1) state growth.</p>\n<p><strong>Example Scenario:</strong> Consider a block containing 1000 transactions. Instead of recording each transaction on-chain, we construct a Merkle tree with these transactions and record only the Merkle root. This reduces the on-chain data from 1000 transactions to a single Merkle root, illustrating the efficiency of this approach.</p>\n<h4><a name=\"implementation-details-13\" class=\"anchor\" href=\"https://ethresear.ch#implementation-details-13\"></a>Implementation Details</h4>\n<p>Implementing Merkle proofs in a blockchain system involves integrating them into the transaction processing pipeline and state management infrastructure.</p>\n<p><strong>Integration:</strong> The Merkle tree construction and root calculation are performed off-chain. Once the Merkle root is computed, it is included in the block header, ensuring minimal on-chain data.</p>\n<p><strong>Algorithms and Data Structures:</strong></p>\n<p><strong>Algorithm 2 Merkle Root Calculation</strong></p>\n<pre><code class=\"lang-auto\">Require: Transactions T1, T2, . . . , Tn\nEnsure: Merkle root R\n1: Initialize leaf nodes with hashes of transactions\n2: while more than one node in the tree do\n3: for each pair of nodes do\n4: Compute parent node as hash of the two child nodes\n5: end for\n6: end while\n7: return Root node\n</code></pre>\n<h3><a name=\"elimination-of-continuous-online-presence-14\" class=\"anchor\" href=\"https://ethresear.ch#elimination-of-continuous-online-presence-14\"></a>Elimination of Continuous Online Presence</h3>\n<p>In traditional blockchain systems, participants often need to remain continuously online to ensure their transactions are confirmed and to participate in consensus mechanisms. This requirement can be burdensome and impractical for many users, leading to inefficiencies and increased operational costs.</p>\n<h4><a name=\"off-chain-payment-channels-15\" class=\"anchor\" href=\"https://ethresear.ch#off-chain-payment-channels-15\"></a>Off-Chain Payment Channels</h4>\n<p>Off-chain payment channels enable participants to conduct transactions without needing to record each one on the blockchain. These channels allow for instant transaction finality and reduce the need for continuous online presence.</p>\n<p><strong>Mechanisms:</strong> Participants open a payment channel by locking funds on-chain. They can then transact off-chain by exchanging signed messages that update the channel balance. The final state is recorded on-chain when the channel is closed.</p>\n<h4><a name=\"instant-finality-with-zero-knowledge-proofs-16\" class=\"anchor\" href=\"https://ethresear.ch#instant-finality-with-zero-knowledge-proofs-16\"></a>Instant Finality with Zero-Knowledge Proofs</h4>\n<p>Instant finality ensures that transactions are immediately confirmed and final once the conditions are met. Zero-knowledge proofs (ZKPs) play a crucial role in achieving this by providing a way to verify transactions without revealing sensitive information.</p>\n<p><strong>Example Use Cases:</strong></p>\n<ul>\n<li>Conditional payments where funds are transferred only if certain conditions are met.</li>\n<li>Micropayments and streaming payments where instant confirmation is essential.</li>\n</ul>\n<h4><a name=\"design-and-implementation-17\" class=\"anchor\" href=\"https://ethresear.ch#design-and-implementation-17\"></a>Design and Implementation</h4>\n<p>Our system architecture supports offline participation through the use of off-chain payment channels and ZKPs.</p>\n<p><strong>Architectural Design:</strong></p>\n<ul>\n<li>Off-chain transactions are facilitated by payment channels.</li>\n<li>ZKPs are used to verify the conditions for transaction finality.</li>\n</ul>\n<p><strong>Technical Implementation:</strong></p>\n<p><strong>Algorithm 3 Off-Chain Transaction with ZKP</strong></p>\n<pre><code class=\"lang-auto\">Require: Initial channel state S0, transactions T1, T2, . . . , Tn\nEnsure: Final channel state Sn\n1: for each transaction Ti do\n2: Verify ZKP for Ti\n3: if ZKP is valid then\n4: Update channel state Si\n5: end if\n6: end for\n7: Record final state on-chain\n</code></pre>\n<h4><a name=\"security-and-reliability-18\" class=\"anchor\" href=\"https://ethresear.ch#security-and-reliability-18\"></a>Security and Reliability</h4>\n<p>Ensuring the security and reliability of offline participants is crucial. Our approach includes several mechanisms to protect users and ensure transaction integrity.</p>\n<p><strong>Security Measures:</strong></p>\n<ul>\n<li>Secure channel opening and closing procedures.</li>\n<li>ZKPs to verify transaction conditions.</li>\n</ul>\n<p><strong>Dispute Resolution:</strong></p>\n<ul>\n<li>Disputes are resolved by submitting ZKPs to the blockchain, which verifies the validity of the disputed transaction.</li>\n</ul>\n<h4><a name=\"benefits-and-user-experience-19\" class=\"anchor\" href=\"https://ethresear.ch#benefits-and-user-experience-19\"></a>Benefits and User Experience</h4>\n<p>Our approach offers several benefits to users, including reduced operational burdens and increased flexibility.</p>\n<p><strong>Advantages:</strong></p>\n<ul>\n<li><strong>Operational Efficiency:</strong> Users do not need to remain online continuously.</li>\n<li><strong>Flexibility:</strong> Participants can transact at their convenience.</li>\n</ul>\n<h3><a name=\"capital-efficiency-20\" class=\"anchor\" href=\"https://ethresear.ch#capital-efficiency-20\"></a>Capital Efficiency</h3>\n<p>The unified liquidity pool ensures efficient use of locked funds, as they can be dynamically allocated where needed most. This reduces the amount of idle capital and optimizes liquidity management.</p>\n<p><strong>Lemma 2 (Capital Efficiency Improvement):</strong> The unified staking pool and dynamic allocation mechanism improve capital efficiency compared to traditional channel-specific staking approaches.</p>\n<p><strong>Proof 7:</strong> In traditional channel-specific staking, funds are locked in individual channels and cannot be reused or reallocated, leading to idle capital and suboptimal liquidity utilization. The unified staking pool, on the other hand, aggregates funds from multiple participants and dynamically allocates them across channels based on demand. This approach minimizes idle capital and optimizes liquidity utilization, as funds can be efficiently moved to channels with higher demand. Therefore, the unified staking pool and dynamic allocation mechanism improve capital efficiency compared to traditional approaches.</p>\n<h3><a name=\"instant-finality-21\" class=\"anchor\" href=\"https://ethresear.ch#instant-finality-21\"></a>Instant Finality</h3>\n<p>Transactions are confirmed instantly off-chain, similar to the Lightning Network, making the system suitable for real-time payments. Zero-knowledge proofs ensure that transactions are final and secure without the need for trust.</p>\n<p><strong>Lemma 3 (Instant Finality Advantage):</strong> Instant finality provided by off-chain payment channels and ZKP-based conditional payments enables real-time transactions and reduces confirmation latency compared to on-chain settlements.</p>\n<p><strong>Proof 8:</strong> On-chain transactions require multiple block confirmations to be considered final, introducing significant latency. In contrast, off-chain payment channels enable instant confirmation of transactions between channel participants. Conditional payments verified by ZKPs further enhance the security and finality of these transactions. As a result, the instant finality mechanism reduces confirmation latency and enables real-time payments, providing a significant advantage over on-chain settlements.</p>\n<h3><a name=\"complexity-for-operators-22\" class=\"anchor\" href=\"https://ethresear.ch#complexity-for-operators-22\"></a>Complexity for Operators</h3>\n<p>Smart contracts handle dynamic allocation and verification, reducing the operational burden on operators. The use of recursive ZKPs simplifies the verification process, making it easier to manage multiple channels.</p>\n<p><strong>Lemma 4 (Operator Complexity Reduction):</strong> Smart contracts and recursive ZKPs reduce the operational complexity for channel operators compared to manual liquidity management and individual proof verification.</p>\n<p><strong>Proof 9:</strong> In a manual liquidity management setup, operators need to continuously monitor channel balances and manually allocate funds, which is time-consuming and error-prone. Similarly, verifying individual proofs for each transaction across multiple channels is computationally intensive. By employing smart contracts for dynamic allocation and recursive ZKPs for aggregated verification, the operational burden on operators is significantly reduced. Smart contracts automate liquidity management based on predefined rules, while recursive ZKPs simplify the verification process by aggregating proofs from multiple transactions and channels. This reduction in complexity allows operators to manage more channels efficiently and focus on other aspects of the system.</p>\n<h3><a name=\"operator-risk-23\" class=\"anchor\" href=\"https://ethresear.ch#operator-risk-23\"></a>Operator Risk</h3>\n<p>By sharing liquidity across multiple channels and dynamically allocating funds, the risk of liquidity shortages and insolvency is minimized. Automated safeguards provided by smart contracts protect operators.</p>\n<p><strong>Lemma 5 (Operator Risk Mitigation):</strong> The unified staking pool and dynamic allocation mechanism mitigate the risk of liquidity shortages and insolvency for channel operators compared to channel-specific staking.</p>\n<p><strong>Proof 10:</strong> In a channel-specific staking setup, operators face the risk of liquidity shortages if the locked funds in a particular channel are insufficient to handle incoming transactions. This can lead to delays, failed transactions, and potential insolvency. The unified staking pool mitigates this risk by aggregating funds from multiple participants and dynamically allocating them across channels based on demand. If one channel experiences a shortage, funds can be quickly reallocated from other channels to meet the demand. Moreover, smart contracts implementing the unified staking pool can enforce automated safeguards, such as minimum balance thresholds and emergency liquidity provisions, further protecting operators from liquidity risks.</p>\n<h3><a name=\"challenge-periods-and-dispute-resolution-24\" class=\"anchor\" href=\"https://ethresear.ch#challenge-periods-and-dispute-resolution-24\"></a>Challenge Periods and Dispute Resolution</h3>\n<p>Aggregated proofs and instant verification reduce the need for lengthy challenge periods and simplify dispute resolution. Recursive ZKPs ensure that the state across interconnected channels is consistently maintained and verifiable.</p>\n<p><strong>Lemma 6 (Simplified Dispute Resolution):</strong> Aggregated proofs and instant verification using recursive ZKPs simplify dispute resolution and reduce the reliance on lengthy challenge periods compared to traditional cross-channel dispute mechanisms.</p>\n<p><strong>Proof 11:</strong> In traditional cross-channel dispute resolution, each</p>\n<p>channel maintains its own state, and disputes are resolved through a lengthy challenge-response process. This involves providing evidence for individual transactions and waiting for a challenge period to expire before the dispute is settled. With aggregated proofs and instant verification using recursive ZKPs, the state across interconnected channels is consistently maintained and can be efficiently verified. If a dispute arises, the aggregated proof can be quickly checked to determine the validity of the disputed transaction, without the need for a lengthy challenge period. This simplified dispute resolution process reduces the time and complexity associated with resolving cross-channel disputes.</p>\n<h3><a name=\"dependence-on-zkps-25\" class=\"anchor\" href=\"https://ethresear.ch#dependence-on-zkps-25\"></a>Dependence on ZKPs</h3>\n<p>While reliance on ZKPs remains, their use in aggregation and instant verification can optimize computational efficiency. Developing scalable infrastructure for ZKP generation and verification can mitigate the overhead.</p>\n<p><strong>Lemma 7 (ZKP Efficiency Optimization):</strong> The use of recursive ZKPs for aggregation and instant verification optimizes the computational efficiency of ZKP-based systems compared to individual proof generation and verification.</p>\n<p><strong>Proof 12:</strong> Generating and verifying ZKPs for each individual transaction can be computationally expensive, especially as the number of transactions and channels grows. By employing recursive ZKPs, multiple proofs can be aggregated into a single proof, reducing the overall proof size and verification complexity. Instead of verifying each proof separately, the verifier only needs to check the aggregated proof, which is more efficient. Moreover, instant verification using ZKPs eliminates the need for lengthy waiting periods, further optimizing the computational overhead. While the reliance on ZKPs remains, the use of recursive ZKPs and instant verification helps mitigate the computational burden associated with ZKP-based systems.</p>\n<h3><a name=\"limited-scope-of-statelessness-26\" class=\"anchor\" href=\"https://ethresear.ch#limited-scope-of-statelessness-26\"></a>Limited Scope of Statelessness</h3>\n<p>The unified liquidity pool and dynamic allocation extend the benefits of statelessness to more complex transactions and applications. The approach supports a wider range of stateless applications beyond simple payments.</p>\n<p><strong>Lemma 8 (Extended Statelessness Scope):</strong> The unified liquidity pool and dynamic allocation mechanism extend the scope of statelessness to support more complex transactions and applications compared to traditional stateless payment channels.</p>\n<p><strong>Proof 13:</strong> Traditional stateless payment channels are limited to simple payment transactions between two parties, where the channel state is not maintained. The unified liquidity pool and dynamic allocation mechanism introduced in this paper extend the scope of statelessness to support more complex transactions and applications. By aggregating funds from multiple participants and dynamically allocating them across channels, the system enables stateless execution of cross-channel transactions and multi-party interactions. The use of recursive ZKPs and smart contract hierarchies further enhances the capabilities of stateless operations, allowing for efficient verification and management of complex state transitions. As a result, the proposed approach expands the range of stateless applications beyond simple payments, enabling the development of more sophisticated stateless protocols and services.</p>\n<h3><a name=\"forced-inclusion-mechanism-27\" class=\"anchor\" href=\"https://ethresear.ch#forced-inclusion-mechanism-27\"></a>Forced Inclusion Mechanism</h3>\n<p>With instant finality, the need for forced inclusion mechanisms is reduced, as transactions are confirmed off-chain instantly. Zero-knowledge proofs ensure that once conditions are met, transactions are final and included without the risk of censorship.</p>\n<p><strong>Lemma 9 (Reduced Reliance on Forced Inclusion):</strong> Instant finality provided by off-chain payment channels and ZKP-based conditional payments reduces the reliance on forced inclusion mechanisms compared to on-chain transaction inclusion.</p>\n<p><strong>Proof 14:</strong> In on-chain transaction inclusion, there is a risk of censorship or delayed inclusion, as miners or validators may prioritize certain transactions over others. Forced inclusion mechanisms, such as transaction pinning or priority fees, are often employed to ensure that transactions are included in a timely manner. However, with instant finality achieved through off-chain payment channels and ZKP-based conditional payments, transactions are confirmed instantly without relying on the underlying blockchain. Once the conditions specified in the ZKP are met, the transaction is considered final and irreversible, eliminating the need for forced inclusion. This reduces the reliance on additional inclusion mechanisms and provides a more censorship-resistant and predictable transaction confirmation process.</p>\n<h1><a name=\"la-fin-28\" class=\"anchor\" href=\"https://ethresear.ch#la-fin-28\"></a>LA FIN</h1>\n            <p><small>7 posts - 2 participants</small></p>\n            <p><a href=\"https://ethresear.ch/t/plasma-next-next-beetlejuice-beetlejuice/19655\">Read full topic</a></p>","link":"https://ethresear.ch/t/plasma-next-next-beetlejuice-beetlejuice/19655","pubDate":"Mon, 27 May 2024 08:26:18 +0000","discourse:topicPinned":"No","discourse:topicClosed":"No","discourse:topicArchived":"No","guid":{"@isPermaLink":"false","#text":"ethresear.ch-topic-19655"},"source":{"@url":"https://ethresear.ch/t/plasma-next-next-beetlejuice-beetlejuice/19655.rss","#text":"Plasma Next Next (Beetlejuice Beetlejuice)"},"filter":false},{"title":"Credibly Neutral Preconfirmation Collateral: The Preconfirmation Registry","dc:creator":"mteam88","category":"Layer 2","description":"<h1><a name=\"credibly-neutral-preconfirmation-collateral-1\" class=\"anchor\" href=\"https://ethresear.ch#credibly-neutral-preconfirmation-collateral-1\"></a>Credibly Neutral Preconfirmation Collateral</h1>\n<p>by <a href=\"https://x.com/mteamisloading\" rel=\"noopener nofollow ugc\">mteam</a> from <a href=\"https://x.com/Spire_Labs\" rel=\"noopener nofollow ugc\">Spire Labs</a><br>\ninspired+reviewed by <a href=\"https://x.com/drakefjustin\" rel=\"noopener nofollow ugc\">Justin Drake</a>.<br>\nreviewed by <a href=\"https://x.com/lvdaniels\" rel=\"noopener nofollow ugc\">Ladislaus</a>, <a href=\"https://x.com/MuratLite\" rel=\"noopener nofollow ugc\">Murat</a>, and others.<br>\n.<br>\n.<br>\n<em><strong>tl;dr</strong><br>\nWe introduce a design for a credibly neutral preconfirmations registry that solves the collateral problem for solo-stakers who want to earn additional yield from preconfs, while simultaneously improving capital efficiency for large operators who would like to opt-in to preconfirmations.</em><br>\n.<br>\n.</p>\n<h2><a name=\"introduction-2\" class=\"anchor\" href=\"https://ethresear.ch#introduction-2\"></a>Introduction</h2>\n<p>There is a fundamental requirement of any proposer-commitment design that the L1 proposer must post some collateral. This is true for Based Preconfirmations (even with delegation) and other systems. This collateral is necessary because, according to the Ethereum protocol, a L1 proposer always has the option to self-build a block. The block that they build may violate commitments that they have made (or that other delegated entities have made).</p>\n<p>In the next few paragraphs, we introduce a simple system for proposer to post this collateral in ETH (the most credibly neutral collateral). This system also enables large operators and solo-stakers alike to post collateral in efficient ways.</p>\n<p><em>See <a href=\"https://docs.google.com/presentation/d/1M5nEpjSuEnuew_P8bdLIk-zZ-v55mWgbeiZ5czto8bI/edit?usp=sharing\" rel=\"noopener nofollow ugc\">my presentation introducing this topic</a> for another intro.</em></p>\n<h2><a name=\"onchain-construction-3\" class=\"anchor\" href=\"https://ethresear.ch#onchain-construction-3\"></a>Onchain Construction</h2>\n<p>The onchain construction is very simple:</p>\n<p>We introduce the <code>PreconfirmationRegistry</code> L1 smart contract that serves as a source of collateral for backing preconfirmations.</p>\n<p>The contract provides 4 functionalities:</p>\n<h3><a name=\"penalties-4\" class=\"anchor\" href=\"https://ethresear.ch#penalties-4\"></a>Penalties</h3>\n<p>The <code>PreconfirmationRegistry</code> facilitates penalty application (i.e. slashing, freezing).</p>\n<p>Delegates can choose what slashing conditions to opt-in to. These slashing conditions can be described using an EVM bytecode function.</p>\n<h3><a name=\"registration-5\" class=\"anchor\" href=\"https://ethresear.ch#registration-5\"></a>Registration</h3>\n<p>The <code>PreconfirmationRegistry</code> provides a way for a registrant to post ETH as collateral. A registrant can be any entity, it is represented in the registry as an Ethereum address.</p>\n<p>Let a <strong>registrant’s collateral balance</strong> = ETH deposited - ETH currently penalized - ETH withdrawn.</p>\n<h3><a name=\"delegation-6\" class=\"anchor\" href=\"https://ethresear.ch#delegation-6\"></a>Delegation</h3>\n<p>Allows registrants to delegate their collateral to proposers.</p>\n<p>Can be used to delegate to any proposer.</p>\n<p>Let a <strong>proposer’s collateral balance</strong> be the sum of the registrant collateral balance of all registrants that have delegated to them.</p>\n<p>If a proposer’s collateral balance is above a parameter, <code>MINIMUM_COLLATERAL</code>, they are a preconfer. If a proposer’s collateral balance falls below <code>MINIMUM_COLLATERAL</code>, they are no longer considered a preconfer.</p>\n<p>When a penalty is applied to a preconfer, the penalty is applied to the registrant collateral of any registrants who delegate to the offending preconfer. The penalty is split proportionally amongst the collateral that is delegated to a proposer.</p>\n<p><em>Note: Delegation can be done offchain and validated onchain in the case of a slashing event. Offchain signatures need to be shared publicly so that others (gateways) can verify that a given proposer is a preconfer.</em></p>\n<h3><a name=\"leader-election-7\" class=\"anchor\" href=\"https://ethresear.ch#leader-election-7\"></a>Leader Election</h3>\n<p>The <code>PrceonfirmationRegistry</code> also elects a leader for the current L1 slot. It does this by checking the lookahead to determine the next proposer in line who is a preconfer (meets the <code>MINIMUM_COLLATERAL</code> threshold.) Based Rollups can select this elected leader as the sequencer for their chains to achieve composability through shared sequencing.</p>\n<p>We call this leader the <strong>registry sponsored leader</strong>. Any rollup interested in composability can use this leader. Rollups that have other requirements for their leader (regulatory, financial) can use their own leader election system, but may ise the registry sponsored leader as a starting point.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/d/3/d3d476034f8a84825dfc2b477c02d88c53eef94f.png\" data-download-href=\"https://ethresear.ch/uploads/default/d3d476034f8a84825dfc2b477c02d88c53eef94f\" title=\"image\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/d/3/d3d476034f8a84825dfc2b477c02d88c53eef94f_2_690x394.png\" alt=\"image\" data-base62-sha1=\"udVWooZBrw6qHCBCeH4xBNck9CT\" width=\"690\" height=\"394\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/d/3/d3d476034f8a84825dfc2b477c02d88c53eef94f_2_690x394.png, https://ethresear.ch/uploads/default/optimized/3X/d/3/d3d476034f8a84825dfc2b477c02d88c53eef94f_2_1035x591.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/d/3/d3d476034f8a84825dfc2b477c02d88c53eef94f_2_1380x788.png 2x\" data-dominant-color=\"E9F0EA\"></a></div><p></p>\n<h2><a name=\"offchain-construction-8\" class=\"anchor\" href=\"https://ethresear.ch#offchain-construction-8\"></a>Offchain Construction</h2>\n<h3><a name=\"underwriters-9\" class=\"anchor\" href=\"https://ethresear.ch#underwriters-9\"></a>Underwriters</h3>\n<p>The most important offchain construction that we introduce is the Underwriter. The Underwriter acts as a registrant and posts at least <code>MINIMUM_COLLATERAL</code> ETH as collateral to the <code>PreconfirmationRegistry</code> contract on behalf of a group of proposers. The Underwriter accepts collateral from proposers in any form (a liquid staking token, equity, reputation).</p>\n<p>Underwriters could be trustless DeFi applications, offchain market makers, etc.</p>\n<h3><a name=\"proposer-pools-10\" class=\"anchor\" href=\"https://ethresear.ch#proposer-pools-10\"></a>Proposer Pools</h3>\n<p>While large staking operators form large trust networks between many proposers and can provide collateral on their own, solo-stakers do not have the same access to resources.</p>\n<p>Solo-stakers may form “Proposer Pools” of a collection of proposers, all restaking their ETH to a single registrant (through an underwriter) to reach a registrant balance of <code>MINIMUM_COLLATERAL</code> or more.</p>\n<p><em>Note: Proposer pools have a 1/n trust model: a single proposer could renege on preconfirmation promises for a significant profit but the entire pool would be penalized. To disincentivize this situation, proposer pools could be designed so that EL rewards are distributed between all proposers in the pool (similar to smoothing pools). With a MaxEB increase above <code>MINIMUM_COLLATERAL</code> and DVT, the trust model becomes n/3.</em></p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/a/9/a9982df96fdbf69566a89c5cc1e4306b9bca08d4.png\" data-download-href=\"https://ethresear.ch/uploads/default/a9982df96fdbf69566a89c5cc1e4306b9bca08d4\" title=\"image\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/a/9/a9982df96fdbf69566a89c5cc1e4306b9bca08d4_2_454x500.png\" alt=\"image\" data-base62-sha1=\"ociJCi8J8RpsBFe52mwVXGXk3Mo\" width=\"454\" height=\"500\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/a/9/a9982df96fdbf69566a89c5cc1e4306b9bca08d4_2_454x500.png, https://ethresear.ch/uploads/default/optimized/3X/a/9/a9982df96fdbf69566a89c5cc1e4306b9bca08d4_2_681x750.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/a/9/a9982df96fdbf69566a89c5cc1e4306b9bca08d4_2_908x1000.png 2x\" data-dominant-color=\"E9F0EA\"></a></div><p></p>\n<h2><a name=\"considerations-11\" class=\"anchor\" href=\"https://ethresear.ch#considerations-11\"></a>Considerations</h2>\n<ul>\n<li><strong><a href=\"https://nakamoto.com/credible-neutrality/\" rel=\"noopener nofollow ugc\">credible neutrality:</a></strong> The <code>PreconfirmationRegistry</code> only accepts the purest form of collateral: ETH. This avoids any dependence on any LST/LRT and minimizes smart contract risk.</li>\n<li><strong>centralization:</strong> The <code>PreconfirmationRegistry</code> does not introduce any permissioned actors. Underwriter centralization is not dangerous to the protocol.</li>\n<li><strong>collateral depeg risk:</strong> An <a href=\"https://x.com/daedalus_angels/status/1787797086219419687\" rel=\"noopener nofollow ugc\">external collateral depeg</a> will not affect the collateral that backs preconfers. Underwriters are only vulnerable to permanent depegs as they are not forced to sell during a temporary depeg event.</li>\n<li><strong>smart contract risk:</strong> The <code>PreconfirmationRegistry</code> is a very simple contract but should be audited extensively. Underwriters are especially incentivized to audit the <code>PreconfirmationRegistry</code> contract.</li>\n<li><strong>roadmap compatibility:</strong> Proposer Pools have even better trust models with a <a href=\"https://ethresear.ch/t/increase-the-max-effective-balance-a-modest-proposal/15801\">MaxEB increase</a> like <a href=\"https://eips.ethereum.org/EIPS/eip-7251\" rel=\"noopener nofollow ugc\">EIP-7251</a> and <a href=\"https://ethereum.org/en/staking/dvt/\" rel=\"noopener nofollow ugc\">DVT.</a> With <a href=\"https://ethresear.ch/t/why-enshrine-proposer-builder-separation-a-viable-path-to-epbs/15710\">ePBS</a>, <a href=\"https://ethresear.ch/t/execution-tickets/17944/1\">Execution Tickets</a>, <a href=\"https://mirror.xyz/barnabe.eth/QJ6W0mmyOwjec-2zuH6lZb0iEI2aYFB9gE-LHWIMzjQ\" rel=\"noopener nofollow ugc\">Execution Auctions / APS-Burn</a> or any other upgrade where proposers do not serve as monopoly sequencers, the <code>PreconfirmationRegistry</code> is no longer useful.</li>\n<li><strong>mass exits:</strong> To avoid a situation where a registrant withdraws collateral that is actively backing a preconfirmation, exits must be delayed. This mandates that there are three states that a proposer can exist in: <code>[INCLUDER, EXITING, PRECONFER]</code>. New preconfirmations should not be backed by collateral from <code>EXITING</code> proposers.</li>\n<li><strong>forced ejection:</strong> In a penalty event, some preconfers may no longer have enough unpenalized collateral to back their preconfirmations. If these preconfers are in the lookahead and actively providing preconfirmations, they must be immediately exited and treated as <code>INCLUDER</code> proposers. Registrants who wish to avoid forced ejection of their delegated proposers should top up their registrant balance to a level significantly higher than <code>MINIMUM_COLLATERAL</code>.</li>\n<li><strong>Preconf Chaining:</strong> Most preconfirmations are only backed by a single proposer (and therefore a single collateral balance), this enables registrants to delegate to many proposers simultaneously. There may be situations where preconfirmations are backed by multiple proposers (think conditional preconfirmations or multi-block preconfirmations). In these situations, the collateral that backs a preconfirmation is the combined <em>unique</em> proposer collateral balance of proposers involved. The odds of preconf chains applying to proposers using the same collateral are higher for registrants with more delegates, and therefore registrants who can afford to post extra collateral.</li>\n</ul>\n<h2><a name=\"bonus-dynamic-collateral-requirements-12\" class=\"anchor\" href=\"https://ethresear.ch#bonus-dynamic-collateral-requirements-12\"></a>Bonus: Dynamic Collateral Requirements</h2>\n<p>The <code>MINIMUM_COLLATERAL</code> parameter is a key parameter for preconfirmation security and bootstrapping a robust Preconfer set. Setting <code>MINIMUM_COLLATERAL</code> ex-ante for all preconfirmations may lead to inefficiencies. For example, many retail users don’t need thousands of ETH backing their preconfirmations. Indeed, many types of transactions (ETH/ERC20 transfers) are time-insensitive; preconfirmations for these transactions do not require huge amounts of collateral.</p>\n<p>The solution to this inefficiency is setting a low <code>MINIMUM_COLLATERAL</code> parameter and allowing users to set their own collateral requirements (along the lines of <a href=\"https://ethresear.ch/t/user-defined-penalties-ensuring-honest-preconf-behavior/19545\">User-Defined Penalties: Ensuring Honest Preconf Behavior</a> by <a href=\"https://x.com/_JonahB_\" rel=\"noopener nofollow ugc\">Jonah from Blockchain Capital</a>).</p>\n<p>Note that it is still necessary to set a <code>MINIMUM_COLLATERAL</code> value that is significant (likely more than 32 ETH) to avoid an adverse selection problem: A user might not be able to get a preconfirmation with a high collateral backing if a low-collateral Preconfer is first in the lookahead, even if a high-collateral Preconfer is next. More research is required to determine this parameter.</p>\n<h2><a name=\"bonus-slashing-conditions-13\" class=\"anchor\" href=\"https://ethresear.ch#bonus-slashing-conditions-13\"></a>Bonus: Slashing Conditions</h2>\n<p>Slashing conditions represent generic agreements between proposers and users. Delegates (proposers) can choose what slashing conditions to use. To declare their preferences, delegates can sign off on EVM bytecode that represents a function. When executed, this bytecode returns the penalties that should be applied:</p>\n<pre data-code-wrap=\"solidity\"><code class=\"lang-plaintext\">struct Penalty {\n    uint weiSlashed,\n    uint weiFrozen,\n    uint blocksFrozen,\n    // other penalties //\n}\n</code></pre>\n<p>Rollups that want to incentivize proposers to adopt their slashing conditions can set up incentives (tokens, fees, etc.) out of the registry.</p>\n<p><em><strong>Note:</strong> Registrants might also choose slashing conditions for their delegates. For example, an Underwriter might accept collateral from an operator and register with the slashing conditions that the operator desires. This simply a way for operators to manage the slashing conditions that they need to think about.</em></p>\n<hr>\n<p><strong>References + Resources</strong><br>\nAll documents used can be found <a href=\"https://mteam.space/eth-sequencing-preconfs-resources/\" rel=\"noopener nofollow ugc\">here</a>.</p>\n<p>Especially useful:</p>\n<ul>\n<li><a href=\"https://x.com/drakefjustin\" rel=\"noopener nofollow ugc\">Justin’s</a> <a href=\"https://ethresear.ch/t/based-rollups-superpowers-from-l1-sequencing/15016\">Based Rollup</a> post</li>\n<li><a href=\"https://x.com/drakefjustin\" rel=\"noopener nofollow ugc\">Justin’s</a> <a href=\"https://ethresear.ch/t/based-preconfirmations/17353\">Based Preconfirmations</a> post</li>\n<li><a href=\"https://x.com/_JonahB_\" rel=\"noopener nofollow ugc\">Jonah’s</a> <a href=\"https://ethresear.ch/t/user-defined-penalties-ensuring-honest-preconf-behavior/19545\">User-Defined Penalties…</a> post</li>\n<li><a href=\"https://limechain.tech/\" rel=\"noopener nofollow ugc\">Limechain’s</a> <a href=\"https://github.com/LimeChain/based-preconfirmations-research\" rel=\"noopener nofollow ugc\">Based Preconfirmations Research</a> repo</li>\n</ul>\n<p>Similar (unrelated) work:</p>\n<ul>\n<li><a href=\"https://primev.xyz\" rel=\"noopener nofollow ugc\">Primev’s</a> <a href=\"https://docs.primev.xyz/developers/contracts\" rel=\"noopener nofollow ugc\">Registry</a></li>\n<li><a href=\"https://puffer.fi\" rel=\"noopener nofollow ugc\">Puffer’s</a> <a href=\"https://docs.puffer.fi/nodes/registration\" rel=\"noopener nofollow ugc\">Registration System</a></li>\n<li><a href=\"https://x.com/cairoeth\" rel=\"noopener nofollow ugc\">Cairo’s</a> <a href=\"https://ethresear.ch/t/towards-an-implementation-of-based-preconfirmations-leveraging-restaking/19211\">preconf-operator code</a></li>\n<li>various <a href=\"https://ethstaker.cc/smoothing-pools\" rel=\"noopener nofollow ugc\">Smoothing Pool</a> designs</li>\n</ul>\n            <p><small>1 post - 1 participant</small></p>\n            <p><a href=\"https://ethresear.ch/t/credibly-neutral-preconfirmation-collateral-the-preconfirmation-registry/19634\">Read full topic</a></p>","link":"https://ethresear.ch/t/credibly-neutral-preconfirmation-collateral-the-preconfirmation-registry/19634","pubDate":"Fri, 24 May 2024 21:34:51 +0000","discourse:topicPinned":"No","discourse:topicClosed":"No","discourse:topicArchived":"No","guid":{"@isPermaLink":"false","#text":"ethresear.ch-topic-19634"},"source":{"@url":"https://ethresear.ch/t/credibly-neutral-preconfirmation-collateral-the-preconfirmation-registry/19634.rss","#text":"Credibly Neutral Preconfirmation Collateral: The Preconfirmation Registry"},"filter":false},{"title":"Anonymous Inclusion Lists (anon-ILs)","dc:creator":"soispoke","category":"Cryptography","description":"<p>by <a href=\"https://ethresear.ch/u/soispoke/summary\">Thomas Thiery</a> and <a href=\"https://x.com/luca_zanolini\" rel=\"noopener nofollow ugc\">Luca Zanolini</a>, in collaboration with <a href=\"https://ethresear.ch/u/mmaller/summary\">Mary Maller</a>, <a href=\"https://x.com/Simk1n\" rel=\"noopener nofollow ugc\">Mark Simkin</a>, and <a href=\"https://ethresear.ch/u/asanso/summary\">Antonio Sanso</a></p>\n<p>– May 23rd, 2024</p>\n<p><em>Special thanks to <a href=\"https://ethresear.ch/u/julian/summary\">Julian Ma</a>, <a href=\"https://ethresear.ch/u/barnabe/summary\">Barnabé Monnot</a> and <a href=\"https://ethresear.ch/u/fradamt/summary\">Francesco D’Amato</a> for helpful comments and feedback.</em></p>\n<h2><a name=\"introduction-1\" class=\"anchor\" href=\"https://ethresear.ch#introduction-1\"></a>Introduction</h2>\n<p>Relying on a few sophisticated entities for building blocks on Ethereum weakens the network’s censorship resistance properties. Currently, more than <a href=\"https://censorship.pics/\" rel=\"noopener nofollow ugc\">60% of blocks</a> are made by builders who actively censor transactions interacting with sanctioned addresses. As a result, there has been renewed interest in finding ways to enable the <a href=\"https://www.ethernodes.org/countries\" rel=\"noopener nofollow ugc\">more decentralized set</a> of proposers to force-include transactions in Ethereum blocks. This interest has materialized in <a href=\"https://github.com/michaelneuder/mev-bibliography?tab=readme-ov-file#censorship-resistance\" rel=\"noopener nofollow ugc\">research and development</a> efforts focused on Inclusion Lists (ILs). Significant progress has been made towards the first practical implementation of ILs, which is currently considered for inclusion in the upcoming Pectra fork (see <a href=\"https://ethresear.ch/t/no-free-lunch-a-new-inclusion-list-design/16389\">design</a>, <a href=\"https://eips.ethereum.org/EIPS/eip-7547\" rel=\"noopener nofollow ugc\">EIP</a>, and <a href=\"https://notes.ethereum.org/@mikeneuder/il-spec-overview\" rel=\"noopener nofollow ugc\">specs</a> <a href=\"https://gist.github.com/michaelneuder/ba32e608c75d48719a7ecba29ec3d64b\" rel=\"noopener nofollow ugc\">here</a>).</p>\n<p>Concurrent efforts have focused on improving the robustness of IL designs by limiting dependence on single entities for creating and proposing ILs, such as through <a href=\"https://ethresear.ch/t/the-more-the-less-censored-introducing-committee-enforced-inclusion-sets-comis-on-ethereum/18835\">Committee-enforced Inclusion Sets (COMIS)</a> and <a href=\"https://ethresear.ch/t/concurrent-block-proposers-in-ethereum/18777/6\">Multiple Concurrent Proposers</a>. However, to our knowledge, no efforts have been made to develop a mechanism that protects the identity of participants involved in the construction of an IL, while also reducing the surface for <a href=\"https://ethresear.ch/t/fun-and-games-with-inclusion-lists/16557\">commitment attack vectors</a> like bribing and extortion games.</p>\n<p>Protecting the identity of IL proposers is crucial to ensure privacy, safeguard against any form of accountability or identity reveal, and boost the adoption of ILs on Ethereum. This principle is akin to the confidentiality provided in voting systems, where participants can express their preferences without the risk of exposure or retaliation (e.g., legal repercussions). Here, we address this gap by introducing anonymous Inclusion Lists (anon-IL), a design that leverages linkable ring signatures and an anonymous broadcast protocol (ABP) to anonymize IL proposers on Ethereum.</p>\n<h4><a name=\"disclaimer-2\" class=\"anchor\" href=\"https://ethresear.ch#disclaimer-2\"></a>Disclaimer</h4>\n<p>This post is intended as an initial exploration of a distributed mechanism for anonymizing IL proposers, setting the stage for future research and discussions. We build the mechanism in a modular fashion, detailing each module’s role and the properties we believe are necessary to achieve anonymity. These modules can be swapped with others or studied as independent building blocks.</p>\n<h2><a name=\"high-level-idea-3\" class=\"anchor\" href=\"https://ethresear.ch#high-level-idea-3\"></a>High-level idea</h2>\n<p>Every slot <code>n</code>, a subset <span class=\"math\">C</span> of the beacon committee, referred to as the IL committee, is randomly selected from validators to participate in the construction of a global inclusion list (<span class=\"math\">IL^G</span>), composed of transactions <span class=\"math\">t</span> pending in the mempool. During the construction of <span class=\"math\">IL^G</span>, a subset <span class=\"math\">P</span> of IL committee members are secretly elected to become IL proposers and create, sign, and disseminate local inclusion lists <span class=\"math\">IL^L</span> without revealing their identities (<strong>Round 1</strong>). A randomly selected IL proposer, the IL aggregator <span class=\"math\">A</span>, collects all observed <span class=\"math\">IL^L</span> to create and distribute the raw <span class=\"math\">IL^G</span> transactions and their associated <span class=\"math\">IL^G_\\text{summary}</span> to the rest of <span class=\"math\">IL</span>  committee members, who then vote on the <span class=\"math\">IL^G_\\text{summary}</span> validity (<strong>Round 2</strong>). Figure 1. illustrates how <span class=\"math\">P</span>, <span class=\"math\">C</span> and <span class=\"math\">A</span> are selected from validators in the beacon committee. If deemed valid, block <code>n+1</code> must include the <span class=\"math\">IL^G_\\text{summary}</span>, a quorum certificate proving its validity and the transactions that satisfy summary entries. Crucially, we use a linkable ring signature scheme and an anonymous broadcast protocol (ABP) to ensure IL committee members can sign and broadcast messages (ILs, votes) without revealing their identity.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/8/e/8eb6e389256d6deab365d99d43f65547bdfd3ac4.png\" data-download-href=\"https://ethresear.ch/uploads/default/8eb6e389256d6deab365d99d43f65547bdfd3ac4\" title=\"Screenshot 2024-05-13 at 10.38.02\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/8/e/8eb6e389256d6deab365d99d43f65547bdfd3ac4_2_507x500.png\" alt=\"Screenshot 2024-05-13 at 10.38.02\" data-base62-sha1=\"kmvDzwPMjP4cIuiUKsP5g3pBBvC\" width=\"507\" height=\"500\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/8/e/8eb6e389256d6deab365d99d43f65547bdfd3ac4_2_507x500.png, https://ethresear.ch/uploads/default/optimized/3X/8/e/8eb6e389256d6deab365d99d43f65547bdfd3ac4_2_760x750.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/8/e/8eb6e389256d6deab365d99d43f65547bdfd3ac4_2_1014x1000.png 2x\" data-dominant-color=\"F0F0F0\"></a></div><p></p>\n<blockquote>\n<p><strong>Figure 1.</strong> <strong>Anon-IL participant selection.</strong> In each slot, 256 validators are randomly selected from the beacon committee to form the publicly known IL committee <span class=\"math\">C</span>. Half of the IL committee members (i.e., <code>≈128</code>), the IL proposers <span class=\"math\">P</span>, are secretly elected to participate in the IL construction. One of these proposers is randomly selected to serve as the IL aggregator <span class=\"math\">A</span>, who is in charge of gossiping the final global IL so it can be validated by other IL proposers.</p>\n</blockquote>\n<h2><a name=\"design-4\" class=\"anchor\" href=\"https://ethresear.ch#design-4\"></a><strong>Design</strong></h2>\n<p>In this section, we illustrate (Figure 2.) and provide a step-by-step description of the anon-IL mechanism.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/e/c/ecbce502f9d9d77875579518d3612c95e78e5653.png\" data-download-href=\"https://ethresear.ch/uploads/default/ecbce502f9d9d77875579518d3612c95e78e5653\" title=\"Screenshot 2024-04-24 at 16.51.22\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/e/c/ecbce502f9d9d77875579518d3612c95e78e5653_2_690x375.png\" alt=\"Screenshot 2024-04-24 at 16.51.22\" data-base62-sha1=\"xMho2FddtvumC4sBDT19lgWCS5l\" width=\"690\" height=\"375\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/e/c/ecbce502f9d9d77875579518d3612c95e78e5653_2_690x375.png, https://ethresear.ch/uploads/default/optimized/3X/e/c/ecbce502f9d9d77875579518d3612c95e78e5653_2_1035x562.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/e/c/ecbce502f9d9d77875579518d3612c95e78e5653_2_1380x750.png 2x\" data-dominant-color=\"EEEEE9\"></a></div><p></p>\n<blockquote>\n<p><strong>Figure 2.</strong> <strong>Diagram illustrating the anon-IL design.</strong></p>\n</blockquote>\n<h3><a name=\"round-1-5\" class=\"anchor\" href=\"https://ethresear.ch#round-1-5\"></a><strong>Round 1</strong></h3>\n<ol>\n<li>In each slot, 256 validators are selected from the beacon committee to build inclusion lists. These <code>256</code> IL committee members are publicly known.</li>\n<li>Out of the <code>256</code> IL committee members, only half of them, on average (i.e., <code>≈128</code>) are secretly elected as IL proposers <span class=\"math\">P</span> to prepare local inclusion lists (<span class=\"math\">IL^L</span>) of transactions observed in the mempool and participate in a ring signature scheme. Each IL proposer signs their list using their private key, along with the public keys of all <code>256</code> IL committee members. Each IL proposer then gossips their <span class=\"math\">IL^L</span>, along with its ring signature, to a dedicated <code>inclusion_set</code> subnet through an ABP, before the slot <code>n</code> deadline <span class=\"math\">d</span>.</li>\n</ol>\n<h3><a name=\"round-2-6\" class=\"anchor\" href=\"https://ethresear.ch#round-2-6\"></a>Round 2</h3>\n<ol>\n<li>An IL aggregator is randomly selected amongst IL proposers that successfully sent commitments during the first round of the linkable ring signature scheme (see <em>Building Blocks</em> section below). Its role is to collect all observed <span class=\"math\">IL^L</span> before the deadline <span class=\"math\">d</span>, constructs a final, deduplicated global inclusion list (<span class=\"math\">IL^G</span>) if transactions are seen in more than the inclusion threshold (e.g., <code>10%</code>) of the available <span class=\"math\">IL^L\\text{s}</span>, and derives an <span class=\"math\">IL^G</span> summary from them. <span class=\"math\">IL^G_\\text{summary}</span>  consists of a list of (<code>address</code>, <code>gasLimit</code>) pairs, which specify the <code>from</code> and <code>gasLimit</code> for each transaction across all  <span class=\"math\">IL^L</span>. Each pair is referred to as an <code>Entry</code>. The aggregator’s <span class=\"math\">IL^G_\\text{summary}</span> with signatures from all IL proposers and the list of raw transactions corresponding to summary entries are then broadcast in the <code>inclusion_set</code> subnet using the ABP used in <strong>Round 1</strong>.</li>\n<li>IL proposers also collect all observed <span class=\"math\">IL^L</span>, and construct their own <span class=\"math\">IL^Gs</span> to evaluate the <span class=\"math\">IL^G_\\text{summary}</span> produced by the aggregator. If transactions in their own <span class=\"math\">IL^G</span> overlap with a given percentage of entries in the aggregator’s <span class=\"math\">IL^G_\\text{summary}</span>, they vote <code>TRUE</code>.  This step ensures a quality check on the global IL proposed by the aggregator, and prevents the generation of arbitrary ILs by a single party. To preserve the anonymity of voters, votes are also gossiped using the same ring signature scheme and ABP.  If enough <code>TRUE</code> votes are received, the IL aggregator (anonymously) broadcasts a valid  <span class=\"math\">IL^G_\\text{summary}</span>, <span class=\"math\">IL^G</span> raw transactions, and a quorum certificate that verifies the accumulation of sufficient <code>TRUE</code> votes (<img src=\"https://ethresear.ch/images/emoji/facebook_messenger/white_check_mark.png?v=12\" title=\":white_check_mark:\" class=\"emoji\" alt=\":white_check_mark:\" loading=\"lazy\" width=\"20\" height=\"20\">) over the global topic, via the ABP.</li>\n</ol>\n<h3><a name=\"block-validity-7\" class=\"anchor\" href=\"https://ethresear.ch#block-validity-7\"></a><strong>Block validity</strong></h3>\n<ol>\n<li>\n<p>To be considered valid, the block <code>n+1</code> must include:</p>\n<ul>\n<li>The <span class=\"math\">IL^G_\\text{summary}</span> and its associated quorum certificate <img src=\"https://ethresear.ch/images/emoji/facebook_messenger/white_check_mark.png?v=12\" title=\":white_check_mark:\" class=\"emoji\" alt=\":white_check_mark:\" loading=\"lazy\" width=\"20\" height=\"20\"></li>\n<li>Raw transactions satisfying the <span class=\"math\">IL^G_\\text{summary}</span> entries</li>\n</ul>\n<p>Attesters must verify whether the block proposed by proposer <code>n+1</code> included all transactions satisfying the valid <span class=\"math\">IL^G_\\text{summary}</span> entries gossiped by the aggregator, in addition to all other standard validity checks before casting an attestation for the block <code>n+1</code>.</p>\n<p>Upon confirming the block’s validity, attesters cast an attestation for block <code>n+1</code>.</p>\n<p>If an <span class=\"math\">IL^G</span> is not made available on time or if a quorum of <code>TRUE</code> votes is not reached, block <code>n+1</code> is valid without including transactions satisfying an IL.</p>\n</li>\n</ol>\n<h2><a name=\"building-blocks-8\" class=\"anchor\" href=\"https://ethresear.ch#building-blocks-8\"></a><strong>Building blocks</strong></h2>\n<p>In this section, we introduce the process for selecting validators to become IL committee members and present the two main components of anon-IL: a linkable ring signature scheme, which allows selected validators to sign their local inclusion lists and votes, thereby proving their membership in the IL committee without revealing their identity; and a synchronous anonymous broadcast protocol, which enables IL committee members to disseminate messages across the peer-to-peer subnet without their identities being revealed by network traffic patterns.</p>\n<h3><a name=\"linkable-ring-signatures-scheme-9\" class=\"anchor\" href=\"https://ethresear.ch#linkable-ring-signatures-scheme-9\"></a>Linkable ring signatures scheme</h3>\n<p>A linkable ring signature is a cryptographic construct that allows a member of a group (ring) to anonymously sign a message on behalf of the group. This type of signature ensures the following properties:</p>\n<ol>\n<li><strong>Anonymity</strong>: The identity of the signer is hidden within the group. Any member of the ring could have potentially signed the message, making it impossible to determine the actual signer.</li>\n<li><strong>Linkability</strong>: Even though the identity of the signer is hidden, it is possible to determine if two different messages were signed by the same member of the group. This is done without revealing which member it was. This property prevents double-signing by the same individual without revealing their identity.</li>\n</ol>\n<p>Each participant in the ring maintains a pair of public and private keys. The public keys are known to everyone and are collectively used to form the ring. The signer selects several public keys from the group, typically including their own, to create a ring. This selection is done such that it is impossible to identify who among the participants is the actual signer, preserving anonymity within the group. Importantly, verification of the signature is straightforward and does not require any special access or permissions; anyone with access to the public keys of the ring members can verify that the signature is valid and was created by one of the ring’s members. This ensures that any participant could potentially be the signer of a specific transaction, maintaining robust anonymity and security.</p>\n<p>For the anon-IL design, we use the <a href=\"https://eprint.iacr.org/2014/764.pdf\" rel=\"noopener nofollow ugc\">“one-out-of-many”</a> ring signature scheme by <a href=\"https://eprint.iacr.org/2014/764\" rel=\"noopener nofollow ugc\">Groth and Kohlweiss</a>. In this scheme, participants “<em>have public keys that are commitments and demonstrate knowledge of an opening for one of the commitments to unlinkably identify themselves as belonging to the group”</em>. The only cryptography this scheme relies on is group operations and hash functions. The zero-knowledge prover and verifier also work out of the box and do not need edits, making it particularly suited for the anon-IL use case. Finally, we expect it to scale well for the number of participants selected in the IL committee.</p>\n<h3><a name=\"il-committee-selection-10\" class=\"anchor\" href=\"https://ethresear.ch#il-committee-selection-10\"></a>IL committee selection</h3>\n<ul>\n<li>Each slot, <code>256</code> validators in the beacon committee are randomly chosen to form the IL committee <span class=\"math\">C</span> (i.e., the ring). These IL committee members have to send a commitment to prove they are part of the ring.</li>\n<li>Half of the IL committee members (<code>128</code>) are then secretly elected to be IL proposers <span class=\"math\">P</span>  and actively participate in the construction of the IL.</li>\n<li>One IL aggregator <span class=\"math\">A</span> is chosen from the set of IL proposers that successfully sent a commitment during the first round of the ring signature scheme.</li>\n</ul>\n<h3><a name=\"anonymous-broadcast-protocol-11\" class=\"anchor\" href=\"https://ethresear.ch#anonymous-broadcast-protocol-11\"></a>Anonymous Broadcast Protocol</h3>\n<p>While we employ a linkable ring signature scheme to conceal the identity of the signer of an IL, it is also crucial to anonymize the sender. This necessity arises because, despite the signer’s identity being obscured by the ring signature scheme, there remains a risk that observers might link the signer’s identity to the entity that transmitted the ring-signed IL. This linkage could occur through the analysis of metadata or network patterns associated with the transmission. To prevent this and fully protect the anonymity of the proposer, an anonymous broadcast protocol seems essential. This protocol would ensure that the transmission of the signed IL cannot be traced back to its origin, thereby safeguarding the identities involved.</p>\n<p><strong>Overview</strong></p>\n<p>We introduce an Anonymous Broadcast Protocol (ABP) inspired by <a href=\"https://arxiv.org/pdf/1701.04439.pdf\" rel=\"noopener nofollow ugc\">Dandelion</a> and <a href=\"https://arxiv.org/pdf/1805.11060.pdf\" rel=\"noopener nofollow ugc\">Dandelion ++</a> and tailored to fit Ethereum’s requirements. The ABP is designed to safeguard committee members from de-anonymization attacks when gossiping messages (i.e., ILs and votes). This is achieved by routing their communications through a randomized, multi-phase process that conceals the origins of messages, thereby significantly complicating the efforts to trace these back to their original source based on network traffic. The protocol consists of two phases: the <em>STEM</em> phase and the <em>FLUFF</em> phase. During the <em>STEM</em> phase, each committee member, acting either as a relay or a diffuser, forwards their locally generated inclusion list to one or two peers. A committee member can either be a relay or a diffuser. If a committee member acts as a relay, upon receiving a local inclusion list, it will forward this list to another peer or two peers. If a committee member is a diffuser, it initiates the <em>FLUFF</em> phase by broadcasting the received list to all members. It is important to note that a diffuser’s role, which involves functioning as such for every message, is determined through a randomized mechanism that takes into account the slot number and the member’s identity.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/5/7/575ee622a8461194f628cc123b3b8665b360deca.jpeg\" data-download-href=\"https://ethresear.ch/uploads/default/575ee622a8461194f628cc123b3b8665b360deca\" title=\"Screenshot 2024-05-23 at 09.56.42\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/5/7/575ee622a8461194f628cc123b3b8665b360deca_2_690x198.jpeg\" alt=\"Screenshot 2024-05-23 at 09.56.42\" data-base62-sha1=\"csURjWrQRd5xgh2DwMtLv0Hx8jE\" width=\"690\" height=\"198\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/5/7/575ee622a8461194f628cc123b3b8665b360deca_2_690x198.jpeg, https://ethresear.ch/uploads/default/optimized/3X/5/7/575ee622a8461194f628cc123b3b8665b360deca_2_1035x297.jpeg 1.5x, https://ethresear.ch/uploads/default/optimized/3X/5/7/575ee622a8461194f628cc123b3b8665b360deca_2_1380x396.jpeg 2x\" data-dominant-color=\"F6F6F6\"></a></div><p></p>\n<blockquote>\n<p><strong>Figure 3. Life cycle of a message during the execution of the ABP</strong> in slot <code>n</code> during (A) the STEM and (B) the FLUFF phase. Sender nodes are coloured in white, relay nodes are coloured in black, and diffuser nodes in red.</p>\n</blockquote>\n<p>For further clarity:</p>\n<ul>\n<li>The protocol starts with the <em>STEM</em> phase: each committee member sends their local inclusion list via two different routes within a 4-regular graph (i.e., a type of network where every node is connected to exactly 4 nodes). This 4-regular graph is part of a larger network <span class=\"math\">G</span>, which overlays all IL committee members selected for the specific slot.</li>\n<li>The structure of this graph requires each committee member to randomly select the next two relay nodes, which also introduces a random delay for each message hop throughout the graph.</li>\n<li>Upon receiving a local inclusion list from another member, the recipient determines its role for that slot — either a relay or a diffuser. As a relay, the member follows the forwarding procedure described in the previous point. As a diffuser, the member starts the <em>FLUFF</em> phase.</li>\n<li>In the <em>FLUFF</em> phase, committee members disseminate their local inclusion lists simultaneously to all members.</li>\n<li>While functioning as a relay during the <em>STEM</em> phase, a committee member also starts a timing deadline <span class=\"math\">f</span> for every message it receives. In this way we implement a fail-safe mechanism that requires relays to monitor whether their forwarded message is successfully diffused. This is designed to prevent black-hole attacks, where a malicious node in the path decides not to forward the message. Specifically, the protocol sets a random expiration timer at each <em>STEM</em> relay immediately upon receiving transaction messages. The relay then monitors the network to see if the transaction reappears. If the timer expires without the transaction reappearing, the node autonomously diffuses the transaction. In Dandelion++, this mechanism offers two key advantages: (1) it ensures that messages are guaranteed to eventually propagate through the network, and (2) the random timers help to anonymize peers initiating the spreading phase, mitigating the risk of black-hole attacks.</li>\n</ul>\n<p><strong>ABP Parameters</strong></p>\n<p>We conducted preliminary analyses to determine the ABP parameters necessary for it to function effectively under Ethereum’s time and bandwidth constraints. These analyses are an initial step toward understanding the trade-offs and consequences of selecting these parameters. A detailed, comprehensive analysis should also be conducted to evaluate the effects of delays, the number of participants, and role distribution (relays vs. diffusers) on the security and anonymization guarantees that anon-IL provides. As previously mentioned, our design requires two rounds of message exchange (one for local ILs, one for voting on the global IL), meaning the ABP must run twice per 12-second slot. We assume a maximum IL size of <code>3M</code> gas, which corresponds to approximately <code>0.33 Mb</code> (see Appendix 1.1 for more details). We expect the ring signature scheme to take around 1 second per round, leaving <code>5 seconds</code> per round for the ABP to complete both the <em>STEM</em> and <em>FLUFF</em> phases. We evaluated the impact of transmission delays and network size on propagation time (Appendix 1.2), and the impact of Byzantine nodes on message propagation success (Appendix 1.3). This evaluation helped us choose initial parameters for the ABP and allocate <code>2.5 seconds</code> for each phase (<em>STEM</em> and <em>FLUFF</em>), a network size of <code>128 nodes</code>, and an added transmission delay randomly chosen between <code>100 ms</code> and <code>900 ms</code>.</p>\n<h2><a name=\"evaluation-and-tradeoffs-12\" class=\"anchor\" href=\"https://ethresear.ch#evaluation-and-tradeoffs-12\"></a>Evaluation and tradeoffs</h2>\n<p>In this section, we discuss how to evaluate anon-IL and the tradeoffs that were made in its design.</p>\n<h3><a name=\"anonymity-guarantees-13\" class=\"anchor\" href=\"https://ethresear.ch#anonymity-guarantees-13\"></a>Anonymity guarantees</h3>\n<p>The core idea behind anon-IL is to allow validators to participate in building ILs without revealing their identity. This is achieved using a linkable ring signature scheme. Importantly, having twice as many IL committee members (<code>256</code>) as secret IL proposers (<code>128</code>) allows each participant to plausibly deny having signed or sent any specific message. Moreover, IL proposers use an anonymous broadcast protocol to gossip messages, further protecting their anonymity from external observers analyzing network traffic. The effectiveness of these anonymity guarantees depends on:</p>\n<ul>\n<li>The cryptographic integrity of the chosen ring signature scheme: Here, we utilize Groth-Kohlweiss signatures that enable all IL proposers to sign in under a second while maintaining robust security. The signatures can theoretically provide long-term anonymity that is secure against advances in cryptanalysis because the protocol achieves statistical zero-knowledge. A caveat: this assumes the validators are using good sources of randomness and that there are no implementation bugs.</li>\n<li>The ABP design and its associated parameters were inspired by <a href=\"https://arxiv.org/pdf/1805.11060\" rel=\"noopener nofollow ugc\">Dandelion++</a>. The parameters were adapted to meet the time constraints imposed by Ethereum’s 12-second slot duration. Further analyses are necessary to assess the anonymity guarantees provided by the roles assigned to nodes (relays or diffusers), the network size (i.e., the number of IL proposers), and the maximum random delay introduced when messages are broadcast to other nodes. Preliminary analyses in Appendix 1 helped establish credible parameters for this post. To comprehensively evaluate the protocol’s robustness, it is crucial to conduct in-depth simulations and set up devnets to assess the anonymity guarantees under real and varied network conditions.</li>\n</ul>\n<p>Assuming anon-IL provides strong anonymity guarantees, we believe it represents a substantial improvement over other IL designs. Allowing validators to participate in preserving <a href=\"https://ethresear.ch/t/uncrowdable-inclusion-lists-the-tension-between-chain-neutrality-preconfirmations-and-proposer-commitments/19372\">chain neutrality</a> while being protected from targeted legal or regulatory measures significantly improves the chances of IL adoption. Currently, according to censorship.pics, about 7.5% of proposers censor transactions. This percentage might increase with the introduction of ILs because proposer agency would be explicitly required. By protecting their identity, we allow the entire validator set, including proposers censoring transactions today, to participate in improving the censorship resistance properties of the network without being targeted by regulatory measures. Furthermore, relying on a secretly chosen set of IL proposers to participate in the construction of ILs decreases the viability of <a href=\"https://ethresear.ch/t/fun-and-games-with-inclusion-lists/16557\">commitment attacks</a>. It seems reasonable to conjecture that our design would require an attacker to bribe a significant fraction of the <code>256</code> IL committee members to have a transaction included or excluded from the global IL. Unlike <a href=\"https://ethresear.ch/t/the-more-the-less-censored-introducing-committee-enforced-inclusion-sets-comis-on-ethereum/18835\">COMIS</a>, in anon-IL the IL aggregator also uses the ABP to broadcast its global IL to other committee members, which essentially removes commitment attacks targeted to a single party, unless the aggregator willingly self-reveals. An attacker can always target the proposer <code>n+1</code>, but it would force it to miss its slot (otherwise the block isn’t valid), missing out on all execution and consensus layer rewards, and potentially incurring <a href=\"https://ethresear.ch/t/missed-slot-penalties-temperature-check/18713\">missed slot penalties</a> in the future.</p>\n<h3><a name=\"inclusion-guarantees-14\" class=\"anchor\" href=\"https://ethresear.ch#inclusion-guarantees-14\"></a>Inclusion guarantees</h3>\n<p>In anon-IL, inclusion guarantees are explicitly determined during <strong>Round 2</strong> with the inclusion threshold, with which IL aggregators include transactions if they are seen in more than <code>X%</code> of the <span class=\"math\">IL^L\\text{s}</span> they collected. We propose to set this inclusion threshold to <code>10%</code>, which means every transaction that ends up being included in more than <code>12 out 128</code> IL proposers’ local ILs should be included in the <span class=\"math\">IL^G</span> and its associated summary.  Choosing a relatively low, non-zero inclusion threshold provides good inclusion guarantees while preventing spam transactions coming a single party from filling the global IL. This approach avoids the scenario where a single IL proposer could flood the system with its transactions, ensuring that only those transactions that overlap with other proposers’ local ILs are included. By requiring that transactions must be seen in multiple local lists, the protocol mitigates the risk of a malicious IL proposer dominating the global list with spam transactions. This selective inclusion helps maintain the integrity and efficiency of the IL. Another parameter in <strong>Round 2</strong> also affects inclusion guarantees, since <code>TRUE</code> votes are cast only if transactions IL proposers <span class=\"math\">IL^G\\text{s}</span> satisfy at least some proportion of entries in the aggregator’s <span class=\"math\">IL^G_\\text{summary}</span>. This gives some leeway for IL proposers who may have missed some of the <span class=\"math\">IL^L\\text{s}</span> gossiped during Round 1 due to p2p network latency. However, we recommend a high overlap percentage (e.g., 90%) to constrain the aggregator’s  <span class=\"math\">IL^G</span> construction and improve inclusion guarantees.</p>\n<p>We also need to consider scenarios where ILs are full. How should IL proposers and the aggregator construct ILs when transactions eligible for inclusion exceed the IL gas limit (i.e., <code>3M</code> gas)? If stuffing ILs becomes a profitable strategy, coordinated IL proposers exceeding the inclusion threshold could potentially add the exact same transactions in their <span class=\"math\">IL^L\\text{s}</span>, thereby crowding out other candidate transactions. To mitigate this concern, we could:</p>\n<ul>\n<li>Establish a priority rule for ordering IL transactions: Transactions that appear most frequently across all collected <span class=\"math\">IL^L\\text{s}</span> should be given priority for inclusion.</li>\n<li>Increase the inclusion threshold.</li>\n<li>Increase IL size to fit more transactions. We could also consider conditional ILs that could be larger, or ILs with <a href=\"https://ethresear.ch/t/cumulative-non-expiring-inclusion-lists/16520\">cumulative, non-expiring</a> properties.</li>\n</ul>\n<h3><a name=\"incentives-scheme-15\" class=\"anchor\" href=\"https://ethresear.ch#incentives-scheme-15\"></a>Incentives scheme</h3>\n<p>The most obvious drawback of protecting IL proposers’ identities is that it makes it very difficult to devise incentive schemes to reward parties that provide useful inputs to the mechanism or penalize those who do not. In this post, anon-IL does not reward IL committee members in any way, and assumes that contributing to improving the censorship-resistance properties of the network is a task that validators can take on without expecting additional rewards. That said, we could design incentives that rely on metrics to evaluate the quality of the global IL constructed by IL proposers without having to identify specific contributors to reward individual inputs. For example, the IL committee members could be uniformly rewarded based on the overlap between all local ILs, encouraging IL proposers to include all public transactions they see pending in the mempool.</p>\n<p>Here’s a simple model to implement this, if we assume rewards come from fees associated with transactions (see conditional tipping). We let <span class=\"math\">C</span> represent the total number of committee members (in the current anon-IL design, <code>256</code>), and <span class=\"math\">T</span> denote the set of all transactions pending in the mempool. Each transaction <span class=\"math\">t</span> in <span class=\"math\">T</span> is associated with a fee <span class=\"math\">f_t</span>, and <span class=\"math\">I_i</span> is the set of transactions included by proposer <span class=\"math\">i</span> in their local ILs.</p>\n<ul>\n<li><strong>Reward Calculation</strong>:\n<ul>\n<li>The intersection <span class=\"math\">U</span> of transactions included by all IL committee members is computed as <span class=\"math\">U = I_1 \\cap I_2 \\cap \\ldots \\cap I_N</span>.</li>\n<li>The reward for each committee member <span class=\"math\">i</span>, <span class=\"math\">R_i</span>, is calculated as follows:</li>\n</ul>\n</li>\n</ul>\n<div class=\"math\">\nR_i = \\frac {1} {N} ∑_{t ∈ U} f_t\n</div>\n<ul>\n<li><strong>Example Scenarios</strong>:\n<ul>\n<li><strong>Scenario 1</strong>: All members (A, B, and C) include all 5 transactions in their ILs, with the transactions being <span class=\"math\">T = {t_1, t_2, t_3, t_4, t_5}</span> and fees <span class=\"math\">f_{t_1} = 0.1, f_{t_2} = 0.3, f_{t_3} = 0.4, f_{t_4} = 1, f_{t_5} = 0.6</span>. Given all members include all transactions, the reward calculation simplifies as each proposer includes the same set of transactions <span class=\"math\">U = T</span>, and<br>\n<span class=\"math\">R_i = \\frac {1} {3}(0.1+0.3+0.4+1+0.6) = 0.8</span> for each member.</li>\n<li><strong>Scenario 2</strong>: Suppose proposers A and B include 4 transactions each (say <span class=\"math\">t_1</span> to <span class=\"math\">t_4</span>), while C includes only 2 transactions (<span class=\"math\">t_1</span> and <span class=\"math\">t_2</span>). The transactions common to all members are <span class=\"math\">U = {t_1, t_2}</span>, and the rewards are computed as: <span class=\"math\">R_i = \\frac {1} {3}(0.1+0.3) = \\frac {0.4} {3} ≈ 0.133</span> each.</li>\n</ul>\n</li>\n</ul>\n<p>Note that if rewards came from issuance, we could also consider the number of IL proposers (out of all possible ones) who contributed to incentivize participation. Another interesting avenue would be to all committee members participate in a lottery. All <code>256</code> participants have a chance of winning the lottery and getting a share of the rewards, but the winning probability can be biased by having IL proposers and the aggregator secretly prove things about their role and their contributions. This would provide a way to reward individual roles or contributions, while still providing plausible deniability (e.g., “I got rewards because I got lucky but I didn’t actually participate in creating a list at all”). We think that exploring solutions to reward IL proposers for their contributions without compromising their anonymity—such as using shielded reward pools, stealth addresses, or fully homomorphic encryption in the future—merits further investigation.</p>\n<h3><a name=\"il-properties-16\" class=\"anchor\" href=\"https://ethresear.ch#il-properties-16\"></a>IL properties</h3>\n<ul>\n<li><strong>Spot:</strong> Since parties other than proposers are responsible for building $IL$s (<span class=\"math\">IL</span> proposers and aggregators), the anon-IL mechanism can run in parallel of the block construction process, which effectively gives real-time censorship resistance at the block level.</li>\n<li><strong><a href=\"https://ethresear.ch/t/unconditional-inclusion-lists/18500\">Unconditional</a></strong>: This property ensures that once an IL includes a transaction, that transaction is guaranteed to go onchain at the latest in slot <code>n+1</code>.\n<ul>\n<li><strong>End-of-block</strong>: The spot, unconditional anon-ILs should be appended at the end of block <code>n+1</code>. Importantly, if transactions satisfying IL summary requirements are already included in the payload, they will take precedence over IL transactions. Should this occur, IL transactions would be reverted.</li>\n</ul>\n</li>\n<li><strong><a href=\"https://ethresear.ch/t/uncrowdable-inclusion-lists-the-tension-between-chain-neutrality-preconfirmations-and-proposer-commitments/19372\">Uncrowdability</a>:</strong> We believe the aforementioned anon-IL properties make them “inconvenient enough” for uses other than chain neutrality. Frontrunnable, end-of-block transactions that need to be seen by a set of secretly elected participants (i.e., made public) offer few opportunities to introduce secondary markets for MEV or preconfirmations.</li>\n</ul>\n<h3><a name=\"byzantine-and-fault-tolerance-17\" class=\"anchor\" href=\"https://ethresear.ch#byzantine-and-fault-tolerance-17\"></a>Byzantine and fault tolerance</h3>\n<p>In anon-IL, Byzantine nodes are capable of launching various attacks at different stages of the mechanism. These attacks can be broadly categorized into two types:</p>\n<ul>\n<li><strong>De-anonymization Attacks:</strong> These are attempts by either external or internal parties to compromise the anonymity of IL committee members, proposers, and aggregators, thereby increasing the likelihood of revealing their identities. A critical factor to consider is that a single entity owning a significant stake could control a large portion of the IL committee. Therefore, the mechanism must be designed to resist de-anonymization efforts, even when many of the committee’s validators are affiliated with the same entity.</li>\n<li><strong>Liveness Attacks:</strong> IL proposers may choose not to engage in the creation, signing, or broadcasting of ILs. This non-participation can lead to liveness faults, characterized by the failure to propagate messages throughout the network. An example of this can be found in Appendix 1.2, where we examine the impact of so-called “black-hole” attacks — scenarios in which Byzantine nodes choose not to forward any messages — on the success of message propagation during the <em>STEM</em> phase. To counteract this attack, we introduce a fail-safe mechanism that requires nodes to monitor whether their messages have been successfully propagated by the end of the <em>STEM</em> phase and to initiate message diffusion themselves if propagation has not occurred.</li>\n</ul>\n<p>Thorough security analyses must be conducted to mitigate de-anonymization and liveness attacks to the best of our ability. However, it is also important to keep in mind that the worst case scenario leads to an IL not being built for one slot: Censorable transactions would likely still be pending in the mempool, and can be picked up by the next IL committee.</p>\n<h2><a name=\"limitations-18\" class=\"anchor\" href=\"https://ethresear.ch#limitations-18\"></a>Limitations</h2>\n<p>Our approach to anonymizing IL proposers on Ethereum, while robust in its design, encounters specific limitations that merit attention:</p>\n<ul>\n<li><strong>Adaptation of the Anonymous Broadcast Protocol (ABP)</strong>: A central element in our mechanism is the ABP, a modified version of the Dandelion++ protocol originally designed for asynchronous communication. For our purposes, we have adapted it to a synchronous setting, maintaining the original structure but with adjusted expectations for message propagation. A critical observation guiding this adaptation is that the complete propagation of all proposed ILs to every committee member is not necessary. This assumption allows for specific deadlines and acknowledges that some transactions, despite passing through multiple relays, may not reach all committee members. This could potentially exclude some transactions from consideration. Although this does not pose a significant concern, as our objective is to include a substantial portion of the proposed IL in the global inclusion list, a thorough security analysis is necessary to assess the trade-offs between anonymity and security stemming from these changes. While it is advantageous to begin with a protocol that has already been implemented elsewhere, it might be more practical in the future to design a protocol from scratch—one with fewer parameters. Conducting the necessary analyses to evaluate its robustness and security will ensure that it is optimally tailored to meet our specific needs.</li>\n<li><strong>Single Aggregator Model</strong>: The current protocol considers a single aggregator randomly selected among the IL proposers. While this simplifies the design and is not a constraint per se—multiple aggregators can be integrated without altering the core mechanism—this setup can introduce specific challenges. Discussions are needed to explore potential issues that may arise from having only one aggregator, such as bottlenecks in processing or points of failure that could be exploited by malicious actors.</li>\n<li>It is also crucial to examine how the RANDAO affects our protocol as validators are able to bias is to a small extent. An analysis should be conducted to understand how such biases could influence the parts of our mechanism where RANDAO is utilized.</li>\n</ul>\n<h2><a name=\"supplementary-material-19\" class=\"anchor\" href=\"https://ethresear.ch#supplementary-material-19\"></a>Supplementary Material</h2>\n<h3><a name=\"appendix-1-abp-parameters-20\" class=\"anchor\" href=\"https://ethresear.ch#appendix-1-abp-parameters-20\"></a>Appendix 1. ABP Parameters</h3>\n<p><strong>1.1. IL gas and size (h/t Toni)</strong></p>\n<p>Previous IL specs have often mentioned using an IL size of <code>3M gas</code>. We chose the same amount of gas for the anon-IL design, and demonstrate that the maximum size in bytes a block can have after snappy compression is one with <code>28%</code> of zero bytes (Figure S1). Given that zero bytes are cheaper (<code>4 gas</code>) than non-zero bytes (<code>16 gas</code>), we calculate the maximum size an IL of <code>3M gas</code> can have as follows: <span class=\"math\">3M \\times 0.28/4 + 3M \\times 0.72/16 = 0.33Mb</span>.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/8/1/813c54436b078bf41f92112b3901b9258649b974.jpeg\" data-download-href=\"https://ethresear.ch/uploads/default/813c54436b078bf41f92112b3901b9258649b974\" title=\"Screenshot 2024-04-25 at 10.42.20\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/8/1/813c54436b078bf41f92112b3901b9258649b974_2_690x281.jpeg\" alt=\"Screenshot 2024-04-25 at 10.42.20\" data-base62-sha1=\"irgQASvOpHyflXH048upTjXn2aE\" width=\"690\" height=\"281\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/8/1/813c54436b078bf41f92112b3901b9258649b974_2_690x281.jpeg, https://ethresear.ch/uploads/default/optimized/3X/8/1/813c54436b078bf41f92112b3901b9258649b974_2_1035x421.jpeg 1.5x, https://ethresear.ch/uploads/default/optimized/3X/8/1/813c54436b078bf41f92112b3901b9258649b974_2_1380x562.jpeg 2x\" data-dominant-color=\"E7E4EB\"></a></div><p></p>\n<blockquote>\n<p><strong>Figure S1.</strong> A. Maximum block size in Mb after Snappy compression relative to the percentage of zero bytes for a 30M gas block. B. Heatmap showing the relationship between the percentage of zero bytes in a block and the compressed size (in MB) of the block after applying Snappy compression, with respect to varying gas limits (h/t Toni for both figures).</p>\n</blockquote>\n<p><strong>1.2. Impact of Transmission Delay and Network Size on Propagation Time</strong></p>\n<p>We then evaluated how changing the maximum transmission delay and the size of the network (i.e., the number of IL proposers) affected to the propagation time of a given message during the <em>STEM</em> and <em>FLUFF</em> phases.</p>\n<ul>\n<li><em>FLUFF</em> phase: According to the <a href=\"https://github.com/ethereum/consensus-specs/blob/836bc43a0667990dd1243cf3aaad7e35a32eab99/specs/phase0/p2p-interface.md#the-gossip-domain-gossipsub\" rel=\"noopener nofollow ugc\">consensus specifications</a> and given a mesh size <span class=\"math\">MS</span> of <code>8</code>, and secret IL proposers sending messages using the ABP for each round, we assume a minimum of <code>100 ms</code> transmission delay <span class=\"math\">T_{delay}</span>, and a maximum determined by a maximum random delay we add to each message transmission to help de-anonymizing participants. We thus use a simple analytical model to compute the propagation time <span class=\"math\">PT_{FLUFF}</span> needed to reach all nodes during the <em>FLUFF</em> phase:</li>\n</ul>\n<p><span class=\"math\">PT_{FLUFF} = T_{delay} \\times \\log_{(MS - 1)}(R)</span></p>\n<p>Where <span class=\"math\">\\log_{(MS - 1)}(R)</span> is used to calculating the number of hops required for a given message to reach all nodes. Using these parameters, the computed propagation time <span class=\"math\">*PT_{FLUFF}</span>* to reach all nodes during the <em>FLUFF</em> phase depending on <span class=\"math\">T_{delay}</span> is shown in Figure S2. A.</p>\n<ul>\n<li><em>STEM</em> phase: As a reminder, each slot, half of nodes are randomly chosen to be relays (forward to 1 or 2 neighbours), the other half are diffusers (forward to all other nodes). Given the more complex network dynamics involved in this phase, we use simulations to estimate <span class=\"math\">PT_{STEM}</span> relative to the network size and  <span class=\"math\">T_{delay}</span> (Figure S2.B.)</li>\n</ul>\n<p>We then simply add <span class=\"math\">PT_{FLUFF}</span> and <span class=\"math\">PT_{STEM}</span> to find viable parameters allowing to propagate messages to everyone under <code>5 seconds</code> per round (Figure S2.C.). As a result, we chose to allocate <code>2.5 seconds</code> for each phase, setting parameters to a network size of <code>128 nodes</code>, with a maximum added random delay of <code>900ms</code>.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/f/4/f4afd5311a8b999e4b07d666626b8768c89ad157.jpeg\" data-download-href=\"https://ethresear.ch/uploads/default/f4afd5311a8b999e4b07d666626b8768c89ad157\" title=\"Screenshot 2024-05-23 at 15.20.17\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/f/4/f4afd5311a8b999e4b07d666626b8768c89ad157_2_690x330.jpeg\" alt=\"Screenshot 2024-05-23 at 15.20.17\" data-base62-sha1=\"yUBdOnLcLHlBZUUUg4kUAiQGe1N\" width=\"690\" height=\"330\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/f/4/f4afd5311a8b999e4b07d666626b8768c89ad157_2_690x330.jpeg, https://ethresear.ch/uploads/default/optimized/3X/f/4/f4afd5311a8b999e4b07d666626b8768c89ad157_2_1035x495.jpeg 1.5x, https://ethresear.ch/uploads/default/optimized/3X/f/4/f4afd5311a8b999e4b07d666626b8768c89ad157_2_1380x660.jpeg 2x\" data-dominant-color=\"99BAAA\"></a></div><p></p>\n<blockquote>\n<p><strong>Figure S2.</strong> <strong>Propagation Time relative to transmission delay and network size</strong> for (<strong>A</strong>) the FLUFF phase, (<strong>B</strong>) the STEM phase across 100 simulation runs, and (<strong>C</strong>) the total propagation time for a given round (FLUFF + STEM). The x-axis indicates the transmission delay <span class=\"math\">T_{delay}</span>, and the y-axis shows network sizes (64, 128, 256 nodes).  Color intensity varies from fast to slow propagation time.</p>\n</blockquote>\n<p><strong>1.3 Impact of Byzantine Nodes on Message Propagation Success</strong></p>\n<p>We considered the impact that Byzantine nodes could have on the propagation of messages (ILs and votes) across the network of IL committee members. In Figure S3, we show the proportion of messages successfully reaching all nodes, given different percentages of Byzantine participants during the STEM phase, for various network sizes.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/0/e/0ef468f4b6446bffe73e294ce7ec6dc22225b106.png\" data-download-href=\"https://ethresear.ch/uploads/default/0ef468f4b6446bffe73e294ce7ec6dc22225b106\" title=\"Byzantine_Nodes\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/0/e/0ef468f4b6446bffe73e294ce7ec6dc22225b106_2_690x345.png\" alt=\"Byzantine_Nodes\" data-base62-sha1=\"28ikuGb7dJ2xAG0o9tvLHfOM4Rw\" width=\"690\" height=\"345\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/0/e/0ef468f4b6446bffe73e294ce7ec6dc22225b106_2_690x345.png, https://ethresear.ch/uploads/default/optimized/3X/0/e/0ef468f4b6446bffe73e294ce7ec6dc22225b106_2_1035x517.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/0/e/0ef468f4b6446bffe73e294ce7ec6dc22225b106_2_1380x690.png 2x\"></a></div><p></p>\n<blockquote>\n<p><strong>Figure S3. Impact of Byzantine Nodes on Message Propagation Success.</strong> This heatmap displays the success rate of full message propagation across networks with varying sizes and proportions of Byzantine nodes, for the <em>STEM</em> phase and averaged across 100 simulation runs. The x-axis indicates the percentage of Byzantine nodes (0% to 50%), and the y-axis shows network sizes (64, 128, 256 nodes). Color intensity varies from blue (higher success rates) to red (lower success rates), illustrating how increased Byzantine presence affects network reliability.</p>\n</blockquote>\n            <p><small>1 post - 1 participant</small></p>\n            <p><a href=\"https://ethresear.ch/t/anonymous-inclusion-lists-anon-ils/19627\">Read full topic</a></p>","link":"https://ethresear.ch/t/anonymous-inclusion-lists-anon-ils/19627","pubDate":"Thu, 23 May 2024 15:17:26 +0000","discourse:topicPinned":"No","discourse:topicClosed":"No","discourse:topicArchived":"No","guid":{"@isPermaLink":"false","#text":"ethresear.ch-topic-19627"},"source":{"@url":"https://ethresear.ch/t/anonymous-inclusion-lists-anon-ils/19627.rss","#text":"Anonymous Inclusion Lists (anon-ILs)"},"filter":false},{"title":"Lumoz Launches zkProver and zkVerifier based on EigenLayer","dc:creator":"nanfengpo","category":"ZK Rollup","description":"<p>Despite recent controversies surrounding its airdrop, there is no doubt that EigenLayer has emerged as one of the most prominent projects of 2024, thanks to its Re-staking mechanism. This mechanism has not only driven a surge in TVL but also prompted users to move their funds and confidence back to the Ethereum ecosystem, away from the frenzy of meme coins.</p>\n<p>According to public <a href=\"https://app.eigenlayer.xyz/\" rel=\"noopener nofollow ugc\">data</a>, as of the time of writing, EigenLayer’s ETH TVL has surpassed 5 million ETH, and the staking amount of its token, Eigen, has exceeded 54 million tokens. The number of active AVS (<a href=\"https://ethresear.ch\">Actively Validated Services</a>) and Operators stands at 11 and 251, respectively. The EigenLayer ecosystem is also booming, with over 20 leading projects across various sectors, including Lumoz, Espresso, Near, and Dodo, actively participating.</p>\n<p>This marks the beginning of a revolution aimed at reshaping blockchain security and profitability around ETH, leveraging EigenLayer. This article will use Lumoz as a case study to delve into the series of technical explorations conducted on EigenLayer, thereby further advancing the technology of Ethereum and the broader blockchain industry.</p>\n<h2><a name=\"h-1-lumoz-launches-avs-computation-layer-based-on-eigenlayer-1\" class=\"anchor\" href=\"https://ethresear.ch#h-1-lumoz-launches-avs-computation-layer-based-on-eigenlayer-1\"></a>1. Lumoz Launches AVS Computation Layer Based on EigenLayer</h2>\n<p>As a leader in modular computing layers and ZKRaas Platform, Lumoz has not only performed exceptionally well in the capital markets but has also continuously innovated in the technical field. In April 2024, Lumoz first announced the completion of its Pre-A financing round (with a current valuation of up to $300 million), and shortly thereafter, it announced support for Op Stack + ZK Fraud Proof Layer 2 architecture, pioneering a new model for L2 architecture.</p>\n<p>This week, Lumoz officially announced the launch of an AVS computation layer based on EigenLayer, composed of zkProver and zkVerifier, which significantly enhances computational power and security.</p>\n<p>Lumoz’s zkProver focuses on generating Zero-Knowledge Proofs (ZKP), verifying the authenticity of data without revealing the specific data itself. With powerful computational resources, zkProver can quickly generate efficient Zero-Knowledge Proofs, significantly improving the privacy and security of blockchain networks. zkVerifier, on the other hand, is responsible for verifying these Zero-Knowledge Proofs, ensuring their correctness and reliability. Combined with EigenLayer’s Re-staking mechanism, zkVerifier not only leverages Ethereum’s security but also provides additional economic incentives for validators. This dual verification mechanism greatly enhances the overall security of the network and reduces trust risks.</p>\n<p><em>Note: EigenLayer’s Re-staking mechanism enhances the security of the Ethereum ecosystem by providing AVS, addressing trust issues and the burden of capital costs.</em></p>\n<p>By integrating powerful computational resources with EigenLayer’s Re-staking mechanism, Lumoz has created an efficient and secure computational service ecosystem. This innovation not only improves the computational power and security of blockchain networks but also provides developers and users with more application scenarios and value. Through zkProver and zkVerifier, Lumoz brings unprecedented innovation and value to the blockchain field, driving technological advancement across the entire industry.</p>\n<h2><a name=\"h-2-lumoz-computation-layer-2\" class=\"anchor\" href=\"https://ethresear.ch#h-2-lumoz-computation-layer-2\"></a>2. Lumoz Computation Layer</h2>\n<p>The Lumoz Computation Layer architecture is a highly integrated and collaborative system, with its main components and functionalities as follows:</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/4/f/4fa2829a63a584f7eb2b536f543482ae1f2286ee.jpeg\" data-download-href=\"https://ethresear.ch/uploads/default/4fa2829a63a584f7eb2b536f543482ae1f2286ee\" title=\"\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/4/f/4fa2829a63a584f7eb2b536f543482ae1f2286ee_2_493x500.jpeg\" alt=\"\" data-base62-sha1=\"bmtTAvKY7uCRF721iyC2Oxp1Fme\" width=\"493\" height=\"500\" role=\"presentation\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/4/f/4fa2829a63a584f7eb2b536f543482ae1f2286ee_2_493x500.jpeg, https://ethresear.ch/uploads/default/optimized/3X/4/f/4fa2829a63a584f7eb2b536f543482ae1f2286ee_2_739x750.jpeg 1.5x, https://ethresear.ch/uploads/default/optimized/3X/4/f/4fa2829a63a584f7eb2b536f543482ae1f2286ee_2_986x1000.jpeg 2x\" data-dominant-color=\"151716\"></a></div><p></p>\n<p>The main components include:</p>\n<ul>\n<li><strong>Ethereum</strong>: Utilizes the EigenLayer standard to build Active Verification Services (AVS). The staking mechanism of EigenLayer enhances the security of AVS.</li>\n<li><strong>EVM Chain</strong>: Supports a diverse blockchain environment compatible with the Ethereum Virtual Machine (EVM), including but not limited to Polygon zkEVM, Polygon CDK, ZKStack, and Scroll, ensuring broad compatibility and scalability.</li>\n<li><strong>Lumoz AVS Oracle</strong>: Responsible for acquiring and storing data from EVM-compatible chains, ensuring high availability and integrity of the data, thus providing a solid data foundation for the computation layer.</li>\n<li><strong>Lumoz Chain</strong>: Acts as the core management layer of the entire computation layer, responsible for task scheduling, reward distribution, and the management of zkProver and zkVerifier, including but not limited to the processes of node joining and exiting.</li>\n<li><strong>zkProver</strong>: Nodes that execute specific computational tasks.</li>\n<li><strong>zkVerifier</strong>: Verification nodes that validate the execution results.</li>\n</ul>\n<p>Through the close collaboration of these modules, the Lumoz Computation Layer not only provides a secure and efficient computational environment but also, through its modular design, lays a solid foundation for future expansion and upgrades.</p>\n<h2><a name=\"h-3-what-problems-can-it-solve-3\" class=\"anchor\" href=\"https://ethresear.ch#h-3-what-problems-can-it-solve-3\"></a>3. What Problems Can It Solve?</h2>\n<h3><a name=\"h-31-large-scale-computational-power-demand-4\" class=\"anchor\" href=\"https://ethresear.ch#h-31-large-scale-computational-power-demand-4\"></a>3.1 Large-Scale Computational Power Demand</h3>\n<p>Lumoz provides robust cloud infrastructure support for zero-knowledge proof (ZKP) computations. This support is crucial for ZK-Rollups, a blockchain scaling solution that executes transactions off-chain and uses ZKPs to verify the validity of these transactions. The proofs are then submitted on-chain, reducing the load on the main chain and increasing transaction throughput.</p>\n<p>Lumoz Cloud Infrastructure Capabilities:</p>\n<ul>\n<li><strong>Compatibility</strong>: Lumoz’s cloud infrastructure is compatible with various ZK-Rollup solutions such as Polygon CDK, zkSync, StarkNet, and Scroll. This means it can serve these different platforms without each platform needing to establish its own infrastructure.</li>\n<li><strong>ZK-PoW Algorithm</strong>: Lumoz combines miners’ computational resources with cloud infrastructure through the Zero-Knowledge Proof of Work (ZK-PoW) algorithm, enabling miners to contribute their computational power to support ZKP computations.</li>\n<li><strong>Performance and Efficiency</strong>: By supporting parallel computation for ZKPs, computational efficiency is significantly improved as multiple tasks can be executed simultaneously. Additionally, sequential submission ensures orderly processing of transactions.</li>\n<li><strong>Recursive Aggregation Algorithm</strong>: Optimizing the recursive aggregation algorithm reduces the number of required ZKPs, thereby lowering computational complexity and costs.</li>\n<li><strong>Network Communication Improvements</strong>: Enhancements in network communication reduce data transmission time, improving the overall system response speed.</li>\n<li><strong>Cost-Effectiveness</strong>: Through the aforementioned optimizations, Lumoz can reduce the costs associated with ZKP computations, making ZK-Rollup solutions more economically efficient.</li>\n</ul>\n<p>Lumoz’s cloud infrastructure provides a powerful, flexible, and cost-effective solution for ZKP computations, contributing to the advancement and application of blockchain technology.</p>\n<h3><a name=\"h-32-reducing-zk-proof-gas-5\" class=\"anchor\" href=\"https://ethresear.ch#h-32-reducing-zk-proof-gas-5\"></a>3.2 Reducing zk Proof Gas</h3>\n<p>The design strategy of zkVerifier aims to enhance efficiency, scalability, and effectively reduce transaction costs, as reflected in the following aspects:</p>\n<ul>\n<li><strong>Integration of Multiple Proof Sources</strong>: zkVerifier can integrate proofs from different sources, supporting a wide range of zero-knowledge proof applications. This flexibility is a key advantage in the blockchain ecosystem, as it allows various projects and applications to utilize zkVerifier services.</li>\n<li><strong>Gas Cost Savings</strong>: Through meticulously designed proof processing and verification mechanisms, zkVerifier significantly reduces the gas cost of submitting proofs, providing users with a more cost-effective blockchain service experience.</li>\n<li><strong>Adaptability to Proof Characteristics</strong>: zkVerifier demonstrates adaptability to the characteristics of proofs generated by different proof systems, including proof size, verification time, and verification logic. This adaptability is central to ensuring the efficient operation of the system.</li>\n<li><strong>Customized Release Strategies</strong>: Based on the characteristics of different proofs, zkVerifier has designed customized release strategies that optimize the use of on-chain resources and ensure efficient proof transmission, helping to reduce network congestion and improve transaction speed.</li>\n<li><strong>Deployment of Dedicated Verifiers</strong>: zkVerifier deploys dedicated verifiers, which are key mechanisms to ensure proof validity. These verifiers ensure that only verified proofs can be published to Ethereum, maintaining the security and reliability of the system.</li>\n<li><strong>Optimization of Data Availability Layer</strong>: zkVerifier’s data availability layer ensures the durability and accessibility of proofs while providing a cost-effective storage strategy, which is crucial for reducing the operational costs of the system.</li>\n<li><strong>Deep Integration with Ethereum</strong>: zkVerifier publishes verification results to Ethereum, where Ethereum generates verification proofs. This step is crucial for ensuring cross-chain interoperability and trust, facilitating seamless collaboration between zkVerifier and major blockchain networks like Ethereum.</li>\n<li><strong>Authority of Verification Proofs</strong>: The verification proofs generated by Ethereum provide the final authoritative confirmation of the data validity provided by zkVerifier. This is essential for establishing trust in zkVerifier data within the Ethereum network.</li>\n</ul>\n<p>These innovative designs of zkVerifier not only address the challenges faced by existing blockchain technology but also achieve significant advancements in enhancing efficiency, reducing costs, and improving interoperability. This design helps to promote the broader application of blockchain technology and provides users with a more secure and efficient service environment.</p>\n<h2><a name=\"h-4-detailed-workflow-6\" class=\"anchor\" href=\"https://ethresear.ch#h-4-detailed-workflow-6\"></a>4. Detailed Workflow</h2>\n<h3><a name=\"h-41-zkprover-7\" class=\"anchor\" href=\"https://ethresear.ch#h-41-zkprover-7\"></a>4.1 zkProver</h3>\n<p>zkProver is the core component responsible for generating zero-knowledge proofs (ZKPs). ZKPs allow the prover to demonstrate the correctness of a certain assertion to the verifier without revealing any additional information. zkProver includes various types of provers such as zkRollup Prover, zkFraud Prover, and zkML Prover, each optimized for specific computational tasks to ensure optimal performance and system efficiency within their respective domains.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/3/e/3eff1a5965e046e6f0ad163d4be95e74257d330c.jpeg\" data-download-href=\"https://ethresear.ch/uploads/default/3eff1a5965e046e6f0ad163d4be95e74257d330c\" title=\"\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/3/e/3eff1a5965e046e6f0ad163d4be95e74257d330c_2_690x489.jpeg\" alt=\"\" data-base62-sha1=\"8Zi9PUSSFaXfxehoylc5lt8YL6s\" width=\"690\" height=\"489\" role=\"presentation\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/3/e/3eff1a5965e046e6f0ad163d4be95e74257d330c_2_690x489.jpeg, https://ethresear.ch/uploads/default/optimized/3X/3/e/3eff1a5965e046e6f0ad163d4be95e74257d330c_2_1035x733.jpeg 1.5x, https://ethresear.ch/uploads/default/optimized/3X/3/e/3eff1a5965e046e6f0ad163d4be95e74257d330c_2_1380x978.jpeg 2x\" data-dominant-color=\"151814\"></a></div><p></p>\n<p><strong>Workflow:</strong></p>\n<ol>\n<li><strong>Task Acquisition:</strong> The Lumoz AVS Oracle and Dispatch module retrieve tasks from the blockchain and synchronize them to the Lumoz Chain. These tasks consist of assertions or computations that require proof.</li>\n<li><strong>Task Distribution:</strong> Tasks are distributed to different Provers via the Dispatch module. Acting as the task scheduling center, Dispatch determines which type of Prover is best suited to handle each task based on its nature and requirements. The Dispatch module dynamically allocates computational resources through intelligent algorithms, optimizing resource distribution in real-time based on task load and the performance of each Prover, ensuring stable system operation during high-demand periods.</li>\n<li>**Proof Generation:**<strong>a, zkRollup Prover:</strong> Focuses on generating proofs related to transaction batch compression, enhancing blockchain processing speed and scalability.<strong>b, zkFraud Prover:</strong> Generates fraud proofs that help detect and prevent improper behavior.<strong>c, zkML Prover:</strong> Specializes in generating complex proofs related to machine learning model verification, ensuring the validity of model outputs without revealing the model itself or its input data.<strong>d, Other Provers:</strong> Handle specific types of proofs as needed.</li>\n<li><strong>Proof Submission:</strong> The generated proofs are sent to the Lumoz Chain for verification and archiving.</li>\n</ol>\n<h3><a name=\"h-42-zkverifier-8\" class=\"anchor\" href=\"https://ethresear.ch#h-42-zkverifier-8\"></a>4.2 zkVerifier</h3>\n<p>zkVerifier is another key component in the architecture, responsible for verifying the ZKPs generated by zkProver. It ensures the correctness and validity of the proofs submitted to the chain, thereby safeguarding the trust and security of the system. Through an optimized verification process, zkVerifier efficiently handles proofs, reducing operational costs and gas consumption.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/6/4/64136a1901b29ae5be439c939975916683752c1d.jpeg\" data-download-href=\"https://ethresear.ch/uploads/default/64136a1901b29ae5be439c939975916683752c1d\" title=\"\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/6/4/64136a1901b29ae5be439c939975916683752c1d_2_563x500.jpeg\" alt=\"\" data-base62-sha1=\"ehjldNyiY42LYAjWQB5IUj3x6Kp\" width=\"563\" height=\"500\" role=\"presentation\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/6/4/64136a1901b29ae5be439c939975916683752c1d_2_563x500.jpeg, https://ethresear.ch/uploads/default/optimized/3X/6/4/64136a1901b29ae5be439c939975916683752c1d_2_844x750.jpeg 1.5x, https://ethresear.ch/uploads/default/optimized/3X/6/4/64136a1901b29ae5be439c939975916683752c1d_2_1126x1000.jpeg 2x\" data-dominant-color=\"151615\"></a></div><p></p>\n<p><strong>Workflow:</strong></p>\n<ol>\n<li>Proof Submission: Proofs generated by zkProver are submitted to the Lumoz Chain, initiating the verification task.</li>\n<li>Proof Verification: The Lumoz Chain sends the verification task to multiple zkVerifiers, which independently perform distributed verification.</li>\n<li>Collective Decision: At least two-thirds of the verification nodes confirm the proof’s validity, ensuring the authority and consistency of the verification results.</li>\n<li>Verification Result Processing: Valid proofs and their results are transmitted back to the Lumoz Proof Contract on the blockchain by the Lumoz AVS Oracle. The Task Manager Contract records and responds to the task results on the Lumoz Chain.</li>\n</ol>\n<h2><a name=\"summary-9\" class=\"anchor\" href=\"https://ethresear.ch#summary-9\"></a>Summary</h2>\n<p>Lumoz announces the launch of zkProver and zkVerifier based on EigenLayer, significantly enhancing the efficiency of computation and verification. The re-staking mechanism of EigenLayer effectively ensures the security and profitability of the entire service process. With specialized node design, Lumoz can provide solutions for different computational tasks, achieving optimal performance and efficiency. Additionally, through the re-staking mechanism, Lumoz offers substantial returns to stakers, further enhancing the economic security of the system.</p>\n<p>In the future, we hope to see more projects like EigenLayer and Lumoz emerge, addressing current blockchain challenges, genuinely solving user pain points, and actively exploring and attempting more efficient and secure solutions. This will ultimately drive the progress and prosperity of the entire industry.</p>\n            <p><small>1 post - 1 participant</small></p>\n            <p><a href=\"https://ethresear.ch/t/lumoz-launches-zkprover-and-zkverifier-based-on-eigenlayer/19622\">Read full topic</a></p>","link":"https://ethresear.ch/t/lumoz-launches-zkprover-and-zkverifier-based-on-eigenlayer/19622","pubDate":"Thu, 23 May 2024 09:18:53 +0000","discourse:topicPinned":"No","discourse:topicClosed":"No","discourse:topicArchived":"No","guid":{"@isPermaLink":"false","#text":"ethresear.ch-topic-19622"},"source":{"@url":"https://ethresear.ch/t/lumoz-launches-zkprover-and-zkverifier-based-on-eigenlayer/19622.rss","#text":"Lumoz Launches zkProver and zkVerifier based on EigenLayer"},"filter":false},{"title":"Queue End Of Block Transaction OPCODE","dc:creator":"MicahZoltu","category":"Execution Layer Research","description":"<h2><a name=\"abstract-1\" class=\"anchor\" href=\"https://ethresear.ch#abstract-1\"></a>Abstract</h2>\n<p>A new OPCODE that allows queuing some piece of code with a well defined gas used that will execute at the end of a block.  If two transactions queue the same end-of-block code, it will only execute once.  Gas costs are covered with ETH in the calling contract.</p>\n<h2><a name=\"motivation-2\" class=\"anchor\" href=\"https://ethresear.ch#motivation-2\"></a>Motivation</h2>\n<p>This would enable things like block auctions, by allowing a bunch of people to submit transactions to swap some asset, and then they would all execute together via a block-auction at the end of the block in a way defined by the contract, rather than in a sequential order that they appear.  Each transaction would queue the end-of-block code execution.  If a single transaction does a swap on some pool, then the end-of-block execution would not change anything from today.  If multiple people submit swaps on some pool within a single block, then the contract can execute a block-auction rather than executing the swaps in the order they are received.  This allows the contract to get the best price for everyone and combat things like in-block front-running.  This does <em>not</em> address cross-block front-running/back-running, but that is far harder to execute than within-block front-running and sandwiching.</p>\n<h2><a name=\"specification-3\" class=\"anchor\" href=\"https://ethresear.ch#specification-3\"></a>Specification</h2>\n<p>Mostly TBD, but gas paid by the contract allows for cost sharing strategies between transactors (e.g., split costs and refund at end) and requiring a fixed gas usage for the end-of-block execution helps with solving the bin-filling problem introduced by delayed execution.</p>\n<h2><a name=\"considerations-4\" class=\"anchor\" href=\"https://ethresear.ch#considerations-4\"></a>Considerations</h2>\n<p>It could be useful to allow for specifying dependencies, so one contract could say “I want my end-of-block execution to run after this other contract’s end-of-block execution”.  Care would need to be taken to avoid circular dependencies, but this could be achieved by just asserting that if a circular dependency is detected then all contracts in the circle do not get their end-of-block execution.  This strongly encourages people to <em>only</em> depend on immutable end-of-block executors with fixed dependency trees.</p>\n            <p><small>1 post - 1 participant</small></p>\n            <p><a href=\"https://ethresear.ch/t/queue-end-of-block-transaction-opcode/19621\">Read full topic</a></p>","link":"https://ethresear.ch/t/queue-end-of-block-transaction-opcode/19621","pubDate":"Thu, 23 May 2024 07:49:03 +0000","discourse:topicPinned":"No","discourse:topicClosed":"No","discourse:topicArchived":"No","guid":{"@isPermaLink":"false","#text":"ethresear.ch-topic-19621"},"source":{"@url":"https://ethresear.ch/t/queue-end-of-block-transaction-opcode/19621.rss","#text":"Queue End Of Block Transaction OPCODE"},"filter":false},{"title":"ZKThreads: A canonical ZK sharding framework for dApps","dc:creator":"guthlStarkware","category":"ZK Rollup","description":"<p><strong>TL;DR:</strong> We propose zkThread, an application-level component allowing users to locally prove a batch of transactions and update the canonical state.</p>\n<p>This protocol allows turning any smart contract or set of smart contracts into their own execution environment at will while leaving the system in a synchronized environment.</p>\n<p>Notice this protocol can also be implemented at the OS level without requiring any change on the user journey.</p>\n<p>This design pattern showcases Horizontal Scaling done right. zkThreads extends the base layer throughput and network capacity at Zero Overhead from the core protocol perspective.</p>\n<p>We believe this model to be a new paradigm in the Fractal Scaling family alongside L3s and other designs known as zkSharding. You can find more details and contribute to its creation on <a href=\"https://github.com/keep-starknet-strange/zkthread\" rel=\"noopener nofollow ugc\">here</a> and a first implementation can be found under this <a href=\"https://github.com/dojoengine/dojo/tree/main/crates/saya\" rel=\"noopener nofollow ugc\">repository</a> under the Saya settlement service developed by <a href=\"https://cartridge.gg\" rel=\"noopener nofollow ugc\">Cartridge</a>.</p>\n<p>As a metaphor, imagine a chain where you can temporarily fork the chain locally to batch txs on your own. Others have hinted at such a design under the name Stateful Coprocessor or Execution Coprocessor.</p>\n<p>Thanks a lot to <a href=\"https://twitter.com/0xfishylosopher/\" rel=\"noopener nofollow ugc\">Jay Yu</a> from <a href=\"https://twitter.com/stanfordcrypto\" rel=\"noopener nofollow ugc\">Stanford Blockchain</a> and <a href=\"https://twitter.com/tarrenceva\" rel=\"noopener nofollow ugc\">Tarrence</a> from <a href=\"https://cartridge.gg/\" rel=\"noopener nofollow ugc\">Cartridge</a> for all the help in formalising and writing this post.</p>\n<p><strong>Background</strong></p>\n<p>In the context of a Validity-Rollup, the OS underpinning the Rollup is usually optimized for being provable, making proof a first-class primitive of the whole system. One important aspect is the ease of proving as one needs to run in a decentralized world with constrained machines.</p>\n<p>Under the current system, Starknet and other chains only allow a smart contract to modify its storage slots.<br>\n</p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/a/d/ad676517d8e89bbc4d937ee07128835d0c72d402.png\" data-download-href=\"https://ethresear.ch/uploads/default/ad676517d8e89bbc4d937ee07128835d0c72d402\" title=\"image\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/a/d/ad676517d8e89bbc4d937ee07128835d0c72d402_2_690x345.png\" alt=\"image\" data-base62-sha1=\"oK07Ke2I0FNy2wexYsCqL9z6RiO\" width=\"690\" height=\"345\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/a/d/ad676517d8e89bbc4d937ee07128835d0c72d402_2_690x345.png, https://ethresear.ch/uploads/default/optimized/3X/a/d/ad676517d8e89bbc4d937ee07128835d0c72d402_2_1035x517.png 1.5x, https://ethresear.ch/uploads/default/original/3X/a/d/ad676517d8e89bbc4d937ee07128835d0c72d402.png 2x\" data-dominant-color=\"EAE8EE\"></a></div><p></p>\n<p><strong>Proposal</strong></p>\n<p>Under zkThread, a new contract would be introduced to allow for proof verification of generic transactions against a specific OS version, a set of contracts, an input, and an output &lt;key, value&gt; state list. Assuming the input state list matches the current canonical state values and assuming the proof verifies, the OS can self-apply the output &lt;key, value&gt; to the canonical state.</p>\n<p>We will call a <strong>zkThread</strong>, the operation governing the runtime of the zkThread contracts updates.</p>\n<p><strong>Stated Goals</strong></p>\n<p>This protocol enables a whole new primitive into the network</p>\n<ul>\n<li>All compatible dApps become L3-ready</li>\n<li>Self Sharded Synchronous state</li>\n<li>Infinitely Adjustable TPS through permissionless self-update</li>\n<li>Future-proof backward compatibility</li>\n</ul>\n<p><strong>Setup</strong><br>\n</p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/4/d/4d2ea6cbd7ef6a2fd9520727e728980356cbce58.png\" data-download-href=\"https://ethresear.ch/uploads/default/4d2ea6cbd7ef6a2fd9520727e728980356cbce58\" title=\"image\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/4/d/4d2ea6cbd7ef6a2fd9520727e728980356cbce58_2_690x386.png\" alt=\"image\" data-base62-sha1=\"b0MInaxvuXs79F89b38Tq8ZsvVu\" width=\"690\" height=\"386\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/4/d/4d2ea6cbd7ef6a2fd9520727e728980356cbce58_2_690x386.png, https://ethresear.ch/uploads/default/optimized/3X/4/d/4d2ea6cbd7ef6a2fd9520727e728980356cbce58_2_1035x579.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/4/d/4d2ea6cbd7ef6a2fd9520727e728980356cbce58_2_1380x772.png 2x\" data-dominant-color=\"ECE9ED\"></a></div><p></p>\n<p>For a set of L2 Smart Contracts, one can define a zkThread by</p>\n<ul>\n<li>Batcher: an entity or set of entities that sequences the zkThread</li>\n<li>Prover: an entity or set of entities that proves the zkThread and forwards it to the L2</li>\n<li>A set of L2 contracts falling targeted by the zkThread</li>\n</ul>\n<p>We call a Sub-block the output of the Batcher.</p>\n<p>For a zkThread, the Batcher creates a sub-block and provides it to the Prover.</p>\n<p>Once proven,sub-blocks are forwarded as a transaction to the L2.</p>\n<p>Assuming all transactions in the sub-block are valid, a transaction is emitted from the zkThread to the L2 as follows</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/5/b/5bfafec8753e568daf47182021da94dd16225cde.png\" data-download-href=\"https://ethresear.ch/uploads/default/5bfafec8753e568daf47182021da94dd16225cde\" title=\"image\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/5/b/5bfafec8753e568daf47182021da94dd16225cde_2_690x384.png\" alt=\"image\" data-base62-sha1=\"d7HcGEPNFLW34Wb4X5niG0ubliC\" width=\"690\" height=\"384\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/5/b/5bfafec8753e568daf47182021da94dd16225cde_2_690x384.png, https://ethresear.ch/uploads/default/optimized/3X/5/b/5bfafec8753e568daf47182021da94dd16225cde_2_1035x576.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/5/b/5bfafec8753e568daf47182021da94dd16225cde_2_1380x768.png 2x\" data-dominant-color=\"EDE9ED\"></a></div><p></p>\n<p>The zkThread transaction is then sequenced by the L2 and run against the canonical state<br>\n</p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/c/3/c3b9902412fe93266b9309cb5b5f4a10f327c263.png\" data-download-href=\"https://ethresear.ch/uploads/default/c3b9902412fe93266b9309cb5b5f4a10f327c263\" title=\"image\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/c/3/c3b9902412fe93266b9309cb5b5f4a10f327c263_2_690x392.png\" alt=\"image\" data-base62-sha1=\"rVsFLR0AsQwbTx22QxHfQpM6ps7\" width=\"690\" height=\"392\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/c/3/c3b9902412fe93266b9309cb5b5f4a10f327c263_2_690x392.png, https://ethresear.ch/uploads/default/optimized/3X/c/3/c3b9902412fe93266b9309cb5b5f4a10f327c263_2_1035x588.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/c/3/c3b9902412fe93266b9309cb5b5f4a10f327c263_2_1380x784.png 2x\" data-dominant-color=\"ECE9ED\"></a></div><p></p>\n<p>If the proof validates against the canonical state, the state updates are accepted and incorporated into the canonical state.<br>\n</p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/8/a/8a396a5cf7e88f798ab726157d5a3da6ca323c7f.png\" data-download-href=\"https://ethresear.ch/uploads/default/8a396a5cf7e88f798ab726157d5a3da6ca323c7f\" title=\"image\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/8/a/8a396a5cf7e88f798ab726157d5a3da6ca323c7f_2_690x388.png\" alt=\"image\" data-base62-sha1=\"jIMTZdDjLs5TDrDw47l4ukH1Z3F\" width=\"690\" height=\"388\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/8/a/8a396a5cf7e88f798ab726157d5a3da6ca323c7f_2_690x388.png, https://ethresear.ch/uploads/default/optimized/3X/8/a/8a396a5cf7e88f798ab726157d5a3da6ca323c7f_2_1035x582.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/8/a/8a396a5cf7e88f798ab726157d5a3da6ca323c7f_2_1380x776.png 2x\" data-dominant-color=\"ECE9ED\"></a></div><p></p>\n<p>In the negative flow, the transaction just reverts and the Prover pays the transaction fees.<br>\n</p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/8/5/850d64651564478bfc37889a3bff85a7ac2a28e1.png\" data-download-href=\"https://ethresear.ch/uploads/default/850d64651564478bfc37889a3bff85a7ac2a28e1\" title=\"image\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/8/5/850d64651564478bfc37889a3bff85a7ac2a28e1_2_690x386.png\" alt=\"image\" data-base62-sha1=\"iZ2ca1u6n5TkYFaY0UmyVuaDMOt\" width=\"690\" height=\"386\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/8/5/850d64651564478bfc37889a3bff85a7ac2a28e1_2_690x386.png, https://ethresear.ch/uploads/default/optimized/3X/8/5/850d64651564478bfc37889a3bff85a7ac2a28e1_2_1035x579.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/8/5/850d64651564478bfc37889a3bff85a7ac2a28e1_2_1380x772.png 2x\" data-dominant-color=\"ECE8EC\"></a></div><p></p>\n<p><strong>Conclusion</strong><br>\nThis new scaling model is perfectly suited for critical DeFi applications, Gaming and all dApps which wish to use the base layer infrastructure but have strong constraints on Responsiveness, Fees and even Privacy such as Order Book. You can find more details and contribute to its creation <a href=\"https://github.com/keep-starknet-strange/zkthread\" rel=\"noopener nofollow ugc\">here</a> and a first implementation can be found under this <a href=\"https://github.com/dojoengine/dojo/tree/main/crates/saya\" rel=\"noopener nofollow ugc\">repository</a> under the Saya settlement service developed by <a href=\"https://cartridge.gg\" rel=\"noopener nofollow ugc\">Cartridge</a>.</p>\n            <p><small>1 post - 1 participant</small></p>\n            <p><a href=\"https://ethresear.ch/t/zkthreads-a-canonical-zk-sharding-framework-for-dapps/19619\">Read full topic</a></p>","link":"https://ethresear.ch/t/zkthreads-a-canonical-zk-sharding-framework-for-dapps/19619","pubDate":"Thu, 23 May 2024 07:27:02 +0000","discourse:topicPinned":"No","discourse:topicClosed":"No","discourse:topicArchived":"No","guid":{"@isPermaLink":"false","#text":"ethresear.ch-topic-19619"},"source":{"@url":"https://ethresear.ch/t/zkthreads-a-canonical-zk-sharding-framework-for-dapps/19619.rss","#text":"ZKThreads: A canonical ZK sharding framework for dApps"},"filter":false},{"title":"EVM Native Sequencing Rules","dc:creator":"Lilyjjo","category":"Execution Layer Research","description":"<p>The goal of this post is to introduce the concept of Sequencing Rules and provide a possible sketch of what a Sequencing Rule-enabled EVM would look like. Sequencing Rules offer a rational solution to both Ethereum’s MEV and protocol innovation mindshare loss problems.</p>\n<h2><a name=\"sequencing-rules-the-why-1\" class=\"anchor\" href=\"https://ethresear.ch#sequencing-rules-the-why-1\"></a><strong>Sequencing Rules: The Why</strong></h2>\n<p>Ethereum is facing a MEV crisis. FUD is <a href=\"https://x.com/dankrad/status/1791379755922498027\" rel=\"noopener nofollow ugc\">building on Twitter</a> as block builders grow in their influence over the chain’s functioning. Block builders are collecting an <a href=\"https://www.relayscan.io/builder-profit?t=7d\" rel=\"noopener nofollow ugc\">uncomfortable amount of capital</a> with each block, yet they provide little to negative value in return. This behavior makes sense: value has been left on the table, so why shouldn’t they collect it? A rational way to stop the growing block builder oligopoly is to enable Ethereum’s on-chain applications to fully capture the value that they create.</p>\n<p>So far, discussions on fixing block builders’ power have focused only on lower-level structural L1 changes<sup><a href=\"https://ethresear.ch/t/execution-tickets/17944\">1</a>,<a href=\"https://ethresear.ch/t/state-lock-auctions-towards-collaborative-block-building/18558\">2</a>,<a href=\"https://ethresear.ch/t/exploring-paths-to-a-decentralized-censorship-resistant-and-non-predatory-mev-ecosystem/17312\">3</a></sup>, leaving out the actual source of value creation and leakage: the on-chain applications themselves. The best entity to decide how to fairly distribute the value created from ordering is the entity that is producing the value. For the sake of Ethereum’s long-term success, on-chain applications need to be able to express and control how their transactions are sequenced with supporting L1/L2 infrastructure.</p>\n<p>The rest of this post will:</p>\n<ul>\n<li>Introduce the concept of Sequencing Rules</li>\n<li>Provide a sketch of what native EVM sequencing support could look like</li>\n<li>Provide a <a href=\"https://github.com/Lilyjjo/tldr-research\" rel=\"noopener nofollow ugc\">proof-of-concept example</a> of an AMM that auctions off the right of the first swap on Ethereum</li>\n</ul>\n<h2><a name=\"sequencing-rules-the-what-2\" class=\"anchor\" href=\"https://ethresear.ch#sequencing-rules-the-what-2\"></a>Sequencing Rules: The What</h2>\n<p>Sequencing rules are not a new concept but have recently seen increased usage by blockchain developers.</p>\n<p>Sequencing rules can be conceptualized as follows:</p>\n<ol>\n<li>On-chain applications decide how they want their transactions to be sequenced.</li>\n<li>Blocks are built that respect that sequencing.</li>\n</ol>\n<p>Blockchain applications can benefit from this programming pattern due to blockchains’ inherent discrete view of time. During the 12 seconds between Ethereum’s blocks, the outside world’s valuation of different pieces of state is in flux, creating arbitrage value in the ability to act first on those pieces of state. Block builders make money by exploiting this in the form of acts like CEX-DEX arbitrage. This phenomenon is also observed in traditional finance (TradFi) with the <a href=\"https://academic.oup.com/qje/article/130/4/1547/1916146\" rel=\"noopener nofollow ugc\">high-speed arms race</a> between high-frequency trading (HFT) firms, which operate in a similar scenario but on a millisecond timeframe instead of seconds.</p>\n<p>As the field of protocol development matures, protocols are starting to manage these value-pressurized pieces of state with varying degrees of success. Examples vary but all showcase the benefits of managing one’s own sequencing:</p>\n<ul>\n<li><a href=\"https://x.com/penumbrazone\" rel=\"noopener nofollow ugc\">Penumbra</a>, a new L1 DEX, enforces ordered batch execution of all business logic, enabling all users to benefit equally from the accrued time arbitrage value.</li>\n<li>HyperLiquid’s <a href=\"https://x.com/chameleon_jeff/status/1743650555879190808\" rel=\"noopener nofollow ugc\">new L1</a> prioritizes retail and makers over toxic takers by running cancels and post-only orders first.</li>\n<li>Skip’s <a href=\"https://docs.skip.money/slinky/overview/\" rel=\"noopener nofollow ugc\">Slinky</a> project surfaces oracle data at the block level to ensure all applications can utilize fresh oracle data.</li>\n<li><a href=\"https://uma.xyz/oval\" rel=\"noopener nofollow ugc\">Oval</a> auctions off the right to be the first person to act on updated oracles information.</li>\n<li>Years of research<sup><a href=\"https://ethresear.ch/t/mev-capturing-amm-mcamm/13336\">1</a>,<a href=\"https://arxiv.org/abs/2210.10601\" rel=\"noopener nofollow ugc\">2</a>,<a href=\"https://arxiv.org/html/2403.03367v1\" rel=\"noopener nofollow ugc\">3</a></sup> have been conducted on how to implement first-swap auctions for AMMs on Ethereum, though no production-grade result is running yet.</li>\n</ul>\n<p>Sequencing rules for blockchain applications are natural, yet Ethereum does not offer native solutions to enable developers to program their applications accordingly.</p>\n<h2><a name=\"sequencing-rules-the-how-3\" class=\"anchor\" href=\"https://ethresear.ch#sequencing-rules-the-how-3\"></a>Sequencing Rules: The How</h2>\n<p>As seen in the list above, protocols are starting to migrate to other ecosystems with novel L1 implementations because their sequencing needs are not being met on Ethereum. Instead of Ethereum’s on-chain protocols capturing the time-accrued value, block builders are. Ethereum’s EVM needs sequencing rules.</p>\n<p>Ethereum’s EVM programming environment is different from an L1 that is specialized for a specific application because it is a shared general execution environment. Applications and transactions share both block space and state with each other. As a result, anyone implementing sequencing rules for an EVM should consider:</p>\n<ul>\n<li>On-chain applications cannot assume a piece of state’s value will not change unless it is explicitly controlled.</li>\n<li>Not all on-chain applications need sequencing.</li>\n<li>Not all actions within an application need sequencing.</li>\n</ul>\n<p>I will now lay out a rough draft version of how one could implement sequencing rules for Ethereum. In order to meet the above considerations, I propose adding two new transaction types:</p>\n<ol>\n<li>A new ‘bundle’ transaction type. This transaction would be signed by an EOA and would contain a payload of ordered transactions. We’ll call this EOA a bundler. This ‘transaction’ itself does not trigger on-chain execution, it simply just orders other transactions.</li>\n<li>A new transaction type that specifies the bundler (just an EOA) that is able to include the transaction in a bundle.</li>\n</ol>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/b/3/b376ab484f0a2eaa09bcb254d7f12439f442621d.png\" data-download-href=\"https://ethresear.ch/uploads/default/b376ab484f0a2eaa09bcb254d7f12439f442621d\" title=\"IMG_0025\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/b/3/b376ab484f0a2eaa09bcb254d7f12439f442621d_2_689x500.png\" alt=\"IMG_0025\" data-base62-sha1=\"pBBIiDg19vfKNLGcdpmPWsWroPr\" width=\"689\" height=\"500\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/b/3/b376ab484f0a2eaa09bcb254d7f12439f442621d_2_689x500.png, https://ethresear.ch/uploads/default/optimized/3X/b/3/b376ab484f0a2eaa09bcb254d7f12439f442621d_2_1033x750.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/b/3/b376ab484f0a2eaa09bcb254d7f12439f442621d_2_1378x1000.png 2x\" data-dominant-color=\"F4F3EA\"></a></div><p></p>\n<p>EVM block construction would be modified to enforce the following rules:</p>\n<ul>\n<li>A bundler can only have a single bundle transaction included in a block, and optionally, a bundle is only valid in a certain block. Some business applications would benefit from being able to run bundles in only certain blocks.</li>\n<li>A bundle can specify a bundler that is able to include it in a bundle, for meta-bundle programming.</li>\n<li>A transaction can only be included in a bundle if it specifies bundler, and if a transaction specifies a bundler, the transaction can only be included in a block if it is in a bundle. This is to prevent bundles from clashing with each other, which would cause builders to have extra incentive to include one bundler over another.</li>\n<li>Unlike Ethereum’s current block builder’s bundle interface, transactions in a bundle do not have any non-revert guarantees. On-chain application logic must handle possible reverts. This is again to prevent bundles from clashing with each other.</li>\n</ul>\n<p>The EVM itself would be modified to include the new following global variables:</p>\n<ul>\n<li><code>bundle.signer</code>: the EOA who signed the bundle. Useful for on-chain applications to designate sequencing rights to a specific off-chain entity. The zero address if not in a bundle.</li>\n<li><code>bundle.number</code>: the global number of the bundle’s ordering. Useful for meta-bundle programming. Zero if not in a bundle.</li>\n<li><code>bundle.tx_number</code>: which number this transaction is in the bundle. Useful for on-chain applications to enable special logic depending on transaction sequence. Zero if not in a bundle.</li>\n</ul>\n<p>These new EVM rules and global variables could be a strong starting point for on-chain applications to express how they’d like to be sequenced.</p>\n<p>There are numerous security and caveats to consider in this implementation. EVM bundle creators would need to take care to only sequence on state that they directly control from the start of the block. This is because all other state is potentially manipulatable by outside entities. Bundle creators would have to assume that all transactions could revert due to insufficient gas funds, that any piece of unprotected state could be changed, and that any starting point besides its own external functions are non-deterministic. Sequencing rule assumptions about mutable state could be a new class of audit vulnerabilities.</p>\n<p>Additionally, these rules or language expansions do not preclude block builders existing or making money. Bundlers could construct multiple bundles and rely on block building services to take advantage of the highest result. Inter-bundle arbitrage could be a new solver target. Analogous to the EVM global variables proposed above, <code>tx.number</code> could be included to allow block builders to explicitly sell the right to be the first transaction included.</p>\n<p>Notably, this implementation lacks specification on how on-chain applications would construct bundles. This would be up to the applications to chose between different trust and privacy tradeoffs. Some options would include using:</p>\n<ul>\n<li>Flashbot’s <a href=\"https://suave-alpha.flashbots.net/\" rel=\"noopener nofollow ugc\">Suave</a> TEE enabled decentralized platform for business applications needing confidential compute.</li>\n<li>A sequencing layer, like <a href=\"https://x.com/AstriaOrg\" rel=\"noopener nofollow ugc\">Astria</a>, to construct generic bundles.</li>\n</ul>\n<h2><a name=\"sequencing-rules-an-example-4\" class=\"anchor\" href=\"https://ethresear.ch#sequencing-rules-an-example-4\"></a>Sequencing Rules: An Example</h2>\n<p>I came up with the above Ethereum compatible sequencing rule proposal while trying to program a <a href=\"https://github.com/Lilyjjo/tldr-research\" rel=\"noopener nofollow ugc\">first swap auction for a AMM on Ethereum</a>. This proof of concept aims to implement the sequencing rule ‘the first swap should be auctioned’ for the sake of rerouting some of the CEX-DEX arbitrage back to the pool’s LPs. It utilizes block builder’s current <a href=\"https://docs.flashbots.net/flashbots-auction/advanced/rpc-endpoint#eth_sendbundle\" rel=\"noopener nofollow ugc\">bundle infrastructure</a> to craft bundles and inserts logic on-chain via a signed transaction to enforce that the bundle’s sequence is respected. This proof of concept uses Flashbot’s SUAVE TEE enabled programming environment to craft bundles for the AMM in a trust-reduced manner. This implementation could be easily rewritten with the above EVM native bundle proposal with much better execution costs and guarantees.</p>\n<p>I wrote this post because I’m a frustrated protocol developer who wants to capture the maximal value for my actual users. These are just my thoughts on how we can potentially make “Ethereum Great Again” <img src=\"https://ethresear.ch/images/emoji/facebook_messenger/green_heart.png?v=12\" title=\":green_heart:\" class=\"emoji\" alt=\":green_heart:\" loading=\"lazy\" width=\"20\" height=\"20\"><img src=\"https://ethresear.ch/images/emoji/facebook_messenger/blue_heart.png?v=12\" title=\":blue_heart:\" class=\"emoji\" alt=\":blue_heart:\" loading=\"lazy\" width=\"20\" height=\"20\"><img src=\"https://ethresear.ch/images/emoji/facebook_messenger/sparkles.png?v=12\" title=\":sparkles:\" class=\"emoji\" alt=\":sparkles:\" loading=\"lazy\" width=\"20\" height=\"20\">.</p>\n<p>Please leave comments if you have them!</p>\n<p>Thank you to my teammates <a href=\"https://x.com/itamarreif\" rel=\"noopener nofollow ugc\">Itamar</a> and <a href=\"https://x.com/visavishesh\" rel=\"noopener nofollow ugc\">Vishesh</a> at <a href=\"https://x.com/AstriaOrg\" rel=\"noopener nofollow ugc\">Astria</a> for agreeing to talk about auctions for way too long, <a href=\"https://x.com/thelatestindefi\" rel=\"noopener nofollow ugc\">The Latest in Defi Research</a> for providing the community to iterate on these thoughts, and to the Suave team for letting me learn how to build bundles on their platform.</p>\n<p>*Note: these @'s have no endorsement or involvement in this post, these words and opinions are my own :).</p>\n            <p><small>9 posts - 5 participants</small></p>\n            <p><a href=\"https://ethresear.ch/t/evm-native-sequencing-rules/19606\">Read full topic</a></p>","link":"https://ethresear.ch/t/evm-native-sequencing-rules/19606","pubDate":"Wed, 22 May 2024 17:06:44 +0000","discourse:topicPinned":"No","discourse:topicClosed":"No","discourse:topicArchived":"No","guid":{"@isPermaLink":"false","#text":"ethresear.ch-topic-19606"},"source":{"@url":"https://ethresear.ch/t/evm-native-sequencing-rules/19606.rss","#text":"EVM Native Sequencing Rules"},"filter":false},{"title":"Self-Sovereign Identity and Account Abstraction for Privacy-Preserving cross chain user operations across roll ups","dc:creator":"EugeRe","category":"Execution Layer Research","description":"<p>This is a part of a longer research on the topic which ultimately intends to establish a common framework to originate on-chain data and process it to the networks supporting data minimization to balance user privacy and compliance needs.</p>\n<p>I wanted to thank <a href=\"https://www.linkedin.com/in/erwin-voloder-mes-317735125/?original_referer=https%3A%2F%2Fwww%2Egoogle%2Ecom%2F&amp;originalSubdomain=hr\">Erwin Voloder</a>, <a href=\"https://twitter.com/PeteCooling\">Pete Cooling</a>, <a href=\"https://twitter.com/kimdhamilton?lang=en\">Kim Hamilton</a> and <a href=\"https://www.linkedin.com/in/martinschaeffner/\">Martin Schaffner</a>, who personally supported this research in different ways and the people from ERC-4337 Team, specifically <a class=\"mention\" href=\"https://ethresear.ch/u/yoavw\">@yoavw</a> , <a class=\"mention\" href=\"https://ethresear.ch/u/zincoshine\">@zincoshine</a> AA Mafia Telegram Group, <a href=\"https://x.com/alexanderchopan\">Alex</a> and <a href=\"https://twitter.com/randomishwalk?lang=en\">Eric</a>  for further support. This is an ongoing project, I hope you appreciate the forward thinking and we are continuing to work on it. Any feedback or support is appreciated, in light blue hyperlinked public content for reference.</p>\n<p><strong>ABSTRACT</strong><br>\nThis research explores the innovative integration of Self-Sovereign Identity (SSI) systems with Account Abstraction (AA) to enhance privacy, compliance, and user experience on the Ethereum blockchain. By leveraging verifiable credentials (VCs) and Ethereum attestations (EAs), the proposed framework empowers bundlers to pre-validate transactions, reducing on-chain reverts and penalties. The implementation of Merkle proofs and Zero-Knowledge Proofs (ZKPs) ensures efficient data processing and minimal disclosure, addressing both scalability and security concerns.</p>\n<p>A significant highlight is the introduction of keystore rollups, which manage encryption keys off-chain to facilitate atomic cross-chain transactions. These rollups promote interoperability between sequencing networks, ensuring seamless data exchange and robust security. The research underscores the potential of modular blockchain networks and advocates for the adoption of ERC-4337 and future cryptographic advancements to standardize and optimize Ethereum’s execution layer.<br>\n<strong></strong></p><div class=\"lightbox-wrapper\"><strong><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/2/e/2e77cc94de2442ed8b9e865737b216b820de2396.png\" data-download-href=\"https://ethresear.ch/uploads/default/2e77cc94de2442ed8b9e865737b216b820de2396\" title=\"\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/2/e/2e77cc94de2442ed8b9e865737b216b820de2396_2_597x354.png\" alt=\"\" data-base62-sha1=\"6D4DbTTkaljJMbgMGtKlmte2pVQ\" width=\"597\" height=\"354\" role=\"presentation\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/2/e/2e77cc94de2442ed8b9e865737b216b820de2396_2_597x354.png, https://ethresear.ch/uploads/default/optimized/3X/2/e/2e77cc94de2442ed8b9e865737b216b820de2396_2_895x531.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/2/e/2e77cc94de2442ed8b9e865737b216b820de2396_2_1194x708.png 2x\" data-dominant-color=\"666666\"></a></strong></div><p></p>\n<p><strong>THE WORK</strong><br>\nUsing verifiable credentials (VCs) or Ethereum attestations (EAs) to empower bundlers in a shared mempool can potentially reduce the risk of on-chain reverts by sequencers and penalties for block builders. By including data assertions in user operations, bundlers are supported in the pre-validate certain aspects of the transactions. This pre-validation can help identify and filter out operations with a high risk of reverting during execution. This reduces the chances of sequencers including such operations in blocks, lowering the overall revert risk. VCs and EAs provide cryptographic proofs that can be verified by sequencers. These proofs can increase trust in the validity of the operations, making sequencers more confident about including them in blocks.</p>\n<p>This has potential positive consequences in terms of reducing risk of penalties for block builders. . Data assertions containing proofs about transaction ordering can help sequencers resist such manipulation attempts, potentially reducing penalties for block builders who are susceptible to MEV.</p>\n<p>The effectiveness of data assertions in reducing reverts and penalties depends on factors like network assertation standardization and native account abstraction adoption but using VCs and EAs in a shared mempool with ERC-4337 could be considered as first step to it and has the potential to significantly reduce the risk of on-chain reverts and penalties for sequencers and block builders.</p>\n<p>Overall, the complexity of implementing and maintaining new verification logic for bundlers may be compensated by an overall better synergy with the other actors in the network. Specifically on the logic side, general standards like did:pkh or did:dis could find common ground of assessment. In fact, the same verification logic is standards practice for user authentication where user store different assertation on the identity within the wallet application. Extending the same logic approach into the context of smart contract accounts we would suggest for bundlers to store data processing assertation into the mempool of future transactions until consolidated finality is reached.<br>\nAt the same time, a standardized method for signature validation will be required. ERC-1271 enhances the security and interoperability of the system. So to ensure that all signatures whether aggregated or individual, are verified uniformly, reducing the risk of fraud and enhancing trust in the system.<br>\nIn that context ERC-1271 facilitates efficient cross-chain operations by ensuring that signatures required for these transactions are validated consistently across different networks. This reduces the complexity and potential errors in verifying multiple signatures, making cross-chain transactions more efficient and reliable.</p>\n<p><a href=\"https://notes.ethereum.org/@yoav/unified-erc-4337-mempool\">The same verification and validation logic could be extended into a future unified mempool once potentially account abstraction would be natively implemented following 7560/7562 rules.</a></p>\n<p>Including proofs of VCs or EAs adds data to user operations, potentially leading to larger bundles and higher gas costs. This can put pressure on mempool capacity. Utilizing Merkle proofs within VCs can allow bundlers to verify the inclusion of specific data elements without needing the entire credential, reducing the amount of data processed. Merkle trees are a cryptographic data structure that allows for efficient verification of the membership of a specific data element within a larger set.</p>\n<p>After user authentication, for each user operation, the bundler includes a Merkle proof. This proof is a concise piece of data that demonstrates the specific assertion’s inclusion within the Merkle tree of the entire bundle. This can significantly reducing the overall size of the bundle compared to including the full VCs or EAs.</p>\n<p>VCs and EAs still remain crucial for containing the actual data and claims associated with user operations. Merkle proof act as a verification tool. They provide a concise way to prove that a specific VC or EA exists within a larger bundle of assertions without revealing the entire content of the VC/EA itself. This may help mitigate pressure on the mempool and potentially lowers gas costs.</p>\n<p>This would imply for bundlers to access a privacy preserving shared mempool ID and establish a dedicated membership set for associated bundle of transactions, so that Sequencers can verify the inclusion of user operations in the bundle. Sequencers or other network participants can efficiently verify the validity of data assertions using the Merkle proofs. They only need to verify the proof itself, not the entire data within the assertion, reducing the computational burden.</p>\n<p>VCs and EAs rely on the underlying logic verification process for authentication and authorization that should be implemented by bundlers. Verifying VCs or EAs requires processing cryptographic proofs. This can be computationally expensive for bundlers, especially for complex assertions.</p>\n<p><a href=\"https://papers.ssrn.com/sol3/papers.cfm?abstract_id=4563364\">Merkle proofs can be combined with ZKPs for a powerful solution.</a> ZKPs can be used within the data assertions themselves to prove the validity of claims without revealing the underlying data. Merkle proofs ensure the integrity of the bundle and verify the inclusion of specific assertions with ZKPs within the bundle. Also, using ZKPs in VCs or EAs could reduce the amount of data included in the bundle, minimizing disclosure, and lowering computational costs.</p>\n<p>Combining SSI verification with AA provides Ethereum a customizable authorization logic that can leverage national data repositories and business and regulatory standards before easily executing global on-chain operations. In this context, embedding a trust less verification logic can support standardizing user operations and streamlining sequencing activities, and so harmonizing operations across L2 transactions for unlocking cross chain atomic transaction and still ensuring efficient data processing compliant with data minimization.</p>\n<p>The transaction generation, submission and execution flow can be represented with an interchained process of triangles of trust representing each moment as described here.</p>\n<p><strong></strong></p><div class=\"lightbox-wrapper\"><strong><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/9/5/957433820f871fd453df50f9074cc21fd4bd9e1e.png\" data-download-href=\"https://ethresear.ch/uploads/default/957433820f871fd453df50f9074cc21fd4bd9e1e\" title=\"\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/9/5/957433820f871fd453df50f9074cc21fd4bd9e1e_2_643x361.png\" alt=\"\" data-base62-sha1=\"lk86o2b0PTKtbNka0sbQn3ZyNdk\" width=\"643\" height=\"361\" role=\"presentation\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/9/5/957433820f871fd453df50f9074cc21fd4bd9e1e_2_643x361.png, https://ethresear.ch/uploads/default/optimized/3X/9/5/957433820f871fd453df50f9074cc21fd4bd9e1e_2_964x541.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/9/5/957433820f871fd453df50f9074cc21fd4bd9e1e_2_1286x722.png 2x\" data-dominant-color=\"F4F4F4\"></a></strong></div><p></p>\n<p>The market pushing for an evolution of networks towards to modular blockchains is proposing concepts of shared mempools and shared sequencing that can embed trustless verification logic typical of SSI systems to establish a root of trust from user authentication until block validation still relying on Ethereum main network as indisputable security layer.</p>\n<p>This combination minimizes data disclosure while maintaining efficient verification, making the system more scalable and privacy-preserving.</p>\n<p><strong><a href=\"https://hackmd.io/@haichen/keystore\">Key store contract</a> <a href=\"https://hackmd.io/@haichen/keystore\">for flexible and efficient key management system</a></strong></p>\n<p>To further enhance standardization and interoperability considering key management an important function to manage user authentication and transaction authorization. A keystore contract paired with zero-knowledge proofs (ZKPs) has the potential to significantly improve the verification logic and overall functionality of data assertions within the ERC-4337 framework.</p>\n<p>The keystore contract can securely store and manage encryption keys used by bundlers to encrypt user operations within bundles after authentication. This can ensure that only authorized parties (with the appropriate decryption key) can access the sensitive data within the bundle.<br>\n</p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/4/2/42da34932f49f48f96077877f991029db0d43fb4.png\" data-download-href=\"https://ethresear.ch/uploads/default/42da34932f49f48f96077877f991029db0d43fb4\" title=\"image\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/4/2/42da34932f49f48f96077877f991029db0d43fb4_2_517x182.png\" alt=\"image\" data-base62-sha1=\"9xp0Z7yHybgHoue33xAye0bRoAk\" width=\"517\" height=\"182\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/4/2/42da34932f49f48f96077877f991029db0d43fb4_2_517x182.png, https://ethresear.ch/uploads/default/optimized/3X/4/2/42da34932f49f48f96077877f991029db0d43fb4_2_775x273.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/4/2/42da34932f49f48f96077877f991029db0d43fb4_2_1034x364.png 2x\" data-dominant-color=\"C6C7C1\"></a></div><p></p>\n<p>The keystore contract can facilitate the pairing of the correct key with specific data assertions within a bundle. This allows different network participants (builders and sequencers) to efficiently verify the authenticity of the data using the corresponding ZKPs without needing the actual data itself. A minimal keystore rollup deployed on Layer 2 can handle a large volume of key management and verification processes off-chain, reducing the load on the main Ethereum network. The keystore functionality is key in order to ensure efficient authentication to users Identifiers and enabling cross chain user operations also leveraging shared sequencing. This allows for seamless data exchange and verification between different ecosystems, fostering a more interconnected environment supported of atomic cross chain transaction data process minimization and standardization. Different potential design for Keystore emerged in the market. Networks like Safe, Arbitrum, ZkSync, Scroll, Starknet have proposed different implementations.</p>\n<p><strong>L1 Keystore with L2 Sync</strong> - This design keeps the keystore on Ethereum L1 and syncs with L2 networks to ensure quick access and state consistency across chains. It provides high security but may involve higher latency and costs.</p>\n<p>When the keystore state is maintained on L1 and synchronized with L2 networks to ensure quick access and state consistency across chains. This approach maintains the security guarantees of L1 while aiming to minimize latency and reduce costs associated with high transaction fees on L1. This method provides a robust security framework due to the inherent security of L1, ensuring that key management and authentication logic are protected against potential threats. However, this design can involve higher transaction costs and potential latency issues due to the need to synchronize state changes across multiple layers. A reference implementation for this design can be seen in projects like Safe.</p>\n<p><strong>Dedicated L2 Keystore</strong> - Deploying the keystore directly on an L2 network reduces costs and latency. This design uses zk-Rollups for secure key updates and storage. Deploying the keystore directly on an L2 network focuses on reducing operational costs and transaction latency. This design option utilizes zk-Rollups for efficient and secure key updates and storage, ensuring scalability without compromising security. By keeping the keystore operations within the L2 environment, transaction fees are significantly lower, and the response times for key management operations are improved.</p>\n<p><strong>Hybrid Model</strong>  - Combines L1 and L2 keystore advantages, using L1 for storage and L2 for efficient access and operations, leveraging cross-chain compatibility for seamless integration. The hybrid model combines the security benefits of L1 storage with the operational efficiency of L2 transactions. In this model, the keystore data is primarily stored on L1, ensuring high security, while L2 is used for accessing and updating keys. Merkle proofs are essential for maintaining consistency and verifying that updates on L2 are accurately reflected on L1. This model uses Merkle proofs to ensure that any changes made on L2 are consistent with the L1 state, providing a balanced approach that leverages the strengths of both L1 and L2. This design requires efficient generation and verification of Merkle proofs across both layers to ensure low latency and high security, making it a complex but highly effective solution for comprehensive key management.</p>\n<p>Merkle proofs play a vital role in maintaining the integrity and consistency of keystore operations across different blockchain layers.</p>\n<p><strong>Here is a potential process workflow and designed architecture:</strong></p>\n<p>The architecture is composed by three main layers:</p>\n<ol>\n<li>An application layer comprises wallets, PKIs apps, and SSI wallet such as Polygon ID, ZkSync ID, and other apps. These wallets and applications generate Verifiable Credentials (VCs) to prove ownership, such as being a DAO member. Users create operations as user intents via bundlers, enabling transactions and interactions on the blockchain. This layer facilitates the generation and management of credentials and user operations as “user intents” through apps, serving as the interface between users and the underlying blockchain infrastructure.</li>\n<li>A network layer based on different L2s, which include a Keystore contract and Smart Contract Accounts. This layer is responsible for generating Zero-Knowledge Proofs (ZKPs) for bundlers and Merkle proofs for Sequencers. The Keystore contract manages encryption keys and user authentication, ensuring secure handling of credentials and operations. Smart Contract Accounts validate user operations, generating cryptographic proofs to ensure the integrity and validity of transactions before they are submitted to the blockchain for execution.</li>\n<li>A sequencing layer which interconnect L2s with Ethereum main-net and manages the execution of batches of transactions anchoring Roll-up IDs to sequencing networks ( projects like SUAVE, Polygon Agg Layer, Espresso Capuccino). Main functions here are batching, validation of  transactions via the Keystore roll-up, and  the Roll-up contract within Ethereum’s slots. This layer ensures efficient transaction processing by batching multiple operations into single transactions, reducing on-chain congestion and costs. Additionally, it enable cross-chain atomic transactions, enabling seamless interoperability across different blockchain networks, ensuring that transactions are securely validated and finalized.</li>\n</ol>\n<p><strong></strong></p><div class=\"lightbox-wrapper\"><strong><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/6/7/676efe42126406535aece6ca6d086ff7e6396736.png\" data-download-href=\"https://ethresear.ch/uploads/default/676efe42126406535aece6ca6d086ff7e6396736\" title=\"\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/6/7/676efe42126406535aece6ca6d086ff7e6396736_2_687x392.png\" alt=\"\" data-base62-sha1=\"eL0YQ2NAoChvwfY0ub9iXBZr64e\" width=\"687\" height=\"392\" role=\"presentation\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/6/7/676efe42126406535aece6ca6d086ff7e6396736_2_687x392.png, https://ethresear.ch/uploads/default/optimized/3X/6/7/676efe42126406535aece6ca6d086ff7e6396736_2_1030x588.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/6/7/676efe42126406535aece6ca6d086ff7e6396736_2_1374x784.png 2x\" data-dominant-color=\"303030\"></a></strong></div><p></p>\n<ol>\n<li>User Authentication: Users authenticate using Verifiable Credentials (VCs) . They share Zero-Knowledge Proofs (ZKPs) of their credentials through a smart contract registry and sign user operations on a dedicated bundler.</li>\n<li>Bundler Operations: Bundlers access a shared mempool ID, create bundles of verified user operations, establish a dedicated Merkle tree for each bundle post-authentication, and share the Merkle proofs and ZKPs with the Sequencer. They submit the transaction bundles to the Smart Contract Account (entry point).</li>\n<li>Sequencer Verification: Sequencers verify Merkle proofs and ZKPs related to VCs. They validate bundles of transactions through the Smart Contract Account and submit them to the Block-builder for inclusion in a new block.</li>\n<li>Keystore Rollup: The keystore contract and rollup manage key functions, including user authentication, transaction submission, validation, and key recovery.</li>\n<li>Batching Transactions: Sequencer batch transactions into new block of Roll up IDs and submit them in batches via the Rollup contracts for validation on L1, verified by ZK validity proofs.</li>\n<li>Rollup Validation: The Rollup contract validates ZK proofs of batches, and the block is  finalized or reverted if validation fails.</li>\n</ol>\n<p>Specifically in this scenario, proposals as ERC 5792 acts as a crucial bridge between user-facing applications and the infrastructure of the ERC-4337 framework. The proposal defines a common language for wallets, apps, and bundlers to communicate each other and it has the potential to significantly enhance the adoption of Smart Contract Accounts and position as the go-to standard for data assertions on the Ethereum blockchain.</p>\n<p>Wallets and apps could signal user preferences (e.g., gas fees, preferred chain ID, or shared sequencer), required data assertions (VCs/EAs) for specific transactions.</p>\n<p>Bundlers could leverage the received signals to automatically construct appropriate bundles for user transactions including user operations data, Merkle proofs for associated VCs/EAs and ZKP of user data claim. With this having an overall improvement for user flexibility, network decentralization and scalability.<br>\nThe designed architecture also benefit from <a href=\"https://ethereum-magicians.org/t/erc-7715-request-permissions-from-wallets/20100\">ERC-7715</a>, further enhancing accounts functionalities on dedicated permission sessions for EOAs and SCAs aligniing with the <a href=\"https://github.com/ethereum/EIPs/blob/master/EIPS/eip-7702.md\">EIP-7702</a> on Pectra. In fact standardized user authentication method will reinforce user protection about what permissions are being requested by dApps for starting sessions.</p>\n<p>Once authenticated users were given permission to start sessions, dapps could leverage User operation builders through apps hosted on bundlers and following ERC-7679 compile different intents as standardized user operations.<br>\n<a href=\"https://ethereum-magicians.org/t/erc-7679-useroperationbuilder-a-common-onchain-interface-for-dapps-to-interact-with-4337-wallets/19547\">ERC-7679</a> provides a common on-chain interface, the UserOperationBuilder, for dApps to interact with ERC-4337 Smart contract Accounts. This interface helps standardize how user operations are constructed, making it easier for dApps to support various account implementations without needing account-specific SDKs.</p>\n<p>The proposed design also goes into the direction of modular networks that can be built over Ethereum network by the Ethereum community. In this modular scenario ERC 4337 and future developments benefits from possible future implementations as Verkle trees or consensus related proposals as ePBS.</p>\n<p>Bundlers create bundles containing user operations, Merkle proofs, VCs/EAs (potentially with ZKPs), and additional data.</p>\n<p>Sequencers verify Merkle proofs and potentially VCs/EAs within bundles, order bundles, perform additional verification if needed, submit pre-built blocks to validators.</p>\n<p>Before accepting the request, the sequencer should:</p>\n<ul>\n<li>If block range was given, check that the block number is within the range.</li>\n<li>If timestamps range was given, check that the block’s timestamp is within the range.</li>\n<li>For an address with a storage root hash, validate the current root is unmodified.</li>\n<li>For an address with a list of slots, it should verify that all these slots hold the exact value specified.</li>\n</ul>\n<p><a href=\"https://notes.ethereum.org/@yoav/SkaX2lS9j#\">The sequencer should REJECT the request if any address is doesn’t pass the above rules.</a></p>\n<p>Builders construct valid blocks based on pre-verified and potentially pre-ordered bundles received from sequencers, considering block gas limits and network conditions. Ultimately, validators verify the validity of submitted blocks (including the validity of the included bundles), reach consensus on block inclusion in the blockchain.</p>\n<p><strong>CONCLUSION</strong><br>\nDriving towards the adoption of blockchain services implies relying on modular networks that can balance security, scalability and decentralization to populate an ecosystem of applications as plug and play solutions for dedicated use cases, in this regard combining SSI verification logic into the network operations to users and machines to support accountability and compliant data processing process is key. Smart Contract Accounts can facilitate adoption by flexible UX and shared sequencing networks support cross chain atomic transaction reconciliation. The narrative of this research wants to emphasize the need to abstract complexities from accounts, and networks where decentralized identifiers and keystore roll up can facilitate the verification and execution of sequencing networks.</p>\n<p><strong>Takeaways</strong>:</p>\n<ul>\n<li>\n<p><strong>SSI</strong>: Integrates trustless identification, enhancing privacy and data minimization.</p>\n</li>\n<li>\n<p><strong>AA</strong>: Simplifies user experience and facilitates regulatory compliance and governance needs.</p>\n</li>\n<li>\n<p><strong>Verifiable Credentials (VCs) and Ethereum Attestations (EAs)</strong>: Used to empower bundlers, reducing the risk of on-chain reverts and penalties for block builders by providing cryptographic proofs.</p>\n</li>\n<li>\n<p><strong>Merkle Proofs</strong>: Efficiently verify specific data elements within larger sets, mitigating mempool pressure and lowering gas costs.</p>\n</li>\n<li>\n<p><strong>Zero-Knowledge Proofs (ZKPs)</strong>: Enhance privacy by proving the validity of claims without revealing underlying data.</p>\n</li>\n<li>\n<p><strong>Shared Mempools</strong>: Facilitate bundler operations and reduce computational burdens.</p>\n</li>\n<li>\n<p><strong>Keystore rollups</strong> Enhance atomic cross-chain transactions across sequencing networks by providing a scalable and interoperable key management solution that ensures seamless data exchange and verification across different L2.*</p>\n</li>\n</ul>\n<p><strong>References</strong>:<br>\n<a href=\"https://notes.ethereum.org/@yoav/AA-roadmap-May-2024\">Notes on the Account Abstraction roadmap</a><br>\n<a href=\"https://github.com/ethereum/RIPs/blob/e3bead34f1bcf1aa37fd51923ad99a77b801775c/RIPS/rip-7560.md#unused-gas-penalty-charge\">RIP 7560</a><br>\n<a href=\"https://eips.ethereum.org/EIPS/eip-7562\">EIP 7562</a><br>\n<a href=\"https://hackmd.io/@alexforshtat/native-account-abstraction-roadmap\">Roadmap for Native Account Abstraction Introduction</a>)<br>\n<a href=\"https://notes.ethereum.org/@yoav/unified-erc-4337-mempool\">Unified ERC-4337 mempool</a><br>\n<a href=\"https://papers.ssrn.com/sol3/cf_dev/AbsByAuth.cfm?per_id=6131244\">Blockchain Privacy and Regulatory Compliance: Towards a Practical Equilibrium</a><br>\n<a href=\"https://hackmd.io/@haichen/keystore\">Keystore Design</a><br>\n<a href=\"https://notes.ethereum.org/@vbuterin/minimal_keystore_rollup\">Dedicated minimal rollup for keystores</a><br>\n<a href=\"https://notes.ethereum.org/@yoav/SkaX2lS9j#\">Integration API for EIP-4337 bundler with an L2 validator/sequencer</a><br>\n<a href=\"https://etherspot.io/blog/decentralized-future-erc-4337-shared-mempool-launches-on-ethereum/\">Decentralized Future: ERC-4337 Shared Mempool Launches on Ethereum</a><br>\n<a href=\"https://www.w3.org/TR/vc-data-model-2.0/#:~:text=A%20verifiable%20credential%20is%20a,certificates%2C%20and%20digital%20educational%20certificates.\">Verifiable Credentials Data Model v2.0</a><br>\n<a href=\"https://attest.org/\">Ethereum Attestation Service</a><br>\n<a href=\"https://mirror.xyz/0xeee68aECeB4A9e9f328a46c39F50d83fA0239cDF/afmS07VvelERZHzG6SSzhOKJlNwhU3jsE-4atkbNZto\">Supercharging Account Abstraction with Attestations</a><br>\n<a href=\"https://hackmd.io/@mdehoog/mksr\">Minimal KeyStore Rollup spec</a><br>\n<a href=\"https://eips.ethereum.org/EIPS/eip-1271\">ERC-1271: Standard Signature Validation Method for Contracts</a><br>\n<a href=\"https://github.com/ethereum/EIPs/blob/master/EIPS/eip-7702.md\">EIP 7702</a><br>\n<a href=\"https://ethereum-magicians.org/t/erc-7715-request-permissions-from-wallets/20100\">ERC-7715: Request Permissions from Wallets</a><br>\n<a href=\"https://ethereum-magicians.org/t/erc-7679-useroperationbuilder-a-common-onchain-interface-for-dapps-to-interact-with-4337-wallets/19547\">ERC-7679: userOperationBuilder - a common onchain interface for dapps to interact with 4337 wallets</a><br>\n<a href=\"https://scroll.io/blog/towards-the-wallet-endgame-with-keystore\">Towards the wallet endgame with Keystore</a><br>\n<a href=\"https://hackmd.io/@haichen/keystore\">Keystore design by Haichen Shen</a></p>\n            <p><small>1 post - 1 participant</small></p>\n            <p><a href=\"https://ethresear.ch/t/self-sovereign-identity-and-account-abstraction-for-privacy-preserving-cross-chain-user-operations-across-roll-ups/19599\">Read full topic</a></p>","link":"https://ethresear.ch/t/self-sovereign-identity-and-account-abstraction-for-privacy-preserving-cross-chain-user-operations-across-roll-ups/19599","pubDate":"Mon, 20 May 2024 15:05:28 +0000","discourse:topicPinned":"No","discourse:topicClosed":"No","discourse:topicArchived":"No","guid":{"@isPermaLink":"false","#text":"ethresear.ch-topic-19599"},"source":{"@url":"https://ethresear.ch/t/self-sovereign-identity-and-account-abstraction-for-privacy-preserving-cross-chain-user-operations-across-roll-ups/19599.rss","#text":"Self-Sovereign Identity and Account Abstraction for Privacy-Preserving cross chain user operations across roll ups"},"filter":false},{"title":"Derivatives Market for Implementing Based Sequencing","dc:creator":"0xTariz","category":"Economics","description":"<p>Authors: <a href=\"https://x.com/Hyunxukee\" rel=\"noopener nofollow ugc\">Tariz</a> (<a href=\"https://x.com/radius_xyz\" rel=\"noopener nofollow ugc\">Radius</a>)</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/1/0/1082a792a892a3e09ad171507d684219426b59dc.jpeg\" data-download-href=\"https://ethresear.ch/uploads/default/1082a792a892a3e09ad171507d684219426b59dc\" title=\"8qmb0g\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/1/0/1082a792a892a3e09ad171507d684219426b59dc_2_690x388.jpeg\" alt=\"8qmb0g\" data-base62-sha1=\"2m3z4sIChJ9yHQOLZQ26ZnXfs7y\" width=\"690\" height=\"388\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/1/0/1082a792a892a3e09ad171507d684219426b59dc_2_690x388.jpeg, https://ethresear.ch/uploads/default/original/3X/1/0/1082a792a892a3e09ad171507d684219426b59dc.jpeg 1.5x, https://ethresear.ch/uploads/default/original/3X/1/0/1082a792a892a3e09ad171507d684219426b59dc.jpeg 2x\" data-dominant-color=\"77605A\"></a></div><p></p>\n<p><em>Special thanks to <a href=\"https://x.com/NathanYJLee\" rel=\"noopener nofollow ugc\">Nathan</a> from <a href=\"https://x.com/factomind\" rel=\"noopener nofollow ugc\">Factomind</a> for his valuable advice on the design of the derivatives market.</em></p>\n<h1><a name=\"tldr-1\" class=\"anchor\" href=\"https://ethresear.ch#tldr-1\"></a><strong>TL;DR</strong></h1>\n<p>This article introduces a derivatives market designed to implement based sequencing for fast finality in rollups. The proposed market aims to align incentives between Ethereum and rollups, mitigate operational risks associated with rollups, and promote voluntary participation and fair competition among rollups, proposers, and builders.</p>\n<p>The unique design allows rollups to act as preconf providers, offering users fast preconfirmation while minimizing censorship, sandwich attacks, and frontrunning risks.</p>\n<blockquote>\n<p><em>For the full proposal, please refer to the complete <a href=\"https://mirror.xyz/tariz.eth/-TZxI3AplP-O11i-yTnyfPjwiaPOUvaWOZ32xqbpnQE\" rel=\"noopener nofollow ugc\">blog post</a>. This summary covers only the key design aspects.</em></p>\n</blockquote>\n<h1><a name=\"motivation-2\" class=\"anchor\" href=\"https://ethresear.ch#motivation-2\"></a>Motivation</h1>\n<p>If rollups, acting as preconf providers, pay proposers to pre-purchase the block building rights for specific slots, they can deterministically promise settlement to users by owning the Ethereum block. This mechanism allows rollups to achieve fast preconfirmation through self-sequencing. However, the difficulty in predicting future block prices introduces operational risks for rollups. To offset these operational risks and create a fair market that encourages active participation from traders, I propose a series of derivatives.</p>\n<blockquote>\n<p><em>This idea is connected to the implementation of delegated preconf mentioned in <a class=\"mention\" href=\"https://ethresear.ch/u/justindrake\">@JustinDrake</a> <a href=\"https://ethresear.ch/t/based-preconfirmations/17353\">based preconfirmation</a>.</em></p>\n</blockquote>\n<h1><a name=\"forward-contract-3\" class=\"anchor\" href=\"https://ethresear.ch#forward-contract-3\"></a><strong>Forward Contract</strong></h1>\n<p>The process of a rollup purchasing the block building rights for a specific slot from a proposer can be likened to a forward contract in financial markets. To understand the operational risks a rollup might face in this transaction, let’s consider a basic scenario involving a 32-slot lookahead for the proposer and a slot auction.</p>\n<ol>\n<li>At t = 1, the rollup participates in a slot auction to purchase a forward contract with the proposer for a specific slot.</li>\n<li>From t = 2 onwards, after securing the slot, the rollup sequences its users’ transactions, providing preconfirmation to users and generating revenue from the block.</li>\n<li>At t = 3, the rollup requests the execution of the forward contract, compressing its transactions into an Ethereum block and submitting them to the proposer.</li>\n<li>At t = 4, the proposer fulfills the contract by signing the received block and proposing it on Ethereum.</li>\n</ol>\n<p><strong>Operational Risks for Rollups</strong></p>\n<ol>\n<li><strong>Excessive Payment Risk</strong>: Rollups may find it challenging to accurately predict block value, leading to overpayment for block space. This occurs because they have to participate in slot auctions and purchase the entire space even if they only need a portion for settlement.</li>\n<li><strong>Revenue Uncertainty</strong>: Rollups cannot reliably predict their future revenue. If transaction costs exceed revenue, they may face potential financial risks.</li>\n<li><strong>Increased Labor Costs</strong>: To ensure stable operations, rollups must now engage in activities such as predicting Ethereum block values, competing with builders, and accurately forecasting revenues, which were previously unnecessary.</li>\n</ol>\n<h1><a name=\"derivative-market-4\" class=\"anchor\" href=\"https://ethresear.ch#derivative-market-4\"></a>Derivative Market</h1>\n<p>To mitigate the operational risks faced by rollups, we propose a derivatives market involving specialized participants, builders. This market includes two key derivatives: a forward contract between the builder and the proposer, and a swap contract between the rollup and the builder.</p>\n<ol>\n<li>At t = 1, the builder participates in a slot auction and enters into a forward contract with the proposer for the block building right.</li>\n<li>At t = 2, the rollup and the builder enter into a swap contract. This contract obligates the builder to include the rollup’s transactions in the block.</li>\n<li>At t = 3, utilizing the block building right secured through the swap contract, the builder constructs the rollup block up until t = 4, thereby generating revenue.</li>\n<li>At t = 4, the rollup demands contract fulfillment according to the obligations stipulated in the swap contract:\n<ul>\n<li>The rollup requires the builder to include its transactions in the Ethereum block secured through the forward contract.</li>\n<li>To maximize revenue, the builder places the rollup’s transactions at the bottom of the Ethereum block and its own transactions at the top, forming a complete block.</li>\n</ul>\n</li>\n<li>At t = 5, the builder delivers the Ethereum block to the proposer, who then proposes it on Ethereum, fulfilling the forward contract.</li>\n</ol>\n<p><strong>Motivation for Participation</strong></p>\n<ul>\n<li><strong>Rollup</strong>: Rollups participate to provide deterministic preconfirmation to users regarding their inclusion in Ethereum, while mitigating the operational risks associated with purchasing block space. Preconfirmed transactions are guaranteed inclusion in the Ethereum block, avoiding the risk of spending more than their revenue on block space. This eliminates the need for unnecessary labor in price prediction and auction participation.</li>\n<li><strong>Builder</strong>: Builders participate to reduce the risk of overpayment from slot auctions. The secured Ethereum block space, along with the rollup block, offers dual revenue streams, diversifying and reducing the risk of loss.</li>\n<li><strong>Proposer</strong>: Proposers participate to receive compensation for rollup preconfirmation. Builders consider the revenue generated from rollup blocks when bidding in slot auctions, aligning proposer incentives with rollup settlement.</li>\n</ul>\n<h1><a name=\"additional-design-5\" class=\"anchor\" href=\"https://ethresear.ch#additional-design-5\"></a><strong>Additional Design</strong></h1>\n<p>To effectively implement these financial products, it is crucial to create an environment where all participants can compete fairly and engage actively. This involves three key additional design elements.</p>\n<p><strong>Conditional Swap Contract</strong></p>\n<p>Rollups may be hesitant to participate if they are required to allocate all potential revenue opportunities to builders through a swap contract. To encourage rollup participation, a conditional swap contract is proposed.</p>\n<p>In this arrangement, if the builder generates profits from the rollup’s block building that exceed the fixed costs paid in the forward contract with the proposer, the rollup is allowed to stop providing the remaining block space to the builder. The rollup can then use the remaining block space to either build independently or auction it to builders for additional revenue.</p>\n<p>This approach preserves the builder’s incentive to participate while protecting the rollup’s opportunity to generate revenue.</p>\n<p><strong>Competitive Proposer Market</strong></p>\n<p>Settlement is essential for rollups to inherit Ethereum’s security. When rollups are compelled to purchase blocks, proposers/builders gain significant pricing power, potentially leading to an uneven playing field that undermines market fairness and efficiency.</p>\n<p>To reduce the pricing power of any single builder, multiple builders should be encouraged to participate in swap transactions, fostering competition among them. This requires expanding the forward contract market to include multiple proposers with block building rights for different slots.</p>\n<p>Such a structure ensures that the variable value of the rollup’s block aligns more closely with the fixed cost of acquiring Ethereum block space. This is analogous to achieving a ‘par value’ of zero for swap contracts in a competitive market, maintaining reasonable costs for rollups. The lookahead necessary to achieve this par value requires further discussion.</p>\n<p><strong>Syndicated Rollup Strategy: Derivatives for All Rollups</strong></p>\n<p>Builders may be unwilling to engage with rollups that have relatively low block value, potentially marginalizing app-specific rollups in the market.</p>\n<p>The Syndicated Rollup Strategy groups multiple rollups into a syndicate, enhancing their market participation. Cross-rollup arbitrage has the potential to increase the value of each block. Builders receive the block building rights for the rollups in the group, and the rollups require the builder to include all group transactions in the Ethereum block.</p>\n<h1><a name=\"building-blocks-in-rollups-6\" class=\"anchor\" href=\"https://ethresear.ch#building-blocks-in-rollups-6\"></a><strong>Building Blocks in Rollups</strong></h1>\n<p>This section describes how builders secure rollup block building rights through swap contracts, focusing on censorship resistance and fast preconfirmation for user-centric rollups.</p>\n<p><strong>Censorship Resistance</strong></p>\n<p>In a structure similar to Proposer-Builder Separation (PBS), rollups that enter into swap contracts receive blocks from builders and execute them. However, this setup may expose users to censorship, sandwich attacks, and frontrunning by builders. Rollups can address these issues by integrating Radius’s <a href=\"https://docs.theradius.xyz/testnet/curie-testnet/encrypted-mempool\" rel=\"noopener nofollow ugc\">sequencing engine</a>.</p>\n<ul>\n<li><strong>Encrypted Mempool (using <a href=\"https://ethresear.ch/t/radius-skde-enhancing-rollup-composability-with-trustless-sequencing/19185\">delay encryption</a>)</strong>: Users’ transactions are encrypted until the promise of inclusion in the rollup block is issued.</li>\n<li><strong>Decryption and Execution</strong>: Once inclusion is confirmed, transactions are decrypted and executed by the rollup, providing preconfirmation similar to standard transactions.</li>\n<li><strong>Economic Order Guarantees</strong>: By assigning an order to the inclusion promises, the economic guarantees ensure that transactions cannot be reordered after decryption, minimizing the risk of frontrunning and sandwich attacks.</li>\n</ul>\n<p><strong>Fast Preconfirmation</strong></p>\n<p>Rollups can achieve fast preconfirmation by designating the preconf provider as their sequencer and implementing self-sequencing. Block space is divided into two segments: Top-of-Block (ToB) and Bottom-of-Block (BoB).</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/d/2/d23430465b0f7160e93904427eba688aef1fff2f.png\" data-download-href=\"https://ethresear.ch/uploads/default/d23430465b0f7160e93904427eba688aef1fff2f\" title=\"스크린샷 2024-05-07 오후 12.44.26\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/d/2/d23430465b0f7160e93904427eba688aef1fff2f_2_690x366.png\" alt=\"스크린샷 2024-05-07 오후 12.44.26\" data-base62-sha1=\"tZy56lMBexmrb7iz0LDznXskJiv\" width=\"690\" height=\"366\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/d/2/d23430465b0f7160e93904427eba688aef1fff2f_2_690x366.png, https://ethresear.ch/uploads/default/optimized/3X/d/2/d23430465b0f7160e93904427eba688aef1fff2f_2_1035x549.png 1.5x, https://ethresear.ch/uploads/default/original/3X/d/2/d23430465b0f7160e93904427eba688aef1fff2f.png 2x\" data-dominant-color=\"E8E7E6\"></a></div><p></p>\n<ul>\n<li>\n<p><strong>Top-of-Block (ToB)</strong>: This space is allocated to the builder under the swap contract. The builder creates a backrunning bundle based on the rollup’s previous block state and submits it to the rollup’s sequencer.</p>\n</li>\n<li>\n<p><strong>Bottom-of-Block (BoB)</strong>: This space is reserved for end-user transactions. The rollup sequences these transactions and provides preconfirmation.</p>\n<p>Using Radius’s sequencing engine in BoB protects users’ transactions from censorship by the sequencer and harmful MEV by the builder, as the builder cannot see the user’s transactions when creating the ToB.</p>\n</li>\n</ul>\n<p><strong>Syndicated Rollup Strategy</strong></p>\n<p>In a syndicated rollup strategy, a group of rollups entering into swap contracts with a builder allocates ToB space to the builder. The builder submits a cross-rollup bundle to be included in the ToB.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/c/4/c4dcc9cf943b6b8894cbabc1360b8aa91e92b141.png\" data-download-href=\"https://ethresear.ch/uploads/default/c4dcc9cf943b6b8894cbabc1360b8aa91e92b141\" title=\"스크린샷 2024-05-10 오전 11.09.13 (1)\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/c/4/c4dcc9cf943b6b8894cbabc1360b8aa91e92b141_2_690x432.png\" alt=\"스크린샷 2024-05-10 오전 11.09.13 (1)\" data-base62-sha1=\"s5wCva1N40Czigkkoa0abMvvOA9\" width=\"690\" height=\"432\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/c/4/c4dcc9cf943b6b8894cbabc1360b8aa91e92b141_2_690x432.png, https://ethresear.ch/uploads/default/original/3X/c/4/c4dcc9cf943b6b8894cbabc1360b8aa91e92b141.png 1.5x, https://ethresear.ch/uploads/default/original/3X/c/4/c4dcc9cf943b6b8894cbabc1360b8aa91e92b141.png 2x\" data-dominant-color=\"F0EFEE\"></a></div><p></p>\n<p>A <a href=\"https://docs.theradius.xyz/testnet/portico-testnet/multi-rollup-sequencing\" rel=\"noopener nofollow ugc\">Shared Sequencing Engine</a> aims to ensures smooth contract execution between rollups and builders. It will verifies that the builder submitting the bundle is a party to the swap contract and is designed to ensure that all rollups in the group fulfill the contract by including the builder’s submitted bundles in ToB.</p>\n<p>Rollups can choose the shared sequencing engine for BoB sequencing. This allows the selected sequencer to act as a shared preconf provider, supporting atomic inclusion for end-users across multiple rollups.</p>\n<h1><a name=\"conclusion-7\" class=\"anchor\" href=\"https://ethresear.ch#conclusion-7\"></a><strong>Conclusion</strong></h1>\n<p>I am enthusiastic about the future of a rollup-centric Ethereum and am dedicated to exploring designs that benefit rollup users. A derivatives market that incentivizes voluntary participation of Ethereum for rollup settlements can significantly contribute to the effective implementation of based sequencing. My future research related to the derivatives market includes the following areas:</p>\n<ul>\n<li>Exploring the technical requirements necessary for market implementation.</li>\n<li>Updating the design to accommodate rollups utilizing blobspace.</li>\n<li>Proposing additional designs that can contribute to Ethereum’s decentralization, potentially considering the separation of beacon proposers and execution proposers as suggested in <a class=\"mention\" href=\"https://ethresear.ch/u/mikeneuder\">@mikeneuder</a> <a href=\"https://ethresear.ch/t/execution-tickets/17944\">Execution Ticket</a> and <a class=\"mention\" href=\"https://ethresear.ch/u/barnabe\">@barnabe</a> <a href=\"https://mirror.xyz/barnabe.eth/QJ6W0mmyOwjec-2zuH6lZb0iEI2aYFB9gE-LHWIMzjQ\" rel=\"noopener nofollow ugc\">APS-Burn</a>.</li>\n</ul>\n<p>Beyond the derivatives market, I am exploring various methods for implementing based sequencing. I look forward to contributing to this field through diverse feedback and collaboration within the community.</p>\n            <p><small>6 posts - 4 participants</small></p>\n            <p><a href=\"https://ethresear.ch/t/derivatives-market-for-implementing-based-sequencing/19593\">Read full topic</a></p>","link":"https://ethresear.ch/t/derivatives-market-for-implementing-based-sequencing/19593","pubDate":"Mon, 20 May 2024 03:49:17 +0000","discourse:topicPinned":"No","discourse:topicClosed":"No","discourse:topicArchived":"No","guid":{"@isPermaLink":"false","#text":"ethresear.ch-topic-19593"},"source":{"@url":"https://ethresear.ch/t/derivatives-market-for-implementing-based-sequencing/19593.rss","#text":"Derivatives Market for Implementing Based Sequencing"},"filter":false},{"title":"DAS fork-choice","dc:creator":"fradamt","category":"Consensus","description":"<p><em>Written by <a href=\"https://twitter.com/fradamt\" rel=\"noopener nofollow ugc\">Francesco</a>, <a href=\"https://twitter.com/luca_zanolini\" rel=\"noopener nofollow ugc\">Luca</a> and <a href=\"https://twitter.com/robsaltini\" rel=\"noopener nofollow ugc\">Roberto</a></em></p>\n<p>The goal of this document is to deepen our understanding of the interactions between the fork-choice and the data availability layer after introduction of data availability sampling (DAS), with the aim of mitigating potential attacks that arise. To achieve this, we first identify potential attacks under the current fork-choice specification and suggest strategies to counter them. This analysis assumes familiarity with <a href=\"https://github.com/ethereum/consensus-specs/blob/d29581315579d37064abf21b174750f9d5c099c0/specs/phase0/fork-choice.md\" rel=\"noopener nofollow ugc\">the current fork-choice</a> and <a href=\"https://notes.ethereum.org/@luca-zanolini/Skf98kZ_i\" rel=\"noopener nofollow ugc\">known attacks</a>, and with <a href=\"https://github.com/ethereum/consensus-specs/blob/d29581315579d37064abf21b174750f9d5c099c0/specs/_features/eip7594/das-core.md\" rel=\"noopener nofollow ugc\">PeerDAS</a>.</p>\n<h2><a name=\"distribution-phase-and-sampling-phase-1\" class=\"anchor\" href=\"https://ethresear.ch#distribution-phase-and-sampling-phase-1\"></a>Distribution phase and sampling phase</h2>\n<p>Recall that in <a href=\"https://ethresear.ch/t/peerdas-a-simpler-das-approach-using-battle-tested-p2p-components/16541\">PeerDas</a>, each blob is individually extended horizontally, stacked vertically and subdivided in <code>NUM_COLUMNS</code> columns, which are used as the sampling unit. PeerDas comprises two phases: a distribution phase and a sampling phase. In the distribution phase, columns are allocated among subsets of validators, with each subset tasked with the custody of one or more columns (<code>CUSTODY_REQUIREMENT</code>). Subsequently, in the sampling phase, validators request samples to verify data availability. These samples, or columns, are acquired from peers through a request/response mechanism. The distribution phase can also serve as a kind of preliminary sampling phase, enabling a validator to consider data available if all the columns it’s required to custody are available, even before completing the actual sampling phase. This proves especially valuable when employing a <em>trailing fork-choice</em> function, a concept explaned further below.</p>\n<h2><a name=\"tight-fork-choice-2\" class=\"anchor\" href=\"https://ethresear.ch#tight-fork-choice-2\"></a>Tight fork-choice</h2>\n<p>Ideally, <em>almost</em> all honest validators would ever only vote for blocks that are fully available, without needing to download all of the data. To achieve this, we can require a sufficiently high amount of sampling to be completed before ever voting for a block. We refer to this as the <em>tight fork-choice</em>. In PeerDAS, this would mean that validators are required to perform peer sampling immediately upon receiving a block, and cannot vote for it without completing it. This gives us a useful property, which we call <em><span class=\"math\">\\delta</span>-safety of sampling</em>, for some <span class=\"math\">\\delta \\in [0,1/2]</span> dependent on the amount of sampling (<span class=\"math\">\\delta \\to 0</span> as number of samples increases)</p>\n<blockquote>\n<p><span class=\"math\">\\delta</span>-safety of sampling: If some data is less than half-available, at most a fraction <span class=\"math\">\\delta</span> of the honest validators will perceive it as available. As a consequence, no more than a fraction <span class=\"math\">\\delta</span> of the honest validators would vote for an unavailable block.</p>\n</blockquote>\n<h2><a name=\"trailing-fork-choice-3\" class=\"anchor\" href=\"https://ethresear.ch#trailing-fork-choice-3\"></a>Trailing fork-choice</h2>\n<p>However, to avoid additional steps between the distribution of blocks and columns and voting, one might consider relaxing this requirement, with the goal of taking peer sampling out of the critical path. Specifically, <a href=\"https://ethresear.ch/t/peerdas-a-simpler-das-approach-using-battle-tested-p2p-components/16541#a-note-on-fork-choice-14\">it has been proposed</a>, and <a href=\"https://github.com/ethereum/consensus-specs/issues/3652\" rel=\"noopener nofollow ugc\">is still being discussed</a>, that validators could forego completing the peer sampling process before casting a vote for the currently proposed block, and postpone it until the next slot (or even further in the future). Instead, they would base their vote on the outcome of the column distribution; if all the data within its assigned subnets is available, a validator deems the entire block available and votes accordingly. Peer sampling for this block would then only be required to be completed before the next slot. We refer to this as <em>the trailing fork-choice</em>.</p>\n<p>Using the trailing fork-choice does not necessarily mean entirely giving up on <span class=\"math\">\\delta</span>-safety of sampling, even during the “trailing period”. In fact, incorporating a sufficient amount of <a href=\"https://ethresear.ch/t/subnetdas-an-intermediate-das-approach/17169\"><em>subnet sampling</em></a> in the column distribution phase allows us to preserve some level of <span class=\"math\">\\delta</span>-safety. In practice, we will do less subnet sampling than we would peer sampling, because subnet sampling is more bandwidth intensive due to the gossip amplification factor it incurs. Therefore, the <span class=\"math\">\\delta</span>-safety from subnet sampling will be for a higher <span class=\"math\">\\delta</span> than for peer sampling, meaning that a higher percentage of honest validators can be tricked into voting incorrectly.</p>\n<p>When discussing the trailing fork-choice in the rest of the document, we are going to use <span class=\"math\">\\delta_p</span> to refer to the <span class=\"math\">\\delta</span>-safety of peer sampling, and <span class=\"math\">\\delta_s</span> to refer to that of subnet sampling. We also going to assume that <span class=\"math\">\\delta_s \\gg \\delta_p</span>, i.e., that the safety loss from peer sampling is negligible compared to the safety loss from subnet sampling.</p>\n\n<h2><a name=\"attacks-4\" class=\"anchor\" href=\"https://ethresear.ch#attacks-4\"></a>Attacks</h2>\n<h3><a name=\"refresher-ex-ante-reorgs-5\" class=\"anchor\" href=\"https://ethresear.ch#refresher-ex-ante-reorgs-5\"></a>Refresher: Ex-ante reorgs</h3>\n<p>Ex-ante reorg attacks are a <a href=\"https://arxiv.org/pdf/2302.11326\" rel=\"noopener nofollow ugc\">well-known</a> threat to the current Ethereum consensus protocol. An adversary controlling a significant fraction of validators can influence the blockchain’s canonical chain through strategic block withholding. In this attack, the adversary privately constructs blocks and orchestrates votes among its validators across multiple slots, ultimately outvoting honest blocks upon their release. This can happen either by overcoming proposer boost with a well-timed release of the withheld blocks and attestations, or by directly overcoming the votes of honest validators.</p>\n<p>We now show an instance of the former strategy, where adversarial blocks <span class=\"math\">B</span> and <span class=\"math\">C</span> are withheld together with adversarial attestations comprising 21% of each committee. An honest proposer extends block <span class=\"math\">A</span> with block <span class=\"math\">D</span>, and the adversary then reveals the withheld objects before the attestation deadline. Since the adversarial votes outweigh proposer boost, the honest block does not get voted and is orphaned.</p>\n\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/8/4/84b2e4a3709361e8d59950234884b8efc69ca94d.png\" data-download-href=\"https://ethresear.ch/uploads/default/84b2e4a3709361e8d59950234884b8efc69ca94d\" title=\"\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/8/4/84b2e4a3709361e8d59950234884b8efc69ca94d_2_690x230.png\" alt=\"\" data-base62-sha1=\"iVUiM6YAuJbuLjxCcmMKSZN6SId\" role=\"presentation\" width=\"690\" height=\"230\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/8/4/84b2e4a3709361e8d59950234884b8efc69ca94d_2_690x230.png, https://ethresear.ch/uploads/default/optimized/3X/8/4/84b2e4a3709361e8d59950234884b8efc69ca94d_2_1035x345.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/8/4/84b2e4a3709361e8d59950234884b8efc69ca94d_2_1380x460.png 2x\" data-dominant-color=\"F4F6F1\"></a></div><p></p>\n<p>These attacks remain viable even with the addition of DAS, and in fact can become more effective because of it, as we discuss in the upcoming sections.</p>\n<h3><a name=\"proposer-sees-unavailable-attesters-see-available-enhanced-ex-ante-reorgs-6\" class=\"anchor\" href=\"https://ethresear.ch#proposer-sees-unavailable-attesters-see-available-enhanced-ex-ante-reorgs-6\"></a>Proposer sees <em>unavailable</em>, attesters see <em>available</em>: enhanced ex-ante reorgs</h3>\n<h4><a name=\"with-the-tight-fork-choice-7\" class=\"anchor\" href=\"https://ethresear.ch#with-the-tight-fork-choice-7\"></a>With the tight fork-choice</h4>\n<p>The adversary is able to somewhat strengthen the ex-ante reorg attack from the previous section, by leveraging the fraction <span class=\"math\">\\delta</span> of honest validators which it can trick into thinking that an unavailable block is available. It proceeds as following:</p>\n<ol>\n<li>Instead of completely withholding block <span class=\"math\">B</span>, the adversary publishes it but does not fully publish the associated data. It does so in such a way that it maximizes the amount of honest validators whose subnet sampling is successful, and thus who think that B is available.</li>\n<li>Therefore, <span class=\"math\">\\delta</span> such validators vote for <span class=\"math\">B</span>, joining the <span class=\"math\">\\beta</span> adversarial validators.</li>\n<li>The adversary then extends <span class=\"math\">B</span> with another block <span class=\"math\">C</span>, itself fully available. Again, <span class=\"math\">\\delta</span> honest validators and <span class=\"math\">\\beta</span> adversarial validators vote for <span class=\"math\">C</span></li>\n<li>This continues until an honest slot, whose proposer attempts to fork <span class=\"math\">B</span> out (unless they happen to be in the <span class=\"math\">\\delta</span> which see it as available). At this point, the adversary makes <span class=\"math\">B</span> available, and the honest proposal does not get voted if the votes on the adversarial chain overcome the proposer boost.</li>\n</ol>\n<p>Compared to the previous attack, the adversary gains an extra <span class=\"math\">\\delta</span> per slot. It is therefore important to do enough sampling to keep <span class=\"math\">\\delta</span> low.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/c/d/cddc68f29f049beb3c25464648d8c51340f11d41.png\" data-download-href=\"https://ethresear.ch/uploads/default/cddc68f29f049beb3c25464648d8c51340f11d41\" title=\"\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/c/d/cddc68f29f049beb3c25464648d8c51340f11d41_2_690x227.png\" alt=\"\" data-base62-sha1=\"tn86FyT7EhtWKxyE7j1dccmNTY5\" role=\"presentation\" width=\"690\" height=\"227\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/c/d/cddc68f29f049beb3c25464648d8c51340f11d41_2_690x227.png, https://ethresear.ch/uploads/default/optimized/3X/c/d/cddc68f29f049beb3c25464648d8c51340f11d41_2_1035x340.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/c/d/cddc68f29f049beb3c25464648d8c51340f11d41_2_1380x454.png 2x\" data-dominant-color=\"F1F6EE\"></a></div><p></p>\n<h4><a name=\"with-the-trailing-fork-choice-8\" class=\"anchor\" href=\"https://ethresear.ch#with-the-trailing-fork-choice-8\"></a>With the trailing fork-choice</h4>\n<p>As already mentioned, here we are going to assume that <span class=\"math\">\\delta_p \\ll \\delta_s</span> and only worry about the effect of <span class=\"math\">\\delta_s</span>. The adversary is only able to exploit <span class=\"math\">\\delta_s</span> <em>during the trailing period</em>. With a trailing period of one slot, it can at most add a single <span class=\"math\">\\delta_s</span> to its attack budget.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/c/9/c9feb4d9369e37cf736b329f4fc213e5e197c18c.png\" data-download-href=\"https://ethresear.ch/uploads/default/c9feb4d9369e37cf736b329f4fc213e5e197c18c\" title=\"\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/c/9/c9feb4d9369e37cf736b329f4fc213e5e197c18c_2_690x247.png\" alt=\"\" data-base62-sha1=\"sOVG0EEvuuLQFHjw5esyTZu4SMQ\" role=\"presentation\" width=\"690\" height=\"247\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/c/9/c9feb4d9369e37cf736b329f4fc213e5e197c18c_2_690x247.png, https://ethresear.ch/uploads/default/optimized/3X/c/9/c9feb4d9369e37cf736b329f4fc213e5e197c18c_2_1035x370.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/c/9/c9feb4d9369e37cf736b329f4fc213e5e197c18c_2_1380x494.png 2x\" data-dominant-color=\"F4F7F1\"></a></div><p></p>\n<p>This attack informs the need to do enough subnet sampling that ex ante reorgs attack do not become significantly easier. For example, if <span class=\"math\">\\delta_s</span> is 20%, a 10% attacker could do such a reorg about 100 times a day, instead of only about once a day. Even worse, <a href=\"https://github.com/ethereum/consensus-specs/blob/d29581315579d37064abf21b174750f9d5c099c0/specs/_features/eip7594/das-core.md#custody-setting\" rel=\"noopener nofollow ugc\">with the current parameters of the PeerDAS spec</a>, an attacker controlling a single proposer can perform a reorg! This is because <code>CUSTODY_REQUIREMENT</code>, the minimum number of subnets that a validator participates in, is set to 1, which makes <span class=\"math\">\\delta_s</span> nearly 50%. For example, the attacker can make the data available in 15 out of the 32 subnets, and convince all validators in those subnets to vote for their unavailable block, overcoming proposer boost.</p>\n<h5><a name=\"mitigation-9\" class=\"anchor\" href=\"https://ethresear.ch#mitigation-9\"></a>Mitigation</h5>\n<p>As already discussed <a href=\"https://ethresear.ch/t/from-4844-to-danksharding-a-path-to-scaling-ethereum-da/18046#possible-fork-choice-attack-vectors-9\">here</a>, this attack vector can be mitigated by attesters of slot <span class=\"math\">n+1</span> complete peer sampling 10s into slot <span class=\"math\">n</span>, while the proposer can keep trying to sample until they propose. If the proposer extends a block which an attester sees as unavailable, they try to sample again. This is in spirit much like <a href=\"https://ethresear.ch/t/view-merge-as-a-replacement-for-proposer-boost/13739\">view-merge</a>, but does not require any extra message in the proposal. In the previously described attacks, this mitigation would make it so that the attesters of slot 4 do not see <span class=\"math\">B</span> as available <em>unless the proposer of <span class=\"math\">D</span> does as well</em>: either the proposer sees <span class=\"math\">B</span> as available and <span class=\"math\">D</span> extends <span class=\"math\">C</span>, or the proposer sees <span class=\"math\">B</span> as unavailable <em>and so do attesters</em>. In either case, they vote for <span class=\"math\">D</span>.</p>\n<p>This mitigation has the downside of worsening the timing assumptions around peer sampling, reducing the benefits of the trailing fork-choice. Still, if this was the only fork-choice problem caused by DAS, we might be ok with solving it this way and otherwise keeping things as is. The next attack does not seem to have such a simple mitigation, and motivates our desire to move to the <em>(block, slot)</em> fork-choice to more effectively address the attack vectors related to (un)availability.</p>\n<h3><a name=\"proposer-sees-available-attesters-see-unavailable-10\" class=\"anchor\" href=\"https://ethresear.ch#proposer-sees-available-attesters-see-unavailable-10\"></a>Proposer sees <em>available</em>, attesters see <em>unavailable</em></h3>\n<h4><a name=\"targeted-data-release-11\" class=\"anchor\" href=\"https://ethresear.ch#targeted-data-release-11\"></a>Targeted data release</h4>\n<p>The attack is going to rely on being able to convince an honest proposer that an unavailable block is available, <em>even after it performs peer sampling for it</em>. How realistic this assumption is depends on how exactly peer sampling is performed. For example, suppose that nodes whose sampling queries fail just try again with other peers. Then, if the adversary wants to target a specific proposer, it has to:</p>\n<ol>\n<li>Link the proposer’s validator identity to a node</li>\n<li>Ensure that it controls at least one peer of the node, and advertise that it custodies all of the columns</li>\n<li>Make all of the data unavailable</li>\n<li>Wait for the node to send sampling query to the peer it controls, after having failed with other peers, and respond to all of them.</li>\n</ol>\n<h4><a name=\"tricking-an-honest-proposer-into-extending-an-unavailable-chain-12\" class=\"anchor\" href=\"https://ethresear.ch#tricking-an-honest-proposer-into-extending-an-unavailable-chain-12\"></a>Tricking an honest proposer into extending an unavailable chain</h4>\n<p>Given this capability, the adversary can manipulate an honest proposer into extending an unavailable chain, leading to their block being reorged. <em>In this scenario, we only assume that the adversary controls two successive proposers</em>, in this case for slots 2 and 3, respectively. The sequence of events unfolds as follows:</p>\n<ol>\n<li>The adversary only publishes a single unavailable block <span class=\"math\">B</span> during slot 2 and does not publish any block in slot 3.</li>\n<li>Importantly, the adversary convinces the proposer for slot 4 that <span class=\"math\">B</span> is available. As a result, the proposer for slot 4 does not attempt to reorg <span class=\"math\">B</span> through a <a href=\"https://github.com/ethereum/consensus-specs/pull/3034\" rel=\"noopener nofollow ugc\">proposer boost reorging</a> for the following reasons:\n<ul>\n<li>The proposer perceives <span class=\"math\">B</span> as available.</li>\n<li>Even if <span class=\"math\">B</span> does not receive any votes, the proposer boost reorging mechanism does not currently attempt reorgs that span more than one slot (as a liveness protection).</li>\n</ul>\n</li>\n<li>As a result:\n<ul>\n<li>Since all other validators see <span class=\"math\">B</span> as unavailable, they continue to vote for <span class=\"math\">A</span>.</li>\n<li>The proposer for slot 5 extends <span class=\"math\">A</span> with <span class=\"math\">D</span>, effectively reorging the honest and available block <span class=\"math\">C</span>.</li>\n</ul>\n</li>\n</ol>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/6/9/69d01104b892c87145507660d3e466307f2767f2.png\" data-download-href=\"https://ethresear.ch/uploads/default/69d01104b892c87145507660d3e466307f2767f2\" title=\"\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/6/9/69d01104b892c87145507660d3e466307f2767f2_2_690x357.png\" alt=\"\" data-base62-sha1=\"f63UInx6xKPuF8xoF6egt0yJYoW\" role=\"presentation\" width=\"690\" height=\"357\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/6/9/69d01104b892c87145507660d3e466307f2767f2_2_690x357.png, https://ethresear.ch/uploads/default/optimized/3X/6/9/69d01104b892c87145507660d3e466307f2767f2_2_1035x535.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/6/9/69d01104b892c87145507660d3e466307f2767f2_2_1380x714.png 2x\" data-dominant-color=\"F5FBF5\"></a></div><p></p>\n<p>The attack could even target multiple honest proposers in a row, leading to all of their blocks being orphaned! This is particularly serious given that the attacker does not need to control a significant amount of stake to pull this off.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/5/8/58bd729c0b54244e6513f1924747003c590d64db.png\" data-download-href=\"https://ethresear.ch/uploads/default/58bd729c0b54244e6513f1924747003c590d64db\" title=\"\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/5/8/58bd729c0b54244e6513f1924747003c590d64db_2_690x351.png\" alt=\"\" data-base62-sha1=\"cF1UfjMuWBXu7Ng5j5ji5f4Bvon\" role=\"presentation\" width=\"690\" height=\"351\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/5/8/58bd729c0b54244e6513f1924747003c590d64db_2_690x351.png, https://ethresear.ch/uploads/default/optimized/3X/5/8/58bd729c0b54244e6513f1924747003c590d64db_2_1035x526.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/5/8/58bd729c0b54244e6513f1924747003c590d64db_2_1380x702.png 2x\" data-dominant-color=\"F4FBF4\"></a></div><p></p>\n<h2><a name=\"block-slot-fork-choice-13\" class=\"anchor\" href=\"https://ethresear.ch#block-slot-fork-choice-13\"></a>(block-slot) fork-choice</h2>\n<p>The attacks discussed above can be effectively addressed by employing a variation of the fork-choice rule known as the (block, slot) fork-choice function. This modification, proposed <a href=\"https://github.com/ethereum/consensus-specs/pull/2197\" rel=\"noopener nofollow ugc\">a few years ago</a>, is specifically designed to account for attestations associated with <em>empty slots</em>. At any given slot <span class=\"math\">t</span>, considering a proposal <span class=\"math\">B</span> extending the head of the canonical chain <span class=\"math\">A</span>, we also take into account the empty slot identified by <span class=\"math\">A</span>. To clarify, with this modification, we consider votes for a block <span class=\"math\">A</span> as votes for pairs (block, slot) (rather than just votes for block <span class=\"math\">A</span>).</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/c/a/ca8ed21df874838328758b89a3fbd77b2e0897d0.png\" data-download-href=\"https://ethresear.ch/uploads/default/ca8ed21df874838328758b89a3fbd77b2e0897d0\" title=\"\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/c/a/ca8ed21df874838328758b89a3fbd77b2e0897d0_2_690x381.png\" alt=\"\" data-base62-sha1=\"sTUrlEXOZ2W3qmI9wceLzoNkwj6\" role=\"presentation\" width=\"690\" height=\"381\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/c/a/ca8ed21df874838328758b89a3fbd77b2e0897d0_2_690x381.png, https://ethresear.ch/uploads/default/optimized/3X/c/a/ca8ed21df874838328758b89a3fbd77b2e0897d0_2_1035x571.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/c/a/ca8ed21df874838328758b89a3fbd77b2e0897d0_2_1380x762.png 2x\" data-dominant-color=\"FBFBFB\"></a></div><p></p>\n<p>In the figure above, we show the difference between the current fork-choice (left) and the (block, slot) fork-choice (right), in the case when a block <span class=\"math\">B</span> is proposed a bit late. Essentially, this approach enables us to concurrently consider both <span class=\"math\">(B,t+1)</span> and <span class=\"math\">(A,t+1)</span> at slot <span class=\"math\">t+1</span>. This effectively mitigates the attacks discussed earlier, as we show below.</p>\n<h3><a name=\"revisiting-the-last-attack-14\" class=\"anchor\" href=\"https://ethresear.ch#revisiting-the-last-attack-14\"></a>Revisiting the last attack</h3>\n<p>Consider the following scenario (which is the starting point of the attack <strong>Proposer sees available, attesters see unavailable</strong>):</p>\n<ol>\n<li>Block <span class=\"math\">A</span> is a fully available block assigned to slot <span class=\"math\">t</span>.</li>\n<li>Block <span class=\"math\">B</span>, on the other hand, is unavailable but appears available to a few validators due to adversary manipulation.</li>\n</ol>\n<p>Following the current fork-choice function, during slot <span class=\"math\">t+1</span>:</p>\n<ol>\n<li>The majority of validators recognize <span class=\"math\">B</span> as unavailable and consequently vote for <span class=\"math\">A</span>.</li>\n<li>A minority of validators cast their votes for <span class=\"math\">B</span>.</li>\n</ol>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/8/d/8d16ac21fce958d43583605625e57fb83dcb2721.png\" data-download-href=\"https://ethresear.ch/uploads/default/8d16ac21fce958d43583605625e57fb83dcb2721\" title=\"\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/8/d/8d16ac21fce958d43583605625e57fb83dcb2721_2_476x500.png\" data-base62-sha1=\"k87TIEntrupil7mtePDykP5D6q5\" alt=\"\" width=\"476\" height=\"500\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/8/d/8d16ac21fce958d43583605625e57fb83dcb2721_2_476x500.png, https://ethresear.ch/uploads/default/optimized/3X/8/d/8d16ac21fce958d43583605625e57fb83dcb2721_2_714x750.png 1.5x, https://ethresear.ch/uploads/default/original/3X/8/d/8d16ac21fce958d43583605625e57fb83dcb2721.png 2x\" data-dominant-color=\"FCFCFC\"></a></div><p></p>\n<p>By introducing the (block,slot) fork-choice function, the majority of validators would then effectively vote for the pair <span class=\"math\">(A,t+1)</span>.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/c/7/c72faacf4a867710311217a025f904385fbf8daf.jpeg\" data-download-href=\"https://ethresear.ch/uploads/default/c72faacf4a867710311217a025f904385fbf8daf\" title=\"Block Availability Diagram\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/c/7/c72faacf4a867710311217a025f904385fbf8daf_2_521x500.jpeg\" data-base62-sha1=\"sq58SnzglRUOxjtO88jt2ITQtkj\" alt=\"Block Availability Diagram\" width=\"521\" height=\"500\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/c/7/c72faacf4a867710311217a025f904385fbf8daf_2_521x500.jpeg, https://ethresear.ch/uploads/default/optimized/3X/c/7/c72faacf4a867710311217a025f904385fbf8daf_2_781x750.jpeg 1.5x, https://ethresear.ch/uploads/default/optimized/3X/c/7/c72faacf4a867710311217a025f904385fbf8daf_2_1042x1000.jpeg 2x\" data-dominant-color=\"FCFCFC\"></a></div><p></p>\n<p>Continuing the sequence of events in the attack, at slot <span class=\"math\">t+2</span>, the adversary abstains from proposing any block. Consequently, the majority of validators will opt to vote for <span class=\"math\">A</span> which effectively means voting for the pair <span class=\"math\">(A, t+2)</span>.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/f/9/f9ebb54f7e36792f39c1947864807bfb983729b0.jpeg\" data-download-href=\"https://ethresear.ch/uploads/default/f9ebb54f7e36792f39c1947864807bfb983729b0\" title=\"\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/f/9/f9ebb54f7e36792f39c1947864807bfb983729b0_2_690x481.jpeg\" alt=\"\" data-base62-sha1=\"zETTlDBmXzAXk9wN1VHferfJIR2\" role=\"presentation\" width=\"690\" height=\"481\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/f/9/f9ebb54f7e36792f39c1947864807bfb983729b0_2_690x481.jpeg, https://ethresear.ch/uploads/default/optimized/3X/f/9/f9ebb54f7e36792f39c1947864807bfb983729b0_2_1035x721.jpeg 1.5x, https://ethresear.ch/uploads/default/optimized/3X/f/9/f9ebb54f7e36792f39c1947864807bfb983729b0_2_1380x962.jpeg 2x\" data-dominant-color=\"FCFCFC\"></a></div><p></p>\n<p>At this point, although the adversary makes the honest proposer for slot <span class=\"math\">t+3</span> believes that <span class=\"math\">B</span> is available, such proposer would still extend <span class=\"math\">A</span> since the chain <span class=\"math\">(A,t+2)</span> is heavier compared to the chain with head <span class=\"math\">(B,t+1)</span>.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/4/9/494fcc892e75772d9ff62e59f9ce7a258450d343.jpeg\" data-download-href=\"https://ethresear.ch/uploads/default/494fcc892e75772d9ff62e59f9ce7a258450d343\" title=\"\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/4/9/494fcc892e75772d9ff62e59f9ce7a258450d343_2_690x369.jpeg\" alt=\"\" data-base62-sha1=\"asxP4R1kRKvqxrHQvZPoTj9yfh9\" role=\"presentation\" width=\"690\" height=\"369\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/4/9/494fcc892e75772d9ff62e59f9ce7a258450d343_2_690x369.jpeg, https://ethresear.ch/uploads/default/optimized/3X/4/9/494fcc892e75772d9ff62e59f9ce7a258450d343_2_1035x553.jpeg 1.5x, https://ethresear.ch/uploads/default/optimized/3X/4/9/494fcc892e75772d9ff62e59f9ce7a258450d343_2_1380x738.jpeg 2x\" data-dominant-color=\"FBFBFB\"></a></div><p></p>\n<h3><a name=\"block-slot-spec-15\" class=\"anchor\" href=\"https://ethresear.ch#block-slot-spec-15\"></a>(block, slot) spec</h3>\n<p>Take a block <span class=\"math\">A</span> proposed by the block proposer for slot <span class=\"math\">t</span> and a vote <span class=\"math\">v</span> for block <span class=\"math\">A</span> cast in slot <span class=\"math\">t+d</span>. Then, <span class=\"math\">v</span> is considered as a vote for any of the tuples <span class=\"math\">\\{(A,t),(A,t+1),\\cdots,(A,t+d)\\}</span>, because <span class=\"math\">v</span> states that the head of the canonical chain is <span class=\"math\">A</span> in all of those slots.</p>\n<p>Consequently, the fork-choice function also proceeds by (block, slot) rather than just by blocks.<br>\nSpecifically, the children of <span class=\"math\">(A,t)</span> are all those (block, slot) pairs <span class=\"math\">(B,t+1)</span> where <span class=\"math\">B</span> is either <span class=\"math\">A</span> or a child of <span class=\"math\">A</span>. This means that in this context, <span class=\"math\">(A,t+1)</span> is considered a child of <span class=\"math\">(A,t)</span>. Therefore, votes cast in support of any child of <span class=\"math\">A</span> are now weighed against votes cast in support of the <em>empty slot</em> <span class=\"math\">(A, t+1)</span>. The fork-choice proceeds in this way until it reaches the current slot, at which point, it outputs the block of the head (block, slot) pair. Note that by the way we have defined things, the support of the pair <span class=\"math\">(A,t+d)</span> includes all votes cast for any block <span class=\"math\">C</span> that is both descendant of <span class=\"math\">A</span> and proposed in a slot higher than <span class=\"math\">t+d</span>, but such that its chain does not include any block proposed in slot <span class=\"math\">t+d</span>.</p>\n<p>We illustrate this in the following figure. On the left it’s the actual block tree with attestations. On the right it’s the block tree as it is interpreted when running the fork-choice. At slot <span class=\"math\">t+1</span>, the choice is between <span class=\"math\">(B,t+1)</span> and <span class=\"math\">(A,t+1)</span>, and the weight of the latter is made up of attestations to <span class=\"math\">A</span> in slots <span class=\"math\">\\ge t+1</span> (the green and orange ones) and attestations to <span class=\"math\">C</span> at slot <span class=\"math\">t+2</span> (the yellow ones), since these also indicate that <span class=\"math\">A</span> is the head at slot <span class=\"math\">t+1</span>.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/f/f/ffbba585b63cf2fee3497800f6be629976103156.png\" data-download-href=\"https://ethresear.ch/uploads/default/ffbba585b63cf2fee3497800f6be629976103156\" title=\"\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/f/f/ffbba585b63cf2fee3497800f6be629976103156_2_690x442.png\" alt=\"\" data-base62-sha1=\"AujMIXyJM4rTJRuIsNLYuXrpnAW\" role=\"presentation\" width=\"690\" height=\"442\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/f/f/ffbba585b63cf2fee3497800f6be629976103156_2_690x442.png, https://ethresear.ch/uploads/default/optimized/3X/f/f/ffbba585b63cf2fee3497800f6be629976103156_2_1035x663.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/f/f/ffbba585b63cf2fee3497800f6be629976103156_2_1380x884.png 2x\" data-dominant-color=\"FAFAFA\"></a></div><p></p>\n<p><a href=\"https://github.com/ethereum/consensus-specs/compare/dev...fradamt:consensus-specs:block-slot\" rel=\"noopener nofollow ugc\">Here</a> is an early attempt at a simple specification of the (block, slot) fork-choice. The loop in <code>get_head</code> is modified to proceed slot by slot. At each slot the heaviest child of the current <code>head</code>, <code>best_child</code>, is compared against <code>empty_slot_weight</code>, the weight of “the subtree rooted at the empty slot”, which is computed by <code>get_empty_slot_weight</code> by interpreting votes as explained above. We include here the modified <code>get_head</code> and the important part of <code>get_empty_slot_weight</code> (in both cases, other than for removing the parts related to the backoff logic, which we discuss later).</p>\n<pre><code class=\"lang-python\">def get_head(store: Store) -&gt; Root:\n    # Get filtered block tree that only includes viable branches\n    blocks = get_filtered_block_tree(store)\n    # Execute the LMD-GHOST fork choice\n    head = store.justified_checkpoint.root\n    slot = Slot(blocks[head].slot + 1)\n    while slot &lt;= get_current_slot(store):\n        children = [\n            root for root in blocks.keys()\n            if (blocks[root].parent_root == head\n                and blocks[root].slot == slot)\n        ]\n        if len(children) &gt; 0:\n            best_child = max(children, key=lambda root: (get_weight(store, root), root))\n            best_child_weight = get_weight(store, best_child)\n            empty_slot_weight = get_empty_slot_weight(store, head, slot)\n            if best_child_weight &gt;= empty_slot_weight:\n                head = best_child\n        slot = Slot(slot + 1)\n    return head\n\ndef get_empty_slot_weight(store: Store, \n                          root: Root, \n                          slot: Slot) -&gt; Gwei:\n    ...\n    attestation_score = Gwei(sum(\n        state.validators[i].effective_balance for i in unslashed_and_active_indices\n        if (i in store.latest_messages\n            and i not in store.equivocating_indices\n            and (\n                (store.latest_messages[i].root == root\n                 and store.latest_messages[i].slot &gt;= slot\n                or (store.latest_messages[i].slot &gt; slot\n                    and not store.latest_messages[i].root == root\n                    and get_ancestor(store, store.latest_messages[i].root, slot) == root\n                    )\n            ))))\n    ...\n    return attestation_score + proposer_score\n</code></pre>\n<h3><a name=\"backoff-scheme-16\" class=\"anchor\" href=\"https://ethresear.ch#backoff-scheme-16\"></a>Backoff scheme</h3>\n<p>One of the disadvantages of the current proposal is that the performance under bad network conditions becomes worse. Chain growth stops completely if block latency is &gt; <code>SECONDS_PER_SLOT / 3</code> (= 4 seconds in the current config).</p>\n<p>Therefore, a <em>backoff</em> scheme is necessary to facilitate chain progression during periods of extended latency. Without such a mechanism, the chain would continuously build on the same (empty) block, resulting in a sequence of empty blocks and an inability to extend the chain with non-empty ones.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/b/2/b2ec5b729fd1162a23940f6ed1592be4519ce4f7.png\" data-download-href=\"https://ethresear.ch/uploads/default/b2ec5b729fd1162a23940f6ed1592be4519ce4f7\" title=\"\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/b/2/b2ec5b729fd1162a23940f6ed1592be4519ce4f7_2_690x381.png\" alt=\"\" data-base62-sha1=\"pwPnJgvsiO1CwJXJPOD0FJVkvRl\" role=\"presentation\" width=\"690\" height=\"381\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/b/2/b2ec5b729fd1162a23940f6ed1592be4519ce4f7_2_690x381.png, https://ethresear.ch/uploads/default/optimized/3X/b/2/b2ec5b729fd1162a23940f6ed1592be4519ce4f7_2_1035x571.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/b/2/b2ec5b729fd1162a23940f6ed1592be4519ce4f7_2_1380x762.png 2x\" data-dominant-color=\"FAF9FB\"></a></div><p></p>\n<p>The backoff scheme is devised to alleviate prolonged periods of empty blocks within the chain. When such instances occur, the scheme intervenes by aiding potential non-empty blocks in accumulating the necessary attestations. As these supported blocks successfully advance the chain, the backoff mechanism is gradually deactivated. This gradual deactivation process continues until the system reaches a state where the backoff mechanism is no longer necessary.</p>\n<p>The activation and deactivation of the backoff mechanism are represented by the <code>backoff_status</code>, which is created and updated within <code>get_head</code>. Crucially, if two honest validators are on the same path while executing <code>get_head</code>, they will share identical backoff statuses. This means that, under synchrony, for honest validators selecting the same branch of the block tree, the backoff mechanism is synchronized, activating and deactivating simultaneously. In the spec linked above, <em>an active backoff has the effect of delaying by one slot the counting of votes for the empty slot</em>: votes for <span class=\"math\">A</span> only count for the empty slot <span class=\"math\">(A,s)</span> if they are <em>at least from slot <span class=\"math\">s+1</span></em>. In other words, we take all votes <em>directly</em> for empty slots and move them back by one slot: votes to <span class=\"math\">(A,t+1)</span> count for <span class=\"math\">(A,t)</span>, votes for <span class=\"math\">(A,t+2)</span> count for <span class=\"math\">(A,t+1)</span> etc… For example, look at the green attestations, which vote for <span class=\"math\">A</span> at slot <span class=\"math\">t+1</span>. When the backoff is not active, these contribute weight to <span class=\"math\">(A,t+1)</span> (more precisely, are counted by <code>get_empty_slot_weight</code> when run at slot <span class=\"math\">t+1</span> with <span class=\"math\">A</span> being <code>head</code>), but when the backoff is active they go back to only contributing to <span class=\"math\">(A,t)</span>. Same goes for the orange attestations to <span class=\"math\">(A,t+2)</span>, which only contribute to <span class=\"math\">(A,t+1)</span> when the backoff is active.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/1/d/1d83659c84d77e80dfbd0579a3b7a776c1f25faa.png\" data-download-href=\"https://ethresear.ch/uploads/default/1d83659c84d77e80dfbd0579a3b7a776c1f25faa\" title=\"\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/1/d/1d83659c84d77e80dfbd0579a3b7a776c1f25faa_2_690x304.png\" alt=\"\" data-base62-sha1=\"4d5mwjp8bogYY1MVjwaUqzrKxUS\" role=\"presentation\" width=\"690\" height=\"304\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/1/d/1d83659c84d77e80dfbd0579a3b7a776c1f25faa_2_690x304.png, https://ethresear.ch/uploads/default/optimized/3X/1/d/1d83659c84d77e80dfbd0579a3b7a776c1f25faa_2_1035x456.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/1/d/1d83659c84d77e80dfbd0579a3b7a776c1f25faa_2_1380x608.png 2x\" data-dominant-color=\"F9F9F9\"></a></div><p></p>\n<p>In the next figure, network latency is high, and all block proposals are late by a few seconds, so they never get any votes. At first, this leads to <span class=\"math\">B</span> being orphaned, because all votes go to <span class=\"math\">(A,t+1)</span>. For simplicity, we assume that the backoff immediately activates on that branch. In slot <span class=\"math\">t+2</span>, <span class=\"math\">C</span> is also late, and all votes again go to <span class=\"math\">A</span>. Due to the backoff being active, these votes do not count for <span class=\"math\">(A,t+2)</span> but only for <span class=\"math\">(A,t+1)</span>, so <span class=\"math\">C</span> is still the head of the chain, and is voted in the next slot. Again, because the backoff is active, those votes only count for <span class=\"math\">(C,t+2)</span> and not for <span class=\"math\">(C,t+3)</span>, i.e., they do not count “against” <span class=\"math\">D</span>, the block proposed at slot <span class=\"math\">t+3</span>. In order for a block to get orphaned, it now needs to be <em>one whole slot late</em>: votes for <span class=\"math\">A</span> at slot <span class=\"math\">t+3</span> would count for <span class=\"math\">(A,t+2)</span> and thus against <span class=\"math\">C</span>, but there will be no such votes as long as <span class=\"math\">C</span> arrives before slot <span class=\"math\">t+3</span>.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/9/5/95acaec4f5b3d5a1b4e2e92602279fba6cab09fa.png\" data-download-href=\"https://ethresear.ch/uploads/default/95acaec4f5b3d5a1b4e2e92602279fba6cab09fa\" title=\"\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/9/5/95acaec4f5b3d5a1b4e2e92602279fba6cab09fa_2_690x345.png\" alt=\"\" data-base62-sha1=\"lm574rIdlaC6sXNfasnMA8s5blw\" role=\"presentation\" width=\"690\" height=\"345\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/9/5/95acaec4f5b3d5a1b4e2e92602279fba6cab09fa_2_690x345.png, https://ethresear.ch/uploads/default/optimized/3X/9/5/95acaec4f5b3d5a1b4e2e92602279fba6cab09fa_2_1035x517.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/9/5/95acaec4f5b3d5a1b4e2e92602279fba6cab09fa_2_1380x690.png 2x\" data-dominant-color=\"FAFAFB\"></a></div><p></p>\n<p>The specific mechanism to activate the backoff scheme are still a work in progress, and the spec modification has been written so that all of the relevant logic is confined to <code>update_backoff_status</code>, called at the end of each iteration of the loop in <code>get_head</code>.</p>\n<h3><a name=\"attacks-to-the-das-fork-choice-with-block-slot-17\" class=\"anchor\" href=\"https://ethresear.ch#attacks-to-the-das-fork-choice-with-block-slot-17\"></a>Attacks to the DAS fork-choice with (block, slot)</h3>\n<p>By adopting the (block,slot) fork-choice function, if a block is unavailable by its attestation deadline, most honest validators will not vote for it. Instead, they will vote for the empty block. With this, we would hope to achieve a stronger property than <span class=\"math\">\\delta</span>-safety of sampling:</p>\n<blockquote>\n<p>If the validator set is <span class=\"math\">&gt; \\frac{1}{2(1-\\delta)}</span> honest and the network is synchronous, no unavailable block is ever in the canonical chain of any honest validator</p>\n</blockquote>\n<p>The reasoning seems simple: if a block <span class=\"math\">B</span> is unavailable at a given time when the fork-choice is being run, than <span class=\"math\">\\delta</span>-safety of sampling ensures that at most a fraction <span class=\"math\">\\delta</span> of the honest validators in the committee of any previous slot could have voted for it. In particular, at least <span class=\"math\">1-\\delta</span> of the honest validators of <span class=\"math\">B</span>'s proposal slot would have voted for the empty slot. If <span class=\"math\">&gt; \\frac{1}{2(1-\\delta)}</span> of the validators are honest, then this is <span class=\"math\">&gt; \\frac{1}{2}</span> of the validators, and the empty slot would have a majority and win.</p>\n<p><em>Things are unfortunately not actually so simple.</em> In the above, we have made the assumption that validators that do not vote for <span class=\"math\">B</span> will instead vote “for the empty slot”. In fact, there could be multiple “empty slots” to vote for, if there is already a chain split, for example caused by a balancing attack, as in the left figure below. The honest votes then get split among multiple branches, and an unavailable block can still “look” canonical to validators that have been tricked into seeing it as available. Another way to achieve the same thing is by equivocating with available blocks and an unavailable block, to split most of the honest votes between the available ones, instead of having them go to the empty block, as in the right figure below.</p>\n<p></p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://ethresear.ch/uploads/default/original/3X/3/3/339a3e61a64ac47087c23992f0123a283cededdf.png\" data-download-href=\"https://ethresear.ch/uploads/default/339a3e61a64ac47087c23992f0123a283cededdf\" title=\"\"><img src=\"https://ethresear.ch/uploads/default/optimized/3X/3/3/339a3e61a64ac47087c23992f0123a283cededdf_2_690x416.png\" alt=\"\" data-base62-sha1=\"7muOCOdUET2eOsOekd9nrd63PFZ\" role=\"presentation\" width=\"690\" height=\"416\" srcset=\"https://ethresear.ch/uploads/default/optimized/3X/3/3/339a3e61a64ac47087c23992f0123a283cededdf_2_690x416.png, https://ethresear.ch/uploads/default/optimized/3X/3/3/339a3e61a64ac47087c23992f0123a283cededdf_2_1035x624.png 1.5x, https://ethresear.ch/uploads/default/optimized/3X/3/3/339a3e61a64ac47087c23992f0123a283cededdf_2_1380x832.png 2x\" data-dominant-color=\"F9F9F7\"></a></div><p></p>\n<h3><a name=\"a-direction-for-further-improvement-the-majority-fork-choice-18\" class=\"anchor\" href=\"https://ethresear.ch#a-direction-for-further-improvement-the-majority-fork-choice-18\"></a>A direction for further improvement: the majority fork-choice</h3>\n<p>It is not at the moment clear whether it is possible to completely eliminate this attack vector with “known tools” (we consider the (block, slot) fork-choice such, since it has been discussed for years, though not implemented). One potentially promising direction is to do something akin to (block, slot) but even a bit more extreme: at slot <span class=\"math\">t</span> in the <code>get_head</code> loop, we could find the <code>best_child</code> and then pit it against <em>all of the voting weight from slots <span class=\"math\">\\ge t</span> which did not vote on the <code>best_child</code>’s subtree</em>. In other words, we require a block from slot <span class=\"math\">t</span> to have a majority of all attesting weight from slots <span class=\"math\">\\ge t</span>. This way, it wouldn’t matter if the adversary finds ways to split honest votes: <em>a vote is against a block whenever it could have been for it but isn’t</em>.</p>\n<p>This would very clearly gives us the stronger property we previously wished for, because an unavailable block would need to get a majority of each committee’s weight in order to win out against the empty slot. The challenge is making sure that such a change does not break anything else in subtle ways, worsen known attacks, or make it much easier to stall liveness.</p>\n<p>You can find the preliminary spec changes from the previous (block, slot) spec to the majority fork-choice <a href=\"https://github.com/ethereum/consensus-specs/commit/baece58837fcfc745443a7144f2558463d6ff5b9\" rel=\"noopener nofollow ugc\">here</a>. The important bit is that now <code>get_empty_slot_weight</code> counts weight from all attestations which could be on the subtree of <code>best_child_root</code> but are not.</p>\n<pre><code class=\"lang-python\">attestation_score = Gwei(sum(\n    state.validators[i].effective_balance for i in unslashed_and_active_indices\n    if (i in store.latest_messages\n        and i not in store.equivocating_indices\n        and store.latest_messages[i].slot &gt;= slot + 1 if is_backoff_active else 0\n        and not get_ancestor(store, store.latest_messages[i].root, slot) != best_child_root)\n))\n</code></pre>\n            <p><small>1 post - 1 participant</small></p>\n            <p><a href=\"https://ethresear.ch/t/das-fork-choice/19578\">Read full topic</a></p>","link":"https://ethresear.ch/t/das-fork-choice/19578","pubDate":"Fri, 17 May 2024 06:34:58 +0000","discourse:topicPinned":"No","discourse:topicClosed":"No","discourse:topicArchived":"No","guid":{"@isPermaLink":"false","#text":"ethresear.ch-topic-19578"},"source":{"@url":"https://ethresear.ch/t/das-fork-choice/19578.rss","#text":"DAS fork-choice"},"filter":false}]}}}